<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>è‡ªé€‚åº”å¸ƒå±€</title>
    <url>/2019/08/07/Adaptive/</url>
    <content><![CDATA[<h2 id="grid"><a href="#grid" class="headerlink" title="grid"></a>grid</h2><p>css</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.main&#123;</span><br><span class="line">        display: grid;</span><br><span class="line">        grid-template-columns:repeat(auto-fill,27rem);</span><br><span class="line">        grid-gap:3rem 1.5rem;</span><br><span class="line">&#125;       </span><br><span class="line">.main &gt; .item&#123;</span><br><span class="line">        background-color: blue;</span><br><span class="line">        width:100%;</span><br><span class="line">        height: 100px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>html</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;main&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æ•ˆæœèƒ½è®©æ¯ä¸€è¡Œéƒ½å°½é‡é“ºæ»¡</p>
<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <style>
            .main{
                display: grid;
                grid-template-columns:repeat(auto-fill,27rem);
                grid-gap:3rem 1.5rem;
            }
            .main > .item{
                  background:linear-gradient(45deg,black,transparent);
                width:100%;
                height: 100px;
            }
        </style>
    </head>
    <body>
            <div class="main">
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
                <div class="item"></div>
            </div>
    </body>
</html>

<h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><p>css</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.container&#123;</span><br><span class="line">    display: table;</span><br><span class="line">    width: 100%;</span><br><span class="line">    border-spacing: 30px 0;</span><br><span class="line">&#125;</span><br><span class="line">.container &gt;div&#123;</span><br><span class="line">    display: table-cell;</span><br><span class="line">    background-color: #00ffff;</span><br><span class="line">    border: 1px solid black;</span><br><span class="line">    height: 200px;</span><br><span class="line">    width: 25vw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;item&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;item&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;item&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;item&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <style>
            .container{
                display: table;
                width: 100%;
                border-spacing: 30px 0;
            }
            .container >.item{
                display: table-cell;
                background-color: #00ffff;
                border: 1px solid black;
                height: 200px;
                width: 25vw;
            }
        </style>
    </head>
    <body>
     <div class="container">
        <div class="item">item</div>
        <div class="item">item</div>
        <div class="item">item</div>
        <div class="item">item</div>
    </div>
    </body>
</html>

<h2 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h2><p>css</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.main&#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">    justify-content: flex-start;             </span><br><span class="line">&#125;</span><br><span class="line">.main &gt; .item&#123;</span><br><span class="line">    width: 300px;</span><br><span class="line">    background:linear-gradient(45deg,black,transparent);</span><br><span class="line">    height: 100px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<html>
    <head><meta name="generator" content="Hexo 3.9.0">
        <style>
            .main{
                display: flex;
                flex-wrap: wrap;
                justify-content: flex-start;
            }
            .main > .item{
                width: 300px;
                background:linear-gradient(45deg,black,transparent);
                height: 100px;
            }
        </style>
    </head>
    <body>
        <div class="main">
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
            <div class="item"></div>
        </div>
    </body>
</html>

<p>ä»¥ä¸‹<a href="https://juejin.im/post/5b90e07ce51d450e6a2dd140" target="_blank" rel="noopener">åŸæ–‡</a></p>
<h2 id="åª’ä½“æŸ¥è¯¢"><a href="#åª’ä½“æŸ¥è¯¢" class="headerlink" title="åª’ä½“æŸ¥è¯¢"></a>åª’ä½“æŸ¥è¯¢</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@media screen and (min-width:240px) &#123;</span><br><span class="line">    html, body, button, input, select, textarea &#123;</span><br><span class="line">        font-size:9px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width:320px) &#123;</span><br><span class="line">	html, body, button, input, select, textarea &#123;</span><br><span class="line">		font-size:12px;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// çº¢ç±³Note2</span><br><span class="line">@media screen and (min-width:360px) &#123;</span><br><span class="line">	html, body, button, input, select, textarea &#123;</span><br><span class="line">		font-size:13.5px;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width:375px) &#123;</span><br><span class="line">	html, body, button, input, select, textarea &#123;</span><br><span class="line">		font-size:14.0625px;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JSè®¾ç½®htmlçš„font-sizeå¤§å°"><a href="#JSè®¾ç½®htmlçš„font-sizeå¤§å°" class="headerlink" title="JSè®¾ç½®htmlçš„font-sizeå¤§å°"></a>JSè®¾ç½®htmlçš„font-sizeå¤§å°</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.documentElement.style.fontSize = document.documentElement.clientWidth / 750 + &apos;px&apos;;</span><br></pre></td></tr></table></figure>

<h2 id="vw"><a href="#vw" class="headerlink" title="vw"></a>vw</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//ä½¿ç”¨vwè®¾ç½®ï¼Œvwä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹å•ä½ï¼Œ100vwç­‰äºå±å¹•å®½åº¦</span><br><span class="line">html&#123;</span><br><span class="line">    font-size: 10vw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>css</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Javscriptå¤æ‚åˆ¤æ–­</title>
    <url>/2019/08/07/Javscript_complex_judge/</url>
    <content><![CDATA[<p>åœ¨å…¬å¸ç»´æŠ¤å‰äººä»£ç çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡è§ä¸€å †çš„if-elseè¯­å¥</p>
<h3 id="if-else"><a href="#if-else" class="headerlink" title="if-else"></a>if-else</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const flag = (status)=&gt;&#123;</span><br><span class="line">    if(status ==0)&#123;</span><br><span class="line">        //do somethind</span><br><span class="line">    &#125;else if(status==1)&#123;</span><br><span class="line">        //do somethind</span><br><span class="line">    &#125;else if(status ==2)&#123;</span><br><span class="line">        //do something</span><br><span class="line">    &#125;else if(status ==3)&#123;</span><br><span class="line">        //do something</span><br><span class="line">    &#125;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>æˆ–è®¸è¿˜å¯ä»¥ç”¨switch-caseçš„å†™æ³•</p>
<h3 id="switch-case"><a href="#switch-case" class="headerlink" title="switch-case"></a>switch-case</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const flag = (status)=&gt;&#123;</span><br><span class="line">    swtich(status)&#123;</span><br><span class="line">        case 0:</span><br><span class="line">            //do something</span><br><span class="line">            break;</span><br><span class="line">        case 1:</span><br><span class="line">        case 2:</span><br><span class="line">            //do something</span><br><span class="line">            break;</span><br><span class="line">        case 3:</span><br><span class="line">            //do something</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            return ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡å¦‚case 1å’Œ case 2çš„å¤„ç†æƒ…å†µéƒ½ä¸€æ ·ï¼Œå¯ä»¥åƒä¸Šé¢çš„å†™æ³•.</p>
<p>ç„¶é¹…å¦‚æœéœ€è¦åˆ¤æ–­çš„æ¡ä»¶å¤šçš„æ—¶å€™ï¼Œå¦‚æœç»§ç»­ç”¨if-elseçš„å†™æ³•ï¼Œé‚£ä¹ˆå·¥ä½œé‡ä¼šç¿»å€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const flag = (status,type)=&gt;&#123;</span><br><span class="line">    if(type==0)&#123;</span><br><span class="line">        if(status ==0)&#123;</span><br><span class="line">            //do somethind</span><br><span class="line">        &#125;else if(status==1)&#123;</span><br><span class="line">            //do somethind</span><br><span class="line">        &#125;else if(status ==2)&#123;</span><br><span class="line">            //do something</span><br><span class="line">        &#125;else if(status ==3)&#123;</span><br><span class="line">            //do something</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else if(type==1)&#123;</span><br><span class="line">         if(status ==0)&#123;</span><br><span class="line">            //do somethind</span><br><span class="line">        &#125;else if(status==1)&#123;</span><br><span class="line">            //do somethind</span><br><span class="line">        &#125;else if(status ==2)&#123;</span><br><span class="line">            //do something</span><br><span class="line">        &#125;else if(status ==3)&#123;</span><br><span class="line">            //do something</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å†™æ³•å¤ªéº»ç“œäº†å§ï¼Œç®€ç›´åäººç±»</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const actions = ()=&gt;&#123;</span><br><span class="line">    function A()&#123;</span><br><span class="line">        return &apos;A&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    function B()&#123;</span><br><span class="line">        return &apos;B&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    return new Map([</span><br><span class="line">        [&apos;0_0&apos;,A],</span><br><span class="line">        [&apos;0_1&apos;,A],</span><br><span class="line">        [&apos;0_2&apos;,B]</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line">const flag =(status ,type)=&gt;&#123;</span><br><span class="line">    const action = actions().get(`$&#123;type&#125;_$&#123;status&#125;`);</span><br><span class="line">    console.log(action());</span><br><span class="line">&#125;</span><br><span class="line">flag(0,0);//A</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å°†é€»è¾‘å°è£…èµ·æ¥ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œçœ‹èµ·æ¥å°±å¹²å‡€å¾ˆå¤šï¼ï¼ï¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const actions = ()=&gt;&#123;</span><br><span class="line">    function A()&#123;</span><br><span class="line">        return &apos;A&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    function B()&#123;</span><br><span class="line">        return &apos;B&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    return new Map([</span><br><span class="line">        [/^0_[0-3]/,A],</span><br><span class="line">        [/1_[0-2]/,A],</span><br><span class="line">        [/1_1/,B]</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line">const flag =(status ,type)=&gt;&#123;</span><br><span class="line">     const action = [...actions()].filter(([key,value])=&gt;&#123;</span><br><span class="line">        return key.test(`$&#123;type&#125;_$&#123;status&#125;`)</span><br><span class="line">    &#125;)</span><br><span class="line">    action.forEach(([_,value])=&gt;&#123;</span><br><span class="line">        console.log(&quot;value.apply(this):&quot;, value.apply(this));//A</span><br><span class="line">        value.call(this);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">flag(1,1);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ObjectKeys</title>
    <url>/2020/07/07/ObjectKeys/</url>
    <content><![CDATA[<h3 id="Object-keys"><a href="#Object-keys" class="headerlink" title="Object.keys"></a>Object.keys</h3><p>ä¸Šä¸€ä¸ªObject.keys()åœ¨jsä¸­çš„ç”¨æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const obj = &#123;</span><br><span class="line">    name:<span class="string">'John'</span>,</span><br><span class="line">    age:12,</span><br><span class="line">    id:1</span><br><span class="line">&#125;</span><br><span class="line">Object.keys(obj).forEach(key=&gt;&#123;</span><br><span class="line">    //output   <span class="string">'John'</span>,12,1</span><br><span class="line">    console.log(obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>è¯•è¯•tsç‰ˆçš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> Person =&#123;</span><br><span class="line">    name:string,</span><br><span class="line">    id:number,</span><br><span class="line">    age:number</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">declare</span> const me:Person;</span><br><span class="line"></span><br><span class="line">Object.keys(me).forEach(key=&gt;&#123;</span><br><span class="line">    // åœ¨tsé‡Œé¢è¿™ä¸ªæ—¶å€™ç¼–è¾‘å™¨ä¼šæç¤ºæˆ‘ä»¬é”™è¯¯</span><br><span class="line">    console.log(me[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>Element implicitly has an â€˜anyâ€™ type because expression of type â€˜stringâ€™ canâ€™t be used to index type â€˜Personâ€™. No index signature with a parameter of type â€˜stringâ€™ was found on type â€˜Personâ€™</code></p>
<p>æ¥çœ‹ä¸€ä¸‹Object.keysçš„ç±»å‹å£°æ˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface ObjectConstructor &#123;</span><br><span class="line">    keys(o: object): string[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•æ¥æ”¶ä»»æ„ç±»å‹çš„objectä½œä¸ºè¾“å…¥å¹¶ä¸”è¿”å›stringç±»å‹çš„æ•°ç»„ä½œä¸ºè¾“å‡ºã€‚</p>
<p>æ¥å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿ</p>
<p>åœ¨Personä¸­ï¼Œå…·ä½“çš„keyå€¼åˆ†åˆ«æ˜¯name|age|idï¼Œä½†æ˜¯å®ƒä»¬çš„ç´¢å¼•ç­¾åå¹¶ä¸æ˜¯stringç±»å‹ï¼Œæ‰€ä»¥å½“åœ¨keysæ–¹æ³•ä¸­è¿”å›çš„stringæ•°ç»„çš„æ¯ä¸€ä¸ªkeyéƒ½æ˜¯stringç±»å‹æ—¶ï¼Œè·ŸPersonä¸­çš„æ¯ä¸ªkeyçš„ç´¢å¼•ç­¾åå¹¶ä¸åŒ¹é…ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½é€šè¿‡stringç±»å‹çš„keyè®¿é—®åˆ°meä¸­çš„æ•°æ®ï¼Œ<br>å¦‚æœPersonè¿™æ ·å®šä¹‰:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface Person&#123;</span><br><span class="line">    [key:string]:string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿™æ ·å†™ï¼Œé‚£ä¹ˆä¹‹å‰çš„forEachè¯­å¥å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œä¸æŠ¥é”™ï¼Œè€Œä¸”å¾ªç¯ä¸­çš„æ¯ä¸ªitemçš„ç±»å‹æ¨å¯¼æ˜¯stringç±»å‹<br><img src="/images/ObjectKeys/code2.png" alt="code"><br><br><br><strong>æ³¨æ„</strong>ï¼šé‚£ä¹ˆè¿™ä¸ªå°±å¾ˆæœ‰å¯èƒ½æ˜¯æŠ¥é”™çš„åŸå› ã€‚æ›´å…·ä½“çš„ç±»å‹åœ¨å·²ç»å»ºç«‹ç´¢å¼•çš„åº“ä¸­å¼•å‘çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯å› ä¸ºç±»å‹è¿‡äºå¤æ‚å¯¼è‡´ç±»å‹ä¸èƒ½æ­£ç¡®æ¨å¯¼</p>
<p>é‚£ä¹ˆé‡åˆ°è¿™ä¸ªé—®é¢˜è¯¥æ€ä¹ˆè§£å†³ï¼Ÿ</p>
<p>æœ€èœçš„æ–¹æ³•å°±æ˜¯æŠŠtsconfig.jsoné‡Œé¢çš„noImplicitAnyé€‰é¡¹ç»™å…³äº†ï¼Œé‚£å›å®¶ç”¨JSå§</p>
<h3 id="Type-casting-ç±»å‹è½¬æ¢"><a href="#Type-casting-ç±»å‹è½¬æ¢" class="headerlink" title="Type-casting(ç±»å‹è½¬æ¢)"></a>Type-casting(ç±»å‹è½¬æ¢)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Object.keys(me).forEach(key=&gt;&#123;</span><br><span class="line">    (me as any)[key]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™æ³•è™½ç„¶å¯ä»¥ï¼Œä½†æ˜¯ä¸æ¨è</p>
<p>ç¬¬äºŒç§å¯ä»¥æŠŠloopé‡Œé¢çš„keyçš„ç±»å‹è®¾ç½®ä¸ºPersonçš„keyï¼Œè¿™æ ·å°±èƒ½è®©tsç†è§£æˆ‘ä»¬åœ¨åšä»€ä¹ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Object.keys(me).forEach(key=&gt;&#123;</span><br><span class="line">    me[key as keyof Person]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ¯”ä¹‹å‰çš„è¦å¥½ç‚¹ï¼Œè¿˜å¯ä»¥è¯•è¯•å…¶ä»–çš„ï¼Œæ¯”å¦‚è®©tsè‡ªå·±èƒ½å¤Ÿå®Œæˆè¿™é¡¹å·¥ä½œ</p>
<h3 id="Extending-Object-Constructor-ç»§æ‰¿æ¥å£ObjectConstructor"><a href="#Extending-Object-Constructor-ç»§æ‰¿æ¥å£ObjectConstructor" class="headerlink" title="Extending Object Constructor(ç»§æ‰¿æ¥å£ObjectConstructor)"></a>Extending Object Constructor(ç»§æ‰¿æ¥å£ObjectConstructor)</h3><p>åœ¨tsé‡Œé¢æœ‰ä¸€ä¸ªå£°æ˜åˆå¹¶çš„ç‰¹æ€§</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface Person &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Person &#123;</span><br><span class="line">  age: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Person &#123;</span><br><span class="line">  height: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„codeå¯¹Personæ¥å£è¿›è¡Œäº†ä¸‰æ¬¡çš„å£°æ˜ï¼Œç­‰åŒäºä¸‹é¢è¿™ä¸ªcode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface Person&#123;</span><br><span class="line">    name: string;</span><br><span class="line">    age: number;</span><br><span class="line">    height: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åŒç†æˆ‘ä»¬å¯ä»¥å†™ObjectConstructorçš„æ¥å£ï¼Œå†™keyæ–¹æ³•çš„é‡è½½ï¼Œè¿™æ¬¡æˆ‘ä»¬éœ€è¦å¯¹objectçš„valueå€¼è¿›è¡Œç»†åˆ†ï¼Œå¹¶ä¸”å†³å®šåº”è¯¥è¿”å›ä»€ä¹ˆç±»å‹</p>
<p>ä¸‰ç§è¡Œä¸º</p>
<ol>
<li>å¦‚æœæˆ‘ä»¬ä¼ é€’è¿›æ¥ä¸€ä¸ªnumberç±»å‹ï¼Œé‚£ä¹ˆåº”è¯¥è¿”å›ç©ºæ•°ç»„</li>
<li>å¦‚æœæˆ‘ä»¬ä¼ é€’è¿›æ¥ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆåº”è¯¥è¿”å›string[]ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²æ•°ç»„</li>
<li>å¦‚æœæˆ‘ä»¬ä¼ é€’è¿›æ¥ä¸€ä¸ªanyç±»å‹ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›å®ƒçš„key</li>
</ol>
<p>çœ‹ä¸€ä¸‹æ€ä¹ˆæ„é€ è¿™ä¸ªç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> ObjectKeys&lt;T&gt; = T extends object?(keyof T)[]:</span><br><span class="line">T extends number?[]:</span><br><span class="line">T extends string|Array&lt;any&gt; ?string[]:</span><br><span class="line">never</span><br></pre></td></tr></table></figure>

<p>ä»¥neverç»“å°¾æ¥æ•æ‰å¼‚å¸¸é”™è¯¯</p>
<p>ç„¶åå†™ObjectConstructor</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface ObjectConstructor&#123;</span><br><span class="line">    keys(o:T):ObjectKeys&lt;T&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠè¿™ä¸¤æ®µä»£ç æ”¾åœ¨å£°æ˜æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚lib.d.ts</p>
<p>ç„¶åè¿™ä¸ªæ—¶å€™æ‰§è¡Œæ–‡ç« å¼€å¤´çš„é‚£ä¸ªloop</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Object.keys(me).forEach((key) =&gt; &#123;</span><br><span class="line">  //è¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ­£å¸¸è¾“å‡ºäº†</span><br><span class="line">  console.log(me[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<br>
<div style="overflow:hidden">
    <img src="/images/ObjectKeys/code.png" style="float:left;" title="Codes" alt="picture">
</div>





]]></content>
      <categories>
        <category>TypeScript</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Traversing</title>
    <url>/2019/09/06/Traversing/</url>
    <content><![CDATA[<h3 id="æ·±åº¦ä¼˜å…ˆéå†"><a href="#æ·±åº¦ä¼˜å…ˆéå†" class="headerlink" title="æ·±åº¦ä¼˜å…ˆéå†"></a>æ·±åº¦ä¼˜å…ˆéå†</h3><p>ä»æŸä¸ªé¡¶ç‚¹vå‡ºå‘ï¼Œé¦–å…ˆè®¿é—®è¯¥é¡¶ç‚¹ç„¶åä¾æ¬¡ä»å®ƒçš„å„ä¸ªæœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹å‡ºå‘æ·±åº¦ä¼˜å…ˆæœç´¢éå†å›¾ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰å’Œvæœ‰è·¯å¾„ç›¸é€šçš„é¡¶ç‚¹éƒ½è¢«è®¿é—®åˆ°</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€’å½’</span></span><br><span class="line"><span class="built_in">let</span> deepTraversal1 = (node, nodeList = []) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (node !== null) &#123;</span><br><span class="line">    nodeList.push(node)</span><br><span class="line">    <span class="built_in">let</span> children = node.children</span><br><span class="line">    <span class="keyword">if</span>(children!==null||children.length!==0)&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; children.length; i++) &#123;</span><br><span class="line">        deepTraversal1(children[i], nodeList)</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> nodeList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€’å½’</span></span><br><span class="line"><span class="built_in">let</span> deepTraversal2= (node)=&gt;&#123;</span><br><span class="line">  <span class="built_in">let</span> nodes=[];</span><br><span class="line">  <span class="keyword">if</span>(node!== null)&#123;</span><br><span class="line">    nodes.push(node);</span><br><span class="line">    <span class="built_in">let</span> children = node.children;</span><br><span class="line">    <span class="keyword">if</span>(children!==null||children.length!==0)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="built_in">let</span> i=0;i&lt;children.length;i++)&#123;</span><br><span class="line">        nodes= nodes.concat(deepTraversal2(children[i]));</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> nodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éé€’å½’</span></span><br><span class="line"><span class="built_in">let</span> deepTraversal2=(node)=&gt;&#123;</span><br><span class="line">  <span class="built_in">let</span> stack =[];</span><br><span class="line">  <span class="built_in">let</span> nodes=[];</span><br><span class="line">  <span class="keyword">if</span>(node)&#123;</span><br><span class="line">    /*å¦‚æœnodeèŠ‚ç‚¹å­˜åœ¨*/</span><br><span class="line">    stack.push(node);</span><br><span class="line">    <span class="keyword">while</span>(stack.length)&#123;</span><br><span class="line">      <span class="built_in">let</span> item= stack.pop();//å–å‡ºé˜Ÿå°¾å…ƒç´ </span><br><span class="line">      <span class="built_in">let</span> children = item.children;//è·å–å…ƒç´ å­èŠ‚ç‚¹</span><br><span class="line">      nodes.push(children);//æ¨è¿›å­èŠ‚ç‚¹ï¼Œç»“æ„ä¸çˆ¶èŠ‚ç‚¹ä¸€æ ·</span><br><span class="line">      <span class="keyword">if</span>(children!==null||children.length!==0)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">let</span> i =0;i&lt;children.length;i++)&#123;</span><br><span class="line">          stack.push(children[i]);</span><br><span class="line">        &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> nodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¹¿åº¦ä¼˜å…ˆéå†"><a href="#å¹¿åº¦ä¼˜å…ˆéå†" class="headerlink" title="å¹¿åº¦ä¼˜å…ˆéå†"></a>å¹¿åº¦ä¼˜å…ˆéå†</h3><p>ä»æŸé¡¶ç‚¹vå‡ºå‘ï¼Œåœ¨è®¿é—®äº†vä¹‹åä¾æ¬¡è®¿é—®vçš„å„ä¸ªæœªæ›¾è®¿é—®è¿‡çš„é‚»æ¥ç‚¹ï¼Œç„¶ååˆ†åˆ«ä»è¿™äº›é‚»æ¥ç‚¹å‡ºå‘ä¾æ¬¡è®¿é—®å®ƒä»¬çš„é‚»æ¥ç‚¹ï¼Œå¹¶ä½¿å¾—â€œå…ˆè¢«è®¿é—®çš„é¡¶ç‚¹çš„é‚»æ¥ç‚¹å…ˆäºåè¢«è®¿é—®çš„é¡¶ç‚¹çš„é‚»æ¥ç‚¹è¢«è®¿é—®ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰å·²è¢«è®¿é—®çš„é¡¶ç‚¹çš„é‚»æ¥ç‚¹éƒ½è¢«è®¿é—®åˆ°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> widthTraversal2=(node)=&gt;&#123;</span><br><span class="line">  <span class="built_in">let</span> nodes=[];</span><br><span class="line">  <span class="built_in">let</span> stack=[];</span><br><span class="line">  <span class="keyword">if</span>(node)&#123;</span><br><span class="line">    stack.push(node);</span><br><span class="line">    <span class="keyword">while</span>(stack.length)&#123;</span><br><span class="line">      <span class="built_in">let</span> item = stack.shift();</span><br><span class="line">      <span class="built_in">let</span> children = item.children;</span><br><span class="line">      nodes.push(node);</span><br><span class="line">      <span class="keyword">if</span>(children!==null||children.length!==0)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">let</span> i =0;i&lt;children.length;i++)&#123;</span><br><span class="line">          stack.push(children[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> nodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>axios</title>
    <url>/2020/09/25/axios/</url>
    <content><![CDATA[<h3 id="ä¸ºä»€ä¹ˆ-axios-æ—¢å¯ä»¥ç”¨-axios-è¿™æ ·è¯·æ±‚-ï¼Œä¹Ÿå¯ä»¥-axios-get-è¿™æ ·è¯·æ±‚ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-axios-æ—¢å¯ä»¥ç”¨-axios-è¿™æ ·è¯·æ±‚-ï¼Œä¹Ÿå¯ä»¥-axios-get-è¿™æ ·è¯·æ±‚ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ axios æ—¢å¯ä»¥ç”¨ axios({})è¿™æ ·è¯·æ±‚ ï¼Œä¹Ÿå¯ä»¥ axios.get()è¿™æ ·è¯·æ±‚ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ axios æ—¢å¯ä»¥ç”¨ axios({})è¿™æ ·è¯·æ±‚ ï¼Œä¹Ÿå¯ä»¥ axios.get()è¿™æ ·è¯·æ±‚ï¼Ÿ</h3><p>åœ¨ä½¿<code>axios.create</code>çš„æ—¶å€™,è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Create an instance of Axios</span><br><span class="line"> *</span><br><span class="line"> * @param &#123;Object&#125; defaultConfig The default config <span class="keyword">for</span> the instance</span><br><span class="line"> * @<span class="built_in">return</span> &#123;Axios&#125; A new instance of Axios</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> createInstance(defaultConfig) &#123;</span><br><span class="line">  var context = new Axios(defaultConfig);//ç”Ÿæˆé…ç½® å’Œæ‹¦æˆªå™¨</span><br><span class="line">  <span class="comment"># åœ¨è¿™é‡Œï¼Œinstance æ˜¯ä¸€ä¸ª wrapped å‡½æ•°ï¼Œå°†contextä½œä¸ºå‚æ•°ä¼ é€’ç»™requestï¼Œæ‰€ä»¥è°ƒç”¨axios(&#123;&#125;)å°±æ˜¯åœ¨è°ƒç”¨request(&#123;&#125;)</span></span><br><span class="line">  var instance = <span class="built_in">bind</span>(Axios.prototype.request, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">#Copy axios.prototype to instance</span></span><br><span class="line">  <span class="comment"># è¿™ä¸ªæ˜¯æŠŠAxiosåŸå‹é“¾çš„ä¸œè¥¿æŒ‚è½½åˆ°instanceä¸Šå»</span></span><br><span class="line">  <span class="comment"># å› ä¸ºinstance æ˜¯ä¸ªä¸€ä¸ªfunctoinï¼Œæ‰€ä»¥åœ¨ç›´æ¥èµ‹å€¼çš„æ—¶å€™ä¸èƒ½ç›´æ¥çœ‹åˆ°</span></span><br><span class="line">  <span class="comment"># èƒ½åœ¨instance çš„prototypeä¸Šå¯ä»¥çœ‹åˆ°</span></span><br><span class="line">  <span class="comment"># æ‰€ä»¥åœ¨è°ƒç”¨ç±»ä¼¼axios.get(ï¼‰è¿™ç±»çš„æ–¹æ³•æ˜¯èƒ½æ­£å¸¸è¿è¡Œ</span></span><br><span class="line">  utils.extend(instance, Axios.prototype, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Copy context to instance</span></span><br><span class="line">  utils.extend(instance, context);</span><br><span class="line">  <span class="comment"># console.log(instance)</span></span><br><span class="line">  <span class="built_in">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°,æ–¹æ³•ä¹‹ç±»çš„ç¡®å®æŒ‚è½½åˆ°äº†åŸå‹é“¾ä¸Š<br><img src="/images/axios/prototype.png" alt="prototype"></p>
<h3 id="cancalToken-æ€ä¹ˆå–æ¶ˆè¯·æ±‚çš„"><a href="#cancalToken-æ€ä¹ˆå–æ¶ˆè¯·æ±‚çš„" class="headerlink" title="cancalToken æ€ä¹ˆå–æ¶ˆè¯·æ±‚çš„"></a>cancalToken æ€ä¹ˆå–æ¶ˆè¯·æ±‚çš„</h3><p>é‚£ä¹ˆå…¶å®ä»€ä¹ˆæ—¶å€™éœ€è¦å–æ¶ˆè¯·æ±‚ï¼Œä¸¾ä¸€ä¸ªå¾ˆå¸¸è§çš„ä¾‹å­ï¼Œå–æ¶ˆé‡å¤è¯·æ±‚ï¼Œå°±æ˜¯å½“å‰å·²ç»å‘å‡ºè¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œåç»­åŒæ ·çš„è¯·æ±‚å¦‚æœå‘é€å°±ä¼šè¢«å–æ¶ˆï¼ˆå¦‚æœæ˜¯è¡¨å•çš„æäº¤ä¹Ÿå¯ä»¥ä½¿ç”¨ dom çš„ disabld ç¦æ­¢ç‚¹å‡» 2333ï¼‰<br>ä¸¾ä¸ªæ —å­ï¼š<br>åœ¨ axios ä¸Šæ˜¯æŒ‚è½½äº† Cancel ç›¸åº”çš„ä¸œè¥¿</p>
<ul>
<li>axios.Cancel = require(â€˜./cancel/Cancelâ€™);</li>
<li>axios.CancelToken = require(â€˜./cancel/CancelTokenâ€™);</li>
<li>axios.isCancel = require(â€˜./cancel/isCancelâ€™);</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var data = document.getElementById(<span class="string">"data"</span>).value;</span><br><span class="line">         const CancelToken = axios.CancelToken;</span><br><span class="line">         axios</span><br><span class="line">           .post(</span><br><span class="line">             <span class="string">"/post/server"</span>,</span><br><span class="line">             &#123;</span><br><span class="line">               data,</span><br><span class="line">             &#125;,</span><br><span class="line">             &#123;</span><br><span class="line">               cancelToken: new CancelToken((c) =&gt; &#123;</span><br><span class="line">                 cancel = c;</span><br><span class="line">                 console.log(c)</span><br><span class="line">               &#125;),</span><br><span class="line">             &#125;</span><br><span class="line">           )</span><br><span class="line">           .<span class="keyword">then</span>(<span class="keyword">function</span> (res) &#123;</span><br><span class="line">             output.className = <span class="string">"container"</span>;</span><br><span class="line">             output.innerHTML = res.data;</span><br><span class="line">           &#125;)</span><br><span class="line">           .catch(<span class="keyword">function</span> (err) &#123;</span><br><span class="line">             output.className = <span class="string">"container text-danger"</span>;</span><br><span class="line">             output.innerHTML = err.message;</span><br><span class="line">           &#125;);</span><br><span class="line">         cancel(<span class="string">'sdfsd'</span>);</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿™é‡Œ axios.post å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†<code>request</code>æ–¹æ³•ï¼Œæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª promiseï¼Œæœ€åä¸€ä¸ªæ‰§è¡Œçš„ promise æ˜¯ä¸€ä¸ªå«<code>dispatchRequest</code>çš„å‡½æ•°ï¼Œå‡½æ•°ä½ç½®åœ¨ core/dispatchRequest.js æ–‡ä»¶ä¸‹ï¼Œå› ä¸ºè¿”å›çš„æ˜¯ä¸€ä¸ª promise ï¼ŒçŠ¶æ€æ˜¯ penddingï¼ŒåŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åæ‰§è¡Œä¸»çº¿ç¨‹çš„<code>cancel</code>æ–¹æ³•ã€‚cancel æ–¹æ³•æ˜¯åœ¨åˆå§‹åŒ– cancelToken çš„æ—¶å€™ç»™ cancel èµ‹å€¼äº†ã€‚</p>
<p><code>cancelTokenï¼š</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> CancelToken(executor) &#123;</span><br><span class="line">  <span class="keyword">if</span> (typeof executor !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    throw new TypeError(<span class="string">'executor must be a function.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var resolvePromise;</span><br><span class="line">  <span class="comment"># è¿™é‡ŒæŠŠresolveé’©å­èµ‹å€¼ç»™resolvePromise ä¸ºäº†è®©cancelå‡½æ•°èƒ½å¤Ÿæ”¹å˜promiseçš„çŠ¶æ€</span></span><br><span class="line">  this.promise = new Promise(<span class="keyword">function</span> promiseExecutor(resolve) &#123;</span><br><span class="line">    resolvePromise = resolve;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  var token = this;</span><br><span class="line">  executor(<span class="keyword">function</span> cancel(message) &#123;</span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      <span class="comment"># Cancellation has already been requested</span></span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token.reason = new Cancel(message);</span><br><span class="line">    <span class="comment"># è¿™é‡Œæ”¹å˜promiseçŠ¶æ€ä½fulfilled</span></span><br><span class="line">    resolvePromise(token.reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæˆçš„æ—¶å€™å¼€å§‹è¿›å…¥ä¸‹ä¸€è½®ä»»åŠ¡æ‰§è¡Œï¼Œæ²¡æœ‰å®ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œç›´æ¥æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œå…ˆæ‰§è¡Œåˆšåˆš request è¿”å›çš„ promiseï¼Œå…¶å®æ˜¯å¼€å§‹æ‰§è¡Œäº†<code>dispatchRequest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">module.exports = <span class="keyword">function</span> dispatchRequest(config) &#123;</span><br><span class="line">  throwIfCancellationRequested(config);</span><br><span class="line">  <span class="comment"># çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Throws a `Cancel` <span class="keyword">if</span> cancellation has been requested.</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> throwIfCancellationRequested(config) &#123;</span><br><span class="line">  <span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">      <span class="comment"># è¿™ä¸ªæ–¹æ³•æŒ‚è½½åœ¨canceltokenåŸå‹é“¾å‚»å§‘å¨˜</span></span><br><span class="line">    config.cancelToken.throwIfRequested();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">CancelToken.prototype.throwIfRequested = <span class="keyword">function</span> <span class="function"><span class="title">throwIfRequested</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> (this.reason) &#123;</span><br><span class="line">      <span class="comment"># è¿™é‡ŒæŠ›å‡ºé”™è¯¯ï¼Œç„¶ååœ¨ä¸»ç¨‹åºä»£ç ä¸­çš„catchæ•è·ï¼Œç„¶åç¨‹åºè¿”å›ï¼Œä¸è¿›è¡Œåç»­åˆ›å»ºxhrå¯¹è±¡çš„è¿‡ç¨‹</span></span><br><span class="line">    throw this.reason;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åœ¨xhræ–‡ä»¶ä¸­çœ‹åˆ°æœ‰ä¸€æ®µä»£ç ï¼Œé•¿è¿™æ ·:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">      // Handle cancellation</span><br><span class="line">      config.cancelToken.promise.then(<span class="keyword">function</span> onCanceled(cancel) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">          <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        request.abort();</span><br><span class="line">        reject(cancel);</span><br><span class="line">        // Clean up request</span><br><span class="line">        request = null;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆä¸Šæ–‡ä¸­çš„resolvePromiseæ”¹å˜åçš„promiseå°±æ˜¯åœ¨è¿™é‡Œè°ƒç”¨ï¼Œé‚£ä»€ä¹ˆæƒ…å†µä¼šåˆ°è¿™é‡Œæ¥æ‰§è¡Œè¯·æ±‚ï¼Œå‡å¦‚æœ‰Aï¼ŒBä¸¤ä¸ªè¯·æ±‚ï¼ŒAè¯·æ±‚å“åº”æ—¶é—´è¿‡é•¿ï¼Œç„¶åç­‰åˆ°Bæ‰§è¡Œå›è°ƒéƒ½å›æ¥çš„æ—¶å€™ï¼Œç›´æ¥æŠŠAè¯·æ±‚ç»™å–ï¼ˆganï¼‰æ¶ˆ(diao)äº†</p>
]]></content>
  </entry>
  <entry>
    <title>éƒ¨ç½²hexoè¸©å‘è®°å½•</title>
    <url>/2020/11/14/bugsForNode/</url>
    <content><![CDATA[<p>åœ¨æ‰§è¡Œä¸‹é¢è¿™å¥ä»£ç çš„æ—¶å€™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g -d</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Something<span class="string">'s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span></span><br><span class="line"><span class="string">TypeError [ERR_INVALID_ARG_TYPE]: The "mode" argument must be integer. Received an instance of Object</span></span><br><span class="line"><span class="string">    at copyFile (fs.js:1924:10)</span></span><br><span class="line"><span class="string">    at tryCatcher (/Users/zjs/Desktop/blog/node_modules/bluebird/js/release/util.js:16:23)</span></span><br><span class="line"><span class="string">    at ret (eval at makeNodePromisifiedEval (/Users/zjs/.nvm/versions/node/v14.10.0/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promisify.js:184:12), &lt;anonymous&gt;:13:39)</span></span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ¡ˆ<br> NodeJs ç‰ˆæœ¬ä» 14 å›åˆ° 12 å°±ğŸ‰‘ï¸ï¼</p>
]]></content>
  </entry>
  <entry>
    <title>Chromeè°ƒè¯•å·¥å…·çš„é‚£ç‚¹äº‹</title>
    <url>/2019/09/27/chorme-panel/</url>
    <content><![CDATA[<h3 id><a href="#" class="headerlink" title="$_"></a>$_</h3><p>è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œä½ ç»å¸¸ä¼šé€šè¿‡æ‰“å°æŸ¥çœ‹ä¸€äº›å˜é‡çš„å€¼ï¼Œä½†å¦‚æœä½ æƒ³çœ‹ä¸€ä¸‹ä¸Šæ¬¡æ‰§è¡Œçš„ç»“æœå‘¢ï¼Ÿå†è¾“ä¸€éè¡¨è¾¾å¼å—</p>
<a id="more"></a>
<p>è¿™æ—¶å€™ $_ å°±æ´¾ä¸Šäº†ç”¨åœºï¼Œ$_ æ˜¯å¯¹ä¸Šæ¬¡æ‰§è¡Œçš„ç»“æœçš„ å¼•ç”¨ ï¼š<br><img src="/images/chrome_panel/demo1.png" alt="demo"></p>
<h3 id="-1"><a href="#-1" class="headerlink" title="$$"></a>$$</h3><p>ç”¨Jqueryåº“çš„åŒå­¦éƒ½çŸ¥é“$æ˜¯Jqueryçš„ç¼©å†™ï¼Œåœ¨Chromeçš„è°ƒè¯•é¢æ¿ä¸­ï¼Œå¦‚æœä½ æ²¡æœ‰å®šä¹‰$è¿™ä¸ªå˜é‡ï¼Œå®ƒåœ¨ console ä¸­å°±æ˜¯å¯¹è¿™ä¸€å¤§ä¸²å‡½æ•° document.querySelector çš„åˆ«åã€‚$$åˆ™æ˜¯==Array.from(document.querySelector),è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªnodeListï¼Œå¯ä»¥å¸®æˆ‘ä»¬çœå´å¾ˆå¤šæ—¶é—´</p>
<h3 id="0"><a href="#0" class="headerlink" title="$0"></a>$0</h3><p>$0ä¿å­˜çš„æ˜¯å½“å‰é€‰ä¸­èŠ‚ç‚¹çš„å¼•ç”¨,$1æ˜¯ä¸Šä¸ªèŠ‚ç‚¹ï¼Œ$2æ˜¯ä¸Šä¸Šä¸ª,åˆ°4æˆªæ­¢ã€‚</p>
<h3 id="æˆªå±"><a href="#æˆªå±" class="headerlink" title="æˆªå±"></a>æˆªå±</h3><p>æˆªå±çš„æ—¶å€™ä½ ä»¬è‚¯å®šç”¨çš„æ˜¯qqæˆ–è€…timçš„ctrl+alt+aæˆ–è€…å¾®ä¿¡çš„alt+aï¼Œå…¶å®æµè§ˆå™¨æœ¬èº«ä¹Ÿæ”¯æŒæˆªå±<br><img src="/images/chrome_panel/demo2.gif" alt="å›¾ç‰‡"></p>
<h3 id="åˆ‡æ¢ä¸»é¢˜"><a href="#åˆ‡æ¢ä¸»é¢˜" class="headerlink" title="åˆ‡æ¢ä¸»é¢˜"></a>åˆ‡æ¢ä¸»é¢˜</h3><p><img src="/images/chrome_panel/demo3.gif" alt="å›¾ç‰‡"></p>
<p>PS:Ummm,è¿˜æœ‰å…¶ä»–å‘½ä»¤æˆ‘å°±ä¸ç©å•¦ã€‚å¿˜äº†è¯´ï¼Œctrl+shift+pæ‰“å¼€é‚£ä¸ªcommandé¢æ¿</p>
<h3 id="æ‰“æ–­ç‚¹"><a href="#æ‰“æ–­ç‚¹" class="headerlink" title="æ‰“æ–­ç‚¹"></a>æ‰“æ–­ç‚¹</h3><p>å¤§éƒ¨åˆ†äººæ‰“æ–­ç‚¹éƒ½æ˜¯è¿™æ ·æ‰“æ»´<br><img src="/images/chrome_panel/demo4.png" alt="å›¾ç‰‡"><br>ç„¶é¹…å¦‚æœä½ åªæƒ³çœ‹ç¬¬50æ¬¡å¾ªç¯ä¸­çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œéš¾é“éœ€è¦å‰é¢çš„49æ¬¡éƒ½æ–­ç”µå—ï¼Ÿçƒ¦ä¸çƒ¦ï¼Ÿæ‰€ä»¥ä½ å¯ä»¥é…±ç´«ï¼š<br><img src="/images/chrome_panel/demo5.gif" alt="å›¾ç‰‡"></p>
<p>è®¾ç½®æ¡ä»¶æ–­ç‚¹åï¼Œå¯ä»¥æŒ‡å®šåœ¨æŸä¸ªæ¡ä»¶çš„æ—¶å€™æ–­ç‚¹ï¼Œå¹¶ä¸”åœ¨å³ä¾§å¯ä»¥ç§»é™¤æ‰€æœ‰æ–­ç‚¹è€Œä¸ç”¨æ‰‹åŠ¨ä¸€ä¸ªä¸ªç‚¹å–æ¶ˆã€‚</p>
]]></content>
      <tags>
        <tag>Chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>æ€è€ƒå¦‚ä½•ä½¿a==1&amp;&amp;a==2&amp;&amp;a==3ä¸ºtrue</title>
    <url>/2019/11/01/closure/</url>
    <content><![CDATA[<p>æ¶‰åŠè¿ç®—ç¬¦æ¯”è¾ƒè¿‡ç¨‹ï¼Œè¿ç®—ç¬¦åœ¨æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰çš„æ—¶å€™åšäº†ä»€ä¹ˆ,ç¬¬äºŒä¸ªæ¶‰åŠé—­åŒ…JSæ¯”è¾ƒä¸¤ä¸ªæ•°å€¼æ˜¯å¦ç›¸ç­‰å¯ä»¥ç”¨== å’Œ=== ï¼Œ<a id="more"></a>å…¶ä¸­ == ä¼šæœ‰éšå¼ç±»å‹è½¬æ¢çš„æ“ä½œï¼Œ===åˆ™ä¸ä¼š,åœ¨ä¸¤ä¸ªæ•°æ¯”è¾ƒæ—¶ï¼Œå…ˆè°ƒç”¨valueOf,å¦‚æœè¿”å›çš„ä¸æ˜¯åŸå§‹ç±»å‹ï¼Œç»§ç»­è°ƒç”¨toString,å¦‚æœä¸æ˜¯åŸå§‹ç±»å‹ï¼ŒæŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const b = &#123;</span><br><span class="line">  value :1,</span><br><span class="line">  toString()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name:1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  valueOf()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name:1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(`toString : $&#123;b==3&#125;`)</span><br><span class="line">console.log(`valueOf : $&#123;b==4&#125;`)</span><br><span class="line">//æŠ›å‡ºå¼‚å¸¸TypeError: Cannot convert object to primitive value</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const b = &#123;</span><br><span class="line">  value :1,</span><br><span class="line">  toString()&#123;</span><br><span class="line">    return 3</span><br><span class="line">  &#125;,</span><br><span class="line">  valueOf()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      name:1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(`toString : $&#123;b==3&#125;`)</span><br><span class="line">console.log(`valueOf : $&#123;b==4&#125;`)</span><br><span class="line">//toString:true,valueOf:false</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const b = &#123;</span><br><span class="line">  value :1,</span><br><span class="line">  toString()&#123;</span><br><span class="line">    return 3</span><br><span class="line">  &#125;,</span><br><span class="line">  valueOf()&#123;</span><br><span class="line">    return 4</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(`toString : $&#123;b==3&#125;`)//false</span><br><span class="line">console.log(`valueOf : $&#123;b==4&#125;`)//true</span><br></pre></td></tr></table></figure>

<p>OK,æ¥ä¸‹æ¥è¯´æ­£é¢˜ï¼Œ a==1çš„æ—¶å€™å…ˆè°ƒç”¨äº†a.valueOf(),ç„¶åæ ¹æ®valueOfçš„è¿”å›å€¼ä¸1è¿›è¡Œæ¯”è¾ƒ,ä½†æ˜¯åœ¨a==1ä¸ºçœŸçš„æƒ…å†µä¸‹å¦‚ä½•ç¡®ä¿a==2ä»¥åŠa==3ä¹ŸåŒæ—¶æˆç«‹å‘¢ï¼Ÿè¿˜è®°å¾—é‡Œä¸¤ä¸ªæ•°æ¯”è¾ƒæ—¶åšçš„æ“ä½œå—ï¼Ÿå…ˆè°ƒç”¨valueOf,ç„¶åæ˜¯toString,æ‰€ä»¥åªè¦è¦†å†™å…¶ä¸­ä¸€ä¸ªæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const a =&#123;</span><br><span class="line">  value:1,</span><br><span class="line">  toString()&#123;</span><br><span class="line">    return this.value++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//ç”±äºè¿™æ—¶çš„aæ˜¯ä¸€ä¸ªObject,æ‰€ä»¥è°ƒç”¨valueOfçš„æ—¶å€™è¿”å›çš„å¹¶ä¸æ˜¯åŸå§‹ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬è¦†å†™toStringæ–¹æ³•å³å¯</span><br><span class="line">console.log(a==1&amp;&amp;a==2&amp;&amp;a==3)//true</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>éšç¬”</title>
    <url>/2020/10/21/conclusion/</url>
    <content><![CDATA[<h3 id="ç¬”è®°ä¸€"><a href="#ç¬”è®°ä¸€" class="headerlink" title="ç¬”è®°ä¸€"></a>ç¬”è®°ä¸€</h3><p>åœ¨vueé¡¹ç›®ä¸­ä½¿ç”¨ts-classçš„å½¢å¼æ¥ç¼–å†™ç»„ä»¶çš„æ—¶å€™ï¼Œè¦è®°å¾—åœ¨exportä¸Šé¢â•<code>@Component</code>è£…é¥°å™¨ï¼Œä¸ç„¶ç»„ä»¶ä¸èƒ½æ­£å¸¸æ³¨å†Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">    Component,</span><br><span class="line">    Vue,</span><br><span class="line">    InjectReactive</span><br><span class="line">&#125; from <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">class Child extends Vue &#123;</span><br><span class="line">    @InjectReactive() node: number;</span><br><span class="line">    <span class="function"><span class="title">mounted</span></span>() &#123;</span><br><span class="line">        console.log(this.node)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨é¡µé¢ä¸­éœ€è¦ç”¨åˆ°å­ç»„ä»¶çš„æƒ…å†µï¼Œéœ€è¦åƒè¿™æ ·æ³¨å†Œ,å¹¶ä¸”<code>@Component</code>è£…é¥°å™¨åªéœ€è¦å†™ä¸€æ¬¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">    Vue,</span><br><span class="line">    Component,</span><br><span class="line">    ProvideReactive</span><br><span class="line">&#125; from <span class="string">'vue-property-decorator'</span>;</span><br><span class="line">import Child from <span class="string">'./child.vue'</span></span><br><span class="line">@Component(&#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">        Child</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">class Parent extends Vue &#123;</span><br><span class="line">    @ProvideReactive() node = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="title">mounted</span></span>() &#123;</span><br><span class="line">        this.node = 1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬”è®°äºŒ-â€”-ProvideReactiveæ¥åšæ•°æ®é€ä¼ çš„æ³¨æ„ç‚¹"><a href="#ç¬”è®°äºŒ-â€”-ProvideReactiveæ¥åšæ•°æ®é€ä¼ çš„æ³¨æ„ç‚¹" class="headerlink" title="ç¬”è®°äºŒ â€” ProvideReactiveæ¥åšæ•°æ®é€ä¼ çš„æ³¨æ„ç‚¹"></a>ç¬”è®°äºŒ â€” ProvideReactiveæ¥åšæ•°æ®é€ä¼ çš„æ³¨æ„ç‚¹</h3><p>å¦‚æœåœ¨ç»„ä»¶ä¸­ä½¿ç”¨Provideæ¥è¿›è¡Œæ•°æ®é€ä¼ çš„è¯ï¼Œæ•°æ®æ˜¯ä¸å¸¦å“åº”å¼çš„ã€‚å¦‚æœéœ€è¦æ•°æ®å…·æœ‰å“åº”å¼ï¼Œé‚£ä¹ˆéœ€è¦ç”¨ProvideReactiveæ¥åšå±æ€§çš„é€ä¼ ï¼Œä»£ç ä¾‹å­å¯ä»¥çœ‹ä¸Šä¸€ä¸ªä»£ç ï¼Œå¦å¤–ç”±äºåœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šæœ‰Provideçš„å€¼é‡æ–°å®šä¹‰çš„é—®é¢˜ï¼Œè¿™æ—¶å€™æ§åˆ¶å°ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ä¸ª<br><a href="https://github.com/kaorun343/vue-property-decorator/issues/277">issue</a>,æœ‰ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆ</p>
<h3 id="ç¬”è®°ä¸‰-â€”-åœ¨å¼¹çª—ä¸­ä¿è¯æ•°æ®çš„å®æ—¶æ€§"><a href="#ç¬”è®°ä¸‰-â€”-åœ¨å¼¹çª—ä¸­ä¿è¯æ•°æ®çš„å®æ—¶æ€§" class="headerlink" title="ç¬”è®°ä¸‰ â€” åœ¨å¼¹çª—ä¸­ä¿è¯æ•°æ®çš„å®æ—¶æ€§"></a>ç¬”è®°ä¸‰ â€” åœ¨å¼¹çª—ä¸­ä¿è¯æ•°æ®çš„å®æ—¶æ€§</h3><p>éœ€è¦æŠŠæ•°æ®ä»¥Provideçš„å½¢å¼ä¼ é€’ç»™å¼¹çª—ï¼Œä½†æ˜¯æ•°æ®ä»…ä»…åªåœ¨ç¬¬ä¸€æ¬¡æ˜¾ç¤ºçš„æ—¶å€™æ˜¯æ­£å¸¸çš„æ•°æ®ï¼Œåœ¨å…³é—­å¼¹çª—åå†ä¸€æ¬¡å¼€å¯å¼¹çª—ï¼Œæ˜¾ç¤ºçš„æ•°æ®æ˜¯ä¸Šä¸€æ¬¡çš„æ•°æ®ã€‚åŸå› æš‚æ—¶ä¸çŸ¥é“ã€‚æ‰€ä»¥æˆ‘åœ¨å…³é—­å¼¹çª—çš„æ—¶å€™åŒæ—¶ç”¨v-ifæ¥é”€æ¯å…ƒç´ ï¼Œè¿™æ ·æ¯æ¬¡æ‰“å¼€çš„å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæœ€æ–°çš„å…ƒç´ ï¼ŒåŒæ—¶è¿™ä¸ªæ—¶å€™è·å–åˆ°çš„æ•°æ®ä¹Ÿæ˜¯æœ€æ–°çš„æ•°æ®ã€‚</p>
<h3 id="ç¬”è®°å››-â€”-æ•°æ®è·å–å®Œåä¿è¯å­ç»„ä»¶è·å–æœ€æ–°çš„æ•°æ®"><a href="#ç¬”è®°å››-â€”-æ•°æ®è·å–å®Œåä¿è¯å­ç»„ä»¶è·å–æœ€æ–°çš„æ•°æ®" class="headerlink" title="ç¬”è®°å›› â€” æ•°æ®è·å–å®Œåä¿è¯å­ç»„ä»¶è·å–æœ€æ–°çš„æ•°æ®"></a>ç¬”è®°å›› â€” æ•°æ®è·å–å®Œåä¿è¯å­ç»„ä»¶è·å–æœ€æ–°çš„æ•°æ®</h3><p>åœ¨çˆ¶ç»„ä»¶ç”¨axiosè·å–æ•°æ®çš„æ—¶å€™ï¼Œç„¶åä¼ é€’ç»™å­ç»„ä»¶ï¼Œä½†æ˜¯å­ç»„ä»¶æ¸²æŸ“çš„æ—¶å€™æ˜¯å®šä¹‰æ—¶å°±ç»™çš„é»˜è®¤å€¼ã€‚<br>åŸå› ï¼šçˆ¶ç»„ä»¶åœ¨è¯·æ±‚æ•°æ®çš„æ—¶å€™ï¼Œå­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå·²ç»èµ°å®Œå¹¶ä¸”å·²ç»æ¸²æŸ“å®Œæˆï¼Œæ‰€ä»¥è¿™æ—¶å€™æ˜¯æ‹¿ä¸åˆ°è¯·æ±‚åè¿”å›çš„çœŸå®æ•°æ®<br>æ–¹æ¡ˆï¼šæˆ‘è¿™é‡Œç”¨v-ifæ¥åˆ¤æ–­è·å–çš„æ•°æ®çš„é•¿åº¦æ˜¯å¦ä¸ºç©ºæ¥åˆ¤æ–­æ˜¯å¦è¦æ¸²æŸ“å­ç»„ä»¶ï¼Œç¼ºç‚¹ï¼šæ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ä¼šæœ‰å¾ˆé•¿æ—¶é—´çš„ç©ºç™½ã€‚</p>
<h3 id="ç¬”è®°äº”-â€”-è‡ªå®šä¹‰ç»„ä»¶ç»‘å®šv-models"><a href="#ç¬”è®°äº”-â€”-è‡ªå®šä¹‰ç»„ä»¶ç»‘å®šv-models" class="headerlink" title="ç¬”è®°äº” â€” è‡ªå®šä¹‰ç»„ä»¶ç»‘å®šv-models"></a>ç¬”è®°äº” â€” è‡ªå®šä¹‰ç»„ä»¶ç»‘å®šv-models</h3><p>æƒ³è®©è‡ªå®šä¹‰ç»„ä»¶èƒ½å¤Ÿä½¿ç”¨v-modelè¯­æ³•ç³–ï¼Œè¿™æ ·å­ç»„ä»¶çš„æ•°æ®å°±å¯ä»¥å®æ—¶çš„åé¦ˆåˆ°çˆ¶ç»„ä»¶ä¸­å»</p>
<p>åœ¨vueä¸­ï¼Œå¯¹inputæ¥è¯´ï¼Œv-modelæ˜¯valueå’Œinputäº‹ä»¶çš„è¯­æ³•ç³–ï¼Œå¯¹äºcheckboxæ¥è¯´ï¼Œç›‘å¬çš„äº‹ä»¶æ˜¯changeï¼Œç»™å¯¹åº”çš„å…ƒç´ æ·»åŠ å¯¹åº”çš„äº‹ä»¶ï¼Œç„¶ååœ¨è‡ªç»„ä»¶emitå‡ºå»ï¼ŒæŠŠç›¸åº”çš„valueå€¼ç»‘å®šåˆ°å¯¹åº”çš„domå…ƒç´ ä¸­å»ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>GET å’Œ POST çš„åŒºåˆ«</title>
    <url>/2020/09/12/diff-between-get-post/</url>
    <content><![CDATA[<h2 id="GETè¯·æ±‚"><a href="#GETè¯·æ±‚" class="headerlink" title="GETè¯·æ±‚"></a>GETè¯·æ±‚</h2><ol>
<li>GETè¯·æ±‚è¿”å›çš„èµ„æºä¼šè¢«æµè§ˆå™¨ç¼“å­˜</li>
<li>GETè¯·æ±‚ä¼šä¿å­˜åœ¨æµè§ˆå™¨çš„å†å²è®°å½•ä¸­</li>
<li>GETè¯·æ±‚èƒ½å½“ä¹¦ç­¾</li>
<li>GETä¸èƒ½ç”¨æ¥å¤„ç†æ•æ„Ÿæ•°æ®</li>
<li>æœ‰é•¿åº¦é™åˆ¶ï¼ˆå…·ä½“é•¿åº¦å‚è§å„ä¸ªæµè§ˆå™¨è§„èŒƒï¼‰</li>
<li>ä»…ä»…ç”¨æ¥è·å–æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹</li>
<li>å‚æ•°çš„æ•°æ®ç±»å‹ï¼Œåªæ¥æ”¶ascllç¼–ç </li>
<li>ä»…æ”¯æŒurlç¼–ç </li>
<li>äº§ç”Ÿä¸€ä¸ªæ•°æ®åŒ…</li>
<li>é¡µé¢é‡è½½æˆ–è€…å›é€€æ²¡æœ‰å½±å“</li>
</ol>
<h2 id="POSTè¯·æ±‚"><a href="#POSTè¯·æ±‚" class="headerlink" title="POSTè¯·æ±‚"></a>POSTè¯·æ±‚</h2><ol>
<li>è¯·æ±‚ä¸ä¼šè¢«ç¼“å­˜</li>
<li>ä¸ä¼šä¿å­˜åœ¨å†å²è®°å½•ä¸­</li>
<li>ä¸èƒ½ä½œä¸ºä¹¦ç­¾</li>
<li>æ•°æ®é•¿åº¦æ²¡æœ‰é™åˆ¶</li>
<li>å‚æ•°çš„æ•°æ®ç±»å‹æ²¡æœ‰é™åˆ¶</li>
<li>æ”¯æŒå¤šç§ç¼–ç </li>
<li>ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œéœ€è¦æœåŠ¡å™¨å“åº”100åç»§ç»­å‘å‡ºè¯·æ±‚ä¹‹åæœåŠ¡å™¨ï¼ˆå¯èƒ½ï¼‰å“åº”200</li>
<li>åˆ·æ–°æˆ–è€…å›é€€ æ•°æ®ä¼šé‡æ–°æäº¤</li>
</ol>
<h2 id="å…¶ä»–httpæ–¹æ³•"><a href="#å…¶ä»–httpæ–¹æ³•" class="headerlink" title="å…¶ä»–httpæ–¹æ³•"></a>å…¶ä»–httpæ–¹æ³•</h2><h3 id="put"><a href="#put" class="headerlink" title="put"></a>put</h3><p>putæ–¹æ³•è·Ÿpostä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨æ¥åˆ›å»ºæˆ–è€…æ›´æ–°èµ„æºçš„ï¼Œä½†æ˜¯è·Ÿpostä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºputè¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´putè¯·æ±‚å‘èµ·å¤šæ¬¡æ‰€äº§ç”Ÿçš„ç»“æœæ˜¯è·Ÿç¬¬ä¸€ä¸ªä¸€æ ·çš„ï¼›é‚£ä¹ˆå¯¹äºpostè¯·æ±‚ï¼Œé‡å¤è¯·æ±‚å°±ä¼šäº§ç”Ÿå¤šæ¬¡åˆ›å»ºç›¸åŒèµ„æºçš„å‰¯ä½œç”¨</p>
<h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>headè¯·æ±‚è·Ÿgetè¯·æ±‚æ˜¯å·®ä¸å¤šç›¸åŒçš„ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºheadè¯·æ±‚æ²¡æœ‰è¿”å›ä½“<br>é‚£ä¹ˆhead è¯·æ±‚é€šå¸¸æ˜¯åœ¨å‘èµ·getè¯·æ±‚ä¹‹å‰æ£€æŸ¥getè¯·æ±‚è¿”å›çš„æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚åœ¨ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™æˆ–è€…ä¸‹è½½è¯·æ±‚ä½“çš„æ—¶å€™</p>
<h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p>åˆ é™¤æ–¹æ³•ç”¨æ¥åˆ é™¤èµ„æº</p>
<h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p>æ˜¯å¤æ‚è¯·æ±‚çš„é¢„æ£€è¯·æ±‚</p>
]]></content>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”(7-29)</title>
    <url>/2020/07/29/essay-1/</url>
    <content><![CDATA[<h2 id="runAsync"><a href="#runAsync" class="headerlink" title="runAsync"></a>runAsync</h2><p>ä½¿ç”¨ web worker åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œå‡½æ•°ï¼Œèƒ½å¤Ÿå…è®¸æ‰§è¡Œä¸é˜»å¡ UI æ¸²æŸ“çš„è€—æ—¶å‡½æ•°</p>
<ol>
<li><p>ä½¿ç”¨ blob å½¢å¼çš„ url æ¥åˆ›å»º<code>worker</code>,<code>worker</code>çš„å†…å®¹åº”è¯¥æ˜¯å‡½æ•°çš„ç³»åˆ—åŒ–ç‰ˆæœ¬ï¼Œç„¶åç«‹å³è¿”å›å‡½æ•°çš„è¿”å›å€¼</p>
</li>
<li><p>è¿”å›å€¼æ˜¯ä¸€ä¸ª<code>promise</code>ï¼Œå®ƒç›‘å¬äº†<code>worker</code>çš„<code>onmessage</code> and <code>onerror</code>ä¸¤ä¸ªäº‹ä»¶ï¼Œè¿”å›ä»ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„æ•°æ®æˆ–è€…æ˜¯æŠ›å‡ºä¸€ä¸ªé”™è¯¯</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const runAsync = fn =&gt; &#123;</span><br><span class="line">  const worker = new Worker(</span><br><span class="line">    URL.createObjectURL(new Blob([`postMessage((<span class="variable">$&#123;fn&#125;</span>)());`]), &#123;</span><br><span class="line">      <span class="built_in">type</span>: <span class="string">'application/javascript; charset=utf-8'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="built_in">return</span> new Promise((res, rej) =&gt; &#123;</span><br><span class="line">    worker.onmessage = (&#123; data &#125;) =&gt; &#123;</span><br><span class="line">      res(data), worker.terminate();</span><br><span class="line">    &#125;;</span><br><span class="line">    worker.onerror = err =&gt; &#123;</span><br><span class="line">      rej(err), worker.terminate();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>example</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> const longRunningFunction = () =&gt; &#123;</span><br><span class="line">      <span class="built_in">let</span> result = 0;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; 1000; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">let</span> j = 0; j &lt; 700; j++)</span><br><span class="line">          <span class="keyword">for</span> (<span class="built_in">let</span> k = 0; k &lt; 300; k++) result = result + i + j + k;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line">runAsync(longRunningFunction).<span class="keyword">then</span>(console.log); // 209685000000</span><br></pre></td></tr></table></figure>

<p>ç„¶åç”±äºä»£ç æ˜¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡æ‰§è¡Œçš„ï¼Œå› æ­¤æ‰€æœ‰çš„å˜é‡ä»¥åŠå‡½æ•°å£°æ˜éƒ½è¦åœ¨å†…éƒ¨å®šä¹‰,<br>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ˜¯ä¸è¡Œæ»´ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> outsideVariable = 50;</span><br><span class="line">runAsync(() =&gt; typeof outsideVariable).<span class="keyword">then</span>(console.log); // <span class="string">'undefined'</span></span><br></pre></td></tr></table></figure>

<h2 id="Copy-to-Clipboard"><a href="#Copy-to-Clipboard" class="headerlink" title="Copy to Clipboard"></a>Copy to Clipboard</h2><ol>
<li>åˆ›å»ºä¸€ä¸ª<code>textarea</code>æˆ–è€…<code>input</code>å…ƒç´ æ·»åŠ åˆ°<code>document</code>ä¸­ï¼Œè®©å®ƒçš„å€¼ç­‰äºè¦æˆ‘ä»¬æƒ³è¦å¤åˆ¶åˆ°ç²˜è´´æ¿ä¸Šçš„å€¼</li>
<li>ä½¿ç”¨<code>HTMLInputElement.select()</code> é€‰æ‹© åˆšåˆšåˆ›å»ºçš„å…ƒç´ çš„å†…å®¹</li>
<li>è°ƒç”¨<code>Document.execCommand(&#39;copy&#39;)</code>å¤åˆ¶åˆšåˆšé€‰ä¸­çš„å†…å®¹</li>
<li>å°†åˆšåˆšåˆ›å»ºçš„å…ƒç´ ç§»é™¤</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const copy = val=&gt;&#123;</span><br><span class="line">    const el = document.createElement(<span class="string">'input'</span>)</span><br><span class="line">    input.value = val</span><br><span class="line">    document.body.appendChild(el)</span><br><span class="line">    el.select()</span><br><span class="line">    document.execCommand(<span class="string">'copy'</span>)</span><br><span class="line">    documnet.body.removeChild(el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œåœ¨æ’å…¥ä»¥åŠç§»é™¤å…ƒç´ çš„æ—¶å€™å¯èƒ½ä¼šå‘ç”Ÿé—ªçƒï¼Œä¸€ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠåˆ›å»ºçš„è¿™ä¸ªå…ƒç´ æ”¾ç½®åœ¨ä¸å¯è§åŒºåŸŸï¼Œçœ‹ä¸€ä¸‹æ”¹é€ åçš„æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const copyToClipboard = str =&gt; &#123;</span><br><span class="line">  const el = document.createElement(<span class="string">'textarea'</span>);</span><br><span class="line">  el.value = str;</span><br><span class="line">  el.setAttribute(<span class="string">'readonly'</span>, <span class="string">''</span>);</span><br><span class="line">  el.style.position = <span class="string">'absolute'</span>;</span><br><span class="line">  el.style.left = <span class="string">'-9999px'</span>;</span><br><span class="line">  document.body.appendChild(el);</span><br><span class="line">  el.select();</span><br><span class="line">  document.execCommand(<span class="string">'copy'</span>);</span><br><span class="line">  document.body.removeChild(el);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹-url-æ¥é‡è½½é¡µé¢"><a href="#ä¿®æ”¹-url-æ¥é‡è½½é¡µé¢" class="headerlink" title="ä¿®æ”¹ url æ¥é‡è½½é¡µé¢"></a>ä¿®æ”¹ url æ¥é‡è½½é¡µé¢</h2><br>

<p><strong>ä½¿ç”¨ h5 çš„ history</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const nextURL = <span class="string">'https://my-website.com/page_b'</span>;</span><br><span class="line">const nextTitle = <span class="string">'My new page title'</span>;</span><br><span class="line">const nextState = &#123; additionalInformation: <span class="string">'Updated the URL with JS'</span> &#125;;</span><br><span class="line"><span class="comment"># åœ¨æµè§ˆå™¨å†å²æ–°å»ºä¸€ä¸ªå…¥å£å¹¶ä¸”æ— éœ€é‡æ–°åŠ è½½</span></span><br><span class="line">window.history.pushState(nextState, nextTitle, nextURL);</span><br><span class="line"><span class="comment"># å–ä»£å½“å‰å…¥å£</span></span><br><span class="line">window.history.replaceState(nextState, nextTitle, nextURL);</span><br></pre></td></tr></table></figure>

<p>history api åªå…è®¸è®¿é—®åŒæºç½‘ç«™ï¼Œæ‰€ä»¥ä½ ä¸èƒ½å¯¼èˆªåˆ°åŸŸåå®Œå…¨ä¸ä¸€æ ·çš„ç½‘ç«™</p>
<p><strong>location</strong></p>
<p>location api æ˜¯æ¯”è¾ƒæ—§çš„ä¸œè¥¿äº†ï¼Œå®ƒéœ€è¦é‡è½½é¡µé¢æ‰å¯ä»¥æ”¹å˜æµè§ˆå™¨è®°å½•</p>
<h2 id="è·å–å½“å‰-url"><a href="#è·å–å½“å‰-url" class="headerlink" title="è·å–å½“å‰ url"></a>è·å–å½“å‰ url</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const getBaseUrl = url =&gt;&#123;</span><br><span class="line">    <span class="built_in">return</span> url.indexOf(<span class="string">'?'</span>) &gt;0 ?url.slice(0,url.indexOf(<span class="string">'?'</span>)):url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EXAMPLES</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">getBaseURL(<span class="string">'http://url.com/page?name=Adam&amp;surname=Smith'</span>);</span><br><span class="line"><span class="comment"># 'http://url.com/page'</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>essay</category>
      </categories>
      <tags>
        <tag>essay</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”(7-30)</title>
    <url>/2020/07/30/essay-2/</url>
    <content><![CDATA[<h2 id="ç”¨-ts-å¼€å‘-react-ç»„ä»¶"><a href="#ç”¨-ts-å¼€å‘-react-ç»„ä»¶" class="headerlink" title="ç”¨ ts å¼€å‘ react ç»„ä»¶"></a>ç”¨ ts å¼€å‘ react ç»„ä»¶</h2><br>

<p><strong>åŸºç¡€å‡½æ•°å¼ç»„ä»¶</strong></p>
<p>ä¸ç”¨ä¼ é€’ä»»ä½•çš„ propï¼Œç›´æ¥è¿”å›ä¸€ä¸ª jsx ä½œä¸º react ç»„ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Title</span></span>() &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;h1&gt;Welcome to this application&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p><strong>å¸¦æœ‰ prop çš„å‡½æ•°å¼ç»„ä»¶</strong></p>
<p>å£°æ˜ props ç±»å‹å¹¶å°† prop ä¼ é€’ç»™ jsx</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> GreetingProps = &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> Greeting(props: GreetingProps) &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;p&gt;Hi &#123;props.name&#125; ğŸ‘‹&lt;/p&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹ prop è¿›è¡Œè§£æ„æˆ–è®¸å¯è¯»æ€§æ›´å¥½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> Greeting(&#123; name &#125;: GreetingProps) &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;p&gt;Hi &#123;name&#125; ğŸ‘‹&lt;/p&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡å¦‚ GreetingProps ä¸­çš„ name å¯é€‰ï¼Œé‚£ä¹ˆå°±è¦ç»™ name ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»¥é˜² name ä¼šå˜æˆ undefined</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> LoginMsgProps = &#123;</span><br><span class="line">  name?: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> LoginMsg(&#123; name = <span class="string">"Guest"</span> &#125;: LoginMsgProps) &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;p&gt;Logged <span class="keyword">in</span> as &#123;name&#125;&lt;/p&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Children</strong></p>
<p>å¯¹äº childrenï¼Œæ›´å€¾å‘äºæ˜¾ç¤ºå®šä¹‰ï¼Œè€Œå¯¹äº ReactNode ç±»å‹æ¥è¯´ï¼Œå·²ç»èƒ½å¤Ÿæ¥å—å¤§å¤šæ•°çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ jsxï¼Œstring å­—ç¬¦ä¸²ç­‰ç­‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> CardProps = &#123;</span><br><span class="line">  title: string;</span><br><span class="line">  children: React.ReactNode;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> Card(&#123; title, children &#125;: CardProps) &#123;</span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    &lt;section className=<span class="string">"cards"</span>&gt;</span><br><span class="line">      &lt;h2&gt;&#123;title&#125;&lt;/h2&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä¸éœ€è¦ children å…ƒç´ æ—¶ï¼Œå¯ä»¥æ˜¾ç¤ºå®šä¹‰ children çš„ç±»å‹ä¸º never</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> SaveButtonProps = &#123;</span><br><span class="line"></span><br><span class="line">  children: never</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å½“ä¼ é€’äº† children æ—¶å°±ä¼šæŠ›å‡ºé”™è¯¯</p>
<p><strong>å¯¹ html å…ƒç´ ä½¿ç”¨æ‹“å±•ç¬¦</strong></p>
<p>æ‹“å±•ç¬¦å¯¹äº html å…ƒç´ æ¥è¯´æ˜¯ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©ä½ ç¡®ä¿ä½ æŠŠæ‰€æœ‰çš„ html å±æ€§éƒ½ç»™æŒªåˆ°ä½ éœ€è¦çš„å…ƒç´ ä¸Š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> ButtonProps = JSX.IntrinsicElements[<span class="string">"button"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> Button(&#123; ...allProps &#125;: ButtonProps) &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;button &#123;...allProps&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å±æ€§å¯ä»¥è‡ªå®šä¹‰è®¾è®¡</strong></p>
<p>å½“éœ€è¦å¯¹ html æŸäº›å±æ€§è¿›è¡Œçº¦æŸæ—¶ï¼Œå¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œè‡ªå®šä¹‰è®¾å®š</p>
<p>å¦‚ä¸‹è¿™ä¸ªä¾‹å­ï¼Œå¯¹ type è¿›è¡Œç±»å‹çº¦æŸï¼Œè¿™æ ·ä»…èƒ½è¢«èµ‹äºˆ<code>&quot;primary&quot; | &quot;secondary&quot;</code>è¿™ä¸¤ä¸ªå€¼äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> StyledButton = Omit&lt;</span><br><span class="line">  JSX.IntrinsicElements[<span class="string">"button"</span>],</span><br><span class="line">  <span class="string">"type"</span> | <span class="string">"className"</span></span><br><span class="line">&gt; &amp; &#123;</span><br><span class="line">  <span class="built_in">type</span>: <span class="string">"primary"</span> | <span class="string">"secondary"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> StyledButton(&#123; <span class="built_in">type</span>, ...allProps &#125;: StyledButton) &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;Button className=&#123;`btn-<span class="variable">$&#123;type&#125;</span>`&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Required</strong></p>
<p>ä¸ºäº†é˜²æ­¢è¢« omit å‡ºæ¥çš„å±æ€§ä¼šå¿˜è®°è¿›è¡Œæ·»åŠ ï¼Œå°è£…ä¸€ä¸ª helper æ¥è¿›è¡Œçº¦æŸ,</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> MakeRequired&lt;T, K extends keyof T&gt; = Omit&lt;T, K&gt; &amp;</span><br><span class="line">  Required&lt;&#123; [P <span class="keyword">in</span> K]: T[P] &#125;&gt;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ—¢å¯ä»¥å°†éœ€è¦çº¦æŸçš„å±æ€§omitå‡ºæ¥ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿé˜²æ­¢å¿˜è®°æ·»åŠ è¢«omitå‡ºæ¥çš„å±æ€§</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> ImgProps</span><br><span class="line">  = MakeRequired&lt;</span><br><span class="line">    JSX.IntrinsicElements[<span class="string">"img"</span>],</span><br><span class="line">    <span class="string">"alt"</span> | <span class="string">"src"</span></span><br><span class="line">  &gt;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> Img(&#123; alt, ...allProps &#125;: ImgProps) &#123;</span><br><span class="line">  <span class="built_in">return</span> &lt;img alt=&#123;alt&#125; &#123;...allProps&#125; /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const zz = &lt;Img alt=<span class="string">"..."</span> src=<span class="string">"..."</span> /&gt;;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>essay</category>
      </categories>
      <tags>
        <tag>essay</tag>
      </tags>
  </entry>
  <entry>
    <title>docker</title>
    <url>/2020/07/31/essay-3/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Docker æ˜¯ç”±å¼€å‘äººå‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜ æ„å»º ã€è¿è¡Œå’Œå®¹å™¨å…±äº«çš„åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå¹³å°ã€‚ä½¿ç”¨å®¹å™¨éƒ¨ç½²åº”ç”¨ç¨‹åºç§°ä¹‹ä¸ºé›†è£…ç®±åŒ–ã€‚</p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>docker ä¸ºä»€ä¹ˆèƒ½å¤Ÿè¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œé‚£æ˜¯å› ä¸º:</p>
<ol>
<li><p>çµæ´»æ€§ï¼šå³ä½¿å†å¤æ‚çš„åº”ç”¨ä¹Ÿèƒ½å¤Ÿè¢«å®¹å™¨åŒ–ã€‚</p>
</li>
<li><p>è½»é‡æ€§ï¼šå®¹å™¨å…±äº«ä¸»æœºå†…æ ¸ï¼Œå¹¶ä¸”åœ¨ç³»ç»Ÿèµ„æºåˆ©ç”¨æ–¹é¢æ¯”è™šæ‹Ÿæœºæ›´åŠ çš„é«˜æ•ˆ</p>
</li>
<li><p>ä¾¿æºæ€§ï¼šä½ å¯ä»¥åœ¨æœ¬åœ°å°†åº”ç”¨æ‰“åŒ…æˆé•œåƒï¼Œç„¶åä¸Šä¼ åˆ°äº‘ç«¯ï¼Œç„¶åå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œè¿™ä¸ªé•œåƒ</p>
</li>
<li><p>è§£è€¦ï¼šå®¹å™¨æ‹¥æœ‰é«˜åº¦è‡ªæ²»æƒä»¥åŠå°é—­æ€§ï¼Œä½ å¯ä»¥åœ¨ä¸å¹²æ‰°å…¶ä»–åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å¯¹å…¶ä¸­ä¸€ä¸ªè¿›è¡Œå‡çº§æˆ–è€…æ›¿æ¢</p>
</li>
<li><p>æ‹“å±•æ€§ï¼šå¯ä»¥åœ¨æ•°æ®ä¸­å¿ƒè‡ªåŠ¨åˆ†å‘å®¹å™¨å‰¯æœ¬</p>
</li>
<li><p>å®¹å™¨å¯¹åº”ç”¨éš”ç¦»ï¼Œå¯¹ç”¨æˆ·æ¥è¯´å®Œå…¨æ˜¯é»‘ç›’ï¼Œä¸ç”¨å…³å¿ƒå®¹å™¨å†…å‘é…ç½®</p>
<a id="more"></a>
<h2 id="è§£å†³äº†å“ªäº›é—®é¢˜"><a href="#è§£å†³äº†å“ªäº›é—®é¢˜" class="headerlink" title="è§£å†³äº†å“ªäº›é—®é¢˜"></a>è§£å†³äº†å“ªäº›é—®é¢˜</h2></li>
<li><p>æœ‰æ—¶å€™åœ¨æµ‹è¯•ç¯å¢ƒç¨‹åºè¿è¡Œæ­£å¸¸ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå´å‡ºç°äº†é—®é¢˜ã€‚<code>docker</code>çš„å‡ºç°è®©æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¿æŒäº†ä¸€è‡´æ€§ã€‚</p>
</li>
<li><p>å¯¹äºæ¯ä¸ªæ–°ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æ‰§è¡Œç¨‹åºä¹‹å‰å¿…é¡»åœ¨æœ¬æœºç¯å¢ƒå®‰è£…å¯¹åº”çš„ç¯å¢ƒã€‚<code>docker</code>ä¿è¯äº†ä¸€æ¬¡é…ç½®ï¼Œä¸€é”®éƒ¨ç½²</p>
</li>
<li><p>ç”±äºç‰ˆæœ¬é—®é¢˜å¯¼è‡´ç¨‹åºä¸èƒ½æ­£å¸¸å¯åŠ¨.<code>docker</code>ä¿è¯åœ¨éƒ¨ç½²çš„æ—¶å€™å®‰è£…çš„ç‰ˆæœ¬è·Ÿå¼€å‘æ—¶å€™çš„ç‰ˆæœ¬æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œé‡æ–°å®šä¹‰äº†äº¤ä»˜ç¯å¢ƒ,æ¯”å¦‚å¯¹äº<code>node-sass</code>çš„å®‰è£…ï¼Œä¸åŒç‰ˆæœ¬çš„<code>node-sass</code>è¦å¯¹åº”ä¸åŒç‰ˆæœ¬çš„<code>node</code>ï¼Œå¦åˆ™åœ¨å®‰è£…çš„æ—¶å€™å°±ä¼šå‡ºç°é”™è¯¯ï¼Œéœ€è¦é‡æ–° rebuild</p>
</li>
</ol>
<h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><p>docker å¸¸å¸¸ä¸ å¾®æœåŠ¡æ¶æ„ ä¸€èµ·ä½¿ç”¨<br>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å•æœºæ¶æ„ï¼Œå½“éœ€æ±‚ç®€å•æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å•æœºæ¶æ„è¿›è¡Œå¼€å‘<br><img src="/images/essay-3/esay.jpg" alt="ç®€å•éœ€æ±‚"></p>
<p>ä½†æ˜¯å½“éœ€æ±‚å¼€å§‹å¤æ‚æ—¶ï¼Œå¦‚æœè¿˜ç”¨å•æœºæ¶æ„è¿›è¡Œå¼€å‘</p>
<p><img src="/images/essay-3/complex.jpg" alt="å¤æ‚éœ€æ±‚"></p>
<p>è¿™æ ·çš„è®¾è®¡æ˜¯ä¸å¤ªåˆç†çš„</p>
<ol>
<li>å¯¹äºç½‘ç«™å’Œç§»åŠ¨ç«¯æ¥è¯´ï¼Œæœ‰å¾ˆå¤šç›¸åŒé€»è¾‘çš„ä¸šåŠ¡ä»£ç </li>
<li>æ•°æ®æœ‰æ—¶å€™é€šè¿‡æ•°æ®åº“å…±äº«ï¼Œæœ‰æ—¶å€™é€šè¿‡è°ƒç”¨æ¥å£ä¼ è¾“ã€‚æ¥å£è°ƒç”¨å…³ç³»æ··ä¹±ã€‚</li>
<li>å•ä¸ªåº”ç”¨ä¸ºäº†ç»™å…¶ä»–åº”ç”¨æä¾›ä¸åŒçš„ç»“æ„ï¼Œé€æ¸è¶Šæ”¹è¶Šå¤§ï¼Œè¶Šæ¥è¶Šå¤šçš„ ifelseï¼ŒåŠŸèƒ½å½’å±æ··ä¹±</li>
<li>æ•°æ®åº“ä¸ºå¤šä¸ªåº”ç”¨æä¾›æ•°æ®æ”¯æŒï¼Œéš¾ä»¥é‡æ„å’Œä¼˜åŒ–</li>
<li>æ‰€æœ‰åº”ç”¨éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå½“æ•°æ®é‡åºå¤§æ—¶ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆï¼Œéœ€è¦åˆ†åº“åˆ†è¡¨</li>
<li>éƒ¨ç½²ã€ç»´æŠ¤ã€å¼€å‘å›°éš¾ï¼Œå³ä½¿åªæ”¹åŠ¨ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿéœ€è¦æ•´ä½“åº”ç”¨ä¸€èµ·å‘å¸ƒã€‚å¦‚æœä¸å°å¿ƒå¸¦ä¸Šæœªç»æµ‹è¯•çš„ä»£ç ï¼Œä¹Ÿæœ‰å¯èƒ½å‡ºç°æ„æ–™ä¹‹å¤–çš„é”™è¯¯</li>
</ol>
<p>å°†æœåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œè®©æ¯ä¸ªå®¹å™¨èƒ½å¤Ÿå„å¸å…¶èŒï¼Œåªè´Ÿè´£ä¸€å°éƒ¨åˆ†æ¨¡å—ï¼Œç„¶åå°†å„ä¸ªæœåŠ¡è¿›è¡Œæ‹¼æ¥èµ·æ¥å°±ç»„æˆä¸€ä¸ªå®Œæ•´çš„æœåŠ¡ï¼Œå¹¶ä¸”åœ¨æ›´æ–°ä»£ç æ—¶ä¹Ÿåªéœ€è¦æ›´æ–°å…¶ä¸­ä¸€ä¸ªå®¹å™¨è€Œä¸ç”¨å¯¹æ•´ä¸ªåº”ç”¨è¿›è¡Œæ›´æ–°<br><img src="/images/essay-3/micro_service.jpg" alt="micro_service"></p>
<h2 id="é•œåƒå’Œå®¹å™¨"><a href="#é•œåƒå’Œå®¹å™¨" class="headerlink" title="é•œåƒå’Œå®¹å™¨"></a>é•œåƒå’Œå®¹å™¨</h2><p>ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œå®¹å™¨åªæ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œåº”ç”¨äº†ä¸€äº›æ·»åŠ çš„å°è£…ç‰¹æ€§ä»¥ä¾¿å®ƒèƒ½å’Œä¸»æœºä»¥åŠå…¶ä»–å®¹å™¨åˆ†ç¦»å¼€ã€‚å¯¹äºå®¹å™¨éš”ç¦»æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€å°±æ˜¯æ¯ä¸ªå®¹å™¨å’Œå®ƒè‡ªèº«çš„æ–‡ä»¶ç³»ç»Ÿäº¤äº’ã€‚æ–‡ä»¶ç³»ç»Ÿæ˜¯ç”±<code>docker image</code>æ¥æä¾›çš„ã€‚ä¸€ä¸ª<code>image</code>åŒ…å«äº†ä¸€åˆ‡è¿è¡Œæ‰€éœ€çš„ä¸œè¥¿â€“ ä»£ç æˆ–è€…äºŒè¿›åˆ¶ï¼Œè¿è¡Œä¾èµ–ä»¥åŠå…¶ä»–ä»»ä½•æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ã€‚</p>
<h2 id="å®¹å™¨è¿æ¥"><a href="#å®¹å™¨è¿æ¥" class="headerlink" title="å®¹å™¨è¿æ¥"></a>å®¹å™¨è¿æ¥</h2><p><code>docker</code>å®ä¾‹ä¹‹é—´è™½ç„¶éƒ½æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œä½†æ˜¯éš”ç¦»çš„åªæ˜¯å®ƒä»¬çš„ç¯å¢ƒï¼Œä½†æ˜¯å®ƒä»¬å®¹å™¨ä¹‹å‰ä¹Ÿéœ€è¦äº’ç›¸è”ç³»ï¼Œæ•°æ®ä¹‹é—´çš„ä¼ é€’ï¼Œä¸ç„¶åšæ‹†åˆ†å°±æ²¡æœ‰ä»»ä½•çš„æ„ä¹‰ï¼Œç”¨â€“link æ¥åšå®¹å™¨ä¹‹é—´çš„è¿æ¥ã€‚åŒæ—¶åœ¨åˆ›å»ºå®¹å™¨æ—¶éœ€è¦è®¾å®šå¥½å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„ç«¯å£æ˜ å°„ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡è®¿é—®å®¿ä¸»æœºçš„ç«¯å£æ¥è®¿é—®å®¹å™¨çš„æœåŠ¡ã€‚<br>å¯¹äºå®¹å™¨æ¥è¯´ï¼Œå¦‚æœæŠŠä¸€äº›æ•°æ®å­˜æ”¾åœ¨å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆå½“å®¹å™¨è¢«åˆ é™¤æ—¶ï¼Œé‚£ä¹ˆå­˜æ”¾åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥æ•°æ®åº”è¯¥æ”¾åœ¨å®¿ä¸»æœºä¸­ï¼Œç„¶åæ˜ å°„è¿›å®¹å™¨ä¸­ï¼Œè¿™æ ·å½“å®¹å™¨è¢«åˆ é™¤æ—¶ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨äºå®¿ä¸»æœºä¸­</p>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>æƒ³è¦æŠŠåº”ç”¨ç¼–å†™æˆä¸€ä¸ª docker é•œåƒï¼Œéœ€è¦ç¼–å†™ DokcerFile æ–‡ä»¶</p>
<p>è¿™æ˜¯ä¸€ä¸ª dockerFile æ–‡ä»¶ä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM php:7.4.8-fpm</span><br><span class="line">MAINTAINER liubucai</span><br><span class="line">ENV REDIS_VERSION=5.3.1</span><br><span class="line">ENV SWOOLE_VERSION=4.4.16</span><br><span class="line">ENV PROTOBUF_VERSION=0.12.3</span><br><span class="line">ENV PSR_VERSION=1.0.0</span><br><span class="line"></span><br><span class="line">RUN mv /etc/apt/sources.list /etc/apt/sources.list.bak \</span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">"deb http://mirrors.163.com/debian/ jessie main non-free contri</span></span><br><span class="line"><span class="string">b"</span> &gt;&gt; /etc/apt/sources.list \</span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">"deb-src http://mirrors.163.com/debian/ jessie main non-free co</span></span><br><span class="line"><span class="string">ntrib"</span> &gt;&gt;/etc/apt/sources.list \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; apt-get update &amp;&amp; apt-get upgrade \</span><br><span class="line">&amp;&amp; <span class="built_in">printf</span> <span class="string">"%s %s %s %s %s\n"</span> Yes, <span class="keyword">do</span> as I say! | apt-get install libtin</span><br><span class="line">fo5=5.9+20140913-1+deb8u3 \</span><br><span class="line">&amp;&amp; apt-get install -y libncurses5 procps \</span><br><span class="line">&amp;&amp; <span class="built_in">printf</span> <span class="string">"%s %s %s %s %s\n"</span> Yes, <span class="keyword">do</span> as I say! | apt-get install zlib1g</span><br><span class="line">=1:1.2.8.dfsg-2+b1 \</span><br><span class="line">&amp;&amp; apt-get install -y libssl-dev libzip-dev wget zip vim \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; docker-php-source extract \</span><br><span class="line">&amp;&amp; docker-php-ext-install bcmath sockets pdo_mysql pcntl opcache \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; wget https://github.com/allegro/php-protobuf/archive/master.zip \</span><br><span class="line">&amp;&amp; unzip master.zip &amp;&amp; rm -rf master.zip \</span><br><span class="line">&amp;&amp; mv php-protobuf-master /usr/src/php/ext/ \</span><br><span class="line">&amp;&amp; docker-php-ext-install php-protobuf-master \</span><br><span class="line">&amp;&amp; curl -sS https://getcomposer.org/installer | php \</span><br><span class="line">&amp;&amp; mv composer.phar /usr/<span class="built_in">local</span>/bin/composer \</span><br><span class="line">&amp;&amp; <span class="built_in">cd</span> /usr/src/php/ext/php-protobuf-master/ &amp;&amp; composer install \</span><br><span class="line">&amp;&amp; wget https://github.com/protocolbuffers/protobuf/releases/download/v</span><br><span class="line">3.12.3/protobuf-php-3.12.3.zip \</span><br><span class="line">&amp;&amp; unzip protobuf-php-3.12.3.zip \</span><br><span class="line">&amp;&amp; <span class="built_in">cd</span> protobuf-3.12.3/ \</span><br><span class="line">&amp;&amp; ./configure --prefix=/usr/<span class="built_in">local</span>/protobuf \</span><br><span class="line">&amp;&amp; make &amp;&amp; make install \</span><br><span class="line">&amp;&amp; <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/protobuf/bin:<span class="variable">$PATH</span> \</span><br><span class="line">&amp;&amp; apt-get -y install npm \</span><br><span class="line">&amp;&amp; npm install -g require &amp;&amp; npm install -g browserify &amp;&amp; npm install g</span><br><span class="line">oogle-protobuf \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; pecl install redis-<span class="variable">$&#123;REDIS_VERSION&#125;</span> &amp;&amp; docker-php-ext-enable redis \</span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">"install redis ok !"</span> \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; <span class="built_in">printf</span> <span class="string">"yes\n yes\n yes\n yes\n"</span> | pecl install swoole-$&#123;SWOOLE_VE</span><br><span class="line">RSION&#125; \</span><br><span class="line">&amp;&amp; docker-php-ext-enable swoole \</span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">"install swoole ok !"</span> \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; pecl install psr-<span class="variable">$&#123;PSR_VERSION&#125;</span> &amp;&amp; docker-php-ext-enable psr \</span><br><span class="line">&amp;&amp; <span class="built_in">echo</span> <span class="string">"install psr ok !"</span> \</span><br><span class="line"><span class="comment"># \</span></span><br><span class="line">&amp;&amp; pecl install zip &amp;&amp; docker-php-ext-enable zip</span><br><span class="line"><span class="comment">#VOLUME ["/var/log","/usr/local/etc/","/var/run","/var/www/html"]</span></span><br><span class="line">WORKDIR /var/www/html</span><br><span class="line"></span><br><span class="line">EXPOSE 9000</span><br><span class="line"><span class="comment">#CMD php-fpm -R -D &amp;&amp; tail -f /dev/null</span></span><br></pre></td></tr></table></figure>

<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker compose"></a>docker compose</h2><p>å½“å®¿ä¸»æœºä¸­æ‹¥æœ‰å‡ åä¸ª docker æœåŠ¡æ—¶ï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œ<code>docker run</code> æ— ç–‘æ˜¯å¾ˆè®©äººå´©æºƒçš„ä»¥åŠæ€€ç–‘ä¸–ç•Œ ingï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨ docker compose æ‰å¯¹ docker å®ä¾‹è¿›è¡Œç®¡ç†ï¼Œåªè¦å†™å¥½ docker compose çš„é…ç½®æ–‡ä»¶, ç„¶åæ‰§è¡Œ <code>docker compose start</code> é‚£ä¹ˆå°±ä¼šæ‰§è¡Œé…ç½®æ–‡ä»¶ä¸­çš„ docker å®ä¾‹ï¼ˆå‡è®¾å®¿ä¸»æœºä¸­å·²ç»å¯åŠ¨å¯¹åº”çš„å®¹å™¨ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">networks:</span><br><span class="line">    xxx-game-net:</span><br><span class="line">        driver: bridge <span class="comment"># ä»¥ç½‘æ¡¥çš„å½¢å¼è¿æ¥docker</span></span><br><span class="line">services:</span><br><span class="line">    nginx:</span><br><span class="line">        image: nginx:latest <span class="comment"># å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">        container_name: nginx-xxx</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - 6688:80</span><br><span class="line">        volumes: <span class="comment"># æ˜ å°„é…ç½®æ–‡ä»¶åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">            - ./conf/nginx/conf.d/:/etc/nginx/conf.d</span><br><span class="line">            - ../html:/usr/share/nginx/html</span><br><span class="line">            - ./<span class="built_in">log</span>/nginx:/var/<span class="built_in">log</span>/nginx</span><br><span class="line">        depends_on: <span class="comment"># å¯åŠ¨çš„ä¾èµ–</span></span><br><span class="line">            - mysql</span><br><span class="line">            - redis</span><br><span class="line">            - php-fpm</span><br><span class="line">        networks:</span><br><span class="line">            - xxx-game-net</span><br><span class="line"> mysql:</span><br><span class="line">    image: mysql:latest</span><br><span class="line">    container_name: mysql-xxx</span><br><span class="line">    <span class="built_in">command</span>: --default-authentication-plugin=mysql_native_password</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">        - 6666:3306</span><br><span class="line">    volumes:</span><br><span class="line">        - ./conf/mysql/conf.d/:/etc/mysql/conf.d</span><br><span class="line">        - ./data/mysql:/var/lib/mysql</span><br><span class="line">    environment:</span><br><span class="line">        MYSQL_ROOT_PASSWORD: 123456</span><br><span class="line">    networks:</span><br><span class="line">        - xxx-game-net</span><br><span class="line">php-fpm:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: php-fpm-xxx</span><br><span class="line">    volumes:</span><br><span class="line">        - ../:/data/www</span><br><span class="line">    networks:</span><br><span class="line">        - xxx-game-net</span><br><span class="line">redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    container_name: redis-xxx</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">        - 6668:6379</span><br><span class="line">    volumes:</span><br><span class="line">        - ./data/redis:/data</span><br><span class="line">    networks:</span><br><span class="line">        - xxx-game-net</span><br></pre></td></tr></table></figure>

<p>â€”â€“OVER</p>
]]></content>
      <categories>
        <category>essay</category>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”(8-6)</title>
    <url>/2020/08/06/essay-4/</url>
    <content><![CDATA[<p>å…ˆçœ‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const a = 1</span><br><span class="line">[...[1,2,3]].forEach(item=&gt;console.log(item))</span><br></pre></td></tr></table></figure>

<p>ä¹ä¸€çœ‹ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰æŒºæ­£å¸¸çš„ï¼Œåœ¨æµè§ˆå™¨çš„logçª—å£åº”è¯¥èƒ½è¾“å‡º1ï¼Œ2ï¼Œ3ï¼Œæ‰å¯¹<br>ç„¶ååœ¨æµè§ˆå™¨è·‘ä¸€ä¸‹ï¼Œå‘ç°</p>
<p><img src="/images/essay-4/unexpected_error.png.png" alt="error"></p>
<p>ç„¶åemmæ’æŸ¥äº†ä¸€ä¸‹ï¼Œè¯­æ³•æ˜¯æ²¡é—®é¢˜çš„ï¼Œæµè§ˆå™¨ç‰ˆæœ¬æ˜¯æœ€æ–°çš„å¼€å‘ç‰ˆæœ¬ï¼Œes6çš„è¯­æ³•è‚¯å®šæ˜¯æ”¯æŒçš„ï¼Œé‚£é—®é¢˜å…¶å®å°±æ˜¯a=1 åé¢æ¼äº†åˆ†å·ï¼Œæ‰€ä»¥ä»£ç å°±æˆäº†è¿™æ ·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const a = 1[...[1,2,3]].forEach(item=&gt;console.log(item))</span><br></pre></td></tr></table></figure>

<p>é‚£ä»£ç æˆäº†è¿™æ ·é‚£è‚¯å®šä¸èƒ½æ­£ç¡®è§£æäº†ï½</p>
<p>æœç„¶ï¼Œæ¼å†™åˆ†å·ä¸æ˜¯å¥½ä¹ æƒ¯ï½</p>
]]></content>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”(2020-10-11)</title>
    <url>/2020/10/11/essay-5/</url>
    <content><![CDATA[<h3 id="å‘½ä»¤è¡Œæ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½"><a href="#å‘½ä»¤è¡Œæ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½" class="headerlink" title="å‘½ä»¤è¡Œæ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½"></a>å‘½ä»¤è¡Œæ–‡ä»¶çš„ä¸Šä¼ ä¸ä¸‹è½½</h3><p>æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½å‘½ä»¤éƒ½æ˜¯scp</p>
<p><strong>ä¸Šä¼ </strong><br>ä»æœåŠ¡å™¨ä¸Šä¸‹è½½æ–‡ä»¶ scp username@servername:/path/filename /Users/mac/Desktopï¼ˆæœ¬åœ°ç›®å½•ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp root@47.98.37.170:/root/test.txt /Users/mac/Desktopå°±æ˜¯å°†æœåŠ¡å™¨ä¸Šçš„/root/test.txtä¸‹è½½åˆ°æœ¬åœ°çš„/Users/mac/Desktopç›®å½•ä¸‹ã€‚æ³¨æ„ä¸¤ä¸ªåœ°å€ä¹‹é—´æœ‰ç©ºæ ¼ï¼</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‹è½½</strong><br>ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°æœåŠ¡å™¨ scp /path/filename username@servername:/path ;</p>
<p>noteï¼š ä¸‹è½½å‘½ä»¤å°±æ˜¯å°†ä¸¤ä¸ªè·¯å¾„æ¢ä¸€ä¸ªä½ç½®å°±è¡Œäº†ã€‚</p>
<h3 id="TS-4-0çš„ä¸€äº›æ›´æ–°"><a href="#TS-4-0çš„ä¸€äº›æ›´æ–°" class="headerlink" title="TS 4.0çš„ä¸€äº›æ›´æ–°"></a>TS 4.0çš„ä¸€äº›æ›´æ–°</h3><h4 id="ç±»å‹è§£æ„"><a href="#ç±»å‹è§£æ„" class="headerlink" title="ç±»å‹è§£æ„"></a>ç±»å‹è§£æ„</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> Strings = [string, string];</span><br><span class="line"><span class="built_in">type</span> Numbers = number[]</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Unbounded = [...Strings, ...Numbers, boolean];</span><br><span class="line"><span class="comment"># // [string, string, ...Array&lt;number | boolean&gt;]</span></span><br><span class="line"><span class="comment"># æŒ‰ç…§å®˜æ–¹çš„è§£é‡Šå°±æ˜¯è§£æ„ä¸€ä¸ªå·²çŸ¥é•¿åº¦çš„ç±»å‹çš„æ—¶å€™ï¼Œé‚£ä¹ˆæœ€åçš„ç»“æœç±»å‹ä¹Ÿæ˜¯æ²¡æœ‰ä»»ä½•é™åˆ¶çš„ï¼Œåœ¨è§£æ„ç±»å‹ä¹‹åæ·»åŠ çš„ç±»å‹å£°æ˜éƒ½è¦æ·»åŠ åˆ°è¢«è§£æ„ç±»å‹çš„ç±»å‹ä¸­å»</span></span><br></pre></td></tr></table></figure>

<p>â€”å¾…ç»­å“ˆï¼Œæ˜å¤©æ›´æ–°</p>
]]></content>
      <tags>
        <tag>TypeScript Upload</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”(2020-12-27)</title>
    <url>/2020/12/27/essay-6/</url>
    <content><![CDATA[<ol>
<li>åœ¨vue ts classç»™æ•°ç»„æ·»åŠ å€¼æ—¶æŠ¥é”™<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> default class App&#123;</span><br><span class="line">    list =[]</span><br><span class="line">    <span class="function"><span class="title">_push</span></span>()&#123;</span><br><span class="line">        this.list.push(1)</span><br><span class="line">        <span class="comment"># error </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ç”±äºå®šä¹‰çš„listæ˜¯neverç±»å‹çš„æ•°ç»„ï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿç›´æ¥æ·»åŠ å…ƒç´ ï¼Œæ‰€ä»¥åœ¨å®šä¹‰æ•°ç»„çš„æ—¶å€™éœ€è¦æ˜¾ç¤ºå®šä¹‰ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">list = [] as number[]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>line-height å±æ€§åŒæ ·ä¼šå½±å“ä¼ªå…ƒç´ çš„é«˜åº¦</li>
<li>ts class è‡ªå®šä¹‰vueåŒå‘ç»‘å®š<br>v-modelé»˜è®¤ç›‘å¬inputäº‹ä»¶ï¼Œå¦‚æœæ˜¯checkboxæˆ–è€…radio<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@Modle(<span class="string">'change'</span>) value:any</span><br><span class="line"><span class="comment"># è¿™æ ·vueä¼šç›‘å¬changeï¼Œ$emit('change')æ”¹å˜å¤–éƒ¨ç»‘å®šçš„å€¼</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”</title>
    <url>/2021/01/10/essay-7/</url>
    <content><![CDATA[<p><img src="/images/essay-7/essay.png" alt="essay"></p>
]]></content>
  </entry>
  <entry>
    <title>ç†è§£ flex-basis</title>
    <url>/2020/11/14/flex/</url>
    <content><![CDATA[<p>ä¸Šä¸ªhtmlä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;div class=<span class="string">"parent"</span>&gt;</span><br><span class="line">  &lt;div class=<span class="string">"child"</span>&gt;Child&lt;/div&gt;</span><br><span class="line">  &lt;div class=<span class="string">"child"</span>&gt;Child&lt;/div&gt;</span><br><span class="line">  &lt;div class=<span class="string">"child"</span>&gt;Child&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>cssâ‰ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.parent &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">&#125;</span><br><span class="line">.child &#123;</span><br><span class="line">  flex: 0 1 auto; /* Default flex value */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<html>
<style>
body{
    body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
    Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
}
.parent {
  display: flex;
}
.child {
  flex: 0 1 auto; /* Default flex value */
  /* ä¸Šé¢çš„ä»£ç ç›¸å½“äºæ˜¯
  *flex-grow:0; flex-shrink:1;flex-basis:auto;s
  *
  */
}
.child-grow{
    flex:1 0 auto;
}
.child-flex{
    flex:1 1 auto
}
</style>
<div class="parent">
  <div class="child">Child</div>
  <div class="child">Child</div>
  <div class="child">Child</div>
</div>
</html>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.child &#123;</span><br><span class="line">  flex: [flex-grow] [flex-shrink] [flex-basis];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><span id="showCssText"><span></span></span></p>
<p><button id="toggle">toggle</button></p>
<script>
const btn = document.getElementById("toggle");
btn.addEventListener('click',function(){
        const span = document.getElementById('showCssText');
        [...document.getElementsByClassName('child')].forEach(item=>{
            const classList = item.classList;
            // console.log(classList)
            if(classList.length === 1 ){
                classList.add('child-grow')
                span.innerText = 'flex:1 0 auto;'
            }else if(classList.length === 2){
                classList.add('child-flex')
                span.innerText = 'flex:1 1 auto'
            }else{
                classList.remove('child-flex')
                classList.remove('child-grow')
                span.innerText = 'flex: 0 1 auto; '
            }
        })
})
</script>


<p>flex-basic é»˜è®¤æ˜¯autoï¼Œå‘Šè¯‰å…ƒç´ ä¿æŒä¸€ä¸ªç†æƒ³çš„å°ºå¯¸ï¼›ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹çš„å…ƒç´ å®½åº¦æ˜¯å¤šå°‘ï¼Ÿautoå‘Šè¯‰å…ƒç´ å®ƒçš„å®½åº¦ç”±å®ƒçš„å†…å®¹å†³å®šã€‚ä¸ºäº†è®©å­å…ƒç´ å æ®çˆ¶å…ƒç´ çš„æ‰€æœ‰ç©ºé—´ï¼Œå¯ä»¥ç»™å­å…ƒç´ çš„å®½åº¦è®¾ç½®ä¸º<code>width:100%</code>,æˆ–è€…<code>flex-basis:100%</code>,æˆ–è€…<code>flex-grow:1</code>ã€‚</p>
<p>å½“ç»™flex çš„ç¬¬ä¸‰å€¼ ï¼Œä¹Ÿå°±æ˜¯ flex-basis è®¾ç½®æˆ1000pxæ—¶ï¼Œå®ƒä¼šè¯•ç€å æ®1000pxçš„ç©ºé—´ï¼Œå¦‚æœä¸è¡Œï¼Œå®ƒä¼šç­‰æ¯”ä¾‹å æ®å…¶ä»–å…ƒç´ çš„ç©ºé—´ï¼Œä½†æ˜¯å…¶ä»–å…ƒç´ å†…çš„æ–‡æœ¬é•¿åº¦åŒæ ·ä¼šå½±å“è¿™ä¸ªå…ƒç´ çš„ä½ç½®åˆ†é…ï¼›ä½†æ˜¯åœ¨æ›´å°çš„å±å¹•ä¸Šå¯èƒ½ä¼šå‘ç°å®é™…å®½åº¦å¹¶æ²¡æœ‰1000pxï¼Œè¿™æ˜¯å› ä¸ºç»™äº†shrinkï¼Œè¿™ä¸ªå€¼å‘Šè¯‰å…ƒç´ éœ€è¦å®ƒç­‰å€¼ç¼©å°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.child-three &#123;</span><br><span class="line">  flex: 0 1 1000px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœgrow å’Œ shrinkéƒ½æ˜¯0ï¼Œé‚£ä¹ˆå…ƒç´ ä¸ä¼šç­‰æ¯”ä¾‹å‹ç¼©ï¼Œbasiså¦‚æœè¶…å‡ºçˆ¶å…ƒç´ å®½åº¦ï¼Œé‚£ç›´æ¥è¶…å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.child-three &#123;</span><br><span class="line">  flex: 0 0 1000px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>gitå¸¸ç”¨å‘½ä»¤é›†åˆ</title>
    <url>/2019/08/05/git-command/</url>
    <content><![CDATA[<h5 id="æŸ¥çœ‹å½“å‰å·¥ä½œåŒºçŠ¶æ€"><a href="#æŸ¥çœ‹å½“å‰å·¥ä½œåŒºçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å½“å‰å·¥ä½œåŒºçŠ¶æ€"></a>æŸ¥çœ‹å½“å‰å·¥ä½œåŒºçŠ¶æ€</h5><p><code>git status</code></p>
<h5 id="æäº¤å½“å‰å·¥ä½œåŒºæ–‡ä»¶åˆ°æš‚å­˜åŒº"><a href="#æäº¤å½“å‰å·¥ä½œåŒºæ–‡ä»¶åˆ°æš‚å­˜åŒº" class="headerlink" title="æäº¤å½“å‰å·¥ä½œåŒºæ–‡ä»¶åˆ°æš‚å­˜åŒº"></a>æäº¤å½“å‰å·¥ä½œåŒºæ–‡ä»¶åˆ°æš‚å­˜åŒº</h5><p><code>git add</code></p>
<h5 id="æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯"><a href="#æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯" class="headerlink" title="æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯"></a>æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹åˆ°å½“å‰åˆ†æ”¯</h5><p><code>git commit</code></p>
<a id="more"></a>
<h5 id="æŠŠå½“å‰åˆ†æ”¯æäº¤çš„ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“å»"><a href="#æŠŠå½“å‰åˆ†æ”¯æäº¤çš„ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“å»" class="headerlink" title="æŠŠå½“å‰åˆ†æ”¯æäº¤çš„ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“å»"></a>æŠŠå½“å‰åˆ†æ”¯æäº¤çš„ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“å»</h5><p><code>git push origin master</code></p>
<h5 id="æŸ¥çœ‹ä»“åº“æäº¤è®°å½•"><a href="#æŸ¥çœ‹ä»“åº“æäº¤è®°å½•" class="headerlink" title="æŸ¥çœ‹ä»“åº“æäº¤è®°å½•"></a>æŸ¥çœ‹ä»“åº“æäº¤è®°å½•</h5><p><code>git log</code></p>
<h5 id="å›é€€æäº¤è®°å½•å’Œå·¥ä½œåŒº"><a href="#å›é€€æäº¤è®°å½•å’Œå·¥ä½œåŒº" class="headerlink" title="å›é€€æäº¤è®°å½•å’Œå·¥ä½œåŒº"></a>å›é€€æäº¤è®°å½•å’Œå·¥ä½œåŒº</h5><p><code>git reset --hard &lt;commitid&gt;</code></p>
<h5 id="å›é€€æäº¤è®°å½•"><a href="#å›é€€æäº¤è®°å½•" class="headerlink" title="å›é€€æäº¤è®°å½•"></a>å›é€€æäº¤è®°å½•</h5><p><code>git reset --soft &lt;commitid&gt;</code></p>
<h5 id="ä¿å­˜å½“å‰å°šæœªæ·»åŠ åˆ°æš‚å­˜åŒºä»¥åŠå°šæœªæäº¤åˆ°æœ¬åœ°åˆ†æ”¯çš„ä»£ç -ä¸€èˆ¬ç”¨äºå½“ä¿®æ”¹æ–‡ä»¶çš„æ—¶å€™çªç„¶æƒ³è¦æ‹‰å–è¿œç¨‹ä»“åº“ä»£ç çš„å°´å°¬æƒ…å†µ-ï¼Œstashæ˜¯æœ¬åœ°çš„ï¼Œå½“push-pullçš„æ—¶å€™ä¸ä¼šæŠŠstatshçš„ä»£ç ä¼ è¾“åˆ°è¿œç¨‹ä»“åº“å»"><a href="#ä¿å­˜å½“å‰å°šæœªæ·»åŠ åˆ°æš‚å­˜åŒºä»¥åŠå°šæœªæäº¤åˆ°æœ¬åœ°åˆ†æ”¯çš„ä»£ç -ä¸€èˆ¬ç”¨äºå½“ä¿®æ”¹æ–‡ä»¶çš„æ—¶å€™çªç„¶æƒ³è¦æ‹‰å–è¿œç¨‹ä»“åº“ä»£ç çš„å°´å°¬æƒ…å†µ-ï¼Œstashæ˜¯æœ¬åœ°çš„ï¼Œå½“push-pullçš„æ—¶å€™ä¸ä¼šæŠŠstatshçš„ä»£ç ä¼ è¾“åˆ°è¿œç¨‹ä»“åº“å»" class="headerlink" title="ä¿å­˜å½“å‰å°šæœªæ·»åŠ åˆ°æš‚å­˜åŒºä»¥åŠå°šæœªæäº¤åˆ°æœ¬åœ°åˆ†æ”¯çš„ä»£ç (ä¸€èˆ¬ç”¨äºå½“ä¿®æ”¹æ–‡ä»¶çš„æ—¶å€™çªç„¶æƒ³è¦æ‹‰å–è¿œç¨‹ä»“åº“ä»£ç çš„å°´å°¬æƒ…å†µ)ï¼Œstashæ˜¯æœ¬åœ°çš„ï¼Œå½“push pullçš„æ—¶å€™ä¸ä¼šæŠŠstatshçš„ä»£ç ä¼ è¾“åˆ°è¿œç¨‹ä»“åº“å»"></a>ä¿å­˜å½“å‰å°šæœªæ·»åŠ åˆ°æš‚å­˜åŒºä»¥åŠå°šæœªæäº¤åˆ°æœ¬åœ°åˆ†æ”¯çš„ä»£ç (ä¸€èˆ¬ç”¨äºå½“ä¿®æ”¹æ–‡ä»¶çš„æ—¶å€™çªç„¶æƒ³è¦æ‹‰å–è¿œç¨‹ä»“åº“ä»£ç çš„å°´å°¬æƒ…å†µ)ï¼Œstashæ˜¯æœ¬åœ°çš„ï¼Œå½“push pullçš„æ—¶å€™ä¸ä¼šæŠŠstatshçš„ä»£ç ä¼ è¾“åˆ°è¿œç¨‹ä»“åº“å»</h5><p><code>git stash</code></p>
<h5 id="åœ¨å·¥ä½œåŒºæ˜¾ç¤ºåˆšåˆšåœ¨statshä¿å­˜çš„ä»£ç ä»¥åŠæ–‡ä»¶"><a href="#åœ¨å·¥ä½œåŒºæ˜¾ç¤ºåˆšåˆšåœ¨statshä¿å­˜çš„ä»£ç ä»¥åŠæ–‡ä»¶" class="headerlink" title="åœ¨å·¥ä½œåŒºæ˜¾ç¤ºåˆšåˆšåœ¨statshä¿å­˜çš„ä»£ç ä»¥åŠæ–‡ä»¶"></a>åœ¨å·¥ä½œåŒºæ˜¾ç¤ºåˆšåˆšåœ¨statshä¿å­˜çš„ä»£ç ä»¥åŠæ–‡ä»¶</h5><p><code>git stash apply</code></p>
<h5 id="æŸ¥çœ‹ä¿å­˜åœ¨stashçš„è®°å½•"><a href="#æŸ¥çœ‹ä¿å­˜åœ¨stashçš„è®°å½•" class="headerlink" title="æŸ¥çœ‹ä¿å­˜åœ¨stashçš„è®°å½•"></a>æŸ¥çœ‹ä¿å­˜åœ¨stashçš„è®°å½•</h5><p><code>git stash list</code></p>
<h5 id="æ’¤é”€æŸä¸€ä¸ªæ“ä½œï¼Œå¹¶ä¸”æŠŠå½“å‰æ’¤é”€æ“ä½œå½“æˆä¸€æ¬¡æ–°çš„commitæäº¤"><a href="#æ’¤é”€æŸä¸€ä¸ªæ“ä½œï¼Œå¹¶ä¸”æŠŠå½“å‰æ’¤é”€æ“ä½œå½“æˆä¸€æ¬¡æ–°çš„commitæäº¤" class="headerlink" title="æ’¤é”€æŸä¸€ä¸ªæ“ä½œï¼Œå¹¶ä¸”æŠŠå½“å‰æ’¤é”€æ“ä½œå½“æˆä¸€æ¬¡æ–°çš„commitæäº¤"></a>æ’¤é”€æŸä¸€ä¸ªæ“ä½œï¼Œå¹¶ä¸”æŠŠå½“å‰æ’¤é”€æ“ä½œå½“æˆä¸€æ¬¡æ–°çš„commitæäº¤</h5><p><code>git revert HEAD|&lt;commitid&gt;</code></p>
<h5 id="åˆ é™¤è¿œç¨‹åˆ†æ”¯"><a href="#åˆ é™¤è¿œç¨‹åˆ†æ”¯" class="headerlink" title="åˆ é™¤è¿œç¨‹åˆ†æ”¯"></a>åˆ é™¤è¿œç¨‹åˆ†æ”¯</h5><p><code>git push origin --delete &lt;branchName&gt;</code></p>
<h5 id="åˆ é™¤æœ¬åœ°åˆ†æ”¯"><a href="#åˆ é™¤æœ¬åœ°åˆ†æ”¯" class="headerlink" title="åˆ é™¤æœ¬åœ°åˆ†æ”¯"></a>åˆ é™¤æœ¬åœ°åˆ†æ”¯</h5><p><code>git branch -d|-D &lt;branchName&gt;</code></p>
<h5 id="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯"><a href="#æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯"></a>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</h5><p><code>git branch</code></p>
<h5 id="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯"><a href="#æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯"></a>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</h5><p><code>git branch -a</code></p>
<h5 id="åˆ‡æ¢åˆ†æ”¯ï¼ˆå¦‚æœæœ¬åœ°è¦æ–°å»ºå¹¶ä¸”åˆ‡æ¢ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œè¦æ–°åŠ ä¸Š-bå‚æ•°ï¼ŒæŸ¥çœ‹åˆ†æ”¯ä¸éœ€è¦åŠ -bå‚æ•°ï¼‰"><a href="#åˆ‡æ¢åˆ†æ”¯ï¼ˆå¦‚æœæœ¬åœ°è¦æ–°å»ºå¹¶ä¸”åˆ‡æ¢ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œè¦æ–°åŠ ä¸Š-bå‚æ•°ï¼ŒæŸ¥çœ‹åˆ†æ”¯ä¸éœ€è¦åŠ -bå‚æ•°ï¼‰" class="headerlink" title="åˆ‡æ¢åˆ†æ”¯ï¼ˆå¦‚æœæœ¬åœ°è¦æ–°å»ºå¹¶ä¸”åˆ‡æ¢ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œè¦æ–°åŠ ä¸Š-bå‚æ•°ï¼ŒæŸ¥çœ‹åˆ†æ”¯ä¸éœ€è¦åŠ -bå‚æ•°ï¼‰"></a>åˆ‡æ¢åˆ†æ”¯ï¼ˆå¦‚æœæœ¬åœ°è¦æ–°å»ºå¹¶ä¸”åˆ‡æ¢ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œè¦æ–°åŠ ä¸Š-bå‚æ•°ï¼ŒæŸ¥çœ‹åˆ†æ”¯ä¸éœ€è¦åŠ -bå‚æ•°ï¼‰</h5><p><code>git checkout ï¼ˆ-bï¼‰ &lt;branchName&gt;</code></p>
<h5 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h5><p><code>git rm &lt;fileName&gt;</code></p>
<h5 id="åˆ é™¤æ–‡ä»¶å¤¹"><a href="#åˆ é™¤æ–‡ä»¶å¤¹" class="headerlink" title="åˆ é™¤æ–‡ä»¶å¤¹"></a>åˆ é™¤æ–‡ä»¶å¤¹</h5><p><code>git rm -r &lt;fileName&gt;</code></p>
<h5 id="ä¸‹è½½æŒ‡å®šä»“åº“-è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†"><a href="#ä¸‹è½½æŒ‡å®šä»“åº“-è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†" class="headerlink" title="ä¸‹è½½æŒ‡å®šä»“åº“(è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†)"></a>ä¸‹è½½æŒ‡å®šä»“åº“(è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†)</h5><p><code>git clone &lt;repoUrl&gt;</code></p>
<h5 id="æ·»åŠ å­æ¨¡å—åˆ°å½“å‰ä»“åº“ä¸­"><a href="#æ·»åŠ å­æ¨¡å—åˆ°å½“å‰ä»“åº“ä¸­" class="headerlink" title="æ·»åŠ å­æ¨¡å—åˆ°å½“å‰ä»“åº“ä¸­"></a>æ·»åŠ å­æ¨¡å—åˆ°å½“å‰ä»“åº“ä¸­</h5><p><code>git submodule add &lt;repo url&gt;</code></p>
<h5 id="cloneå¸¦æœ‰å­æ¨¡å—çš„ä»“åº“æ—¶éœ€è¦æ›´æ–°å­æ¨¡å—"><a href="#cloneå¸¦æœ‰å­æ¨¡å—çš„ä»“åº“æ—¶éœ€è¦æ›´æ–°å­æ¨¡å—" class="headerlink" title="cloneå¸¦æœ‰å­æ¨¡å—çš„ä»“åº“æ—¶éœ€è¦æ›´æ–°å­æ¨¡å—"></a>cloneå¸¦æœ‰å­æ¨¡å—çš„ä»“åº“æ—¶éœ€è¦æ›´æ–°å­æ¨¡å—</h5><p><code>git submodule update --init --recursive</code></p>
<h5 id="åˆå§‹åŒ–æœ¬åœ°ä»“åº“"><a href="#åˆå§‹åŒ–æœ¬åœ°ä»“åº“" class="headerlink" title="åˆå§‹åŒ–æœ¬åœ°ä»“åº“"></a>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</h5><p><code>git init</code></p>
<h5 id="æ·»åŠ è¿œç¨‹ä»“åº“"><a href="#æ·»åŠ è¿œç¨‹ä»“åº“" class="headerlink" title="æ·»åŠ è¿œç¨‹ä»“åº“"></a>æ·»åŠ è¿œç¨‹ä»“åº“</h5><p><code>git remote add [option_name] [repo_url]</code></p>
<h5 id="ä»è¿œç¨‹ä»“åº“æ‹‰å–æ–‡ä»¶"><a href="#ä»è¿œç¨‹ä»“åº“æ‹‰å–æ–‡ä»¶" class="headerlink" title="ä»è¿œç¨‹ä»“åº“æ‹‰å–æ–‡ä»¶"></a>ä»è¿œç¨‹ä»“åº“æ‹‰å–æ–‡ä»¶</h5><p><code>git pull origin master</code><br><code>git pull origin master --allow-unrelated-histories</code></p>
<h5 id="æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€"><a href="#æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€"></a>æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€</h5><p><code>git remote -v</code></p>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
    <style>
        .weather {
            width: 100%;
            height: 500px;
            /* background: #212125; */
            display: flex;
            justify-content: flex-start;
            align-content: center;
            color: #e6e8db;
        }
        .cloudy {
            position: relative;
            width: 300px;
            height: 300px;
            border-radius: 100%;
            background: linear-gradient(to top right, #1b9ce2 0, #e0e2e5 90%);
            box-shadow: 0 0 0 10px currentColor inset, 0 0 100px -10px;
        }
        .cloud {
            position: absolute;
            top: 25%;
            left: 40%;
            width: 100px;
            height: 30px;
            border-radius: 20px;
            background-color: #fff;
            box-shadow: 0 0 20px 10px currentColor inset, 0 0 100px -10px #c9e8de;
            animation: move 4000ms infinite ease-in-out;
        }
        .cloud::after {
            left: 45px;
            height: 35px;
            width: 35px;
        }
        .cloud::before {
            left: 15px;
            height: 50px;
            width: 50px;
        }
        .cloud::before,
        .cloud::after {
            content: '';
            position: inherit;
            border-radius: 100%;
            background-color: inherit;
            box-shadow: inherit;
            bottom: 40%;
        }
        @keyframes move {
            50% {
                transform: translateX(-10px);
            }
        }
    </style>
</head>

<body>
    <div class="weather">
        <div class="cloudy">
            <span class="cloud"></span>
        </div>
    </div>

</body>

</html>]]></content>
      <categories>
        <category>tool</category>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºHexoæ­å»ºä¸ªäººåšå®¢</title>
    <url>/2019/08/05/hexo-config/</url>
    <content><![CDATA[<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ol>
<li>å®‰è£…Node</li>
<li>å®‰è£…hexo-cli</li>
<li>ç¡®ä¿æœ‰githubè´¦å·</li>
<li>å®‰è£…git</li>
</ol>
<a id="more"></a>
<h2 id="æ„å»ºhexoé¡¹ç›®"><a href="#æ„å»ºhexoé¡¹ç›®" class="headerlink" title="æ„å»ºhexoé¡¹ç›®"></a>æ„å»ºhexoé¡¹ç›®</h2><h3 id="åˆå§‹åŒ–hexoé¡¹ç›®-é¡¹ç›®åä¸€å®šè¦ç”¨è¿™ä¸ªæ ¼å¼ï¼Œxxxä»£è¡¨çš„æ˜¯ä½ çš„GitHubè´¦å·çš„åç§°"><a href="#åˆå§‹åŒ–hexoé¡¹ç›®-é¡¹ç›®åä¸€å®šè¦ç”¨è¿™ä¸ªæ ¼å¼ï¼Œxxxä»£è¡¨çš„æ˜¯ä½ çš„GitHubè´¦å·çš„åç§°" class="headerlink" title="åˆå§‹åŒ–hexoé¡¹ç›®,é¡¹ç›®åä¸€å®šè¦ç”¨è¿™ä¸ªæ ¼å¼ï¼Œxxxä»£è¡¨çš„æ˜¯ä½ çš„GitHubè´¦å·çš„åç§°"></a>åˆå§‹åŒ–hexoé¡¹ç›®,é¡¹ç›®åä¸€å®šè¦ç”¨è¿™ä¸ªæ ¼å¼ï¼Œxxxä»£è¡¨çš„æ˜¯ä½ çš„GitHubè´¦å·çš„åç§°</h3><p><code>hexo init xxx.github.io</code></p>
<h3 id="è¿›å…¥æ–‡ä»¶å¤¹"><a href="#è¿›å…¥æ–‡ä»¶å¤¹" class="headerlink" title="è¿›å…¥æ–‡ä»¶å¤¹"></a>è¿›å…¥æ–‡ä»¶å¤¹</h3><p><code>cd xxx.github.io</code></p>
<h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><p><code>npm i</code></p>
<h3 id="è¿è¡Œé¡¹ç›®"><a href="#è¿è¡Œé¡¹ç›®" class="headerlink" title="è¿è¡Œé¡¹ç›®"></a>è¿è¡Œé¡¹ç›®</h3><p><code>hexo server</code></p>
<h3 id="æ­å»ºæ–°çš„post-æ–°æ­å»ºçš„postæ”¯æŒmarkdownè¯­æ³•ï¼Œåªè¦ä¸“æ³¨å†™æ–‡å°±OK"><a href="#æ­å»ºæ–°çš„post-æ–°æ­å»ºçš„postæ”¯æŒmarkdownè¯­æ³•ï¼Œåªè¦ä¸“æ³¨å†™æ–‡å°±OK" class="headerlink" title="æ­å»ºæ–°çš„post,æ–°æ­å»ºçš„postæ”¯æŒmarkdownè¯­æ³•ï¼Œåªè¦ä¸“æ³¨å†™æ–‡å°±OK"></a>æ­å»ºæ–°çš„post,æ–°æ­å»ºçš„postæ”¯æŒmarkdownè¯­æ³•ï¼Œåªè¦ä¸“æ³¨å†™æ–‡å°±OK</h3><p><code>hexo new post_name</code></p>
<h2 id="ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²"></a>ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²</h2><h3 id="é…ç½®æ ¹ç›®å½•ä¸‹çš„-config-ymlæ–‡ä»¶"><a href="#é…ç½®æ ¹ç›®å½•ä¸‹çš„-config-ymlæ–‡ä»¶" class="headerlink" title="é…ç½®æ ¹ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶"></a>é…ç½®æ ¹ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶</h3><p>  â‘ urlæ˜¯ä½ è¦éƒ¨ç½²çš„åœ°å€(githubåœ°å€æˆ–è€…è‡ªå·±çš„ç½‘ç«™åœ°å€ï¼Œå¦‚æœä¸æ˜¯éƒ¨ç½²åœ¨æ ¹ç›®å½•ä¸‹ï¼Œurlå¡«å†™ä¸ºå…·ä½“éƒ¨ç½²çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œrootä¸º/fileName/),fileNameä¸ºå…·ä½“çš„è¦éƒ¨ç½²çš„æ–‡ä»¶å¤¹åç§°<br>  â‘¡é…ç½®deployå‚æ•°ï¼Œtypeä¸ºgitï¼Œrepoä¸ºä»“åº“åœ°å€ï¼Œsshå’Œhttpså‡å¯ä»¥ï¼Œbranchä¸ºè¦éƒ¨ç½²çš„åˆ†æ”¯</p>
<h3 id="å®‰è£…ä¾èµ–åŒ…"><a href="#å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¾èµ–åŒ…"></a>å®‰è£…ä¾èµ–åŒ…</h3><p><code>npm install hexo-deployer-git --save</code></p>
<h3 id="æ¸…é™¤ç¼“å­˜æ–‡ä»¶"><a href="#æ¸…é™¤ç¼“å­˜æ–‡ä»¶" class="headerlink" title="æ¸…é™¤ç¼“å­˜æ–‡ä»¶"></a>æ¸…é™¤ç¼“å­˜æ–‡ä»¶</h3><p><code>hexo clean</code></p>
<h3 id="ç”Ÿæˆé™æ€æ–‡ä»¶"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶"></a>ç”Ÿæˆé™æ€æ–‡ä»¶</h3><p><code>hexo generate</code><br>å¯ä»¥ç®€å†™ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š"><a href="#éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š" class="headerlink" title="éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š"></a>éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š</h3><p><code>hexo deploy</code><br>å¯ä»¥ç®€å†™ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h3><p>  æˆ‘é€‰æ‹©çš„æ˜¯nextï¼Œæ‹¥æœ‰ä¸°å¯Œè€Œç®€å•çš„é…ç½®ï¼Œç»“åˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæ‰“é€ å±äºæ‚¨è‡ªå·±çš„åšå®¢,åœ¨hexoæ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¼šåœ¨themesæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªnextçš„å­æ¨¡å—<br>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git submodule add https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></p>
<p>  åœ¨æ ¹ç›®å½•ä¸‹çš„_config.ymlé…ç½®themeï¼šnextä¸»é¢˜å°±å¯ä»¥ç”Ÿæ•ˆäº†(å…³äºæ›´å¤šsubmoduleç”¨æ³•è‡ªè¡Œgoogle)</p>
<h2 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h2><p> éƒ¨ç½²å®Œæˆåå°±å¯ä»¥ç›´æ¥è®¿é—®äº†ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥æ ä¸­è¾“å…¥xxx.github.ioå³å¯ï¼ˆxxxä¸ºä½ çš„GitHubè´¦å·åç§°ï¼‰</p>
<h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ol>
<li>è®°å¾—æŠŠä½ çš„ä»£ç pushåˆ°ä½ çš„remote repoä¸Šï¼Œä¸ç„¶åªèƒ½åœ¨ä¸€å°ç”µè„‘åšå¼€å‘å•¦</li>
<li>å¦å¤–ï¼Œç”±äºåœ¨å½“å‰ä»“åº“ä¸‹æœ‰å­æ¨¡å—å­˜åœ¨ï¼Œå› æ­¤å½“ä½ åœ¨å¦å¤–ä¸€å°ç”µè„‘cloneä½ çš„é¡¹ç›®çš„æ—¶å€™ï¼Œå­æ¨¡å—æ˜¯ä¸ä¼šè‡ªåŠ¨æ›´æ–°çš„,æ‰€ä»¥è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°å­æ¨¡å—ï¼Œå¦åˆ™é¡¹ç›®ä¸å®Œæ•´<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>tool</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>å†…ç½‘ç©¿é€</title>
    <url>/2020/01/08/intranet-contacts/</url>
    <content><![CDATA[<p>å†…ç½‘ç©¿é€å°±æ˜¯æŠŠæœ¬åœ°æœåŠ¡æ˜ å°„åˆ°å…·æœ‰å…¬ç½‘IPåœ°å€çš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è®¿é—®åœ¨å…¬ç½‘ä¸Šçš„æœºå™¨ï¼Œå°±å¯ä»¥è®¿é—®åˆ°å†…ç½‘</p>
<a id="more"></a>
<p>å·¥å…·æŒºå¤šçš„ï¼Œä»Šå¤©åˆšç”¨çš„ngrokï¼Œæ„Ÿè§‰ä¸å¤ªç¨³å®šï¼Œä¸è¿‡èƒ½å‡‘æ´»ç”¨å§ï¼Œå†…ç½‘ç©¿é€è¿™ç©æ„å„¿å¯¹ç§»åŠ¨ç«¯å¼€å‘æ¥è¯´æŒºæ–¹ä¾¿çš„ï¼ŒæŠŠç”µè„‘ä¸Šçš„æœ¬åœ°æœåŠ¡æ˜ å°„åˆ°å¤–ç½‘ç«¯å£ï¼Œç„¶åè¿™æ ·æ‰‹æœºä¹Ÿå°±å¯ä»¥è®¿é—®åœ¨ç”µè„‘ä¸Šçš„æœåŠ¡äº†ï¼Œä¹Ÿèƒ½çƒ­æ›´</p>
<p>ä½¿ç”¨ä¹ŸæŒºæ–¹ä¾¿çš„ï¼Œgoogleæœç´¢ngrokï¼Œç„¶åä¸‹è½½</p>
<p><img src="/images/intranet-contacts/demo1.png" alt="å›¾ç‰‡"></p>
<p>ç„¶åå°±æ˜¯è¿™æ ·äº†</p>
<p><img src="/images/intranet-contacts/demo2.png" alt="å›¾ç‰‡"></p>
<p>ç„¶åä½ å‘ç°ä¸ç®¡æœ¬åœ°è¿˜æ˜¯ngrokç»™ä½ ç”Ÿæˆçš„åœ°å€ï¼Œä½ éƒ½å¯ä»¥è®¿é—®åˆ°æœ¬åœ°å¼€å¯çš„æœåŠ¡ï¼Œä½†æ˜¯æ¯æ¬¡å¼€å¯çš„æ—¶å€™IPéƒ½ä¸ä¸€æ ·hhh</p>
]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>item</title>
    <url>/2020/10/07/item/</url>
    <content><![CDATA[<h3 id="Proposal-for-a-item-method-on-all-the-built-in-indexables"><a href="#Proposal-for-a-item-method-on-all-the-built-in-indexables" class="headerlink" title="Proposal for a .item() method on all the built-in indexables"></a>Proposal for a .item() method on all the built-in indexables</h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç»™æœ‰ç´¢å¼•å¯¹è±¡å†…ç½®çš„ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ª number ç±»å‹çš„ indexï¼Œå¯¹è±¡èƒ½å¤Ÿæ ¹æ® index æ¥ç¡®å®šå€¼ã€‚é‚£å…¶å®çœ‹åˆ°è¿™ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå…·å¤‡ç´¢å¼•çš„å¯¹è±¡è‡ªå·±å°±èƒ½æ ¹æ®ç´¢å¼•æ¥ç¡®å®šå€¼äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å‡ºç°çš„æ„ä¹‰æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå®ƒå…¶å®æ˜¯ç”¨è´Ÿå€¼çš„ index æ¥è·å–å€¼ï¼Œæ¯”å¦‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const arr =[1,2,3]</span><br><span class="line">arr.item(-1) // 3</span><br></pre></td></tr></table></figure>

<p>æ˜¯è¿™æ ·çš„ç”¨æ³•ã€‚<br>é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯æŒ‚è½½åœ¨ Stringï¼ŒArrayï¼ŒTypeArray è¿™ä¸‰ä¸ªæ•°æ®ç»“æ„çš„åŸå‹é“¾ä¸Šã€‚<br>ç„¶åå¯¹äº dom ç»“æ„ä¸­ç±»å‹ document.getElementById()è¿™æ ·çš„è¿”å› NodeList ç»“æ„åœ¨ç»è¿‡ Array.from è½¬åŒ–ä¹‹ååŒæ ·ä¼šæŒ‚è½½ item æ–¹æ³•</p>
<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ç›®å‰è¿˜å¤„äº stage3 é˜¶æ®µï¼Œå› æ­¤æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„ hhhhã€‚ä½†æ˜¯å®˜æ–¹ç»™å‡ºäº† polyfill</p>
<p>Like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> item(n) &#123;</span><br><span class="line">	<span class="comment"># ToInteger() abstract op</span></span><br><span class="line">	n = Math.trunc(n) || 0;</span><br><span class="line">	<span class="comment"># Allow negative indexing from the end</span></span><br><span class="line">	<span class="keyword">if</span>(n &lt; 0) n += this.length;</span><br><span class="line">	<span class="comment"># OOB access is guaranteed to return undefined</span></span><br><span class="line">	<span class="keyword">if</span>(n &lt; 0 || n &gt;= this.length) <span class="built_in">return</span> undefined;</span><br><span class="line">	<span class="comment"># Otherwise, this is just normal property access</span></span><br><span class="line">	<span class="built_in">return</span> this[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Other TypedArray constructors omitted for brevity.</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">let</span> C of [Array, String, Uint8Array]) &#123;</span><br><span class="line">    Object.defineProperty(C.prototype, <span class="string">"item"</span>,</span><br><span class="line">                          &#123; value: item,</span><br><span class="line">                            writable: <span class="literal">true</span>,</span><br><span class="line">                            enumerable: <span class="literal">false</span>,</span><br><span class="line">                            configurable: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>javascriptæµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</title>
    <url>/2019/10/10/javascript-float-num/</url>
    <content><![CDATA[<h3 id="æµ®ç‚¹æ•°é™·é˜±"><a href="#æµ®ç‚¹æ•°é™·é˜±" class="headerlink" title="æµ®ç‚¹æ•°é™·é˜±"></a>æµ®ç‚¹æ•°é™·é˜±</h3><p>åŸæ–‡ï¼š<a href="https://zhuanlan.zhihu.com/ne-fe" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/ne-fe</a></p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaScript æµ®ç‚¹æ•°è¿ç®—æ—¶ç»å¸¸é‡åˆ°ä¼š 0.000000001 å’Œ 0.999999999 è¿™æ ·å¥‡æ€ªçš„ç»“æœï¼Œå¦‚ 0.1+0.2=0.30000000000000004ã€1-0.9=0.09999999999999998ï¼Œå¾ˆå¤šäººçŸ¥é“è¿™æ˜¯æµ®ç‚¹æ•°è¯¯å·®é—®é¢˜ï¼Œä½†å…·ä½“å°±è¯´ä¸æ¸…æ¥šäº†ã€‚æœ¬æ–‡å¸®ä½ ç†æ¸…è¿™èƒŒåçš„åŸç†ä»¥åŠè§£å†³æ–¹æ¡ˆï¼Œè¿˜ä¼šå‘ä½ è§£é‡ŠJSä¸­çš„å¤§æ•°å±æœºå’Œå››åˆ™è¿ç®—ä¸­ä¼šé‡åˆ°çš„å‘ã€‚</p>
<a id="more"></a>
<h3 id="æµ®ç‚¹æ•°çš„å‚¨å­˜"><a href="#æµ®ç‚¹æ•°çš„å‚¨å­˜" class="headerlink" title="æµ®ç‚¹æ•°çš„å‚¨å­˜"></a>æµ®ç‚¹æ•°çš„å‚¨å­˜</h3><p>é¦–å…ˆè¦ææ¸…æ¥š JavaScript å¦‚ä½•å­˜å‚¨å°æ•°ã€‚å’Œå…¶å®ƒè¯­è¨€å¦‚ Java å’Œ Python ä¸åŒï¼ŒJavaScript ä¸­æ‰€æœ‰æ•°å­—åŒ…æ‹¬æ•´æ•°å’Œå°æ•°éƒ½åªæœ‰ä¸€ç§ç±»å‹ â€” Numberã€‚å®ƒçš„å®ç°éµå¾ª IEEE 754 æ ‡å‡†ï¼Œä½¿ç”¨ 64 ä½å›ºå®šé•¿åº¦æ¥è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯æ ‡å‡†çš„ double åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆç›¸å…³çš„è¿˜æœ‰float 32ä½å•ç²¾åº¦ï¼‰ã€‚</p>
<p>è¿™æ ·çš„å­˜å‚¨ç»“æ„ä¼˜ç‚¹æ˜¯å¯ä»¥å½’ä¸€åŒ–å¤„ç†æ•´æ•°å’Œå°æ•°ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p>
<p>64ä½æ¯”ç‰¹åˆå¯åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>ç¬¦å·ä½Sï¼šç¬¬ 1 ä½æ˜¯æ­£è´Ÿæ•°ç¬¦å·ä½ï¼ˆsignï¼‰ï¼Œ0ä»£è¡¨æ­£æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•°</li>
<li>æŒ‡æ•°ä½Eï¼šä¸­é—´çš„ 11 ä½å­˜å‚¨æŒ‡æ•°ï¼ˆexponentï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºæ¬¡æ–¹æ•°</li>
<li>å°¾æ•°ä½Mï¼šæœ€åçš„ 52 ä½æ˜¯å°¾æ•°ï¼ˆmantissaï¼‰ï¼Œè¶…å‡ºçš„éƒ¨åˆ†è‡ªåŠ¨è¿›ä¸€èˆé›¶</li>
</ul>
<p><img src="/images/javascript_float_num/demo1.png" alt="å›¾ç‰‡"></p>
<p>å®é™…æ•°å­—å°±å¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼æ¥è®¡ç®—ï¼š<br><img src="/images/javascript_float_num/demo2.png" alt="å›¾ç‰‡"></p>
<p>å…¬å¼æ¨å¯¼è¿‡ç¨‹è§ç»´åŸºç™¾ç§‘<a href="https://zh.wikipedia.org/wiki/%E9%9B%99%E7%B2%BE%E5%BA%A6%E6%B5%AE%E9%BB%9E%E6%95%B8" target="_blank" rel="noopener">wiki</a></p>
<h3 id="ä¸ºä»€ä¹ˆ0-1-0-2-0-30000000000000004"><a href="#ä¸ºä»€ä¹ˆ0-1-0-2-0-30000000000000004" class="headerlink" title="ä¸ºä»€ä¹ˆ0.1+0.2 =0.30000000000000004?"></a>ä¸ºä»€ä¹ˆ0.1+0.2 =0.30000000000000004?</h3><p>0.1 è½¬æˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸º 0.0001100110011001100(1100å¾ªç¯)ï¼Œ1.100110011001100x2^-4ï¼Œæ‰€ä»¥ E=-4+1023=1019ï¼›M èˆå»é¦–ä½çš„1ï¼Œå¾—åˆ° 100110011â€¦ã€‚<br>è½¬åŒ–æˆåè¿›åˆ¶åä¸º 0.100000000000000005551115123126ï¼Œå› æ­¤å°±å‡ºç°äº†æµ®ç‚¹è¯¯å·®ã€‚<br>æ¥ç€0.1+0.2è®¡ç®—æ­¥éª¤ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0.00011001100110011001100110011001100110011001100110011010 +</span><br><span class="line">0.0011001100110011001100110011001100110011001100110011010 =</span><br><span class="line">0.0100110011001100110011001100110011001100110011001100111</span><br><span class="line">// è½¬æˆåè¿›åˆ¶æ­£å¥½æ˜¯ 0.30000000000000004</span><br></pre></td></tr></table></figure>

<p>å› ä¸º mantissa å›ºå®šé•¿åº¦æ˜¯ 52 ä½ï¼Œå†åŠ ä¸Šçœç•¥çš„ä¸€ä½ï¼Œæœ€å¤šå¯ä»¥è¡¨ç¤ºçš„æ•°æ˜¯ 2^53=9007199254740992ï¼Œå¯¹åº”ç§‘å­¦è®¡æ•°å°¾æ•°æ˜¯ 9.007199254740992ï¼Œè¿™ä¹Ÿæ˜¯ JS æœ€å¤šèƒ½è¡¨ç¤ºçš„ç²¾åº¦ï¼Œå¦‚æœæ•´æ•°å¤§äº 9007199254740992 ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ<br>ç”±äº E æœ€å¤§å€¼æ˜¯ 1023ï¼Œæ‰€ä»¥æœ€å¤§å¯ä»¥è¡¨ç¤ºçš„æ•´æ•°æ˜¯ 2^1024 - 1ï¼Œè¿™å°±æ˜¯èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°ã€‚ä½†ä½ å¹¶ä¸èƒ½è¿™æ ·è®¡ç®—è¿™ä¸ªæ•°å­—ï¼Œå› ä¸ºä» 2^1024 å¼€å§‹å°±å˜æˆäº† Infinity</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.pow(2, 1023)</span><br><span class="line">//8.98846567431158e+307</span><br><span class="line"></span><br><span class="line">//Math.pow(2, 1024)</span><br><span class="line">Infinity</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¯¹äº (2^53, 2^63) ä¹‹é—´çš„æ•°ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p>
<ul>
<li>(2^53, 2^54) ä¹‹é—´çš„æ•°ä¼šä¸¤ä¸ªé€‰ä¸€ä¸ªï¼Œåªèƒ½ç²¾ç¡®è¡¨ç¤ºå¶æ•°</li>
<li>(2^54, 2^55) ä¹‹é—´çš„æ•°ä¼šå››ä¸ªé€‰ä¸€ä¸ªï¼Œåªèƒ½ç²¾ç¡®è¡¨ç¤º4ä¸ªå€æ•°</li>
<li>â€¦ ä¾æ¬¡è·³è¿‡æ›´å¤š2çš„å€æ•°<br>ä¸‹é¢è¿™å¼ å›¾èƒ½å¾ˆå¥½çš„è¡¨ç¤º JavaScript ä¸­æµ®ç‚¹æ•°å’Œå®æ•°ï¼ˆReal Numberï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»<br><img src="/images/javascript_float_num/demo3.jfif" alt="real number"></li>
</ul>
<p>è¦æƒ³è§£å†³å¤§æ•°çš„é—®é¢˜ä½ å¯ä»¥å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ bignumber.jsï¼ŒåŸç†æ˜¯æŠŠæ‰€æœ‰æ•°å­—å½“ä½œå­—ç¬¦ä¸²ï¼Œé‡æ–°å®ç°äº†è®¡ç®—é€»è¾‘ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½æ¯”åŸç”Ÿçš„å·®å¾ˆå¤š</p>
<h3 id="toPrecision-vs-toFixed"><a href="#toPrecision-vs-toFixed" class="headerlink" title="toPrecision vs toFixed"></a>toPrecision vs toFixed</h3><p>æ•°æ®å¤„ç†æ—¶ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¾ˆå®¹æ˜“æ··æ·†ã€‚å®ƒä»¬çš„å…±åŒç‚¹æ˜¯æŠŠæ•°å­—è½¬æˆå­—ç¬¦ä¸²ä¾›å±•ç¤ºä½¿ç”¨ã€‚æ³¨æ„åœ¨è®¡ç®—çš„ä¸­é—´è¿‡ç¨‹ä¸è¦ä½¿ç”¨ï¼Œåªç”¨äºæœ€ç»ˆç»“æœã€‚</p>
<p>ä¸åŒç‚¹å°±éœ€è¦æ³¨æ„ä¸€ä¸‹</p>
<ul>
<li>toPrecision æ˜¯å¤„ç†ç²¾åº¦ï¼Œç²¾åº¦æ˜¯ä»å·¦è‡³å³ç¬¬ä¸€ä¸ªä¸ä¸º0çš„æ•°å¼€å§‹æ•°èµ·ã€‚</li>
<li>toFixed æ˜¯å°æ•°ç‚¹åæŒ‡å®šä½æ•°å–æ•´ï¼Œä»å°æ•°ç‚¹å¼€å§‹æ•°èµ·ã€‚</li>
</ul>
<p>ä¸¤è€…éƒ½èƒ½å¯¹å¤šä½™æ•°å­—åšå‡‘æ•´å¤„ç†ï¼Œä¹Ÿæœ‰äº›äººç”¨ toFixed æ¥åšå››èˆäº”å…¥ï¼Œä½†ä¸€å®šè¦çŸ¥é“å®ƒæ˜¯æœ‰ Bug çš„ã€‚</p>
<p>å¦‚ï¼š1.005.toFixed(2) è¿”å›çš„æ˜¯ 1.00 è€Œä¸æ˜¯ 1.01ã€‚</p>
<p>åŸå› ï¼š 1.005 å®é™…å¯¹åº”çš„æ•°å­—æ˜¯ 1.00499999999999989ï¼Œåœ¨å››èˆäº”å…¥æ—¶å…¨éƒ¨è¢«èˆå»ï¼</p>
<p>è§£æ³•ï¼šä½¿ç”¨ä¸“ä¸šçš„å››èˆäº”å…¥å‡½æ•° Math.round() æ¥å¤„ç†ã€‚ä½† Math.round(1.005 * 100) / 100 è¿˜æ˜¯ä¸è¡Œï¼Œå› ä¸º 1.005 * 100 = 100.49999999999999ã€‚è¿˜éœ€è¦æŠŠä¹˜æ³•å’Œé™¤æ³•ç²¾åº¦è¯¯å·®éƒ½è§£å†³åå†ä½¿ç”¨ Math.roundã€‚</p>
<h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><ul>
<li><a href="https://github.com/dt-fe/number-precision">https://github.com/dt-fe/number-precision</a></li>
<li>BigInt</li>
<li>Number.EPSILON,è¡¨ç¤º 1 ä¸Numberå¯è¡¨ç¤ºçš„å¤§äº 1 çš„æœ€å°çš„æµ®ç‚¹æ•°ä¹‹é—´çš„å·®å€¼ã€‚å¦‚æœä¸¤ä¸ªæ•°çš„å·®å€¼å°äºè¿™ä¸ªï¼Œå°±è®¤ä¸ºè¿™ä¸¤ä¸ªæ•°ç›¸ç­‰</li>
</ul>
]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>jsonpå®ç°</title>
    <url>/2019/11/28/jsonp/</url>
    <content><![CDATA[<p>ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œæ‰€ä»¥å½“ä¸åŒæºå‘é€è¯·æ±‚æ—¶ï¼Œä¼šå‘ç”Ÿè·¨åŸŸï¼Œè¯·æ±‚è¿”å›çš„ç»“æœè¢«æµè§ˆå™¨æ‰€æ‹¦æˆªï¼Œå…¶ä¸­ä¸€ä¸ªè§£å†³åŠæ³•å°±æ˜¯ç”¨jsonp,jqueryä¸­çš„ajaxä¸­å°±æ”¯æŒäº†jsonpçš„æ•°æ®ç±»å‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line"> url: &apos;http://twitter.com/status/user_timeline/padraicb.json?count=10&apos;,</span><br><span class="line"> dataType: &apos;jsonp&apos;,</span><br><span class="line"> success: function onSuccess() &#123; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="ä»€ä¹ˆæ˜¯jsonpï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯jsonpï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯jsonpï¼Ÿ"></a>ä»€ä¹ˆæ˜¯jsonpï¼Ÿ</h3><p>jsonpå°±æ˜¯æˆ‘ä»¬å¼€å‘äººå‘˜åˆ©ç”¨äº†scriptæ ‡ç­¾çš„ç‰¹æ€§æ¥ç»•è¿‡äº†æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œå› ä¸ºscriptåŠ è½½èµ„æºçš„æ—¶å€™ä¸å—æµè§ˆå™¨åŒæºç­–ç•¥çš„å½±å“ï¼Œä½†æ˜¯è¿™ä¸ªç­–ç•¥ï¼ˆåŒæºç­–ç•¥ï¼‰ä¸å…è®¸è¯»å–ä¸å½“å‰ç½‘ç«™ä¸åŒæºçš„å›å¤ï¼Œåªå…è®¸å‘é€è¯·æ±‚ï¼Œä¸å…è®¸è¯»å–è¯·æ±‚</p>
<p>ä¸€ä¸ªç½‘ç«™çš„originç”±ä¸‰åˆ†éƒ¨åˆ†ç»„æˆï¼Œé¦–å…ˆå°±æ˜¯URIçš„æ ¼å¼ï¼ˆhttp://ï¼‰,æ¥ç€æ˜¯ä¸»æœºåï¼ˆæ¯”å¦‚ï¼šbaidu.comï¼‰ï¼Œæœ€åæ˜¯ç«¯å£å·ï¼ˆæ¯”å¦‚ï¼š443ï¼‰ã€‚åƒ <a href="http://logrocket.com" target="_blank" rel="noopener">http://logrocket.com</a> å’Œ https:////logrocket.com æ˜¯ä¸¤ä¸ªä¸åŒçš„originå› ä¸ºURIçš„æ ¼å¼ä¸åŒã€‚</p>
<h3 id="å®ƒæ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"><a href="#å®ƒæ€ä¹ˆå·¥ä½œçš„ï¼Ÿ" class="headerlink" title="å®ƒæ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"></a>å®ƒæ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h3><p>å‡å¦‚æœ¬åœ°ç«¯å£å¯åŠ¨åœ¨localhostï¼š8080ï¼Œæˆ‘ä»¬å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æä¾›json apiçš„æœåŠ¡ä¸Šå»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://www.server.com/api/person/1</span><br></pre></td></tr></table></figure>

<p>ç„¶åå“åº”çš„è¯å¯èƒ½é•¿è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;Maciej&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Cieslar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ç”±äºåŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œä½†æ˜¯æœåŠ¡ç«¯è¿”å›çš„è¯·æ±‚è¢«æµè§ˆå™¨ç»™æ‹¦æˆªäº†ï¼Œå› ä¸ºç½‘ç«™è·ŸæœåŠ¡å™¨ä¸åŒæºã€‚</p>
<p>scriptå…ƒç´ å¯ä»¥ä»£æ›¿æˆ‘ä»¬è‡ªå·±å‘é€è¯·æ±‚ï¼ŒåŒæºç­–ç•¥ä¸é™åˆ¶å®ƒï¼Œå®ƒèƒ½å¤ŸåŠ è½½å¹¶ä¸”æ‰§è¡Œå¤–é“¾èµ„æºçš„jsï¼Œè¿™æ ·çš„è¯æ¯”å¦‚åœ¨ <a href="https://logrocket.comçš„ç½‘ç«™å¯ä»¥ä»ä¸åŒæ¥æºçš„æä¾›å•†åŠ è½½google" target="_blank" rel="noopener">https://logrocket.comçš„ç½‘ç«™å¯ä»¥ä»ä¸åŒæ¥æºçš„æä¾›å•†åŠ è½½google</a> Mapåº“ï¼Œæ¯”å¦‚CDN</p>
<p>é€šè¿‡ç»™scriptä¸­çš„srcèµ‹å€¼æˆæƒ³è¦è®¿é—®çš„è¯·æ±‚ï¼Œscriptæ ‡ç­¾å°†ä¼šè·å–åˆ°å“åº”ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src=&quot;https://www.server.com/api/person/1&quot; async=&quot;true&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œscriptä¼šè‡ªåŠ¨è§£æå¹¶ä¸”æ‰§è¡Œè¿”å›çš„jsä»£ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šé¢è¿”å›çš„ä»£ç ä¼šæ˜¯JSONæ ¼å¼çš„ã€‚JSONä¼šè¢«è§£ææˆjsä»£ç ï¼Œå› æ­¤æµè§ˆå™¨ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯å› ä¸ºJSONä¸æ˜¯æœ‰æ•ˆçš„JSä»£ç <br><img src="https://i0.wp.com/blog.logrocket.com/wp-content/uploads/2019/11/invalid-syntax-error.png?w=730&ssl=1" alt="å›¾ç‰‡"></p>
<p>å› æ­¤æˆ‘ä»¬å¿…é¡»è¿”å›ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„JSä»£ç è¿™æ ·scriptè§£æå¹¶ä¸”è¿è¡Œçš„æ—¶å€™æµè§ˆå™¨æ‰ä¸ä¼šæŠ›å‡ºé”™è¯¯ã€‚æˆ‘ä»¬åªè¦æŠŠè¿”å›çš„JSONèµ‹å€¼ç»™JSå˜é‡æˆ–è€…ä½œä¸ºå‡½æ•°çš„å‚æ•°å°±è¡Œï¼Œæ¯•ç«Ÿæœ¬è´¨ä¸Šæ¥è¯´ï¼ŒJSONä¹Ÿå±äºJSå¯¹è±¡æ ¼å¼ã€‚</p>
<p>å› æ­¤ä¸å…¶è¿”å›çº¯JSONæ ¼å¼ï¼ŒæœåŠ¡å™¨å€’ä¸å¦‚è¿”å›JSä»£ç ã€‚åœ¨è¿”å›çš„ä»£ç ä¸­ï¼Œå°†JSONå¯¹è±¡æ”¾åœ¨è¿”å›çš„å‡½æ•°ä¸­ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå‡½æ•°çš„åå­—éœ€è¦ç”±å®¢æˆ·ç«¯æ¥ä¼ é€’ï¼Œæä¾›çš„å‡½æ•°åå­—åœ¨æŸ¥è¯¢å‚æ•°ä¸­å«åšcallback</p>
<p>åœ¨æŸ¥è¯¢ä¸­æä¾›å›è°ƒå‡½æ•°çš„åå­—åï¼Œæˆ‘ä»¬åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼ˆfunctionï¼‰ï¼Œè¿™ä¸ªå‡½æ•°åœ¨å“åº”è¢«è§£æå¹¶ä¸”æ‰§è¡Œçš„æ—¶å€™å›è°ƒç”¨ä¸€æ¬¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://www.server.com/api/person/1?callback=callbackName</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">callbackName(&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;Maciej&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Cieslar&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºcallbackNameåœ¨æ¥æ”¶åˆ°å›è°ƒçš„æ—¶å€™callbackNameæŒ‚è½½åˆ°windowä¸Šï¼Œå› æ­¤ä¸Šé¢çš„ä»£ç å…¶å®å°±æ˜¯ç›¸å½“äº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">window.callbackName(&#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;Maciej&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;Cieslar&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¼šåœ¨windowä¸Šä¸‹æ–‡æ‰§è¡Œï¼Œè¿™ä¸ªå‡½æ•°å°†ç”±scriptä¸‹è½½çš„ä»£ç æ¥æ‰§è¡Œ</p>
<p>ä¸ºäº†è®©jsonpèƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œå‰åç«¯éƒ½éœ€è¦æ”¯æŒã€‚å½“å¯¹äºå‡½æ•°çš„å‘½åæ²¡æœ‰æ ‡å‡†çš„è§„èŒƒçš„æ—¶å€™ï¼Œå‰ç«¯é€šå¸¸ä¼šç»™å‘é€çš„å‡½æ•°å‘½åä¸ºcallback</p>
<h3 id="åˆ›å»ºä¸€ä¸ªjsonpçš„å®ç°"><a href="#åˆ›å»ºä¸€ä¸ªjsonpçš„å®ç°" class="headerlink" title="åˆ›å»ºä¸€ä¸ªjsonpçš„å®ç°"></a>åˆ›å»ºä¸€ä¸ªjsonpçš„å®ç°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let jsonpID = 0;</span><br><span class="line"></span><br><span class="line">function jsonp(url, timeout = 7500) &#123;</span><br><span class="line">  const head = document.querySelector(&apos;head&apos;);</span><br><span class="line">  jsonpID += 1;</span><br><span class="line"></span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    let script = document.createElement(&apos;script&apos;);</span><br><span class="line">    const callbackName = `jsonpCallback$&#123;jsonpID&#125;`;</span><br><span class="line"></span><br><span class="line">    script.src = encodeURI(`$&#123;url&#125;?callback=$&#123;callbackName&#125;`);</span><br><span class="line">    script.async = true;</span><br><span class="line"></span><br><span class="line">    const timeoutId = window.setTimeout(() =&gt; &#123;</span><br><span class="line">      cleanUp();</span><br><span class="line"></span><br><span class="line">      return reject(new Error(&apos;Timeout&apos;));</span><br><span class="line">    &#125;, timeout);</span><br><span class="line"></span><br><span class="line">    window[callbackName] = data =&gt; &#123;</span><br><span class="line">      cleanUp();</span><br><span class="line"></span><br><span class="line">      return resolve(data);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    script.addEventListener(&apos;error&apos;, error =&gt; &#123;</span><br><span class="line">      cleanUp();</span><br><span class="line"></span><br><span class="line">      return reject(error);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    function cleanUp() &#123;</span><br><span class="line">      window[callbackName] = undefined;</span><br><span class="line">      head.removeChild(script);</span><br><span class="line">      window.clearTimeout(timeoutId);</span><br><span class="line">      script = null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    head.appendChild(script);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šæ‰€ç¤ºï¼ŒjsonpIDæ˜¯ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œå®ƒä¼šç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ä¸€æ— äºŒçš„å‡½æ•°åå­—ã€‚<br>é¦–å…ˆæˆ‘ä»¬æŠŠheadå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨ä¸€ä¸ªå«headçš„å˜é‡ä¸­ï¼Œç„¶åæˆ‘ä»¬ä¼šå¢åŠ jsonpIDæ¥ç¡®ä¿å‡½æ•°åå”¯ä¸€ã€‚åœ¨å‡½æ•°å†…éƒ¨è¿”å›ä¸€ä¸ªpromiseï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªscriptæ ‡ç­¾ä»¥åŠç”±jsonpCallbackå’Œç‹¬ä¸€æ— äºŒçš„IDç»„æˆçš„callbackName,ç„¶åæˆ‘ä»¬æŠŠæä¾›çš„urlæ”¾åˆ°scriptæ ‡ç­¾çš„srcå±æ€§ä¸Šï¼Œè®¾ç½®callbackName = callbackNameï¼Œè¿™ä¸ªå®ç°ä¸æ”¯æŒæ·»åŠ å‚æ•°ï¼Œåªèƒ½getè¯·æ±‚ï¼Œå¯ä»¥æ·»åŠ asyncç¡®ä¿ä¸ä¼šé˜»å¡æµè§ˆå™¨</p>
<p>è¿”å›çš„ç»“æœæœ‰ä¸‰ç§å¯èƒ½</p>
<ul>
<li>è¦ä¹ˆæ­£ç¡®  </li>
<li>è¦ä¹ˆé”™è¯¯  </li>
<li>è¦ä¹ˆè¶…æ—¶<br>åœ¨ä¸Šé¢çš„ä»£ç ä¸­éƒ½åšäº†å¤„ç†</li>
</ul>
<p>åœ¨cleanUpå‡½æ•°ä¸­æŠ½è±¡æ¸…ç†è¿‡ç¨‹ï¼Œä¸‰ä¸ªå‡½æ•°-è¶…æ—¶ï¼ŒæˆåŠŸï¼Œå¤±è´¥-çœ‹èµ·æ¥éƒ½é•¿ä¸€æ · </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const timeoutId = window.setTimeout(() =&gt; &#123;</span><br><span class="line">  cleanUp();</span><br><span class="line"></span><br><span class="line">  return reject(new Error(&apos;Timeout&apos;));</span><br><span class="line">&#125;, timeout);</span><br><span class="line"></span><br><span class="line">window[callbackName] = data =&gt; &#123;</span><br><span class="line">  cleanUp();</span><br><span class="line"></span><br><span class="line">  return resolve(data);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">script.addEventListener(&apos;error&apos;, error =&gt; &#123;</span><br><span class="line">  cleanUp();</span><br><span class="line"></span><br><span class="line">  return reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨è¯·æ±‚å®Œæˆåè°ƒç”¨cleanUpå‡½æ•°,æ³¨é”€æŒ‚è½½åœ¨windowä¸Šçš„callbackNameï¼Œç§»é™¤scriptèŠ‚ç‚¹ï¼Œæ¸…é™¤å®šæ—¶å™¨ï¼Œå°†scriptç½®ç©ºï¼Œè®©scriptèƒ½è¢«æµè§ˆå™¨æ­£å¸¸GC</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function cleanUp() &#123;</span><br><span class="line">  window[callbackName] = undefined;</span><br><span class="line">  head.removeChild(script);</span><br><span class="line">  window.clearTimeout(timeoutId);</span><br><span class="line">  script = null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å†æŠŠscriptæ’å…¥åˆ°headå¤´ä¸­ï¼Œscriptå°†ä¼šåœ¨æ’å…¥çš„æ—¶å€™è‡ªåŠ¨å‘é€è¯·æ±‚,<br>æ¥ä¸ªä¾‹å­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jsonp(</span><br><span class="line">  &apos;https://gist.github.com/maciejcieslar/1c1f79d5778af4c2ee17927de769cea3.json&apos;</span><br><span class="line">)</span><br><span class="line">  .then(console.log)</span><br><span class="line">  .catch(console.error);</span><br></pre></td></tr></table></figure>

<p>PSï¼šå½“åˆè¢«é—®çš„æ—¶å€™å°±ä¸ä¼šï¼Œå¥½æ°”å•Š</p>
]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeç¬¬1003ä¹‹æ£€æŸ¥æ›¿æ¢åçš„è¯æ˜¯å¦æœ‰æ•ˆ</title>
    <url>/2019/08/08/leetcode-1003/</url>
    <content><![CDATA[<p>æè¿°ï¼š: ç»™å®šæœ‰æ•ˆå­—ç¬¦ä¸² â€œabcâ€ã€‚<br>å¯¹äºä»»ä½•æœ‰æ•ˆçš„å­—ç¬¦ä¸² Vï¼Œæˆ‘ä»¬å¯ä»¥å°† V åˆ†æˆä¸¤ä¸ªéƒ¨åˆ† X å’Œ Yï¼Œä½¿å¾— X + Yï¼ˆX ä¸ Y è¿æ¥ï¼‰ç­‰äº Vã€‚ï¼ˆX æˆ– Y å¯ä»¥ä¸ºç©ºã€‚ï¼‰é‚£ä¹ˆï¼ŒX + â€œabcâ€ + Y ä¹ŸåŒæ ·æ˜¯æœ‰æ•ˆçš„ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœ S = â€œabcâ€ï¼Œåˆ™æœ‰æ•ˆå­—ç¬¦ä¸²çš„ç¤ºä¾‹æ˜¯ï¼šâ€abcâ€ï¼Œâ€aabcbcâ€ï¼Œâ€abcabcâ€ï¼Œâ€abcabcababccâ€ã€‚æ— æ•ˆå­—ç¬¦ä¸²çš„ç¤ºä¾‹æ˜¯ï¼šâ€abccbaâ€ï¼Œâ€abâ€ï¼Œâ€cababcâ€ï¼Œâ€bacâ€ã€‚<br>å¦‚æœç»™å®šå­—ç¬¦ä¸² S æœ‰æ•ˆï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™ï¼Œè¿”å› false</p>
<a id="more"></a>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;string&#125; S</span><br><span class="line"> * @<span class="built_in">return</span> &#123;boolean&#125;</span><br><span class="line"> */</span><br><span class="line">var isValid = <span class="keyword">function</span>(S) &#123;</span><br><span class="line">    <span class="built_in">let</span> temp= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">while</span>(S.indexOf(<span class="string">'abc'</span>)!=-1)&#123;</span><br><span class="line">        temp= S.split(<span class="string">'abc'</span>).filter(item=&gt;item).join(<span class="string">""</span>);</span><br><span class="line">        S = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    const isFlag=(str)=&gt;&#123;</span><br><span class="line">         <span class="built_in">return</span> str ==<span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> isFlag(S);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeç¬¬70ä¹‹çˆ¬æ¥¼æ¢¯</title>
    <url>/2019/08/08/leetcode-70/</url>
    <content><![CDATA[<p>æè¿°ï¼šå‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</p>
<p>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</p>
<p>æ³¨æ„ï¼šç»™å®š n æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚<br>ä¸¤ç§å†™æ³•ï¼Œä¸€ç§é€’å½’ï¼Œä¸€ç§å¼€å¾ªç¯ã€‚<br>å†™é€’å½’æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æ•°æ®é‡åºå¤§çš„æ—¶å€™ï¼Œé€’å½’ä¼šçˆ†æ ˆï¼Œå¼€å¾ªç¯å°±ä¸å­˜åœ¨çˆ†æ ˆçš„é—®é¢˜ï¼Œå› ä¸ºå¾ªç¯åªæ˜¯åœ¨ä¸€ä¸ªè°ƒç”¨æ ˆæ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸ä¼šåƒé€’å½’ä¸€æ ·é‡å¤è®¡ç®—å€¼ã€‚</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * çˆ¬æ¥¼æ¢¯</span><br><span class="line"> * @param &#123;number&#125; n</span><br><span class="line"> * @<span class="built_in">return</span> &#123;number&#125;</span><br><span class="line"> */</span><br><span class="line">var climbStairs = <span class="keyword">function</span>(n) &#123;</span><br><span class="line">    <span class="built_in">let</span> ans =[1,2];</span><br><span class="line">    <span class="keyword">if</span>(n==1||n==2)&#123;</span><br><span class="line">        <span class="built_in">return</span> ans[n-1];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> i = 2;i&lt;n;i++)&#123;</span><br><span class="line">        ans[i]=ans[i-1]+ans[i-2];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> ans[n-1]</span><br><span class="line"></span><br><span class="line">    // <span class="keyword">else</span> &#123;</span><br><span class="line">    //     <span class="built_in">return</span> climbStairs(n-1)+climbStairs(n-2);</span><br><span class="line">    // &#125;</span><br><span class="line">&#125;;</span><br><span class="line">console.log(<span class="string">"climbStairs(44):"</span>, climbStairs(44));</span><br><span class="line">// climbStairs(3)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeç¬¬73ä¹‹çŸ©é˜µç½®0</title>
    <url>/2019/08/08/leetcode-73/</url>
    <content><![CDATA[<p>æè¿°ï¼š: ç»™å®šä¸€ä¸ª m x n çš„çŸ©é˜µï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ ä¸º 0ï¼Œåˆ™å°†å…¶æ‰€åœ¨è¡Œå’Œåˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½è®¾ä¸º 0ã€‚è¯·ä½¿ç”¨åŸåœ°ç®—æ³•ã€‚</p>
<a id="more"></a>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;number[][]&#125; matrix</span><br><span class="line"> * @<span class="built_in">return</span> &#123;void&#125; Do not <span class="built_in">return</span> anything, modify matrix <span class="keyword">in</span>-place instead.</span><br><span class="line"> */</span><br><span class="line">var setZeroes = <span class="keyword">function</span>(matrix) &#123;</span><br><span class="line">    <span class="built_in">let</span> columns=new Set(),rows=new Set();</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> row =0;row&lt;matrix.length;row++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">let</span> column =0;column&lt;matrix[row].length;column++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(matrix[row][column]==0)&#123;</span><br><span class="line">                columns.add(column);</span><br><span class="line">                rows.add(row);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> row =0;row&lt;matrix.length;row++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">let</span> column =0;column&lt;matrix[row].length;column++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(rows.has(row)||columns.has(column))&#123;</span><br><span class="line">               matrix[row][column]=0;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> matrix;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>é¢˜è§£ï¼šå°†0æ‰€åœ¨çš„è¡Œåˆ—å‚¨å­˜èµ·æ¥ä½œä¸ºæ ‡è®°ï¼Œç¬¬äºŒæ¬¡å¾ªç¯çš„æ—¶å€™åˆ¤æ–­å…ƒç´ å½“å‰æ‰€åœ¨è¡Œæˆ–è€…åˆ—æ˜¯å¦åœ¨æ ‡è®°çš„è¡Œæˆ–åˆ—å³å¯</p>
]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeç¬¬289ä¹‹ç”Ÿå‘½æ¸¸æˆ</title>
    <url>/2019/08/08/leetcode_289/</url>
    <content><![CDATA[<p>æè¿°ï¼šæ ¹æ®ç™¾åº¦ç™¾ç§‘ï¼Œç”Ÿå‘½æ¸¸æˆï¼Œç®€ç§°ä¸ºç”Ÿå‘½ï¼Œæ˜¯è‹±å›½æ•°å­¦å®¶çº¦ç¿°Â·ä½•é¡¿Â·åº·å¨åœ¨1970å¹´å‘æ˜çš„ç»†èƒè‡ªåŠ¨æœºã€‚</p>
<p>ç»™å®šä¸€ä¸ªåŒ…å« m Ã— n ä¸ªæ ¼å­çš„é¢æ¿ï¼Œæ¯ä¸€ä¸ªæ ¼å­éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç»†èƒã€‚æ¯ä¸ªç»†èƒå…·æœ‰ä¸€ä¸ªåˆå§‹çŠ¶æ€ liveï¼ˆ1ï¼‰å³ä¸ºæ´»ç»†èƒï¼Œ æˆ– deadï¼ˆ0ï¼‰å³ä¸ºæ­»ç»†èƒã€‚æ¯ä¸ªç»†èƒä¸å…¶å…«ä¸ªç›¸é‚»ä½ç½®ï¼ˆæ°´å¹³ï¼Œå‚ç›´ï¼Œå¯¹è§’çº¿ï¼‰çš„ç»†èƒéƒ½éµå¾ªä»¥ä¸‹å››æ¡ç”Ÿå­˜å®šå¾‹ï¼š</p>
<p>å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®çš„æ´»ç»†èƒæ•°å°‘äºä¸¤ä¸ªï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›<br>å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒä»ç„¶å­˜æ´»ï¼›<br>å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰è¶…è¿‡ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›<br>å¦‚æœæ­»ç»†èƒå‘¨å›´æ­£å¥½æœ‰ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ­»ç»†èƒå¤æ´»ï¼›<br>æ ¹æ®å½“å‰çŠ¶æ€ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—é¢æ¿ä¸Šç»†èƒçš„ä¸‹ä¸€ä¸ªï¼ˆä¸€æ¬¡æ›´æ–°åçš„ï¼‰çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯é€šè¿‡å°†ä¸Šè¿°è§„åˆ™åŒæ—¶åº”ç”¨äºå½“å‰çŠ¶æ€ä¸‹çš„æ¯ä¸ªç»†èƒæ‰€å½¢æˆçš„ï¼Œå…¶ä¸­ç»†èƒçš„å‡ºç”Ÿå’Œæ­»äº¡æ˜¯åŒæ—¶å‘ç”Ÿçš„ã€‚</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * leetcode ç”Ÿå‘½æ¸¸æˆ</span><br><span class="line"> * @param &#123;number[][]&#125; board</span><br><span class="line"> * @<span class="built_in">return</span> &#123;void&#125; Do not <span class="built_in">return</span> anything, modify board <span class="keyword">in</span>-place instead.</span><br><span class="line"> */</span><br><span class="line">var gameOfLife = <span class="keyword">function</span>(board) &#123;</span><br><span class="line">    //é¢å¤–ç©ºé—´æ³•</span><br><span class="line">  <span class="built_in">let</span> tempArr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; board.length; i++) &#123;</span><br><span class="line">    <span class="built_in">let</span> [...arr] = board[i];</span><br><span class="line">    tempArr.push(arr);</span><br><span class="line">  &#125;</span><br><span class="line">  const flag = (point, data, flag) =&gt; &#123;</span><br><span class="line">    <span class="built_in">let</span> count = 0;</span><br><span class="line">    <span class="built_in">let</span> top = 0,</span><br><span class="line">      bottom = data.length - 1;</span><br><span class="line">    //ä¸Šä¸‹å·¦å³å››ä¸ªè¾¹ç•Œ</span><br><span class="line">    //å…«ä¸ªç‚¹ å¾ªç¯ä¸‰å±‚</span><br><span class="line">    <span class="keyword">if</span> (top &lt; point.x) &#123;</span><br><span class="line">      //è¯´æ˜å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€å±‚èŠ‚ç‚¹å­˜åœ¨è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = point.y - 1; i &lt;= point.y + 1; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[point.x - 1][i] == flag) &#123;</span><br><span class="line">          ++count;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = point.y - 1; i &lt;= point.y + 1; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (data[point.x][i] == flag &amp;&amp; i != point.y) &#123;</span><br><span class="line">        ++count;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (bottom &gt; point.x) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = point.y - 1; i &lt;= point.y + 1; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[point.x + 1][i] == flag) &#123;</span><br><span class="line">          ++count;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> count;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">let</span> x = 0; x &lt; board.length; x++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> y = 0; y &lt; board[0].length; y++) &#123;</span><br><span class="line">      const point = &#123;</span><br><span class="line">        x,</span><br><span class="line">        y</span><br><span class="line">      &#125;;</span><br><span class="line">      const count = flag(point, board, 1);</span><br><span class="line">      <span class="keyword">if</span> (count &lt; 2 &amp;&amp; board[x][y] == 1) &#123;</span><br><span class="line">        tempArr[x][y] = 0;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((count == 2 || count == 3) &amp;&amp; board[x][y] == 1) &#123;</span><br><span class="line">        tempArr[x][y] = 1;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count &gt; 3 &amp;&amp; board[x][y] == 1) &#123;</span><br><span class="line">        tempArr[x][y] = 0;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count == 3 &amp;&amp; board[x][y] == 0) &#123;</span><br><span class="line">        tempArr[x][y] = 1;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> Object.assign(board, tempArr);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// console.log(<span class="string">"gameOfLife([\r\n    [0,1,0],\r\n    [0,0,1],\r\n    [1,1,1],\r\n    [0,0,0]\r\n  ]):"</span>, gameOfLife([</span><br><span class="line">//     [0,1,0],</span><br><span class="line">//     [0,0,1],</span><br><span class="line">//     [1,1,1],</span><br><span class="line">//     [0,0,0]</span><br><span class="line">//   ]));</span><br><span class="line">// gameOfLife([</span><br><span class="line">//     [0,1,0],</span><br><span class="line">//     [0,0,1],</span><br><span class="line">//     [1,1,1],</span><br><span class="line">//     [0,0,0]</span><br><span class="line">//   ]);</span><br><span class="line"></span><br><span class="line">var _gameOfLife = <span class="keyword">function</span>(board) &#123;</span><br><span class="line">    //åŸåœ°ç®—æ³•</span><br><span class="line">  const flag = (point, data, flag) =&gt; &#123;</span><br><span class="line">    <span class="built_in">let</span> count = 0;</span><br><span class="line">    <span class="built_in">let</span> top = 0,</span><br><span class="line">      bottom = data.length - 1;</span><br><span class="line">    </span><br><span class="line">    //ä¸Šä¸‹å·¦å³å››ä¸ªè¾¹ç•Œ</span><br><span class="line">    //å…«ä¸ªç‚¹ å¾ªç¯ä¸‰å±‚</span><br><span class="line">    <span class="keyword">if</span> (top &lt; point.x) &#123;</span><br><span class="line">      //è¯´æ˜å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€å±‚èŠ‚ç‚¹å­˜åœ¨è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = point.y - 1; i &lt;= point.y + 1; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[point.x - 1][i] == flag[0]||data[point.x - 1][i] == flag[1]) &#123;</span><br><span class="line">          ++count;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = point.y - 1; i &lt;= point.y + 1; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((data[point.x ][i] == flag[0]||data[point.x ][i] == flag[1]) &amp;&amp; i != point.y) &#123;</span><br><span class="line">        ++count;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (bottom &gt; point.x) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = point.y - 1; i &lt;= point.y + 1; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[point.x +1][i] == flag[0]||data[point.x +1][i] == flag[1]) &#123;</span><br><span class="line">          ++count;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> count;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">let</span> x = 0; x &lt; board.length; x++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> y = 0; y &lt; board[0].length; y++) &#123;</span><br><span class="line">      const point = &#123;</span><br><span class="line">        x,</span><br><span class="line">        y</span><br><span class="line">      &#125;;</span><br><span class="line">      //alive -&gt; dead -2</span><br><span class="line">      //dead -&gt; alive 2</span><br><span class="line">      const count = flag(point, board, [1,-2]);</span><br><span class="line">      <span class="keyword">if</span> (count &lt; 2 &amp;&amp; board[x][y] == 1) &#123;</span><br><span class="line">        board[x][y] = -2;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((count == 2 || count == 3) &amp;&amp; board[x][y] == 1) &#123;</span><br><span class="line">        board[x][y] = 1;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count &gt; 3 &amp;&amp; board[x][y] == 1) &#123;</span><br><span class="line">        board[x][y] = -2;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count == 3 &amp;&amp; board[x][y] == 0) &#123;</span><br><span class="line">        board[x][y] = 2;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">let</span> x = 0; x &lt; board.length; x++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> y = 0; y &lt; board[0].length; y++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (board[x][y] == -2) &#123;</span><br><span class="line">        board[x][y]=0;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(board[x][y]==2)&#123;</span><br><span class="line">        board[x][y]=1;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> board;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">console.log(<span class="string">"\r\n_gameOfLife([\r\n    [0,1,0],\r\n    [0,0,1],\r\n    [1,1,1],\r\n    [0,0,0]\r\n  ]):"</span>, </span><br><span class="line">_gameOfLife([</span><br><span class="line">    [0,1,0],[0,0,1],[1,1,1],[0,0,0]</span><br><span class="line">  ]));</span><br><span class="line"></span><br><span class="line">_gameOfLife([</span><br><span class="line">    [0,1,0],[0,0,1],[1,1,1],[0,0,0]</span><br><span class="line">  ])</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeç¬¬55ä¹‹è·³è·ƒæ¸¸æˆ</title>
    <url>/2019/08/08/leetcode_55/</url>
    <content><![CDATA[<p> æè¿°:ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</p>
<p>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚</p>
<p>åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;number[]&#125; nums</span><br><span class="line"> * @<span class="built_in">return</span> &#123;boolean&#125;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">var canJump = <span class="keyword">function</span>(nums) &#123;</span><br><span class="line">    const length = nums.length;</span><br><span class="line">    <span class="built_in">let</span> lastIndex = nums.length-1;</span><br><span class="line">    const res = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> i=lastIndex;i&gt;=0;--i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]+i&gt;=lastIndex)&#123;</span><br><span class="line">             </span><br><span class="line">                lastIndex = i;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> lastIndex == 0 ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>leetcode</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>é“¾è¡¨</title>
    <url>/2019/08/13/listNode/</url>
    <content><![CDATA[<p>é“¾è¡¨ç›¸æ¯”æ•°ç»„è€Œè¨€ï¼Œé“¾è¡¨å¯¹æ•°æ®çš„æ’å…¥æ•°æ®çš„ç©ºé—´å¤æ‚åº¦ä¸ºo(1)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">*é“¾è¡¨èŠ‚ç‚¹</span><br><span class="line">*param &#123;*&#125; val</span><br><span class="line">*param &#123;ListNode&#125; next</span><br><span class="line">**/</span><br><span class="line">function ListNode(val,next=null)&#123;</span><br><span class="line">    this.val = val;</span><br><span class="line">    this.next = next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">*å°†æ•°ç»„è½¬ä¸ºé“¾è¡¨</span><br><span class="line">*param &#123;array&#125; a</span><br><span class="line">*param &#123;ListNode&#125; </span><br><span class="line">**/</span><br><span class="line">const getListFromArray=a=&gt;&#123;</span><br><span class="line">    let dummy = new ListNode()</span><br><span class="line">    let pre =dummy;</span><br><span class="line">    a.forEach(x =&gt; &#123;</span><br><span class="line">        return pre=pre.next=new ListNode(x);</span><br><span class="line">    &#125;);</span><br><span class="line">    return dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é¡ºåºéå†é“¾è¡¨"><a href="#é¡ºåºéå†é“¾è¡¨" class="headerlink" title="é¡ºåºéå†é“¾è¡¨"></a>é¡ºåºéå†é“¾è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let listNodeArr = getListFromArray(arr);</span><br><span class="line">while(listNodeArr!=null)&#123;</span><br><span class="line">    console.log(listNodeArr.val);</span><br><span class="line">    listNodeArr=listNodeArr.next;</span><br><span class="line">&#125;</span><br><span class="line">//1 2 3 4 5 6</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"><a href="#åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹" class="headerlink" title="åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"></a>åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</h3><p>ç¬¬ä¸€ä¸ªæŒ‡é’ˆä»åˆ—è¡¨çš„å¼€å¤´å‘å‰ç§»åŠ¨ n+1n+1 æ­¥ï¼Œè€Œç¬¬äºŒä¸ªæŒ‡é’ˆå°†ä»åˆ—è¡¨çš„å¼€å¤´å‡ºå‘ã€‚ç°åœ¨ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆè¢« nn ä¸ªç»“ç‚¹åˆ†å¼€ã€‚æˆ‘ä»¬é€šè¿‡åŒæ—¶ç§»åŠ¨ä¸¤ä¸ªæŒ‡é’ˆå‘å‰æ¥ä¿æŒè¿™ä¸ªæ’å®šçš„é—´éš”ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªæŒ‡é’ˆåˆ°è¾¾æœ€åä¸€ä¸ªç»“ç‚¹ã€‚æ­¤æ—¶ç¬¬äºŒä¸ªæŒ‡é’ˆå°†æŒ‡å‘ä»æœ€åä¸€ä¸ªç»“ç‚¹æ•°èµ·çš„ç¬¬ nn ä¸ªç»“ç‚¹ã€‚æˆ‘ä»¬é‡æ–°é“¾æ¥ç¬¬äºŒä¸ªæŒ‡é’ˆæ‰€å¼•ç”¨çš„ç»“ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘è¯¥ç»“ç‚¹çš„ä¸‹ä¸‹ä¸ªç»“ç‚¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var removeNthFromEnd = function(head, n) &#123;</span><br><span class="line">    let dummy=new ListNode(0);</span><br><span class="line">    dummy.next=head;</span><br><span class="line">    let slow=dummy;</span><br><span class="line">    let fast=dummy;</span><br><span class="line">    for(let i =1;i&lt;=n+1;i++)&#123;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    if(!slow)return head.next;</span><br><span class="line">    while(slow!=null)&#123;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">        fast=fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    fast.next=fast.next.next;</span><br><span class="line">    return dummy.next;</span><br><span class="line">&#125;</span><br><span class="line"> removeNthFromEnd(listNodeArr,4);</span><br></pre></td></tr></table></figure>

<h3 id="ç¯å½¢é“¾è¡¨"><a href="#ç¯å½¢é“¾è¡¨" class="headerlink" title="ç¯å½¢é“¾è¡¨"></a>ç¯å½¢é“¾è¡¨</h3><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p>
<p>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var hasCycle = function(head) &#123;</span><br><span class="line">    let slow = head, fast = head</span><br><span class="line">    while (fast &amp;&amp; fast.next) &#123;</span><br><span class="line">        slow = slow.next</span><br><span class="line">        fast = fast.next.next</span><br><span class="line">        if (slow === fast) &#123; return true &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚</p>
<p>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p>
<p>è¯´æ˜ï¼šä¸å…è®¸ä¿®æ”¹ç»™å®šçš„é“¾è¡¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var detectCycle = function(head) &#123;</span><br><span class="line">    if(!head || !head.next) return null;</span><br><span class="line">    </span><br><span class="line">    let slow = head;</span><br><span class="line">    let fast = head;</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        if(!fast || !fast.next) return null;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast =fast.next.next;</span><br><span class="line">        if(slow === fast) break;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    slow = head;</span><br><span class="line">    while (slow !== fast) &#123;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return slow;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.leetcode-cn.com/99987d4e679fdfbcfd206a4429d9b076b46ad09bd2670f886703fb35ef130635-image.png" alt="å›¾ç‰‡"></p>
<p>æˆ‘ä»¬åˆ©ç”¨å·²çŸ¥çš„æ¡ä»¶ï¼šæ…¢æŒ‡é’ˆç§»åŠ¨ 1 æ­¥ï¼Œå¿«æŒ‡é’ˆç§»åŠ¨ 2 æ­¥ï¼Œæ¥è¯´æ˜å®ƒä»¬ç›¸é‡åœ¨ç¯çš„å…¥å£å¤„ã€‚ï¼ˆä¸‹é¢è¯æ˜ä¸­çš„ tortoise è¡¨ç¤ºæ…¢æŒ‡é’ˆï¼Œhare è¡¨ç¤ºå¿«æŒ‡é’ˆï¼‰<br>2â‹…distance(tortoise)=distance(hare)<br>2(F+a)=F+a+b+a<br>2F+2a=F+2a+b<br>F=b<br>â€‹å› ä¸º F=bï¼ŒæŒ‡é’ˆä» hh ç‚¹å‡ºå‘å’Œä»é“¾è¡¨çš„å¤´å‡ºå‘ï¼Œæœ€åä¼šéå†ç›¸åŒæ•°ç›®çš„èŠ‚ç‚¹ååœ¨ç¯çš„å…¥å£å¤„ç›¸é‡ã€‚</p>
<h3 id="ç›¸äº¤é“¾è¡¨"><a href="#ç›¸äº¤é“¾è¡¨" class="headerlink" title="ç›¸äº¤é“¾è¡¨"></a>ç›¸äº¤é“¾è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;ListNode&#125; headA</span><br><span class="line"> * @param &#123;ListNode&#125; headB</span><br><span class="line"> * @return &#123;ListNode&#125;</span><br><span class="line"> * æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)</span><br><span class="line"> * æ€è·¯ï¼šæƒ³æ³•ç‰¹åˆ«ç²¾å¦™ï¼Œä¸¤ä¸ªé“¾è¡¨é•¿åº¦ä¸ä¸€è‡´ï¼ŒçŸ­+é•¿æ‹¼æ¥å’Œé•¿+çŸ­æ‹¼æ¥ï¼Œæœ€åèŠ‚ç‚¹ç›¸ç­‰æ—¶ä¸æ˜¯ç›¸äº¤èŠ‚ç‚¹å°±æ˜¯ï¼ˆnull===nullï¼‰</span><br><span class="line"> * ä¸¾æ —å­ï¼š[0,9,1,2,4]å’Œ[3,2,4] ä¸¤ä¸ªé“¾è¡¨æ‹¼æ¥å[0,9,1,2,4,3,2,4]å’Œ[3,2,4,0,9,1,2,4]ç›¸äº¤èŠ‚ç‚¹åœ¨2å¼€å§‹ç›¸åŒ</span><br><span class="line"> */</span><br><span class="line">var getIntersectionNode = function(headA, headB) &#123;</span><br><span class="line">  if (headA === null || headB === null) return null;</span><br><span class="line">  let curA = headA;</span><br><span class="line">  let curB = headB;</span><br><span class="line">  // curA===curBè¯´æ˜ç›¸äº¤æˆ–è€…å…¨éƒ¨èŠ‚ç‚¹èµ°å®Œç›´æ¥è¿”å›</span><br><span class="line">  while (curA !== curB) &#123;</span><br><span class="line">    //AèŠ‚ç‚¹èµ°å®Œèµ°B å®ç°A+B</span><br><span class="line">    curA = curA === null ? headB : curA.next;</span><br><span class="line">    curB = curB === null ? headA : curB.next;</span><br><span class="line">  &#125;</span><br><span class="line">  return curA;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<html>
  <head><meta name="generator" content="Hexo 3.9.0">
    <style>
      .css-82kbtk-Text {
        font-family: monospace;
        white-space: pre;
        user-select: none;
        font-size: 12px;
        line-height: 14px;
        color: rgb(38, 50, 56);
        max-height: 100px;
        margin: 0px 20px;
        overflow: auto;
    }
    </style>
  </head>
  <body>
    <div class="css-82kbtk-Text"> 
     _   _      _ _    __        __         _     _ 
    | | | | ___| | | __\ \      / /__  _ __| | __| |
    | |_| |/ _ \ | |/ _ \ \ /\ / / _ \| '__| |/ _` |
    |  _  |  __/ | | (_) \ V  V / (_) | |  | | (_| |
    |_| |_|\___|_|_|\___/ \_/\_/ \___/|_|  |_|\__,_|
    </div>
  </body>
</html>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>listNode</tag>
      </tags>
  </entry>
  <entry>
    <title>å…ƒç´ å®šä½</title>
    <url>/2020/12/31/location/</url>
    <content><![CDATA[<ol>
<li><p>focus</p>
<ul>
<li><p>Options</p>
<p>An optional object providing options to control aspects of the focusing process. This object may contain the following property:</p>
<ul>
<li><p>preventScroll Optional</p>
<p> A Boolean value indicating whether or not the browser should scroll the document to bring the newly-focused element into view. A value of false for preventScroll (the default) means that the browser will scroll the element into view after focusing it. If preventScroll is set to true, no scrolling will occur.</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>è®¡ç®—å…ƒç´ çš„scrollTopï¼Œè®©æ»šåŠ¨åˆ—è¡¨çš„scrollTopçš„å€¼ç­‰äºå…ƒç´ çš„scrollTop</p>
</li>
<li><p>scrollIntoView</p>
<p> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>é¢è¯•æ€»ç»“</title>
    <url>/2020/08/07/mianshi/</url>
    <content><![CDATA[<p>ä»Šå¤©é¢äº†ä¸€å®¶å…¬å¸ï¼Œç”µé¢ã€‚å·®ä¸å¤šæ˜¯è¿™äº›é¢˜ç›®</p>
<ol>
<li>åŠ¨ç”»</li>
<li>æµè§ˆå™¨å‚¨å­˜</li>
<li>ç¼“å­˜æœºåˆ¶ â€“ å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜</li>
<li>vueå“åº”å¼åŸç† â€“ 2å’Œ3</li>
<li>reactäº‹ä»¶</li>
<li>æµè§ˆå™¨å®‰å…¨å’Œå·¥ç¨‹åŒ–</li>
<li>httpåè®®</li>
<li>Promise</li>
<li>typescript</li>
<li>æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–</li>
<li>vue3ç›¸æ¯”vue2çš„ä¼˜ç‚¹</li>
<li>webpackä¼˜åŒ–</li>
<li>é¦–å±ä¼˜åŒ–</li>
<li>å…ƒç´ éšè—</li>
</ol>
<a id="more"></a>

<h3 id="æ€ä¹ˆè®©å…ƒç´ éšè—"><a href="#æ€ä¹ˆè®©å…ƒç´ éšè—" class="headerlink" title="æ€ä¹ˆè®©å…ƒç´ éšè—"></a>æ€ä¹ˆè®©<code>å…ƒç´ éšè—</code></h3><p>ä¸¤ä¸ªå±æ€§:</p>
<ol>
<li>display</li>
<li>visible</li>
</ol>
<p>ä¸¤ä¸ªå±æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>
<ol>
<li><code>display:none</code> é”€æ¯domå…ƒç´ </li>
<li><code>visbleï¼šhidden</code> ä¸é”€æ¯domå…ƒç´ </li>
</ol>
<p>å“ªä¸ªä¼šäº§ç”Ÿå›æµï¼Œå“ªä¸ªä¼šäº§ç”Ÿé‡ç»˜</p>
<ol>
<li><code>display</code> ä¼šäº§ç”Ÿå›æµï¼Œå› ä¸ºå½±å“äº†å‘¨å›´çš„å…ƒç´ ä½ç½®</li>
<li><code>visible</code> åªä¼šäº§ç”Ÿé‡ç»˜</li>
</ol>
<h3 id="åŠ¨ç”»ç›¸å…³"><a href="#åŠ¨ç”»ç›¸å…³" class="headerlink" title="åŠ¨ç”»ç›¸å…³"></a>åŠ¨ç”»ç›¸å…³</h3><p>ä¸€ã€ å“ªäº›å±æ€§å¯ä»¥äº§ç”ŸåŠ¨ç”»</p>
<ol>
<li><code>animation</code></li>
<li><code>key-frames</code></li>
<li><code>requestAnimationFrame</code></li>
</ol>
<p>ä¸‰è€…æœ‰ä»€ä¹ˆä¸åŒ</p>
<ol>
<li><code>animation</code>å’Œ<code>requestAnimationFrame</code>æ²¡æœ‰æ—¶é—´è½´çš„æ¦‚å¿µã€‚äº§ç”Ÿçš„åŠ¨ç”»æ˜¯è¿ç»­çš„ã€‚</li>
</ol>
<p>å¦‚æœåœ¨JSä¸»çº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªé˜»å¡ä»»åŠ¡ï¼Œé‚£ä¹ˆä¸‰ç§ä¸åŒæ–¹å¼äº§ç”Ÿçš„åŠ¨ç”»ä¼šå¡é¡¿å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p><strong>wdmï¼Œè§¦åŠåˆ°æˆ‘çš„çŸ¥è¯†ç›²åŒº</strong></p>
<h3 id="æµè§ˆå™¨å‚¨å­˜ç›¸å…³"><a href="#æµè§ˆå™¨å‚¨å­˜ç›¸å…³" class="headerlink" title="æµè§ˆå™¨å‚¨å­˜ç›¸å…³"></a>æµè§ˆå™¨å‚¨å­˜ç›¸å…³</h3><p>ä¸€ã€æµè§ˆå™¨æœ‰å“ªäº›å‚¨å­˜æ–¹å¼</p>
<ol>
<li>cookie</li>
<li>sessionStorage</li>
<li>localStorge</li>
</ol>
<p>äºŒã€æœ‰å“ªäº›åŒºåˆ«</p>
<ol>
<li>cookieå‚¨å­˜å‘æ•°æ®æ¯”è¾ƒå°ï¼Œå¤§æ¦‚4k</li>
<li>sessionStorageå‚¨å­˜æ•°æ®æœ‰æ—¶é—´é™åˆ¶ï¼Œå¹¶ä¸”å‚¨å­˜åœ¨sessionStorageçš„æ•°æ®ä¼šåœ¨å½“å‰é¡µé¢ä¼šè¯ç»“æŸæ—¶æ¸…é™¤</li>
<li>localStorageå‚¨å­˜æ•°æ®æ²¡æœ‰æ—¶é—´é™åˆ¶ï¼ŒlocalStorageä¸­çš„æ•°æ®é™¤éæ‰‹åŠ¨æ¸…é™¤ï¼Œå¦åˆ™æ•°æ®ä¸ä¼šæ¶ˆå¤±</li>
</ol>
<p>ä¸‰ã€å¦‚æœè¦è®©localStorageå®ç°æ•°æ®æœ‰è¿‡æœŸçš„æ•ˆæœè¯¥æ€ä¹ˆå®ç°</p>
<p>åœ¨æŠŠæ•°æ®å­˜è¿›localStorageçš„æ—¶å€™åŒæ—¶å­˜æ”¾æ—¶é—´å‚æ•°ã€‚æ¯æ¬¡å–å€¼çš„æ—¶å€™æ ¹æ®æ—¶é—´å‚æ•°æ¥æ¯”å¯¹æ•°æ®æ˜¯å¦è¿‡æœŸ</p>
<h3 id="èµ„æºç¼“å­˜ç›¸å…³"><a href="#èµ„æºç¼“å­˜ç›¸å…³" class="headerlink" title="èµ„æºç¼“å­˜ç›¸å…³"></a>èµ„æºç¼“å­˜ç›¸å…³</h3><h4 id="å¼ºç¼“å­˜"><a href="#å¼ºç¼“å­˜" class="headerlink" title="å¼ºç¼“å­˜"></a>å¼ºç¼“å­˜</h4><p>åœ¨http1.0æ—¶æœŸï¼Œä½¿ç”¨çš„æ˜¯expireæ¥åˆ¤æ–­èµ„æºæ˜¯å¦è¿‡æœŸã€‚è¿™ä¸ªå­—æ®µå­˜æ”¾çš„æ˜¯å…·ä½“çš„è¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚2020å¹´å…«æœˆä¹æ—¥ï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æœåŠ¡å™¨æ—¶é—´å’Œæœ¬åœ°æµè§ˆå™¨æ—¶é—´ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œç»™å‡ºå…·ä½“è¿‡æœŸæ—¶é—´ä¼šå¯¹èµ„æºæ˜¯å¦è¿‡æœŸåˆ¤æ–­é”™è¯¯ï¼Œå› æ­¤åœ¨http1.1å¯¹æ—¶å€™æ–°åŠ äº†cache-controlå­—æ®µï¼Œè¿™ä¸ªå­—æ®µç”¨æ¥å­˜æ”¾èµ„æºçš„è¿‡æœŸæ—¶é•¿ï¼Œç”¨max-ageè®°å½•ã€‚å½“å¼ºç¼“å­˜æ²¡æœ‰å‘½ä¸­çš„æ—¶å€™é‚£ä¹ˆè¿›è¡Œåå•†ç¼“å­˜ã€‚</p>
<h4 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h4><p>åå•†ç¼“å­˜ä¸»è¦æœ‰ä¸¤ä¸ªå­—æ®µä¸€ä¸ªæ˜¯<code>If-modified-Since</code>ï¼Œè¿™ä¸ªå€¼è·Ÿ<code>Last-modifed</code>é…å¯¹ï¼Œä¸€ä¸ªæ˜¯<code>Etag</code>ï¼Œè¿™ä¸ªè·Ÿ<code>If-Match</code>é…å¯¹,ä¸¤ä¸ªä¸»è¦è®°å½•çš„ä¸œè¥¿ä¸åŒã€‚å‰è€…æ˜¯è®°å½•æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œåè€…æ˜¯æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆä¸€ä¸ªEtageå€¼ï¼Œå¯¹äºå¦‚ä½•ç”ŸæˆEtagå€¼ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®è§„å®šã€‚è€Œé€šå¸¸ç”ŸæˆEtageçš„å€¼æ˜¯ä½¿ç”¨å†…å®¹çš„æ•£åˆ—ï¼Œæœ€åä¿®æ”¹æ—¶é—´æˆ³çš„å“ˆå¸Œå€¼ï¼Œæˆ–ç®€å•åœ°ä½¿ç”¨ç‰ˆæœ¬å·ã€‚<br>å¯¹äº<code>if-modifued-since</code>æ¥è¯´ï¼Œå‡å¦‚æ–‡ä»¶åªæ˜¯ä¿®æ”¹äº†æ ¼å¼ï¼Œä½†æ˜¯å†…å®¹å¹¶æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å¯¹è¿™ä¸ªå€¼æ¥è¯´ï¼Œä»ç„¶ä¼šå‘Šè¯‰æµè§ˆå™¨èµ„æºæ— æ•ˆå¹¶ä¸”è¿”å›æ–°çš„èµ„æºï¼Œè¿™æ˜æ˜¾æ˜¯ä¸å¤ªåˆé€‚çš„<br>å¯¹äº<code>Etag</code>æ¥è¯´ï¼Œå½“ä¸”ä»…å½“æ–‡ä»¶å†…å®¹æœ‰æ‰€å˜æ›´æ—¶ï¼Œæ­¤æ—¶Etagå€¼å°±ä¼šç›¸åº”çš„æ›´æ–°ï¼Œå› æ­¤å°±å¯ä»¥å‘Šè¯‰æµè§ˆå™¨ç¼“å­˜çš„èµ„æºå·²ç»è¿‡æœŸã€‚ETagå¤´çš„å¦ä¸€ä¸ªå…¸å‹ç”¨ä¾‹æ˜¯ç¼“å­˜æœªæ›´æ”¹çš„èµ„æºã€‚ å¦‚æœç”¨æˆ·å†æ¬¡è®¿é—®ç»™å®šçš„URLï¼ˆè®¾æœ‰ETagå­—æ®µï¼‰ï¼Œæ˜¾ç¤ºèµ„æºè¿‡æœŸäº†ä¸”ä¸å¯ç”¨ï¼Œå®¢æˆ·ç«¯å°±å‘é€å€¼ä¸ºETagçš„If-None-Match headerå­—æ®µã€‚æœåŠ¡å™¨å°†å®¢æˆ·ç«¯çš„ETagï¼ˆä½œä¸ºIf-None-Matchå­—æ®µçš„å€¼ä¸€èµ·å‘é€ï¼‰ä¸å…¶å½“å‰ç‰ˆæœ¬çš„èµ„æºçš„ETagè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤ä¸ªå€¼åŒ¹é…ï¼ˆå³èµ„æºæœªæ›´æ”¹ï¼‰ï¼ŒæœåŠ¡å™¨å°†è¿”å›ä¸å¸¦ä»»ä½•å†…å®¹çš„304æœªä¿®æ”¹çŠ¶æ€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ç¼“å­˜ç‰ˆæœ¬å¯ç”¨ï¼ˆæ–°é²œï¼‰</p>
<h3 id="vueå“åº”å¼åŸç†ç›¸å…³"><a href="#vueå“åº”å¼åŸç†ç›¸å…³" class="headerlink" title="vueå“åº”å¼åŸç†ç›¸å…³"></a>vueå“åº”å¼åŸç†ç›¸å…³</h3><h4 id="ä¸¤è€…å®ç°æ–¹å¼çš„åŒºåˆ«"><a href="#ä¸¤è€…å®ç°æ–¹å¼çš„åŒºåˆ«" class="headerlink" title="ä¸¤è€…å®ç°æ–¹å¼çš„åŒºåˆ«"></a>ä¸¤è€…å®ç°æ–¹å¼çš„åŒºåˆ«</h4><p>vue2æ˜¯ä½¿ç”¨äº†Object.definePropertyæ¥å®ç°çš„æ•°æ®ç›‘å¬<br>vue3æ˜¯ä½¿ç”¨äº†Proxyæ¥å®ç°çš„æ•°æ®ç›‘å¬</p>
<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><p>å‡å¦‚æœ‰ä¸€ä¸ªå“åº”å¼æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const obj = reactive(&#123;a:1&#125;)</span><br><span class="line">const computed_obj = computed(()=&gt;&#123;</span><br><span class="line">    <span class="built_in">return</span> obj.a+1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆå¯¹aä¿®æ”¹ä¹‹åï¼Œcomputed_objä¹Ÿä¼šç›¸åº”çš„è¿›è¡Œä¿®æ”¹?</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">åœ¨æ‰§è¡Œobj.açš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œtrackæ–¹æ³•</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> track(target: object, <span class="built_in">type</span>: TrackOpTypes, key: unknown) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!shouldTrack || activeEffect === undefined) &#123;</span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">let</span> depsMap = targetMap.get(target)</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = new Map()))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">let</span> dep = depsMap.get(key)</span><br><span class="line">  <span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">    depsMap.set(key, (dep = new Set()))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!dep.has(activeEffect)) &#123;</span><br><span class="line">    dep.add(activeEffect)</span><br><span class="line">    <span class="comment"># è¿™ä¸ªactiveEffectå°±æ˜¯åœ¨è¿™ä¹‹å‰æ‰§è¡Œçš„ä¾èµ–å‡½æ•°</span></span><br><span class="line">    <span class="comment"># dep å°±æ˜¯ target[key]çš„ä¾èµ–</span></span><br><span class="line">    activeEffect.deps.push(dep)</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; activeEffect.options.onTrack) &#123;</span><br><span class="line">      activeEffect.options.onTrack(&#123;</span><br><span class="line">        effect: activeEffect,</span><br><span class="line">        target,</span><br><span class="line">        <span class="built_in">type</span>,</span><br><span class="line">        key</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤å½“å“åº”å¼å¯¹è±¡æ›´æ”¹æ—¶ï¼Œå…¶å¯¹åº”çš„ä¾èµ–é¡¹ä¼šæ‰§è¡Œä¸€éï¼Œå› æ­¤æ­¤æ—¶computedå‡½æ•°å°±ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h3 id="reactäº‹ä»¶ç›¸å…³"><a href="#reactäº‹ä»¶ç›¸å…³" class="headerlink" title="reactäº‹ä»¶ç›¸å…³"></a>reactäº‹ä»¶ç›¸å…³</h3><h4 id="setState"><a href="#setState" class="headerlink" title="setState"></a>setState</h4><p> setStateä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥çš„ï¼Ÿä»€ä¹ˆæ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼Ÿ</p>
<p> å½“äº‹ä»¶æ˜¯åˆæˆäº‹ä»¶æ—¶ï¼Œå³ç”±reactæ§åˆ¶çš„äº‹ä»¶æ—¶ï¼Œå°±æ˜¯å¼‚æ­¥çš„ï¼›<br> å¦‚æœæ˜¯ç”±addEventlistenerç›‘å¬æ—¶æˆ–è€…åœ¨å®šæ—¶å™¨ä¸­æ‰§è¡Œæ—¶ï¼Œé‚£å°±æ˜¯åŒæ­¥çš„ã€‚</p>
<h3 id="æµè§ˆå™¨å®‰å…¨ä»¥åŠå·¥ç¨‹åŒ–ç›¸å…³"><a href="#æµè§ˆå™¨å®‰å…¨ä»¥åŠå·¥ç¨‹åŒ–ç›¸å…³" class="headerlink" title="æµè§ˆå™¨å®‰å…¨ä»¥åŠå·¥ç¨‹åŒ–ç›¸å…³"></a>æµè§ˆå™¨å®‰å…¨ä»¥åŠå·¥ç¨‹åŒ–ç›¸å…³</h3><h4 id="æ•°æ®ä¼ è¾“å®‰å…¨"><a href="#æ•°æ®ä¼ è¾“å®‰å…¨" class="headerlink" title="æ•°æ®ä¼ è¾“å®‰å…¨"></a>æ•°æ®ä¼ è¾“å®‰å…¨</h4><p> ä½¿ç”¨httpsä¼ è¾“æ•°æ®ï¼ŒæœåŠ¡ç«¯ä»ç¬¬ä¸‰æ–¹å¹³å°è·å–éå †æˆåŠ å¯†çš„å…¬é’¥å’Œç§é’¥ï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡ç«¯è·å–å…¬é’¥ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯éšæœºç”Ÿæˆå“ˆå¸Œä¸²ï¼Œç„¶åç”¨å…¬é’¥å¯¹è¿™ä¸ªå“ˆå¸Œä¸²åŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†åçš„å“ˆå¸Œä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”¨ç§é’¥å¯¹è¿™ä¸ªå“ˆå¸Œä¸²è¿›è¡Œè§£å¯†ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±æœ‰äº†å…±åŒçš„å“ˆå¸Œä¸²ï¼Œç„¶åå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç”¨è¿™ä¸ªå“ˆå¸Œä¸²å¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€‚</p>
<h4 id="å·¥ç¨‹åŒ–"><a href="#å·¥ç¨‹åŒ–" class="headerlink" title="å·¥ç¨‹åŒ–"></a>å·¥ç¨‹åŒ–</h4><p>å·¥ç¨‹åŒ–å³ç³»ç»ŸåŒ–ã€æ¨¡å—åŒ–ã€è§„èŒƒåŒ–çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p>
<p>å·¥ç¨‹åŒ–éœ€è¦åšä»€ä¹ˆï¼š</p>
<ol>
<li><p>ç»Ÿä¸€å›¢é˜Ÿæˆå‘˜çš„ç¼–ç è§„èŒƒï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œä»£ç ç»´æŠ¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ç›®å½•ç»“æ„ï¼Œæ–‡ä»¶å‘½åè§„èŒƒ</li>
<li>ç¼–ç è§„èŒƒï¼šeslint stylelintç­‰</li>
</ul>
</li>
<li><p>å¼€å‘æµç¨‹çš„è§„èŒƒ</p>
<ul>
<li>åº”å¯¹å„é¡¹é£é™©ï¼Œéœ€æ±‚å˜æ›´ç­‰</li>
<li>code reviewæœºåˆ¶</li>
</ul>
</li>
<li><p>å‰åç«¯æ¥å£è§„èŒƒï¼Œå…¶ä»–æ–‡æ¡£è§„èŒƒ</p>
</li>
<li><p>ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·æ¥å®‰å…¨é«˜æ•ˆç­‰ç®¡ç†ä»£ç </p>
<ul>
<li>å¯¹gitå¯¹ä½¿ç”¨</li>
<li>è§„èŒƒcommitæè¿°</li>
<li>åˆ›å»ºmerge request ï¼Œcode reviewé€šè¿‡åæ‰å¯ä»¥è¿›è¡Œmerge</li>
</ul>
</li>
<li><p>ä½¿ç”¨åˆé€‚å¯¹æŠ€æœ¯æ ˆç¼–ç ï¼Œæ¥æé«˜å¼€å‘æ•ˆç‡ä»¥åŠç»´æŠ¤éš¾åº¦</p>
<ul>
<li>ç”¨æ¨¡å—åŒ–å¯¹æ–¹å¼æ¥ç»„ç»‡ä»£ç ï¼ŒåŒ…æ‹¬jsæ¨¡å—åŒ–ï¼Œcssæ¨¡å—åŒ–</li>
<li>é‡‡ç”¨ç»„ä»¶åŒ–å¯¹ç¼–ç¨‹æ€æƒ³ï¼Œå¤„ç†UIå±‚</li>
<li>å°†æ•°æ®å±‚å’ŒUIå±‚åˆ†ç¦»</li>
</ul>
</li>
<li><p>æé«˜ä»£ç å¯é æ€§ï¼Œå¼•å…¥å•å…ƒæµ‹è¯•</p>
</li>
</ol>
<h3 id="httpåè®®ç›¸å…³"><a href="#httpåè®®ç›¸å…³" class="headerlink" title="httpåè®®ç›¸å…³"></a>httpåè®®ç›¸å…³</h3><p>httpè¯·æ±‚ä¸­åˆ†ä¸ºå“ªäº›éƒ¨åˆ†ï¼Ÿ</p>
<ol>
<li>è¯·æ±‚å¤´</li>
<li>è¯·æ±‚ä½“</li>
</ol>
<p>http2.0 ç›¸æ¯”è¾ƒä¹‹å‰çš„åè®®æœ‰å“ªäº›æ”¹è¿›ï¼Ÿ</p>
<ol>
<li>å¤šè·¯å¤ç”¨ï¼Œå¤ç”¨tcpè¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥ä¸æŒ‰é¡ºåºï¼Œå’ŒäºŒè¿›åˆ¶åˆ†å¸§ä¸€èµ·è§£å†³é˜Ÿå¤´å µå¡é—®é¢˜</li>
<li>äºŒè¿›åˆ¶åˆ†å¸§</li>
<li>å¤´éƒ¨å‹ç¼©ï¼Œä¼ é€’æ–¹æ³•çš„æ—¶å€™åªä¼ é€’ç´¢å¼•ï¼ŒæœåŠ¡ç«¯æ ¹æ®ç´¢å¼•å»ç´¢å¼•è¡¨æŸ¥è¯¢æ–¹æ³•</li>
<li>å…è®¸æœåŠ¡ç«¯æ¨é€ï¼Œè¿™æ ·å®¢æˆ·ç«¯ä¸ç”¨å‘èµ·è¯·æ±‚è·å¾—åç»­èµ„æº<br>httpä¼ è¾“æ˜¯æ ¹æ®ä»€ä¹ˆåè®®ä¼ è¾“ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li>
</ol>
<ul>
<li>tcp/ipåè®®ï¼Œå®‰å…¨å¯é </li>
</ul>
<p>httpä¼ è¾“åœ¨å“ªä¸ªå±‚è¿›è¡Œä¼ è¾“ï¼Ÿ</p>
<ul>
<li>åº”ç”¨å±‚</li>
</ul>
<h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><p>Promise å¯¹è±¡æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆä»£ç†ä¸€ä¸ªå€¼ï¼‰ï¼Œè¢«ä»£ç†çš„å€¼åœ¨Promiseå¯¹è±¡åˆ›å»ºæ—¶å¯èƒ½æ˜¯æœªçŸ¥çš„ã€‚å®ƒå…è®¸ä½ ä¸ºå¼‚æ­¥æ“ä½œçš„æˆåŠŸå’Œå¤±è´¥åˆ†åˆ«ç»‘å®šç›¸åº”çš„å¤„ç†æ–¹æ³•ï¼ˆhandlersï¼‰ã€‚ è¿™è®©å¼‚æ­¥æ–¹æ³•å¯ä»¥åƒåŒæ­¥æ–¹æ³•é‚£æ ·è¿”å›å€¼ï¼Œä½†å¹¶ä¸æ˜¯ç«‹å³è¿”å›æœ€ç»ˆæ‰§è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½ä»£è¡¨æœªæ¥å‡ºç°çš„ç»“æœçš„promiseå¯¹è±¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const data = Promise.resolve(2)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå°±ç®—æ˜¯ä½¿ç”¨äº†resolveï¼Œé‚£ä¹ˆdataä¹Ÿä¸ä¼šè¢«èµ‹å€¼æˆ2ï¼Œè€Œæ˜¯ä¸€ä¸ªpromiseå¯¹è±¡<br>ï¼Œåªæœ‰åœ¨è°ƒç”¨äº†thenæ–¹æ³•åæ‰ä¼šå¾—åˆ°çœŸæ­£å¯¹å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Promise.resolve(2).<span class="keyword">then</span>(res=&gt;console.log(res))</span><br><span class="line"><span class="comment"># è¿™æ—¶å€™å°±ä¼šè¾“å‡º22</span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ thenæ–¹æ³•æ¥å—ä¸¤ä¸ªå‡½æ•°ç±»å‹å¯¹å‚æ•°ï¼Œä¸€ä¸ªæ˜¯onfulfilledï¼Œä¸€ä¸ªæ˜¯onrejectedï¼Œå‰è€…åœ¨è°ƒç”¨resolveçš„æ—¶å€™è¿›å…¥ï¼Œåè€…åˆ™æ˜¯åœ¨è°ƒç”¨rejectæˆ–è€…æŠ›å‡ºé”™è¯¯çš„æ—¶å€™è°ƒç”¨ï¼Œå› æ­¤catchä¹Ÿå¯ä»¥è¢«å«åšæ˜¯thençš„è¯­æ³•ç³–ï¼Œå› ä¸ºcatchæ–¹æ³•å¯ä»¥ç­‰äºthen(null,onRejected)</p>
<h3 id="typescript"><a href="#typescript" class="headerlink" title="typescript"></a>typescript</h3><p>åœ¨tsä¸­ interface å’Œ type çš„åŒºåˆ«ï¼Ÿ</p>
<p><strong>ç›¸åŒç‚¹ï¼š</strong></p>
<ol>
<li>éƒ½å¯ä»¥æè¿°ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°âœ…</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface User &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SetUser &#123;</span><br><span class="line">  (name: string, age: number): void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> User = &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> SetUser = (name: string, age: number)=&gt; void;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>éƒ½å…è®¸æ‹“å±•âœ…</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># interface extends interface</span></span><br><span class="line"></span><br><span class="line">interface Name &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line">interface User extends Name &#123; </span><br><span class="line">  age: number; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># type extends type</span></span><br><span class="line"><span class="built_in">type</span> Name = &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">type</span> User = Name &amp; &#123; age: number  &#125;;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># interface extends type</span></span><br><span class="line"><span class="built_in">type</span> Name = &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line">interface User extends Name &#123; </span><br><span class="line">  age: number; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># type extends interface</span></span><br><span class="line">interface Name &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">type</span> User = Name &amp; &#123; </span><br><span class="line">  age: number; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸åŒç‚¹ï¼š</strong></p>
<ol>
<li><p>type å¯ä»¥å£°æ˜åŸºæœ¬ç±»å‹åˆ«åï¼Œè”åˆç±»å‹ï¼Œå…ƒç»„ç­‰ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºæœ¬ç±»å‹åˆ«å</span></span><br><span class="line"><span class="built_in">type</span> Name = string</span><br><span class="line"></span><br><span class="line"><span class="comment"># è”åˆç±»å‹</span></span><br><span class="line">interface Dog &#123;</span><br><span class="line">    wong();</span><br><span class="line">&#125;</span><br><span class="line">interface Cat &#123;</span><br><span class="line">    miao();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Pet = Dog | Cat</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“å®šä¹‰æ•°ç»„æ¯ä¸ªä½ç½®çš„ç±»å‹</span></span><br><span class="line"><span class="built_in">type</span> PetList = [Dog, Pet]</span><br></pre></td></tr></table></figure>
</li>
<li><p>type è¯­å¥ä¸­è¿˜å¯ä»¥ä½¿ç”¨ typeof è·å–å®ä¾‹çš„ ç±»å‹è¿›è¡Œèµ‹å€¼</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å½“ä½ æƒ³è·å–ä¸€ä¸ªå˜é‡çš„ç±»å‹æ—¶ï¼Œä½¿ç”¨ typeof</span></span><br><span class="line"><span class="built_in">let</span> div = document.createElement(<span class="string">'div'</span>);</span><br><span class="line"><span class="built_in">type</span> B = typeof div</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>interface å¯ä»¥è¿›è¡Œå£°æ˜åˆå¹¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">interface User &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface User &#123;</span><br><span class="line">  sex: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ä¸Šé¢ä¸¤ä¸ªæ¥å£å“¦å¯ä»¥åˆå¹¶æˆä¸‹é¢è¿™ä¸ªæ¥å£å£°æ˜</span></span><br><span class="line">interface User&#123;</span><br><span class="line">    name:string,</span><br><span class="line">    age:number,</span><br><span class="line">    sex:string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–"><a href="#æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–"></a>æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–</h3><p>é‡‡ç”¨chromeæ ‡ç­¾çš„performace æ¥ æŸ¥çœ‹ é¡µé¢æ¸²æŸ“è¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿå¡é¡¿çš„ ç‰‡æ®µï¼ŒæŸ¥çœ‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ è€—æ—¶è¿‡é•¿çš„å‡½æ•°ï¼Œé…åˆç«ç„°å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ·±åº¦</p>
<ol>
<li>ä½¿ç”¨RequestAnimationFrameå‡½æ•°å®ç°åŠ¨ç”»ï¼Œæˆ–è€…æ–°å»ºå›¾å±‚æ¥å®ç°åŠ¨ç”»</li>
<li>ä½¿ç”¨Web Workersæ¥æ‰§è¡Œè€—è´¹å¤§é‡æ—¶é—´çš„ä»»åŠ¡</li>
<li>é™ä½æ ·å¼è®¡ç®—å¤æ‚åº¦ï¼Œ</li>
<li>é¿å…åŠ¨æ€ä¿®æ”¹æ ·å¼<h3 id="v3ç›¸æ¯”v2ä¼˜ç‚¹"><a href="#v3ç›¸æ¯”v2ä¼˜ç‚¹" class="headerlink" title="v3ç›¸æ¯”v2ä¼˜ç‚¹"></a>v3ç›¸æ¯”v2ä¼˜ç‚¹</h3>v3 æœ‰æ›´æ£’çš„tree-shaking<br>v3 çš„dom diffæ€§èƒ½ä¼˜åŒ–ï¼Œåªç›‘å¬å˜é‡ï¼Œè€Œå¯¹äºé™æ€èŠ‚ç‚¹ä¸è¿›è¡Œæ¯”è¾ƒ<br>v3 æœ‰æ›´å¥½çš„tsæ”¯æŒ<br>v3 èƒ½å¤Ÿæ ¹æ®æ•°æ®ç´¢å¼•å€¼æ¥å¯¹æ•°æ®è¿›è¡Œç›‘å¬äº†<br>v3 ä½“ç§¯æ›´å°<h3 id="webpackä¼˜åŒ–"><a href="#webpackä¼˜åŒ–" class="headerlink" title="webpackä¼˜åŒ–"></a>webpackä¼˜åŒ–</h3>è§é¢è¯•2<h3 id="é¦–å±æ¸²æŸ“ä¼˜åŒ–"><a href="#é¦–å±æ¸²æŸ“ä¼˜åŒ–" class="headerlink" title="é¦–å±æ¸²æŸ“ä¼˜åŒ–"></a>é¦–å±æ¸²æŸ“ä¼˜åŒ–</h3></li>
</ol>
<ul>
<li>å‡å°‘è¯·æ±‚èµ„æºæ•°<ul>
<li>å›¾ç‰‡åˆæˆé›ªç¢§å›¾</li>
<li>webpackçš„html-webpack-plugin</li>
</ul>
</li>
<li>å‡å°‘èµ„æºä½“ç§¯<ul>
<li>webpackå¯¹å›¾ç‰‡ä½“ç§¯çš„å‹ç¼©ï¼Œè½¬base64</li>
<li>ä¸åœ¨è§†å£åŒºåŸŸçš„å…ƒç´ ä¸æ¸²æŸ“</li>
<li>éé‡ç‚¹æ–‡ä»¶å»¶è¿ŸåŠ è½½defer</li>
<li>é‡ç‚¹ç™»é™†é¡µå¯ä»¥è€ƒè™‘ssr</li>
</ul>
</li>
<li>loadingè¿‡ç¨‹å¯ä»¥é‡‡ç”¨éª¨æ¶å±</li>
<li>ç»„ä»¶åŠ¨æ€åŠ è½½</li>
<li>è·¯ç”±åŠ¨æ€åŠ è½½</li>
<li>å›¾ç‰‡æ‡’åŠ è½½</li>
<li>å›¾ç‰‡æ ¼å¼å°½é‡é‡‡ç”¨webpæˆ–è€…avif</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>é¢è¯•æ€»ç»“(2)</title>
    <url>/2020/08/30/mianshi2/</url>
    <content><![CDATA[<h2 id="httpsæ¡æ‰‹è¿‡ç¨‹"><a href="#httpsæ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="httpsæ¡æ‰‹è¿‡ç¨‹"></a>httpsæ¡æ‰‹è¿‡ç¨‹</h2><ol>
<li>æœåŠ¡ç«¯ç”Ÿæˆå…¬ç§é’¥</li>
<li>æœåŠ¡ç«¯æŠŠå…¬é’¥ï¼ŒåŠ å¯†çš„hashç®—æ³•ä»¥åŠä¸ªäººä¿¡æ¯å‘é€ç»™CA</li>
<li>CAæŠŠæœåŠ¡ç«¯å‘é€æ¥çš„æ˜æ–‡ä¿¡æ¯ç”¨æœåŠ¡ç«¯å‘æ¥çš„hashç®—æ³•åŠ å¯†ç”Ÿæˆå¯†æ–‡ï¼Œç„¶åç”¨CAçš„ç§é’¥å¯¹å¯†æ–‡è¿›è¡ŒåŠ å¯†ç”Ÿæˆç­¾å</li>
<li>CAæŠŠè¯ä¹¦å‘è¿˜ç»™æœåŠ¡ç«¯ï¼Œè¯ä¹¦å†…å®¹åŒ…æ‹¬ç­¾åï¼Œä»¥åŠè¯ä¹¦çš„é¢å‘å¯¹è±¡ä»¥åŠ é¢å‘è€…ç­‰ä¿¡æ¯ã€‚</li>
<li>æœåŠ¡ç«¯æŠŠè¯ä¹¦å’Œæ˜æ–‡ä¿¡æ¯ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯å‘é€çš„è¯ä¹¦ï¼Œç”¨å†…ç½®åœ¨æ“ä½œç³»ç»Ÿçš„å…¬é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œç„¶åç”¨æœåŠ¡ç«¯å‘æ¥å¯¹hashç®—æ³•å¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œå¦‚æœä¸¤æ¬¡ç”Ÿæˆçš„å­—ç¬¦ä¸²ç›¸ç­‰ï¼Œé‚£ä¹ˆæ•°æ®æ˜¯å¯ä¿¡çš„</li>
<li>å®¢æˆ·ç«¯åœ¨æœ¬åœ°éšæœºç”Ÿæˆrandom1ï¼Œå‘é€ç»™æœåŠ¡ç«¯</li>
<li>æœåŠ¡ç«¯åœ¨æœ¬åœ°éšæœºç”Ÿæˆrandom2ï¼Œå‘é€ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯åœ¨æœ¬åœ°éšæœºç”Ÿæˆrandom3ï¼Œç„¶åç”¨æœåŠ¡ç«¯å‘æ¥çš„å…¬é’¥å¯¹random3åŠ å¯†å‘é€ç»™æœåŠ¡ç«¯</li>
<li>å®¢æˆ·ç«¯æœåŠ¡ç«¯æ ¹æ®ä¸‰ä¸ªéšæœºrandomå„è‡ªç”Ÿæˆå¯¹ç§°å¯†é’¥</li>
<li>ç”¨ç”Ÿæˆçš„å¯¹ç§°å¯†é’¥åŠ å¯†ä¸€æ®µæ¡æ‰‹ä¿¡æ¯ï¼Œå‘é€ç»™æœåŠ¡ç«¯ã€‚åŒç«¯éªŒè¯ã€‚</li>
<li>åç»­åŠ å¯†ç”¨ç”Ÿæˆçš„å¯¹ç§°å¯†é’¥åŠ å¯†<a id="more"></a>
<h2 id="è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹"><a href="#è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹" class="headerlink" title="è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹"></a>è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹</h2></li>
<li>æµè§ˆå™¨è¿›ç¨‹æ‹¼æ¥URLï¼ŒåŠ åè®®</li>
<li>ç½‘ç»œè¿›ç¨‹æ ¹æ®URlåšDNSè§£æ</li>
<li>è¯·æ±‚çš„èµ„æºè¿”å›ç»™æ¸²æŸ“è¿›ç¨‹</li>
<li>æ¸²æŸ“è¿›ç¨‹æ ¹æ®è¿”å›çš„çŠ¶æ€ç ä»¥åŠcontent-typeæ¥è¿›è¡Œåç»­çš„æµç¨‹</li>
<li>æ˜¯htmlç±»å‹åˆ™è¿›è¡Œæ¸²æŸ“æµç¨‹</li>
<li>ç”ŸæˆCSSOMä»¥åŠDOM</li>
<li>ç”ŸæˆRenderæ ‘ã€‚</li>
<li>æ ¹æ®renderæ ‘ç”Ÿæˆå›¾å±‚æ ‘</li>
<li>æ¸²æŸ“è¿›ç¨‹å¯¹å›¾å±‚è¿›è¡Œç»˜åˆ¶ï¼ŒæŠŠå›¾å±‚ç»˜åˆ¶æ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„ç»˜åˆ¶æŒ‡ä»¤ï¼Œç»˜åˆ¶æŒ‡ä»¤ç»„æˆç»˜åˆ¶åˆ—è¡¨</li>
<li>æ¸²æŸ“è¿›ç¨‹çš„åˆæˆçº¿ç¨‹æ¥è¿›è¡Œå®é™…çš„ç»˜åˆ¶æ“ä½œ</li>
<li>åˆæˆçº¿ç¨‹åœ¨å…‰æ …åŒ–çº¿ç¨‹ä¸­æ‰§è¡Œå…‰æ …åŒ–ï¼ˆæŠŠå›¾å±‚è½¬åŒ–æˆä½å›¾ï¼‰</li>
<li>å…‰æ …åŒ–é‡‡ç”¨GPUåŠ é€Ÿï¼Œå› æ­¤å®é™…ç»˜åˆ¶è¿‡ç¨‹åœ¨GPUè¿›ç¨‹</li>
<li>å…‰æ …åŒ–ç»“æŸæ¸²æŸ“è¿›ç¨‹é€šçŸ¥æµè§ˆå™¨è¿›ç¨‹</li>
<li>æµè§ˆå™¨è¿›ç¨‹æ¥æ”¶drawquardå‘½ä»¤ï¼Œå°†å…¶é¡µé¢å†…å®¹ç»˜åˆ¶åˆ°å†…å­˜ä¸­ï¼Œæœ€åå†å°†å†…å­˜æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</li>
<li>doneï¼</li>
</ol>
<h2 id="å­—ç¬¦ä¸²ç¿»è½¬"><a href="#å­—ç¬¦ä¸²ç¿»è½¬" class="headerlink" title="å­—ç¬¦ä¸²ç¿»è½¬"></a>å­—ç¬¦ä¸²ç¿»è½¬</h2><p>ç•¥</p>
<h2 id="å­—ç¬¦ä¸²è½¬æ•°ç»„"><a href="#å­—ç¬¦ä¸²è½¬æ•°ç»„" class="headerlink" title="å­—ç¬¦ä¸²è½¬æ•°ç»„"></a>å­—ç¬¦ä¸²è½¬æ•°ç»„</h2><p>parseInt Number ä¸¤è€…åŒºåˆ«<br>ç•¥</p>
<h2 id="DNSè§£æè¿‡ç¨‹"><a href="#DNSè§£æè¿‡ç¨‹" class="headerlink" title="DNSè§£æè¿‡ç¨‹"></a>DNSè§£æè¿‡ç¨‹</h2><p>æ‰¾æœ¬åœ°ç¼“å­˜ï¼Œæ²¡æ‰¾åˆ°è¯·æ±‚åŸŸåæœåŠ¡å™¨</p>
<h2 id="DNSåŠ«æŒ"><a href="#DNSåŠ«æŒ" class="headerlink" title="DNSåŠ«æŒ"></a>DNSåŠ«æŒ</h2><p>ç•¥</p>
<h2 id="å¼ºç¼“å­˜-åå•†ç¼“å­˜"><a href="#å¼ºç¼“å­˜-åå•†ç¼“å­˜" class="headerlink" title="å¼ºç¼“å­˜ åå•†ç¼“å­˜"></a>å¼ºç¼“å­˜ åå•†ç¼“å­˜</h2><ul>
<li><p>å¼ºç¼“å­˜ï¼š</p>
<ul>
<li>Cache-Control</li>
<li>Expire</li>
</ul>
</li>
<li><p>åå•†ç¼“å­˜ï¼š</p>
<ul>
<li>If-Modified-Since</li>
<li>Etag<br>å…¶ä»–ç•¥</li>
</ul>
</li>
</ul>
<h2 id="vueåŒå‘ç»‘å®šåŸç†"><a href="#vueåŒå‘ç»‘å®šåŸç†" class="headerlink" title="vueåŒå‘ç»‘å®šåŸç†"></a>vueåŒå‘ç»‘å®šåŸç†</h2><p>æ•°æ®åŠ«æŒ â• å‘å¸ƒè®¢é˜…</p>
<h2 id="vueå“åº”å¼åŸç†"><a href="#vueå“åº”å¼åŸç†" class="headerlink" title="vueå“åº”å¼åŸç†"></a>vueå“åº”å¼åŸç†</h2><p>ä¾èµ–æ”¶é›† + ä¾èµ–æ›´ç»†</p>
<h2 id="react-fiber"><a href="#react-fiber" class="headerlink" title="react fiber"></a>react fiber</h2><ol>
<li>æ ¹æ®componentç”Ÿæˆfiberæ ‘</li>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªfiberèŠ‚ç‚¹</li>
<li>å½“å‰æ¸²æŸ“åœ¨å±å¹•ä¸Šçš„æ˜¯currentæ ‘</li>
<li>currentæ ‘æœ‰ä¸€ä¸ªæ˜¯alternateçš„æŒ‡é’ˆæŒ‡å‘wipæ ‘</li>
<li>wipä¹Ÿæœ‰ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘currentæ ‘</li>
<li>wipæ ‘æ˜¯forkäº†ä¸€ä»½currentæ ‘ï¼Œè¿™ä¸ªå«åšdouble buffering</li>
<li>æœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯renderï¼Œä¸€ä¸ªæ˜¯commit</li>
<li>renderé˜¶æ®µå¯ä»¥è¢«æ‰“æ–­ï¼Œcommité˜¶æ®µä¸å¯ä»¥è¢«æ‰“æ–­</li>
<li>renderé˜¶æ®µçš„ä»»åŠ¡ä¸»è¦æ ¹æ®æ’å…¥çš„é¡ºåºæ¥æ‰§è¡Œï¼Œé€šè¿‡ä½¿ç”¨requestIdlecallbackè¿™ä¸ªapiæ¥å®ç°ä»»åŠ¡çš„è°ƒåº¦</li>
<li>é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡æ‰§è¡Œï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥ç­‰éœ€è¦åŠæ—¶åé¦ˆçš„ä»»åŠ¡å±äºé«˜ä¼˜å…ˆçº§ï¼Œè€Œå¯¹äºæ•°æ®è·å–è¿™ç±»çš„ä»»åŠ¡å±äºä½ä¼˜å…ˆçº§</li>
<li>reactå†…éƒ¨é€šè¿‡ä½¿ç”¨messageChannelæ¥å®ç°reqeustIdleCallbackçš„polyfill</li>
</ol>
<h2 id="xssé˜²å¾¡"><a href="#xssé˜²å¾¡" class="headerlink" title="xssé˜²å¾¡"></a>xssé˜²å¾¡</h2><ol>
<li>è½¬ç </li>
<li>ç™½åå•</li>
<li>è¿‡æ»¤</li>
</ol>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><ol>
<li>SameSite<ul>
<li>Lax</li>
<li>Strict</li>
<li>None</li>
</ul>
</li>
<li>x-frame-option</li>
<li>csp<ul>
<li>default-src</li>
<li>image-src</li>
<li>media-src</li>
<li>script-src</li>
</ul>
</li>
<li>token</li>
<li>refer/origin</li>
</ol>
<h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><ol>
<li><p>webpack</p>
<ul>
<li>ç¼©å°æ„å»ºä½“ç§¯ï¼ˆåˆ†åŒ…ï¼Œtree-shakingï¼Œå‰”é™¤ç¬¬ä¸‰æ–¹åº“ä¸éœ€è¦çš„æ¨¡å—ï¼‰</li>
<li>ç¼“å­˜ï¼ˆcache-loaderï¼Œhard-source-webpack-pluginï¼Œdllï¼‰</li>
<li>é¢„åŠ è½½ï¼ˆpreloadï¼‰</li>
<li>å‡å°‘è¯·æ±‚èµ„æºæ•°ï¼ˆmini-css-extract-pluginï¼Œhtml-webpack-pluginï¼‰</li>
</ul>
</li>
<li><p>å·®å¼‚åŒ–æœåŠ¡</p>
</li>
<li><p>å›¾ç‰‡æ‡’åŠ è½½ï¼ˆéå¯è§†åŒºåŸŸå›¾ç‰‡ç”¨placeholderæ›¿ä»£æˆ–è€…ä½è´¨é‡å›¾ç‰‡ï¼‰</p>
</li>
<li><p>å‡å°‘æ—¶é—´å¤æ‚åº¦</p>
</li>
<li><p>éå¿…è¦æ–‡ä»¶å¼‚æ­¥åŠ è½½æˆ–åŠ¨æ€åŠ è½½æ¨¡å—</p>
</li>
<li><p>å¯¹æ ¸å¿ƒå†…å®¹å¯ç”¨SSR</p>
</li>
</ol>
<h2 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="headerlink" title="è·¨åŸŸ"></a>è·¨åŸŸ</h2><p>CORS</p>
<p>img</p>
<p>script</p>
]]></content>
      <tags>
        <tag>article</tag>
        <tag>conclusion</tag>
      </tags>
  </entry>
  <entry>
    <title>mutationObserver</title>
    <url>/2019/12/18/mutationObserver/</url>
    <content><![CDATA[<h3 id="MutationObserver-ä¸€ä¸ªç›‘å¬domå…ƒç´ å˜åŒ–çš„æ¥å£"><a href="#MutationObserver-ä¸€ä¸ªç›‘å¬domå…ƒç´ å˜åŒ–çš„æ¥å£" class="headerlink" title="MutationObserver,ä¸€ä¸ªç›‘å¬domå…ƒç´ å˜åŒ–çš„æ¥å£"></a>MutationObserver,ä¸€ä¸ªç›‘å¬domå…ƒç´ å˜åŒ–çš„æ¥å£</h3><p>domå…ƒç´ è§‚å¯Ÿè€…ï¼Œç›‘è§† DOM å˜åŠ¨çš„æ¥å£ï¼Œä½†æ˜¯äº‹ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦ç­‰æ‰€æœ‰domå…ƒç´ æ¸²æŸ“å®Œä¹‹åæ‰æ‰§è¡Œ<br>å®ä¾‹åŒ–ä¸€ä¸ªobserverå¯¹è±¡,å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ”¹å˜çš„å±æ€§æ‰€ç»„æˆçš„ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œä¸€ä¸ªæ˜¯å®ä¾‹æœ¬èº«</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const observer = new MutationObserver(mutationCallback);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ˜¯å®ƒçš„å±æ€§ä»‹ç»<br>|  å±æ€§   | ç±»å‹  | æè¿°  |<br>|  â€”-  | â€”-  | â€”- |<br>| childList  | Boolean |æ˜¯å¦è§‚å¯Ÿå­èŠ‚ç‚¹çš„å˜åŠ¨<br>| attributes  | Boolean |æ˜¯å¦è§‚å¯Ÿå±æ€§çš„å˜åŠ¨<br>| characterData  | Boolean |æ˜¯å¦èŠ‚ç‚¹å†…å®¹æˆ–èŠ‚ç‚¹æ–‡æœ¬çš„å˜åŠ¨<br>| subtree  | Boolean |æ˜¯å¦è§‚å¯Ÿæ‰€æœ‰åä»£èŠ‚ç‚¹çš„å˜åŠ¨<br>| attributeOldValue  | Boolean |è§‚å¯Ÿ attributes å˜åŠ¨æ—¶ï¼Œæ˜¯å¦è®°å½•å˜åŠ¨å‰çš„å±æ€§å€¼<br>| characterDataOldValue  | Boolean |è§‚å¯Ÿ characterData å˜åŠ¨æ—¶ï¼Œæ˜¯å¦è®°å½•å˜åŠ¨å‰çš„å±æ€§å€¼<br>| attributeFilter  | Boolean |è¡¨ç¤ºéœ€è¦è§‚å¯Ÿçš„ç‰¹å®šå±æ€§ï¼ˆæ¯”å¦‚[â€˜classâ€™,â€™srcâ€™]ï¼‰ï¼Œä¸åœ¨æ­¤æ•°ç»„ä¸­çš„å±æ€§å˜åŒ–æ—¶å°†è¢«å¿½ç•¥</p>
<p>å®ä¾‹åˆå§‹åŒ–å,å®ä¾‹è°ƒç”¨observeæ¥ç›‘å¬targetNodeå±æ€§çš„å˜åŒ–ï¼Œéœ€è¦ç›‘å¬çš„å±æ€§æ”¾åœ¨configä¸­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const config = &#123;</span><br><span class="line">    attributes:true,</span><br><span class="line">    childList:true,</span><br><span class="line">    subtree:true</span><br><span class="line">&#125;</span><br><span class="line">const targetNode = document.getElementById(&apos;test&apos;);</span><br><span class="line">observer.observe(targetNode,config)</span><br></pre></td></tr></table></figure>

<p>å›è°ƒå‡½æ•°ä¸­å¯ä»¥è¿™æ ·å†™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const mutationCallback = (mutationList)=&gt;&#123;</span><br><span class="line">  for(let mutation of mutationList)&#123;</span><br><span class="line">    const type = mutation.type;</span><br><span class="line">    switch(type)&#123;</span><br><span class="line">      case &apos;childList&apos;:</span><br><span class="line">        console.log(&apos;A child node has added or removed&apos;);</span><br><span class="line">        break;</span><br><span class="line">      case &apos;attributes&apos;:</span><br><span class="line">        console.log(`the $&#123;mutation.attributaName&#125; attribute was modified`);</span><br><span class="line">        break;</span><br><span class="line">      case &apos;subtree&apos;:</span><br><span class="line">        console.log(&apos;the subtree was modified&apos;;)</span><br><span class="line">        break</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬è¿™æ ·å°±å¯ä»¥å®Œæˆäº†ä¸€ä¸ªå¯¹domå…ƒç´ çš„ç›‘å¬äº†</p>
<p>å½“ä¸æƒ³ç›‘å¬domå…ƒç´ å˜åŒ–çš„æ—¶å€™,å¯ä»¥ç”¨disconnectæ¥å–æ¶ˆç›‘å¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">observer.disconnnet()</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>mutation</tag>
      </tags>
  </entry>
  <entry>
    <title>npmåŒ…çš„å‘å¸ƒ</title>
    <url>/2020/09/02/npm-pkg/</url>
    <content><![CDATA[<p><strong>è¶è¶è¶ç€è¿˜ä¸å¤ªå¿™ï¼Œè¡¥ä¸ªnpmåŒ…çš„å‘å¸ƒ</strong></p>
<ul>
<li>é‚£ä¹ˆé¦–å…ˆå°±æ˜¯<code>npm init -y</code>åˆå§‹åŒ–ä¸€ä¸ªnpmä»“åº“</li>
<li>ç„¶å<code>touch index.js</code>åˆ›å»ºindexæ–‡ä»¶</li>
<li>å®‰è£…<code>chalk figlet commander</code>è¿™å‡ ä¸ªåŒ…ï¼Œâš ï¸ä¸€å®šä¸€å®šè¦è£…å¼€å‘ä¾èµ–ï¼ï¼</li>
<li>ç„¶åcoding</li>
<li>è¦è®°å¾—åœ¨packageæ–‡ä»¶åŠ ä¸Šbinå­—æ®µï¼Œvalueæ˜¯å¯¹è±¡ï¼Œkeyæ˜¯è¦åœ¨<code>terminal</code>è¿è¡Œçš„å‘½ä»¤ï¼Œkeyå¯¹åº”çš„å¯¹è±¡æ˜¯è¦æ‰§è¡Œçš„æ–‡ä»¶</li>
<li>âš ï¸ä¸€å®šä¸€å®šè¦è®°å¾—åœ¨æ‰§è¡Œçš„æ–‡ä»¶çš„å¤´éƒ¨è¦åŠ <code>#!/usr/bin/env node</code>(å¿ƒå¡ï¼ŒæŸ¥äº†å¥½ä¹…æ‰æ‰¾åˆ°)ï¼ï¼ï¼</li>
<li>codingç»“æŸè¦ç”¨<code>npm link</code>æœ¬åœ°è°ƒè¯•ä¸€ä¸ªï¼Œè®°ä½npmçš„repoä¸è¦å®šä½åˆ°æ·˜å®çš„å»ï¼ï¼</li>
<li>æ²¡æœ‰è´¦å·çš„è®°å¾—æ³¨å†Œï¼Œç„¶åç”¨npm login ç™»é™†ä¸€ä¸‹</li>
<li>npm publishï¼Œâš ï¸ä¸€å®šä¸€å®šè¦è®°å¾—æ”¹ç‰ˆæœ¬å·ï¼ï¼å¦‚æœpublishçš„æ—¶å€™403äº†ï¼Œmaybeæ˜¯ä½ çš„åŒ…é‡åäº†ï¼Œè®°å¾—å»npmä¸ŠæŸ¥ä¸€ä¸‹ä½ çš„åŒ…æœ‰æ²¡æœ‰è·Ÿåˆ«äººçš„é‡äº†(è¸©å‘è¸©çš„é‚£å«ä¸€è¸©ä¸€ä¸ªå‡†hhh)<br>Doneï¼</li>
</ul>
]]></content>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>provide of vue3</title>
    <url>/2020/06/28/provide/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å¥½å¥‡provideæ€ä¹ˆå®ç°çš„ï¼Œç„¶åå‘¢å°±å»æ‰’äº†ä¸‹æºç hhhï¼Œçœ‹äº†ä¸‹provideçš„functionï¼Œæœ‰ç‚¹æ‡µ,provideçš„ä»£ç åœ¨runtime-core/src/apiInject.tsé‡Œé¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> interface InjectionKey&lt;T&gt; extends Symbol &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> provide&lt;T&gt;(key: InjectionKey&lt;T&gt; | string, value: T) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!currentInstance) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      warn(`provide() can only be used inside setup().`)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">let</span> provides = currentInstance.provides</span><br><span class="line">    <span class="comment"># by default an instance inherits its parent's provides object</span></span><br><span class="line">    <span class="comment"># but when it needs to provide values of its own, it creates its</span></span><br><span class="line">    <span class="comment"># own provides object using parent provides object as prototype.</span></span><br><span class="line">    <span class="comment"># this way in `inject` we can simply look up injections from direct</span></span><br><span class="line">    <span class="comment"># parent and let the prototype chain do the work.</span></span><br><span class="line">    const parentProvides =</span><br><span class="line">      currentInstance.parent &amp;&amp; currentInstance.parent.provides</span><br><span class="line">    <span class="keyword">if</span> (parentProvides === provides) &#123;</span><br><span class="line">      provides = currentInstance.provides = Object.create(parentProvides)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># TS doesn't allow symbol as index type</span></span><br><span class="line">    provides[key as string] = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>æœ‰ç‚¹çº³é—·ä¸ºå•¥parentProvides === provides çš„æ—¶å€™å°±å¯ä»¥åˆ¤æ–­å½“å‰çš„å®ä¾‹è°ƒç”¨äº†provideï¼Œç„¶åæˆ‘ç”¨å°¤å¤§çš„é‚£ä¸ªviteå†™äº†ä¸ªdemoï¼Œçˆ¶å…ƒç´ è°ƒç”¨provideï¼Œå­å…ƒç´ ä¹Ÿè°ƒç”¨provide<br><br>App.vue</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;img alt=<span class="string">"Vue logo"</span> src=<span class="string">"./assets/logo.png"</span> /&gt;</span><br><span class="line">  &lt;HelloWorld msg=<span class="string">"Hello Vue 3.0 + Vite"</span> /&gt;</span><br><span class="line">  &#123;&#123;foo&#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import HelloWorld from <span class="string">'./components/HelloWorld.vue'</span></span><br><span class="line">import &#123;provide,inject&#125; from <span class="string">'vue'</span></span><br><span class="line"><span class="built_in">export</span> default &#123;</span><br><span class="line">  name: <span class="string">'App'</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">  &#125;,</span><br><span class="line">  setup(props,ctx)&#123;</span><br><span class="line">	  provide(<span class="string">'foo'</span>,1)</span><br><span class="line">	  // console.log(ctx,props)</span><br><span class="line">	  <span class="built_in">return</span> &#123;</span><br><span class="line">		  foo:inject(<span class="string">'foo'</span>)</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;br&gt;</span><br></pre></td></tr></table></figure>

<p>HelloWorld.vue</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;</span><br><span class="line">	&lt;button @click=<span class="string">"count++"</span>&gt;count is: &#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br><span class="line">	&lt;p&gt;</span><br><span class="line">		Edit</span><br><span class="line">		&lt;code&gt;components/HelloWorld.vue&lt;/code&gt;</span><br><span class="line">		to <span class="built_in">test</span> hot module replacement.</span><br><span class="line">	&lt;/p&gt;</span><br><span class="line">	&#123;&#123;foo&#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref ,provide,inject,defineComponent&#125; from <span class="string">'vue'</span>;</span><br><span class="line"><span class="built_in">export</span> default defineComponent(&#123;</span><br><span class="line">	name: <span class="string">'HelloWorld'</span>,</span><br><span class="line">	props: &#123;</span><br><span class="line">		msg: String</span><br><span class="line">	&#125;,</span><br><span class="line">	setup(props,ctx ) &#123;</span><br><span class="line">		// debugger</span><br><span class="line">		const count = ref(0);</span><br><span class="line">		provide(<span class="string">'bar'</span>,2)</span><br><span class="line">		// debugger</span><br><span class="line">		// console.log(ctx.provide)</span><br><span class="line">		const foo = inject(<span class="string">'foo'</span>)</span><br><span class="line">		<span class="built_in">return</span> &#123;</span><br><span class="line">			count,</span><br><span class="line">			foo</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;br&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨debugçš„æ—¶å€™åœ¨è°ƒç”¨æ ˆé‡Œé¢å‘ç°åœ¨è°ƒç”¨mountçš„æ—¶å€™ä»¥æ­¤è°ƒç”¨äº†render,patch,processComponent,mountComponent..è¿™äº›æ–¹æ³•ï¼Œrenderå’Œpatchåº”è¯¥æ˜¯å’Œdomç›¸å…³ï¼Œç„¶åçœ‹processComponent</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const processComponent = (n1, n2, container, anchor, parentComponent, parentSuspense, isSVG, optimized) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (n1 == null) &#123;</span><br><span class="line">          <span class="keyword">if</span> (n2.shapeFlag &amp; 512 /* COMPONENT_KEPT_ALIVE */) &#123;</span><br><span class="line">              parentComponent.ctx.activate(n2, container, anchor, isSVG, optimized);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              mountComponent(n2, container, anchor, parentComponent, parentSuspense, isSVG, optimized);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          updateComponent(n1, n2, optimized);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>emmmçœ‹èµ·æ¥è¿˜æ˜¯è·Ÿdomç›¸å…³,ç›´æ¥çœ‹æ¸²æŸ“ç»„ä»¶çš„æ—¶å€™å¹²äº†å•¥å§ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const mountComponent = (initialVNode, container, anchor, parentComponent, parentSuspense, isSVG, optimized) =&gt; &#123;</span><br><span class="line">       const instance = (initialVNode.component = createComponentInstance(initialVNode, parentComponent, parentSuspense)); //çœ‹è¿™ä¸ªå®ä¾‹</span><br><span class="line">       //çœç•¥ä»£ç </span><br><span class="line">       // setup() is async. This component relies on async logic to be resolved</span><br><span class="line">       // before proceeding</span><br><span class="line">       //çœç•¥ä»£ç </span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>

<br>
createComponentInstance

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> createComponentInstance(vnode, parent, suspense) &#123;</span><br><span class="line">    // inherit parent app context - or - <span class="keyword">if</span> root, adopt from root vnode</span><br><span class="line">    // ç»§æ‰¿çˆ¶çº§appä¸Šä¸‹æ–‡ï¼Œå¦‚æœæ˜¯rootï¼Œè°ƒæ•´ä¸ºæ ¹èŠ‚ç‚¹</span><br><span class="line">    const appContext = (parent ? parent.appContext : vnode.appContext) || emptyAppContext;</span><br><span class="line">    const instance = &#123;</span><br><span class="line">        //çœç•¥</span><br><span class="line">        provides: parent ? parent.provides : Object.create(appContext.provides),</span><br><span class="line">        //çœç•¥</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((process.env.NODE_ENV !== <span class="string">'production'</span>)) &#123;</span><br><span class="line">        instance.ctx = createRenderContext(instance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        instance.ctx = &#123; _: instance &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    instance.root = parent ? parent.root : instance;</span><br><span class="line">    instance.emit = emit.bind(null, instance);</span><br><span class="line">    <span class="built_in">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å¦‚æœinstanceå¦‚æœæœ‰çˆ¶å…ƒç´ çš„è¯ï¼Œinstanceé‡Œé¢çš„providesæ˜¯ä¼šç»§æ‰¿çˆ¶èŠ‚ç‚¹ä¸­çš„provides<br>æ‰€ä»¥è¿™å°±æ˜¯ä¸ºå•¥provideæ–¹æ³•ä¸­åˆ¤æ–­å½“å‰çš„provideå’Œçˆ¶å…ƒç´ çš„æ˜¯å¦ç›¸ç­‰ï¼Œå› ä¸ºå¦‚æœå½“å‰èŠ‚ç‚¹è°ƒç”¨provideæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå½“å‰å…ƒç´ çš„provideä¸€å®šæ˜¯å’Œçˆ¶å…ƒç´ çš„provideçš„å¼•ç”¨åœ°å€ç›¸åŒçš„ï¼Œæ‰€ä»¥å½“å‰çš„provideå°±å¯ä»¥æŠŠçˆ¶å…ƒç´ çš„provideå½“åšåŸå‹é“¾æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„object<br><br><br>ç„¶åæˆ‘å›å¤´çœ‹äº†ä¸‹provideæ–¹æ³•çš„æ³¨è§£ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ä¾‹æ˜¯ç»§æ‰¿çˆ¶å…ƒç´ çš„providesçš„ï¼Œæ“å•Šï¼Œæˆ‘èŠ±è¿™ä¹ˆå¤šæ—¶é—´æ˜¯å¹²å•¥å•Šï¼</p>
]]></content>
      <categories>
        <category>Vue</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>å“åº”å¼æ¨¡å—</title>
    <url>/2020/07/09/reactive/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>vue3 å‡ºäº† betaï¼Œäº†è§£ä¸€ä¸‹å“åº”å¼æ•°æ®çš„å®ç°</p>
<h3 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p>ä¸‹é¢è¿™äº›æ˜¯åœ¨ reactive ä¸­å¯¼å…¥çš„å¤–éƒ¨æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import &#123; isObject, toRawType, def, hasOwn, makeMap &#125; from <span class="string">'@vue/shared'</span><span class="comment">##è¿™äº›éƒ½æ˜¯é€šç”¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">## ä¸¤ä¸ªhandlerï¼Œå¾…ä¼šå„¿è¯´ä¸ºå•¥</span></span><br><span class="line">import &#123;</span><br><span class="line">  mutableHandlers,</span><br><span class="line">  readonlyHandlers,</span><br><span class="line">  shallowReactiveHandlers,</span><br><span class="line">  shallowReadonlyHandlers</span><br><span class="line">&#125; from <span class="string">'./baseHandlers'</span></span><br><span class="line">import &#123;</span><br><span class="line">  mutableCollectionHandlers,</span><br><span class="line">  readonlyCollectionHandlers,</span><br><span class="line">  shallowCollectionHandlers</span><br><span class="line">&#125; from <span class="string">'./collectionHandlers'</span></span><br><span class="line"><span class="comment">## ç„¶åæ˜¯refï¼Œæ˜¯ä¸ºäº†ç»™primitiveç±»å‹çš„valueåšreactive</span></span><br><span class="line">import &#123; UnwrapRef, Ref &#125; from <span class="string">'./ref'</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>ç„¶åæ˜¯å¸¸é‡å®šä¹‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="built_in">export</span> const enum ReactiveFlags &#123;</span><br><span class="line">  SKIP = <span class="string">'__v_skip'</span>,</span><br><span class="line">  IS_REACTIVE = <span class="string">'__v_isReactive'</span>,</span><br><span class="line">  IS_READONLY = <span class="string">'__v_isReadonly'</span>,</span><br><span class="line">  RAW = <span class="string">'__v_raw'</span>,</span><br><span class="line">  REACTIVE = <span class="string">'__v_reactive'</span>,</span><br><span class="line">  READONLY = <span class="string">'__v_readonly'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## æ‰€ç›‘å¬æ•°æ®ä¸­çš„å±æ€§æ¥å£</span></span><br><span class="line">interface Target &#123;</span><br><span class="line">  [ReactiveFlags.SKIP]?: boolean</span><br><span class="line">  [ReactiveFlags.IS_REACTIVE]?: boolean</span><br><span class="line">  [ReactiveFlags.IS_READONLY]?: boolean</span><br><span class="line">  [ReactiveFlags.RAW]?: any</span><br><span class="line">  [ReactiveFlags.REACTIVE]?: any</span><br><span class="line">  [ReactiveFlags.READONLY]?: any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>typeof Map = &#39;function&#39;</code>ä»¥åŠ Set é‡Œé¢çš„å››ä¸ªç±»å‹éƒ½æ˜¯ï¼Œæ‰€ä»¥è¿™é‡Œçš„ collectionTypes è¦å˜æˆ new Set<function></function></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const collectionTypes = new Set&lt;Function&gt;([Set, Map, WeakMap, WeakSet])</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ˜¯åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨çš„å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#</span></span><br><span class="line"> <span class="comment"># Make a map and return a function for checking if a key</span></span><br><span class="line"> <span class="comment"># is in that map.</span></span><br><span class="line"> <span class="comment"># IMPORTANT: all calls of this function must be prefixed with</span></span><br><span class="line"> <span class="comment"># \/\*#\_\_PURE\_\_\*\/</span></span><br><span class="line"> <span class="comment"># So that rollup can tree-shake them if necessary.</span></span><br><span class="line"> <span class="comment">#</span></span><br><span class="line"> <span class="comment"># è¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›ç”¨çš„æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œå¾ˆæ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè¿”å›çš„å‡½æ•°æ˜¯ç”¨æ¥åˆ¤æ–­# keyæ˜¯å¦å­˜åœ¨mapä¸­,åœ¨è°ƒç”¨æ–¹æ³•æ—¶è¦åœ¨å‰ç‰‡åŠ ä¾‹å­ä¸­çš„pure è®©rollupèƒ½å¤Ÿtree-shake</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> makeMap(</span><br><span class="line">  str: string,</span><br><span class="line">  expectsLowerCase?: boolean</span><br><span class="line">): (key: string) =&gt; boolean &#123;</span><br><span class="line">  const map: Record&lt;string, boolean&gt; = Object.create(null)</span><br><span class="line">  const list: Array&lt;string&gt; = str.split(<span class="string">','</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; list.length; i++) &#123;</span><br><span class="line">    map[list[i]] = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> expectsLowerCase ? val =&gt; !!map[val.toLowerCase()] : val =&gt; !!map[val]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const isObservableType = /*<span class="comment">#__PURE__*/ makeMap(</span></span><br><span class="line">  <span class="string">'Object,Array,Map,Set,WeakMap,WeakSet'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## åˆ¤æ–­valueæ˜¯å¦èƒ½è¢«ä»£ç†</span></span><br><span class="line">const canObserve = (value: Target): boolean =&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    !value[ReactiveFlags.SKIP] &amp;&amp;</span><br><span class="line">    isObservableType(toRawType(value)) &amp;&amp;</span><br><span class="line">    !Object.isFrozen(value)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## only unwrap nested ref,ç”¨æ¥ç»™åµŒå¥—çš„refè§£å¥—</span></span><br><span class="line"><span class="built_in">type</span> UnwrapNestedRefs&lt;T&gt; = T extends Ref ? T : UnwrapRef&lt;T&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## å‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> reactive&lt;T extends object&gt;(target: T): UnwrapNestedRefs&lt;T&gt;</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> reactive(target: object) &#123;</span><br><span class="line">  <span class="comment">## if trying to observe a readonly proxy, return the readonly version.</span></span><br><span class="line">  <span class="comment">## å¦‚æœä¼ è¿›æ¥çš„æ•°æ®æ˜¯åªè¯»çš„ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (target &amp;&amp; (target as Target)[ReactiveFlags.IS_READONLY]) &#123;</span><br><span class="line">    <span class="built_in">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">## å¦åˆ™å°±åˆ›å»ºå“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="built_in">return</span> createReactiveObject(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    mutableHandlers,</span><br><span class="line">    mutableCollectionHandlers</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½œè€…çš„æ³¨é‡Šéƒ½å†™çš„å¾ˆæ˜ç™½äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åªæœ‰åœ¨å±æ€§ä¸­ä¸å¸¦skipå¹¶ä¸”ç±»å‹å±äº'Object,Array,Map,Set,WeakMap,WeakSet'å¹¶ä¸”å±æ€§æ²¡æœ‰è¢«å†»ç»“çš„å¯¹è±¡æ‰èƒ½å¤Ÿè¢«ä»£ç†</span></span><br><span class="line">const canObserve = (value: Target): boolean =&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    !value[ReactiveFlags.SKIP] &amp;&amp;</span><br><span class="line">    isObservableType(toRawType(value)) &amp;&amp;</span><br><span class="line">    !Object.isFrozen(value)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">const hasOwnProperty = Object.prototype.hasOwnProperty</span><br><span class="line"><span class="built_in">export</span> const hasOwn = (</span><br><span class="line">  val: object,</span><br><span class="line">  key: string | symbol</span><br><span class="line">): key is keyof typeof val =&gt; hasOwnProperty.call(val, key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> createReactiveObject(</span><br><span class="line">  target: Target,</span><br><span class="line">  isReadonly: boolean,</span><br><span class="line">  baseHandlers: ProxyHandler&lt;any&gt;,</span><br><span class="line">  collectionHandlers: ProxyHandler&lt;any&gt;</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      console.warn(`value cannot be made reactive: <span class="variable">$&#123;String(target)&#125;</span>`)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># target is already a Proxy, return it.</span></span><br><span class="line">  <span class="comment"># exception: calling readonly() on a reactive object</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    target[ReactiveFlags.RAW] &amp;&amp;</span><br><span class="line">    !(isReadonly &amp;&amp; target[ReactiveFlags.IS_REACTIVE])</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="built_in">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># target already has corresponding Proxy</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    hasOwn(target, isReadonly ? ReactiveFlags.READONLY : ReactiveFlags.REACTIVE)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="built_in">return</span> isReadonly</span><br><span class="line">      ? target[ReactiveFlags.READONLY]</span><br><span class="line">      : target[ReactiveFlags.REACTIVE]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># only a whitelist of value types can be observed.</span></span><br><span class="line">  <span class="keyword">if</span> (!canObserve(target)) &#123;</span><br><span class="line">    <span class="built_in">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  const observed = new Proxy(</span><br><span class="line">    target,</span><br><span class="line">    collectionTypes.has(target.constructor) ? collectionHandlers : baseHandlers</span><br><span class="line">  )</span><br><span class="line">  def(</span><br><span class="line">    target,</span><br><span class="line">    isReadonly ? ReactiveFlags.READONLY : ReactiveFlags.REACTIVE,</span><br><span class="line">    observed</span><br><span class="line">  )</span><br><span class="line">  <span class="built_in">return</span> observed</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># defå‡½æ•°ï¼Œæ˜¾ç„¶æ˜¯åœ¨objå®šä¹‰ä¸€ä¸ªå¯ç¼–å†™ä¸å¯æšä¸¾çš„key,å°†targetçš„å“åº”å¼å¯¹è±¡å‚¨å­˜åœ¨è‡ªèº«çš„å±æ€§ä¸Šï¼Œè¿™æ ·å¯ä»¥è§£å†³è‡ªå·±åµŒå¥—è‡ªå·±çš„æ— é™å¾ªç¯ï¼ˆç¦æ­¢å¥—å¨ƒï¼‰</span></span><br><span class="line"><span class="built_in">export</span> const def = (obj: object, key: string | symbol, value: any) =&gt; &#123;</span><br><span class="line">  Object.defineProperty(obj, key, &#123;</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    value</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿™é‡Œè¦è¯´æ˜ä¸ºä»€ä¹ˆå¯¹ target æ‰§è¡Œä»£ç†çš„æ—¶å€™ handler è¦æ ¹æ® target çš„ contstructor æ¥è°ƒç”¨ä¸åŒçš„ handlerï¼Œæ‹¿ Map ä¸¾ä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const map = new Map()</span><br><span class="line">const proxy = new Proxy(map,&#123;&#125;)</span><br><span class="line">proxy.set(1,1)</span><br></pre></td></tr></table></figure>

<p>ä¸€æ‰§è¡Œè‚¯å®šå°±æŠ¥é”™<code>Uncaught TypeError: Method Map.prototype.set called on incompatible receiver [object Object]</code>,æç¤ºä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬ä»£ç å¯ä»¥å˜æˆè¿™æ ·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var map = new Map();</span><br><span class="line">var proxy = new Proxy(map, &#123;&#125;);</span><br><span class="line">Map.prototype.set.call(proxy, 1, 1);</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™æ®µä»£ç <code>Map.prototype.set.call(proxy, 1, 1);</code>ä¸ºä»€ä¹ˆè¿™ä¸ªæŠ¥é”™ï¼Œå°±æ˜¯è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒ</p>
<p>é‚£é¦–å…ˆï¼ŒMap è¿™ä¸ªå‘¢æŠŠæ•°æ®å‚¨å­˜åœ¨è‡ªå·±çš„ç§æœ‰å†…éƒ¨æ’æ§½ä¸­ï¼Œç±»å‹[MapData]è¿™æ ·ï¼Œç„¶åè¿™ä¸ªæ’æ§½æ˜¯è·Ÿ Map å¯¹è±¡è‡ªèº«ç»‘å®šçš„ã€‚è€Œ Proxy ä¸èƒ½å®Œå…¨æ¨¡ä»¿è¿™æ ·çš„è¡Œä¸ºï¼Œå·§çš„æ˜¯ï¼Œè¿™æ ·çš„æ’æ§½ Proxy å­¦ä¸æ¥ï¼Œæ‰€ä»¥åœ¨ç»™å®ƒä»¬åšä»£ç†çš„æ—¶å€™æŠŠè°ƒç”¨çš„å®ä¾‹é‡æ–°æŒ‡å‘ Map è¿™ç±»ç»“æ„çš„å®ä¾‹å†è¿›è¡Œè°ƒç”¨å®ä¾‹æ–¹æ³•å°±è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const PRIVATE = new WeakMap();</span><br><span class="line">const obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">PRIVATE.set(obj, <span class="string">"private stuff"</span>);</span><br><span class="line"></span><br><span class="line">const proxy = new Proxy(obj, &#123;&#125;);</span><br><span class="line"></span><br><span class="line">PRIVATE.get(proxy) === undefined // <span class="literal">true</span></span><br><span class="line">PRIVATE.get(obj) === <span class="string">"private stuff"</span> // <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åœ¨ä¸Šé¢åˆ›å»ºå“åº”å¼å¯¹è±¡çš„æ—¶å€™è¦æ ¹æ® target çš„ç±»å‹æ˜¯åˆ¤æ–­ç”¨å“ªä¸ªçš„ handler</p>
<p>ä¹‹å‰çš„æšä¸¾ç±»å‹ä¸­æœ‰å®šä¹‰äº†<code>IS_REACTIVE</code>å’Œ<code>IS_READONLY</code>ï¼Œå°±æ˜¯ç”¨æ¥åˆ¤æ–­<code>isReactive</code>å’Œ<code>isReadonly</code>ï¼Œç”±äºåˆ›å»ºåªè¯»å¯¹è±¡çš„<code>readonly</code>æ–¹æ³•å’Œåˆ›å»ºå“åº”å¼å¯¹è±¡çš„<code>reactive</code>éƒ½æ˜¯é€šè¿‡<code>createReactiveObject</code>æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡åˆ¤æ–­å“åº”å¼æˆ–è€…åªè¯»å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è¢«ä»£ç†è¿‡çš„å¯¹è±¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isReactive(value: unknown): boolean &#123;</span><br><span class="line">  <span class="keyword">if</span> (isReadonly(value)) &#123;</span><br><span class="line">    <span class="built_in">return</span> isReactive((value as Target)[ReactiveFlags.RAW])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> !!(value &amp;&amp; (value as Target)[ReactiveFlags.IS_REACTIVE])</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isReadonly(value: unknown): boolean &#123;</span><br><span class="line">  <span class="built_in">return</span> !!(value &amp;&amp; (value as Target)[ReactiveFlags.IS_READONLY])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isProxy(value: unknown): boolean &#123;</span><br><span class="line">  <span class="built_in">return</span> isReactive(value) || isReadonly(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è·å–åŸå§‹æ•°æ®</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> toRaw&lt;T&gt;(observed: T): T &#123;</span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    (observed &amp;&amp; toRaw((observed as Target)[ReactiveFlags.RAW])) || observed</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸è®©valueå€¼è¢«ä»£ç†ï¼Œä¹‹å‰çš„canObserveä¸­æœ‰å¯¹SKIPçš„åˆ¤æ–­</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> markRaw&lt;T extends object&gt;(value: T): T &#123;</span><br><span class="line">  def(value, ReactiveFlags.SKIP, <span class="literal">true</span>)</span><br><span class="line">  <span class="built_in">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>toRaw</code>è¿™ä¸ªæ–¹æ³•æˆ‘æ›¾ç»æŠŠå®ƒæ”¹æˆè¿™æ ·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> toRaw&lt;T&gt;(observed: T): T &#123;</span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">       observed ? toRaw((observed as Target)[ReactiveFlags.RAW]) : observed</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè·‘äº†å•æµ‹ï¼Œå‘ç°æ‰€æœ‰æœ‰å…³ toRaw çš„æµ‹è¯•ç”¨ä¾‹éƒ½æŠ¥é”™ï¼Œæˆ‘é .ç„¶åå†™äº†ä¸ªå° demo è·‘äº†ä¸€ä¸‹ï¼Œä¸Šé¢è¿™ä¸ªä»£ç åœ¨è¿›å…¥å€’æ•°ç¬¬äºŒä¸ªè°ƒç”¨æ ˆçš„æ—¶å€™ï¼Œobserved æ˜¯ truthyï¼Œç„¶åè¿›å…¥æœ€åä¸€ä¸ªè°ƒç”¨æ ˆçš„æ—¶å€™æ˜¯è¿”å› undefined çš„ï¼Œç„¶åè¿”å›å€’æ•°ç¬¬äºŒä¸ªè°ƒç”¨æ ˆçš„æ—¶å€™è¿˜æ˜¯ undefinedï¼Œè¿™æ ·ä¸€ç›´åˆ°ç¬¬ä¸€ä¸ªæ ˆè¿”å›çš„ç»“æœä¸€ç›´éƒ½æ˜¯ undefined.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> toRaw&lt;T&gt;(observed: T): T &#123;</span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    (observed &amp;&amp; toRaw((observed as Target)[ReactiveFlags.RAW])) || observed</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼ŒåŒæ ·çš„è¿›å…¥æœ€åä¸€ä¸ªè°ƒç”¨æ ˆçš„æ—¶å€™è¿”å›çš„æ˜¯ undefinedï¼Œä½†æ˜¯è¿”å›å€’æ•°ç¬¬äºŒä¸ªè°ƒç”¨æ ˆçš„æ—¶å€™ <code>observed &amp;&amp; undefined</code>æ˜¯ fasly å€¼ï¼Œæ‰€ä»¥å€’æ•°ç¬¬äºŒä¸ªè°ƒç”¨æ ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼<code>observed</code>,æœ‰ã€ä¸œè¥¿ï¼Œæ™ºå•†æ‰æ€¥äº†ã€‚</p>
<p>ç„¶åè¿˜å‰©å‡ ä¸ªæ–¹æ³•,è¿™ä¸ªä¸ç”¨è¯´ï¼Œå¾ˆæ˜æ˜¾æ˜¯è®¾ç½®åªè¯»å¯¹è±¡ï¼Œhandler ä¹Ÿæ˜¯æœ‰æ‰€åŒºåˆ«çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> <span class="built_in">readonly</span>&lt;T extends object&gt;(</span><br><span class="line">  target: T</span><br><span class="line">): Readonly&lt;UnwrapNestedRefs&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> createReactiveObject(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    readonlyHandlers,</span><br><span class="line">    readonlyCollectionHandlers</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æµ…æ‹·è´ï¼Œåªæœ‰ç¬¬ä¸€å±‚çš„æ•°æ®æ‰æ˜¯å“åº”å¼</span></span><br><span class="line"><span class="comment"># Return a reactive-copy of the original object, where only the root level</span></span><br><span class="line"><span class="comment"># properties are reactive, and does NOT unwrap refs nor recursively convert</span></span><br><span class="line"><span class="comment"># returned properties.</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> shallowReactive&lt;T extends object&gt;(target: T): T &#123;</span><br><span class="line">  <span class="built_in">return</span> createReactiveObject(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    shallowReactiveHandlers,</span><br><span class="line">    shallowCollectionHandlers</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æµ…åªè¯»ï¼Œä¸ä¼šå¯¹refè§£å¥—</span></span><br><span class="line"><span class="comment"># Return a reactive-copy of the original object, where only the root level</span></span><br><span class="line"><span class="comment"># properties are readonly, and does NOT unwrap refs nor recursively convert</span></span><br><span class="line"><span class="comment"># returned properties.</span></span><br><span class="line"><span class="comment"># This is used for creating the props proxy object for stateful components.</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> shallowReadonly&lt;T extends object&gt;(</span><br><span class="line">  target: T</span><br><span class="line">): Readonly&lt;&#123; [K <span class="keyword">in</span> keyof T]: UnwrapNestedRefs&lt;T[K]&gt; &#125;&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> createReactiveObject(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    shallowReadonlyHandlers,</span><br><span class="line">    readonlyCollectionHandlers</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="baseHandler"><a href="#baseHandler" class="headerlink" title="baseHandler"></a>baseHandler</h4><br>
<br>
å¯¼å…¥æ–¹æ³•
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import &#123; reactive, <span class="built_in">readonly</span>, toRaw, ReactiveFlags &#125; from <span class="string">'./reactive'</span></span><br><span class="line">import &#123; TrackOpTypes, TriggerOpTypes &#125; from <span class="string">'./operations'</span></span><br><span class="line">import &#123; track, trigger, ITERATE_KEY &#125; from <span class="string">'./effect'</span></span><br><span class="line">import &#123;</span><br><span class="line">  isObject,</span><br><span class="line">  hasOwn,</span><br><span class="line">  isSymbol,</span><br><span class="line">  hasChanged,</span><br><span class="line">  isArray,</span><br><span class="line">  extend</span><br><span class="line">&#125; from <span class="string">'@vue/shared'</span></span><br><span class="line">import &#123; isRef &#125; from <span class="string">'./ref'</span></span><br></pre></td></tr></table></figure>

<p>è·å–Symbolçš„å±æ€§å</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const builtInSymbols = new Set(</span><br><span class="line">  Object.getOwnPropertyNames(Symbol)</span><br><span class="line">    .map(key =&gt; (Symbol as any)[key])</span><br><span class="line">    .filter(isSymbol)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>çœ‹åå­—å°±çŸ¥é“å¹²å˜›çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const get = /*<span class="comment">#__PURE__*/ createGetter()</span></span><br><span class="line">const shallowGet = /*<span class="comment">#__PURE__*/ createGetter(false, true)</span></span><br><span class="line">const readonlyGet = /*<span class="comment">#__PURE__*/ createGetter(true)</span></span><br><span class="line">const shallowReadonlyGet = /*<span class="comment">#__PURE__*/ createGetter(true, true)</span></span><br></pre></td></tr></table></figure>

<p>å¯¹æ•°ç»„çš„è¿™ä¸‰ä¸ªæ–¹æ³•æ’æ¡©ï¼Œçœ‹çš„æ—¶å€™æœ‰ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸ªæ¡ä»¶åˆ†æ”¯æ˜¯<code>res === -1 || res === false</code>çš„æ—¶å€™ç»§ç»­æ‰§è¡Œï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¿›å…¥è¿™ä¸ªåˆ†æ”¯ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const arrayInstrumentations: Record&lt;string, Function&gt; = &#123;&#125;</span><br><span class="line">;[<span class="string">'includes'</span>, <span class="string">'indexOf'</span>, <span class="string">'lastIndexOf'</span>].forEach(key =&gt; &#123;</span><br><span class="line">  arrayInstrumentations[key] = <span class="keyword">function</span>(...args: any[]): any &#123;</span><br><span class="line">    const arr = toRaw(this) as any</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0, l = (this as any).length; i &lt; l; i++) &#123;</span><br><span class="line">      track(arr, TrackOpTypes.GET, i + <span class="string">''</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">## we run the method using the original args first (which may be reactive)</span></span><br><span class="line">    <span class="comment">## console.log(key,...args)</span></span><br><span class="line">    const res = arr[key](...args)</span><br><span class="line">    <span class="keyword">if</span> (res === -1 || res === <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="comment">## if that didn't work, run it again using raw values.</span></span><br><span class="line">      <span class="built_in">return</span> arr[key](...args.map(toRaw))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">## return res</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æŠŠ if çš„æ¡ä»¶åˆ†æ”¯æ³¨é‡Šï¼Œåªç•™ä¸‹<code>return res</code>è¿™ä¸ªåˆ†æ”¯ï¼Œç„¶åè·‘å•æµ‹ï¼Œå‘ç° reactiveArray.spec.ts è¿™ä¸ªæµ‹è¯•æ–‡ä»¶çš„æµ‹è¯•ç”¨ä¾‹<code>Ã— Array identity methods should work with raw values (16 ms)</code>æµ‹è¯•ä¸é€šè¿‡ã€‚å‘ç°æ˜¯åœ¨è¿™é‡Œçš„æ—¶å€™ä¸èƒ½æµ‹è¯•é€šè¿‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const raw = &#123;&#125;</span><br><span class="line">const arr = reactive([&#123;&#125;, &#123;&#125;])</span><br><span class="line">arr.push(raw)</span><br><span class="line"><span class="comment">## çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line"><span class="comment"># should work also for the observed version</span></span><br><span class="line">const observed = arr[2]</span><br><span class="line">expect(arr.indexOf(observed)).toBe(2)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†æµ‹è¯•ä¸é€šè¿‡ä»£ç æ‹·è´åˆ° vite çš„ app ä¸­è¿›è¡Œè°ƒè¯•ï¼Œå‘ç°æ˜¯ observed è¿™ä¸ªå€¼ä¸å†æ˜¯è·Ÿ raw ä¸€æ ·çš„{},çŒœæµ‹æ˜¯åŠ«æŒäº†æ•°ç»„çš„ get æ–¹æ³•å¹¶ä¸”å¯¹è¿”å›å€¼è¿›è¡Œäº†ä¿®æ”¹ã€‚ç„¶åè¿›å…¥åˆ°<code>createGetter</code>è¿™ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸ªé€»è¾‘,å¦‚æœå‚æ•°æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå°±è¦è½¬æˆå“åº”å¼å¯¹è±¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (isObject(res)) &#123;</span><br><span class="line">    <span class="comment"># Convert returned value into a proxy as well. we do the isObject check</span></span><br><span class="line">    <span class="comment"># here to avoid invalid value warning. Also need to lazy access readonly</span></span><br><span class="line">    <span class="comment"># and reactive here to avoid circular dependency.</span></span><br><span class="line">    <span class="built_in">return</span> isReadonly ? <span class="built_in">readonly</span>(res) : reactive(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜¾ç„¶ï¼Œ<code>typeof {} === &#39;object&#39;</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™çš„ observed ä¸å†æ˜¯å•çº¯çš„<code>{}</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå“åº”å¼çš„<code>{}</code>ï¼Œæ‰€ä»¥å°±èƒ½è§£é‡Šä¸ºä»€ä¹ˆåœ¨<code>res === -1 || res === false</code>çš„æ—¶å€™è¿˜è¦è¿›è¡Œæ¬¡å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢è·å–åˆ°çš„å€¼æ˜¯ç»è¿‡è½¬æ¢çš„å€¼ï¼Œæ‰€ä»¥åœ¨åˆ†æ”¯é‡Œé¢çš„å‚æ•°è¦å¯¹å‚æ•°è¿›è¡Œä¸€æ¬¡è¿˜åŸï¼ŒSKRã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªå°±æ˜¯åŠ«æŒäº† get çš„æ–¹æ³•ï¼Œä¸€æ¡æ¡é€»è¾‘çœ‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> createGetter(isReadonly = <span class="literal">false</span>, shallow = <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="keyword">function</span> get(target: object, key: string | symbol, receiver: object) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === ReactiveFlags.IS_REACTIVE) &#123;</span><br><span class="line">      <span class="built_in">return</span> !isReadonly</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === ReactiveFlags.IS_READONLY) &#123;</span><br><span class="line">      <span class="built_in">return</span> isReadonly</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp;</span><br><span class="line">      receiver ===</span><br><span class="line">        (isReadonly</span><br><span class="line">          ? (target as any)[ReactiveFlags.READONLY]</span><br><span class="line">          : (target as any)[ReactiveFlags.REACTIVE])</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="built_in">return</span> target</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const targetIsArray = isArray(target)</span><br><span class="line">    <span class="keyword">if</span> (targetIsArray &amp;&amp; hasOwn(arrayInstrumentations, key)) &#123;</span><br><span class="line">      <span class="built_in">return</span> Reflect.get(arrayInstrumentations, key, receiver)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const res = Reflect.get(target, key, receiver)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      isSymbol(key)</span><br><span class="line">        ? builtInSymbols.has(key)</span><br><span class="line">        : key === `__proto__` || key === `__v_isRef`</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="built_in">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">      track(target, TrackOpTypes.GET, key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shallow) &#123;</span><br><span class="line">      <span class="built_in">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isRef(res)) &#123;</span><br><span class="line">      <span class="comment"># ref unwrapping, only for Objects, not for Arrays</span></span><br><span class="line">      <span class="comment"># å¯¹äºrefçš„è§£å¥—ï¼Œä»…ä»…é’ˆå¯¹objectï¼Œä¸é’ˆå¯¹æ•°ç»„.</span></span><br><span class="line">      <span class="built_in">return</span> targetIsArray ? res : res.value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isObject(res)) &#123;</span><br><span class="line">      <span class="comment"># Convert returned value into a proxy as well. we do the isObject check</span></span><br><span class="line">      <span class="comment"># here to avoid invalid value warning. Also need to lazy access readonly</span></span><br><span class="line">      <span class="comment"># and reactive here to avoid circular dependency.</span></span><br><span class="line">      <span class="built_in">return</span> isReadonly ? <span class="built_in">readonly</span>(res) : reactive(res)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹è¿™ä¸ª,è€æ ·å­ï¼Œå…ˆæ³¨é‡Šï¼Œè·‘å•æµ‹ï¼Œçœ‹ç»“æœ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (key === ReactiveFlags.IS_REACTIVE) &#123;</span><br><span class="line">      <span class="built_in">return</span> !isReadonly</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœ:<br><img src="/images/reactive/code3.png" alt="code3"><br>å¯ä»¥çœ‹åˆ°æ˜¯<code>reactivity/reactive/Array â€º should make Array reactive</code>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­çš„æŸä¸ªç”¨ä¾‹å‡ºç°äº†é—®é¢˜ï¼Œæ¥çœ‹å…·ä½“é—®é¢˜ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const observed = reactive(original)</span><br><span class="line">expect(observed).not.toBe(original)</span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™æ®µæ˜¯é—®é¢˜ä»£ç </span></span><br><span class="line">expect(isReactive(observed)).toBe(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>çœ‹<code>isReactive</code>æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isReactive(value: unknown): boolean &#123;</span><br><span class="line">  <span class="keyword">if</span> (isReadonly(value)) &#123;</span><br><span class="line">    <span class="built_in">return</span> isReactive((value as Target)[ReactiveFlags.RAW])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> !!(value &amp;&amp; (value as Target)[ReactiveFlags.IS_REACTIVE])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ç°åœ¨å¯ä»¥çœ‹å‡ºï¼Œæ˜¯åœ¨æ•°ç»„è®¿é—®<code>ReactiveFlags.IS_REACTIVE</code>è¿™ä¸ª key çš„æ—¶å€™è¢«åŠ«æŒäº†ï¼Œç„¶åè¿›</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (key === ReactiveFlags.IS_REACTIVE) &#123;</span><br><span class="line">      return !isReadonly</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé€»è¾‘ï¼Œè‡³äºä¸ºä»€ä¹ˆè¿”å›ç»“æœè¦å¯¹<code>isReadonly</code>å–åï¼Œå¾ˆæ˜¾ç„¶ï¼Œåœ¨<code>createReactiveObject</code>çš„æ—¶å€™ reactive å’Œ readonly æ˜¯äº’æ–¥çš„å…³ç³»ï¼Œé‚£ä¹ˆä¸€ä¸ªå¯¹è±¡ä¸æ˜¯åªè¯»å¾ˆæ˜¾ç„¶å°±æ˜¯å“åº”å¼,é‚£å¦‚æœæ˜¯åŸå§‹å¯¹è±¡å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼ŒåŸå§‹å¯¹è±¡æ²¡æœ‰<code>__v_isReactive</code>è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆä¼šè¿”å› undefinedï¼Œç”¨!!è½¬ä¹‰å°±æ˜¯ falseï¼›ç„¶å<code>key === ReactiveFlags.IS_READONLY</code>è¿™ä¸ªåˆ†æ”¯çš„é€»è¾‘å°±è·Ÿ<code>REACTIVE</code>çš„é€»è¾‘ä¸€æ ·çš„ã€‚</p>
<p>ç„¶åæˆ‘æŠŠç¬¬ä¸‰ä¸ªåˆ†æ”¯ç»™æ³¨é‡Šï¼ŒWDMï¼Œç›´æ¥çˆ†æ ˆäº†ã€‚ã€‚ã€‚<br><br><br><code>RangeError: Maximum call stack size exceeded at Object.get (&lt;anonymous&gt;)</code><br>å››ä¸ªæµ‹è¯•ç”¨ä¾‹æ²¡é€šè¿‡ï¼Œæˆ‘é€‰äº†å…¶ä¸­ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥å¤ç°<code>Array identity methods should work with raw values</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> const raw = &#123;&#125;</span><br><span class="line"> const arr = reactive([&#123;&#125;, &#123;&#125;])</span><br><span class="line"> arr.push(raw)</span><br><span class="line">console.log(arr.indexOf(raw))</span><br></pre></td></tr></table></figure>

<p>ç„¶åè·Ÿç€ä»£ç èµ°ï¼Œå…ˆè¿›å…¥ indexOf çš„è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è¢«åŠ«æŒçš„,èµ°åˆ°è¿™é‡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[<span class="string">'includes'</span>, <span class="string">'indexOf'</span>, <span class="string">'lastIndexOf'</span>].forEach(key =&gt; &#123;</span><br><span class="line">    arrayInstrumentations[key] = <span class="keyword">function</span> (...args) &#123;</span><br><span class="line">        <span class="comment"># 1 è¿™é‡Œéœ€è¦è·å–å½“å‰æ•°ç»„çš„åŸå§‹æ•°æ®,ç„¶åä¼šåœ¨thisä¸­è®¿é—®__v_rawå±æ€§ï¼Œæ¥ç€å°±è¿›å…¥åŠ«æŒçš„getæ–¹æ³•</span></span><br><span class="line">        const arr = toRaw(this);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">let</span> i = 0, l = this.length; i &lt; l; i++) &#123;</span><br><span class="line">            track(arr, <span class="string">"get"</span> /* GET */, i + <span class="string">''</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># we run the method using the original args first (which may be reactive)</span></span><br><span class="line">        <span class="comment"># 2</span></span><br><span class="line">        const res = arr[key](...args);</span><br><span class="line">        <span class="keyword">if</span> (res === -1 || res === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="comment"># if that didn't work, run it again using raw values.</span></span><br><span class="line">            <span class="built_in">return</span> arr[key](...args.map(toRaw));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“1æ‰§è¡Œçš„æ—¶å€™ï¼Œè·³åˆ°getçš„æ—¶å€™æ­¤æ—¶çš„keyæ˜¯__v_raw</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæˆªå–getæ–¹æ³•çš„ä¸€éƒ¨åˆ†ï¼Œç¬¬ä¸‰ä¸ªåˆ†æ”¯è¢«æˆ‘åˆ å»ï¼Œæ­¤æ—¶ä¸ä¼šç›´æ¥returnï¼Œè€Œæ˜¯ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ­¤æ—¶</span></span><br><span class="line"><span class="comment"># çš„return resæ˜¯undefined,ç„¶ååœ¨è¿”å›toRawæ–¹æ³•çš„æ—¶å€™ç›´æ¥çœ‹ç¬¬ä¸€å±‚è°ƒç”¨æ ˆobserved&amp;&amp;undefinde||observed,å¾ˆæ˜æ˜¾è¿™æ—¶å€™çš„arrè¿”å›çš„æ˜¯observedï¼Œå› æ­¤æ­¤æ—¶çš„arrå¹¶ä¸æ˜¯åŸå§‹æ•°æ®ï¼Œå½“æ‰§è¡Œåˆ°2å¤„æ—¶ï¼Œåˆä¸€æ¬¡è¿›å…¥getæ–¹# æ³•ï¼Œæ­¤æ—¶çš„keyæ˜¯indexOfï¼Œç„¶åæ­¤æ—¶ä¼šè¿”å› return Reflect.get(arrayInstrumentations, # key, receiver);è€ŒarrayInstrumentations['indexOf']è¿™ä¸ªæ–¹æ³•åˆè¿›å…¥äº†1è¿™ä¸ªè¿‡ç¨‹ï¼Œä»è€Œé€ # æˆè°ƒç”¨æ ˆçˆ†æ ˆçš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">if</span> (key === <span class="string">"__v_isReactive"</span> /* IS_REACTIVE */) &#123;</span><br><span class="line">        <span class="built_in">return</span> !isReadonly;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">"__v_isReadonly"</span> /* IS_READONLY */) &#123;</span><br><span class="line">        <span class="built_in">return</span> isReadonly;</span><br><span class="line">    &#125;</span><br><span class="line">    const targetIsArray = isArray(target);</span><br><span class="line">    <span class="keyword">if</span> (targetIsArray &amp;&amp; hasOwn(arrayInstrumentations, key)) &#123;</span><br><span class="line">        <span class="built_in">return</span> Reflect.get(arrayInstrumentations, key, receiver);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸€ä¸ª Symbol çš„åˆ¤æ–­é€»è¾‘ä¸€ç›´æ²¡æœ‰ç†è§£ï¼Œæˆ‘ TM</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    isSymbol(key)</span><br><span class="line">      ? builtInSymbols.has(key)</span><br><span class="line">      : key === `__proto__` || key === `__v_isRef`</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘åœ¨å•æµ‹é‡Œé¢æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„è‡ªå®šä¹‰ Symbol è®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const customSymbol = Symbol()</span><br><span class="line">const obj = &#123;</span><br><span class="line">  [Symbol.asyncIterator]: &#123; a: 1 &#125;,</span><br><span class="line">  [Symbol.unscopables]: &#123; b: <span class="string">'1'</span> &#125;,</span><br><span class="line">  [customSymbol]: &#123; c: [1, 2, 3] &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const objRef = ref(obj)</span><br><span class="line">expect(objRef.value[Symbol.asyncIterator]).toBe(obj[Symbol.asyncIterator])</span><br><span class="line">expect(objRef.value[Symbol.unscopables]).toBe(obj[Symbol.unscopables])</span><br><span class="line"><span class="comment"># è¿™ä¸¤å¥logè¯­å¥éƒ½æ˜¯è¾“å‡º &#123; c: [ 1, 2, 3 ] &#125;åŸå§‹æ•°æ®</span></span><br><span class="line">console.log(objRef.value[customSymbol])</span><br><span class="line">console.log(obj[customSymbol])</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘åœ¨ demo é‡Œé¢ä¹Ÿå¤åˆ¶äº†è¿™æ®µä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const customSymbol = Symbol()</span><br><span class="line">const obj = &#123;</span><br><span class="line">  [Symbol.asyncIterator]: &#123; a: 1 &#125;,</span><br><span class="line">  [Symbol.unscopables]: &#123; b: <span class="string">'1'</span> &#125;,</span><br><span class="line">  [customSymbol]: &#123; c: [1, 2, 3] &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">debugger</span><br><span class="line">const objRef = ref(obj)</span><br><span class="line"><span class="comment"># ç»“æœä¸‹é¢ä¸¤ä¸ªlog ä¸€ä¸ªè¾“å‡º ä»£ç†è¿‡çš„Objectï¼Œä¸€ä¸ªè¾“å‡ºObjecttåŸå§‹æ•°æ®</span></span><br><span class="line">console.log(objRef.value[customSymbol])</span><br><span class="line">console.log(obj[customSymbol])</span><br></pre></td></tr></table></figure>

<p>æˆ‘å°±å…ˆä¸ç®¡å®ƒäº†ã€‚</p>
<p>ç„¶åæ˜¯<code>createSetter</code>,æ˜¯ set æ–¹æ³•çš„æ’æ¡©</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> createSetter(shallow = <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="keyword">function</span> <span class="built_in">set</span>(</span><br><span class="line">    target: object,</span><br><span class="line">    key: string | symbol,</span><br><span class="line">    value: unknown,</span><br><span class="line">    receiver: object</span><br><span class="line">  ): boolean &#123;</span><br><span class="line">    const oldValue = (target as any)[key]</span><br><span class="line">    <span class="keyword">if</span> (!shallow) &#123;</span><br><span class="line">      value = toRaw(value)</span><br><span class="line">      <span class="comment"># è¿™é‡Œå°±æ˜¯åˆ¤æ–­èµ‹å€¼çš„æ—¶å€™æ–°å€¼å¦‚æœä¸æ˜¯refï¼Œå¹¶ä¸”æ—§å€¼æ˜¯refçš„æƒ…å†µä¸‹çš„èµ‹å€¼</span></span><br><span class="line">      <span class="comment"># è¿™é‡Œæœ‰ä¸ªæ¡ä»¶æ˜¯åˆ¤æ–­å½“å‰targetæ˜¯éæ•°ç»„ï¼Œä½†æ˜¯å½“æˆ‘æŠŠè¿™ä¸ªæ¡ä»¶åˆ é™¤çš„æ—¶å€™ï¼Œ210ä¸ªæµ‹è¯•ç”¨ä¾‹ä»ç„¶æµ‹è¯•é€šè¿‡ï¼Œæ‰€ä»¥è¿™ä¸ªæ¡ä»¶ä¸çŸ¥é“æ˜¯å¹²å•¥çš„ã€‚</span></span><br><span class="line">      <span class="keyword">if</span> (!isArray(target) &amp;&amp; isRef(oldValue) &amp;&amp; !isRef(value)) &#123;</span><br><span class="line">        oldValue.value = value</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment"># in shallow mode, objects are set as-is regardless of reactive or not</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const hadKey = hasOwn(target, key)</span><br><span class="line">    const result = Reflect.set(target, key, value, receiver)</span><br><span class="line">    <span class="comment"># don't trigger if target is something up in the prototype chain of original</span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªç­‰äºæ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‘ç”Ÿçš„ï¼ŒæŠŠé‡Œé¢çš„é€»è¾‘æ‹¿å‡ºæ¥ï¼Œæ‰¾åˆ°æ²¡æœ‰é€šè¿‡çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå‘ç°å°±ä¸€ä¸ªï¼Œæ˜¯åœ¨effectæ¨¡å—ï¼Œemmå…ˆè®°å½•ï¼Œç­‰è¯»åˆ°çš„æ—¶å€™å†çœ‹---effect-settter</span></span><br><span class="line">    <span class="keyword">if</span> (target === toRaw(receiver)) &#123;</span><br><span class="line">      <span class="comment"># è¿™é‡Œå°±æ˜¯åˆ¤æ–­è¦setçš„keyæ˜¯å¦å­˜åœ¨targetä¸Šï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è§¦å‘æ·»åŠ æ•°æ®çš„ä¾èµ–ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±è§¦å‘æ›´æ–°æ•°æ®çš„ä¾èµ–</span></span><br><span class="line">      <span class="keyword">if</span> (!hadKey) &#123;</span><br><span class="line">        trigger(target, TriggerOpTypes.ADD, key, value)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hasChanged(value, oldValue)) &#123;</span><br><span class="line">        trigger(target, TriggerOpTypes.SET, key, value, oldValue)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># Reflectè¦è¿”å›booleanæ¥åˆ¤æ–­æ˜¯å¦è®¾ç½®æˆåŠŸ</span></span><br><span class="line">    <span class="built_in">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># hasChangeæ–¹æ³•ç”¨æ¥åˆ¤æ–­å€¼æ˜¯å¦æœ‰æ‰€æ”¹å˜ï¼Œ&amp;&amp;åé¢çš„åˆ¤æ–­è¯­å¥æ˜¯ç”¨æ¥è¿‡æ»¤NaNçš„ï¼Œå› ä¸ºNaNæ˜¯å”¯ä¸€ä¸€ä¸ªè‡ªèº«ä¸ç›¸ç­‰çš„æ•°</span></span><br><span class="line"><span class="built_in">export</span> const hasChanged = (value: any, oldValue: any): boolean =&gt;</span><br><span class="line">  value !== oldValue &amp;&amp; (value === value || oldValue === oldValue)</span><br></pre></td></tr></table></figure>

<p>é™„ä¸€å¼ ç–‘é—®å›¾<br><img src="/images/reactive/code5.png" alt="confused"><br><img src="/images/reactive/code6.png" alt="confused"><br>å‰©ä¸‹å‡ ä¸ªçš„é€»è¾‘å°±å¾ˆå•ä¸€äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤é€»è¾‘ åˆ é™¤æˆåŠŸå¹¶ä¸”åœ¨targetæœ‰è¿™ä¸ªkeyå­˜åœ¨ç„¶åè§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">function</span> deleteProperty(target: object, key: string | symbol): boolean &#123;</span><br><span class="line">  const hadKey = hasOwn(target, key)</span><br><span class="line">  const oldValue = (target as any)[key]</span><br><span class="line">  const result = Reflect.deleteProperty(target, key)</span><br><span class="line">  <span class="keyword">if</span> (result &amp;&amp; hadKey) &#123;</span><br><span class="line">    trigger(target, TriggerOpTypes.DELETE, key, undefined, oldValue)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># é™æ€æ–¹æ³• Reflect.has() ä½œç”¨ä¸ in æ“ä½œç¬¦ ç›¸åŒã€‚</span></span><br><span class="line"><span class="keyword">function</span> has(target: object, key: string | symbol): boolean &#123;</span><br><span class="line">  const result = Reflect.has(target, key)</span><br><span class="line">  track(target, TrackOpTypes.HAS, key)</span><br><span class="line">  <span class="built_in">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Reflect.ownKeys() è¿”å›ä¸€ä¸ªç”±ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å±æ€§é”®ç»„æˆçš„æ•°ç»„ã€‚ä¸åŒ…æ‹¬åŸå‹é“¾å–”</span></span><br><span class="line"><span class="keyword">function</span> ownKeys(target: object): (string | number | symbol)[] &#123;</span><br><span class="line">  track(target, TrackOpTypes.ITERATE, ITERATE_KEY)</span><br><span class="line">  <span class="built_in">return</span> Reflect.ownKeys(target)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ baseHandlers å‰©ä¸‹çš„ä»£ç å°±æ˜¯ä¸€äº› handler äº†ï¼Œæ²¡æœ‰é€»è¾‘</p>
<h4 id="collectionHandler"><a href="#collectionHandler" class="headerlink" title="collectionHandler"></a>collectionHandler</h4><p>å¯¼å…¥æ–‡ä»¶ï¼Œç±»å‹å£°æ˜ï¼Œä»¥åŠä¸€äº›æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import &#123; toRaw, reactive, <span class="built_in">readonly</span>, ReactiveFlags &#125; from <span class="string">'./reactive'</span></span><br><span class="line">import &#123; track, trigger, ITERATE_KEY, MAP_KEY_ITERATE_KEY &#125; from <span class="string">'./effect'</span></span><br><span class="line">import &#123; TrackOpTypes, TriggerOpTypes &#125; from <span class="string">'./operations'</span></span><br><span class="line">import &#123;</span><br><span class="line">  isObject,</span><br><span class="line">  capitalize,</span><br><span class="line">  hasOwn,</span><br><span class="line">  hasChanged,</span><br><span class="line">  toRawType</span><br><span class="line">&#125; from <span class="string">'@vue/shared'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="built_in">type</span> CollectionTypes = IterableCollections | WeakCollections</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> IterableCollections = Map&lt;any, any&gt; | Set&lt;any&gt;</span><br><span class="line"><span class="built_in">type</span> WeakCollections = WeakMap&lt;any, any&gt; | WeakSet&lt;any&gt;</span><br><span class="line"><span class="built_in">type</span> MapTypes = Map&lt;any, any&gt; | WeakMap&lt;any, any&gt;</span><br><span class="line"><span class="built_in">type</span> SetTypes = Set&lt;any&gt; | WeakSet&lt;any&gt;</span><br><span class="line"></span><br><span class="line">const toReactive = &lt;T extends unknown&gt;(value: T): T =&gt;</span><br><span class="line">  isObject(value) ? reactive(value) : value</span><br><span class="line"></span><br><span class="line">const toReadonly = &lt;T extends unknown&gt;(value: T): T =&gt;</span><br><span class="line">  isObject(value) ? <span class="built_in">readonly</span>(value) : value</span><br><span class="line"></span><br><span class="line">const toShallow = &lt;T extends unknown&gt;(value: T): T =&gt; value</span><br><span class="line"></span><br><span class="line">const getProto = &lt;T extends CollectionTypes&gt;(v: T): any =&gt;</span><br><span class="line">  Reflect.getPrototypeOf(v)</span><br></pre></td></tr></table></figure>

<p>çœ‹ get æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> get(</span><br><span class="line">  target: MapTypes,</span><br><span class="line">  key: unknown,</span><br><span class="line">  wrap: typeof toReactive | typeof toReadonly | typeof toShallow</span><br><span class="line">) &#123;</span><br><span class="line">  target = toRaw(target)</span><br><span class="line">  const rawKey = toRaw(key)</span><br><span class="line">  <span class="comment"># è¿™é‡Œçš„keyä¸ç­‰äºrawKeyçš„è¯é‚£ä¹ˆå¿…ç„¶æ˜¯è¿™ä¸ªkeyæ˜¯å“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="comment"># ç„¶åè¿™é‡Œtrackåº”è¯¥æ˜¯æ”¶é›†ä¾èµ–ï¼Œå…·ä½“é€»è¾‘ä¸çŸ¥é“ï¼Œå…ˆè¿™æ ·çœ‹</span></span><br><span class="line">  <span class="keyword">if</span> (key !== rawKey) &#123;</span><br><span class="line">    track(target, TrackOpTypes.GET, key)</span><br><span class="line">  &#125;</span><br><span class="line">  track(target, TrackOpTypes.GET, rawKey)</span><br><span class="line">  const &#123; has, get &#125; = getProto(target)</span><br><span class="line">  <span class="comment"># åˆ¤æ–­æ˜¯keyåœ¨targetä¸Šè¿˜æ˜¯rawKeyåœ¨targetä¸Šï¼Œwrapæ˜¯å±äºtoReactive|toReadonly|toShallowä¸‰ä¸ªå‡½æ•°ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œifé‡Œé¢æ˜¯åœ¨ç»„åˆè°ƒç”¨å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (has.call(target, key)) &#123;</span><br><span class="line">    <span class="built_in">return</span> wrap(get.call(target, key))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (has.call(target, rawKey)) &#123;</span><br><span class="line">    <span class="built_in">return</span> wrap(get.call(target, rawKey))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>å•Šï¼Œç„¶åçœ‹ set æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="built_in">set</span>(this: MapTypes, key: unknown, value: unknown) &#123;</span><br><span class="line">  value = toRaw(value)</span><br><span class="line">  <span class="comment"># è¿™é‡Œè‚¯å®šè¦æŠŠthisè½¬æˆåŸç”Ÿæ•°æ®ç±»å‹ï¼Œè€Œä¸èƒ½ç”¨Proxyï¼ŒåŸå› ä¹‹å‰æœ‰è®²äº†ï¼Œè¿™é‡Œçš„hasè°ƒç”¨ç»‘å®šåˆ°äº†ä»£ç†ä¹‹å‰çš„æ•°æ®å®ä¾‹</span></span><br><span class="line">  const target = toRaw(this)</span><br><span class="line">  const &#123; has, get, <span class="built_in">set</span> &#125; = getProto(target)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">let</span> hadKey = has.call(target, key)</span><br><span class="line">  <span class="comment">## è¿™ä¸ªæ˜¯æˆ‘è‡ªå·±æ”¹çš„ï¼Œæœç„¶ ï¼Œæµ‹è¯•ç”¨ä¾‹æ²¡é€šè¿‡ï¼Œè°ƒäº†ä¸‹ï¼Œæœç„¶è¿˜æ˜¯å¾—ç”¨å®ä¾‹è‡ªå¸¦çš„æ–¹æ³•æ¥åˆ¤æ–­ï¼Œç”¨Object.prototype.hasOwnPropertyè¿˜æ˜¯ä¸èƒ½ç”¨æ¥å¯¹Mapè¿™ç±»ç»“æ„è¿›è¡Œåˆ¤æ–­çš„</span></span><br><span class="line">  <span class="comment">## let hadKey = hasOwn(target,key as any)</span></span><br><span class="line">  <span class="keyword">if</span> (!hadKey) &#123;</span><br><span class="line">    <span class="comment"># è¿™ä¸ªé€»è¾‘è·Ÿä¹‹å‰çš„å¯¹æ•°ç»„çš„indexOfæ’æ¡©çš„æ–¹æ³•ä¸€ä¸ªé“ç†ï¼Œéƒ½æ˜¯è€ƒè™‘äº†keyå€¼ä¸ºå“åº”å¼å¯¹è±¡çš„æƒ…å†µ</span></span><br><span class="line">    key = toRaw(key)</span><br><span class="line">    hadKey = has.call(target, key)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    checkIdentityKeys(target, has, key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const oldValue = get.call(target, key)</span><br><span class="line">  const result = set.call(target, key, value)</span><br><span class="line">  <span class="comment"># æ›´æ–°ä¾èµ–----&gt;è¦ä¹ˆaddè¦ä¹ˆset</span></span><br><span class="line">  <span class="keyword">if</span> (!hadKey) &#123;</span><br><span class="line">    trigger(target, TriggerOpTypes.ADD, key, value)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hasChanged(value, oldValue)) &#123;</span><br><span class="line">    trigger(target, TriggerOpTypes.SET, key, value, oldValue)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>has å’Œ add æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> has(this: CollectionTypes, key: unknown): boolean &#123;</span><br><span class="line">  const target = toRaw(this)</span><br><span class="line">  const rawKey = toRaw(key)</span><br><span class="line">  <span class="comment"># å“åº”å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (key !== rawKey) &#123;</span><br><span class="line">    track(target, TrackOpTypes.HAS, key)</span><br><span class="line">  &#125;</span><br><span class="line">  track(target, TrackOpTypes.HAS, rawKey)</span><br><span class="line">  const has = getProto(target).has</span><br><span class="line">  <span class="comment"># è¿™é‡Œç”¨åˆ°äº†æˆ–è¿ç®—ç¬¦è€ƒè™‘åˆ°äº†Seté‡Œé¢æ”¾ç½®äº†å“åº”å¼å¯¹è±¡çš„æƒ…å†µ</span></span><br><span class="line">  <span class="comment"># æ‰€ä»¥å•ç‹¬åªä½¿ç”¨ä¸€ä¸ªåˆ¤æ–­çš„è¯æµ‹è¯•ç”¨ä¾‹æ˜¯ä¸èƒ½å…¨éƒ¨é€šè¿‡çš„</span></span><br><span class="line">  <span class="built_in">return</span> has.call(target, key) || has.call(target, rawKey)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªæ–¹æ³• å°± å—¯  ä¸€ç›®äº†ç„¶</span></span><br><span class="line"><span class="keyword">function</span> add(this: SetTypes, value: unknown) &#123;</span><br><span class="line">  <span class="comment"># å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œè¿™é‡Œçš„æ·»åŠ ä¸æ˜¯æŠŠvalueéƒ½åšäº†ä¸€ä¸ªè½¬æ¢å—ï¼Ÿä¸ºä»€ä¹ˆSeté‡Œé¢ä¼šæœ‰å“åº”å¼å¯¹è±¡ï¼Ÿ</span></span><br><span class="line">  <span class="comment"># è¿™ä¸ªæ–¹æ³•åªæ˜¯åŠ«æŒäº†Setæ–¹æ³•çš„addï¼Œæ‰€ä»¥åªæœ‰Setè½¬å˜æˆå“åº”å¼å¯¹è±¡åè°ƒç”¨äº†addæ–¹æ³•ï¼ŒåŠ å…¥è¿›å»çš„valueæ‰åªæ˜¯æ™®é€šçš„valueå€¼</span></span><br><span class="line">  value = toRaw(value)</span><br><span class="line">  const target = toRaw(this)</span><br><span class="line">  const proto = getProto(target)</span><br><span class="line">  const hadKey = proto.has.call(target, value)</span><br><span class="line">  const result = proto.add.call(target, value)</span><br><span class="line">  <span class="keyword">if</span> (!hadKey) &#123;</span><br><span class="line">    trigger(target, TriggerOpTypes.ADD, value, value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¿™æ®µä»£ç ï¼Œåœ¨ set è½¬ä¸ºå“åº”å¼å¯¹è±¡å‰ååˆ†åˆ«æŠŠå“åº”å¼å¯¹è±¡ entry åŠ å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const raw = new Set();</span><br><span class="line">const entry = reactive(&#123;&#125;);</span><br><span class="line">raw.add(entry);</span><br><span class="line">const <span class="built_in">set</span> = reactive(raw);</span><br><span class="line">// console.log(set.has(entry));</span><br><span class="line">set.add(entry)</span><br></pre></td></tr></table></figure>

<p>çœ‹ log ç»“æœ<br><img src="/images/reactive/code7.png" alt="code7"></p>
<p>ä»å›¾é‡Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡º æ·»åŠ äº†ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯åŸå§‹å€¼ï¼Œä¸€ä¸ªæ˜¯ä»£ç†å¯¹è±¡ï¼Œè¯´æ˜ä¹‹å‰é‚£ä¸ªé—®é¢˜ï¼ŒSet ç»“æ„é‡Œé¢æ˜¯å¯ä»¥æœ‰ä»£ç†å¯¹è±¡çš„ï¼Œåªè¦åœ¨ Set è¢« reactive ä¹‹å‰åŠ å…¥å°±è¡Œï¼Œåœ¨è¢« reactive ä¹‹åæ·»åŠ çš„æ•°æ®å°±åªæ˜¯åŸå§‹æ•°æ®ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡äº†ï¼Œè¿™é‡Œçš„åŸå§‹æ•°æ®æŒ‡çš„æ˜¯æ²¡æœ‰è¢« Proxy</p>
<p>deleteEntry è·Ÿ set é€»è¾‘æœ‰ç‚¹ç›¸ä¼¼,åŒºåˆ«å°±åœ¨äºè°ƒç”¨çš„æ–¹æ³•ä¸ä¸€æ ·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> deleteEntry(this: CollectionTypes, key: unknown) &#123;</span><br><span class="line">  const target = toRaw(this)</span><br><span class="line">  const &#123; has, get, delete: del &#125; = getProto(target)</span><br><span class="line">  <span class="built_in">let</span> hadKey = has.call(target, key)</span><br><span class="line">  <span class="keyword">if</span> (!hadKey) &#123;</span><br><span class="line">    key = toRaw(key)</span><br><span class="line">    hadKey = has.call(target, key)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    checkIdentityKeys(target, has, key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const oldValue = get ? get.call(target, key) : undefined</span><br><span class="line">  <span class="comment"># forward the operation before queueing reactions</span></span><br><span class="line">  const result = del.call(target, key)</span><br><span class="line">  <span class="keyword">if</span> (hadKey) &#123;</span><br><span class="line">    trigger(target, TriggerOpTypes.DELETE, key, undefined, oldValue)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>clear æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> clear(this: IterableCollections) &#123;</span><br><span class="line">  const target = toRaw(this)</span><br><span class="line">  const hadItems = target.size !== 0</span><br><span class="line">  const oldTarget = __DEV__</span><br><span class="line">    ? target instanceof Map</span><br><span class="line">      ? new Map(target)</span><br><span class="line">      : new Set(target)</span><br><span class="line">    : undefined</span><br><span class="line">  <span class="comment"># forward the operation before queueing reactions</span></span><br><span class="line">  const result = getProto(target).clear.call(target)</span><br><span class="line">  <span class="comment"># å‘Šè¯‰æœ‰æ”¶é›†è¿™ä¸ªtargetçš„å¯¹è±¡ä»¬å¯ä»¥æŠŠå®ƒçš„å€¼ç½®ç©ºäº†</span></span><br><span class="line">  <span class="keyword">if</span> (hadItems) &#123;</span><br><span class="line">    trigger(target, TriggerOpTypes.CLEAR, undefined, undefined, oldTarget)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forEach</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unction createForEach(isReadonly: boolean, shallow: boolean) &#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="keyword">function</span> forEach(</span><br><span class="line">    this: IterableCollections,</span><br><span class="line">    callback: Function,</span><br><span class="line">    <span class="comment"># ä»¥ä¸ºè¿™ä¸ªå‚æ•°æ²¡æœ‰ç”¨ï¼Œæ³¨é‡Šæ‰è·‘äº†ä¸‹æµ‹è¯•ï¼Œåªæœ‰ä¸€ä¸ªç”¨ä¾‹æŠ¥é”™ï¼Œæ–­è¨€å†™çš„æ˜¯callbackå†…éƒ¨çš„thisç­‰äºthisArg</span></span><br><span class="line">    thisArg?: unknown</span><br><span class="line">  ) &#123;</span><br><span class="line">    const observed = this</span><br><span class="line">    <span class="comment"># æœ¬æ¥ä»¥ä¸ºè¿™é‡Œçš„observedç®—æ˜¯é‡å¤å˜é‡ï¼Œ</span></span><br><span class="line">    <span class="comment"># æ‰€ä»¥ä¸‹ä¸€è¡Œå¯ä»¥æ”¹æˆ</span></span><br><span class="line">    <span class="comment"># const target = toRaw(this)</span></span><br><span class="line">    <span class="comment"># ä½†æ˜¯æ³¨æ„åˆ°wrappedCallbackè¿™ä¸ªå‡½æ•°ä¹Ÿç”¨åˆ°äº†ï¼Œå–å¾—æ˜¯å¤–å±‚ä½œç”¨åŸŸçš„thisï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªå‚¨å­˜thisçš„ä¸´æ—¶å˜é‡</span></span><br><span class="line">    const target = toRaw(observed)</span><br><span class="line">    const wrap = isReadonly ? toReadonly : shallow ? toShallow : toReactive</span><br><span class="line">    !isReadonly &amp;&amp; track(target, TrackOpTypes.ITERATE, ITERATE_KEY)</span><br><span class="line">    <span class="comment"># important: create sure the callback is</span></span><br><span class="line">    <span class="comment"># 1. invoked with the reactive map as `this` and 3rd arg</span></span><br><span class="line">    <span class="comment"># 2. the value received should be a corresponding reactive/readonly.</span></span><br><span class="line">    <span class="keyword">function</span> wrappedCallback(value: unknown, key: unknown) &#123;</span><br><span class="line">      <span class="built_in">return</span> callback.call(thisArg, wrap(value), wrap(key), observed)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># è¿™å¥æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯éå†åŸå‹é“¾ä¸Šæ‰€æœ‰çš„å±æ€§ä»¥åŠæ–¹æ³•å¹¶ä¸”è¿›è¡Œthisé‡å®šå‘ï¼Œåæ¥æˆ‘å¯¹è¿™å¥è¿›è¡Œäº†ä¸€æ¬¡debugï¼Œæˆ‘å‘ç°ä¸‹é¢è¿™å¥åº”è¯¥æ˜¯ç­‰åŒäº</span></span><br><span class="line">    <span class="comment"># return getProto(target)['forEach'].call(target,wrappedCallback)</span></span><br><span class="line">    <span class="comment"># æˆ‘è§‰å¾—è¿™æ ·å†™åº”è¯¥æ›´å®¹æ˜“ç†è§£å§ï½</span></span><br><span class="line">    <span class="built_in">return</span> getProto(target).forEach.call(target, wrappedCallback)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹è¿­ä»£æ–¹æ³•è¿›è¡Œä¸€ä¸ªæ’æ¡©ï¼Œè¿”å›é—­åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> createIterableMethod(</span><br><span class="line">  method: string | symbol,</span><br><span class="line">  isReadonly: boolean,</span><br><span class="line">  shallow: boolean</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="keyword">function</span>(</span><br><span class="line">    this: IterableCollections,</span><br><span class="line">    ...args: unknown[]</span><br><span class="line">  ): Iterable &amp; Iterator &#123;</span><br><span class="line">    const target = toRaw(this)<span class="comment">#è·å–åŸå§‹æ•°æ®</span></span><br><span class="line">    const isMap = target instanceof Map</span><br><span class="line">    const isPair = method === <span class="string">'entries'</span> || (method === Symbol.iterator &amp;&amp; isMap)</span><br><span class="line">    const isKeyOnly = method === <span class="string">'keys'</span> &amp;&amp; isMap</span><br><span class="line">    <span class="comment"># è€ƒè™‘è¿™é‡Œå¯¹applyå¯ä»¥ç”¨callæ¥è°ƒç”¨å—ï¼Ÿ</span></span><br><span class="line">    <span class="comment"># ä½†æ˜¯æ˜¯ä¸è¡Œï¼Œå› ä¸ºè¿™é‡Œçš„argæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œcallçš„å‚æ•°éœ€è¦æ˜¯ä¸€ä¸ªå‚æ•°æˆ–è€…å¤šä¸ªå‚æ•°ï¼Œå°±æ˜¯è¯´callçš„å‚æ•°åªèƒ½æ˜¯ä¸€ä¸ªä¸ªçš„ä¼ ï¼</span></span><br><span class="line">    <span class="comment"># å¹¶ä¸”è¿™é‡Œçš„innerIteratorè¿”å›çš„å¹¶ä¸æ˜¯ä¸€ä¸ªarrayï¼Œè€Œæ˜¯ä¸€ä¸ªiterator</span></span><br><span class="line">    const innerIterator = getProto(target)[method].apply(target, args)</span><br><span class="line">    const wrap = isReadonly ? toReadonly : shallow ? toShallow : toReactive</span><br><span class="line">    !isReadonly &amp;&amp;</span><br><span class="line">      track(</span><br><span class="line">        target,</span><br><span class="line">        TrackOpTypes.ITERATE,</span><br><span class="line">        isKeyOnly ? MAP_KEY_ITERATE_KEY : ITERATE_KEY</span><br><span class="line">      )</span><br><span class="line">    <span class="comment"># return a wrapped iterator which returns observed versions of the</span></span><br><span class="line">    <span class="comment"># values emitted from the real iterator</span></span><br><span class="line">    <span class="built_in">return</span> &#123;</span><br><span class="line">      <span class="comment"># iterator protocol</span></span><br><span class="line">      <span class="function"><span class="title">next</span></span>() &#123;</span><br><span class="line">        const &#123; value, <span class="keyword">done</span> &#125; = innerIterator.next()</span><br><span class="line">        <span class="built_in">return</span> <span class="keyword">done</span></span><br><span class="line">          ? &#123; value, <span class="keyword">done</span> &#125;</span><br><span class="line">          : &#123;</span><br><span class="line">              <span class="comment"># åªæœ‰åœ¨è°ƒç”¨entriesæ–¹æ³•æˆ–è€…æ˜¯Mapç±»å‹å¯¹æ—¶å€™æ‰éœ€è¦è¿”å›ã€keyï¼Œvalueã€‘ï¼Œå¹¶ä¸”è®©è¿”å›å¯¹æ•°æ®ä¿æŒå“åº”å¼ç»“æ„</span></span><br><span class="line">              value: isPair ? [wrap(value[0]), wrap(value[1])] : wrap(value),</span><br><span class="line">              <span class="keyword">done</span></span><br><span class="line">            &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment"># iterable protocol</span></span><br><span class="line">      <span class="comment"># mdnå¯¹äºé‡å†™è¿­ä»£å™¨æœ‰æåˆ°éœ€è¦è¿”å›è‡ªèº«ï¼Œå¦åˆ™ä¼šå‘ç”Ÿæ„æ–™ä¹‹å¤–å¯¹é”™è¯¯</span></span><br><span class="line">      [Symbol.iterator]() &#123;</span><br><span class="line">        <span class="built_in">return</span> this</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ä¹‹åçš„å‡½æ•°éƒ½æ˜¯é€šè¿‡æ¡ä»¶æ¥è°ƒç”¨ä¹‹å‰çš„å‡½æ•°ï¼Œå°±è·³å“Ÿæ‹‰ï½</span><br><span class="line"></span><br><span class="line">å¾…ç»­...(reactiveè¿˜æ²¡çœ‹å®Œ)</span><br></pre></td></tr></table></figure>

<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>è·Ÿ reactive ç±»ä¼¼ï¼ŒåŒæ ·ä¹Ÿæ˜¯è®©ä¸€ä¸ª value å€¼å˜æˆä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ reactive åªèƒ½è®© object å˜æˆå“åº”å¼å¯¹è±¡ï¼Œå´ä¸åŒ…æ‹¬ primitive å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ”¶é›† è§¦å‘ä¾èµ–</span></span><br><span class="line">import &#123; track, trigger &#125; from <span class="string">'./effect'</span></span><br><span class="line"><span class="comment"># æšä¸¾ç±»å‹</span></span><br><span class="line">import &#123; TrackOpTypes, TriggerOpTypes &#125; from <span class="string">'./operations'</span></span><br><span class="line"><span class="comment"># é€šç”¨æ–¹æ³•</span></span><br><span class="line">import &#123; isObject, hasChanged &#125; from <span class="string">'@vue/shared'</span></span><br><span class="line">import &#123; reactive, isProxy, toRaw &#125; from <span class="string">'./reactive'</span></span><br><span class="line">import &#123; CollectionTypes &#125; from <span class="string">'./collectionHandlers'</span></span><br></pre></td></tr></table></figure>

<p>è¦å®šä¹‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å­—æ®µ Symbol ç±»å‹ï¼Œå¹¶ä¸”ä¸æƒ³è®© ide è¯†åˆ«å‡ºæ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">declare</span> const RefSymbol: unique symbol</span><br><span class="line"><span class="built_in">export</span> interface Ref&lt;T = any&gt; &#123;</span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">   <span class="comment">#Type differentiator only.</span></span><br><span class="line">   <span class="comment">#We need this to be in public d.ts but don't want it to show up in IDE</span></span><br><span class="line">   <span class="comment">#autocomplete, so we use a private Symbol instead.</span></span><br><span class="line">   <span class="comment">#</span></span><br><span class="line">  [RefSymbol]: <span class="literal">true</span></span><br><span class="line">  value: T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>toRefs çš„ç±»å‹å£°æ˜ï¼Œæ¯ä¸ªåœ¨ T é‡Œé¢çš„å€¼éƒ½æ˜¯ ref ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="built_in">type</span> ToRefs&lt;T = any&gt; = &#123; [K <span class="keyword">in</span> keyof T]: Ref&lt;T[K]&gt; &#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº reactive ä»…æ¥å— object ä½œä¸ºå…¥å‚ï¼Œæ‰€ä»¥å¯¹äº primitive çš„å€¼å°±è¿”å›å®ƒçš„å€¼è€Œä¸æ˜¯è°ƒç”¨ reactive</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const convert = &lt;T extends unknown&gt;(val: T): T =&gt;</span><br><span class="line">  isObject(val) ? reactive(val) : val</span><br></pre></td></tr></table></figure>

<p>ref ç›´æ¥è°ƒç”¨äº†<code>createRef</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> ref(value?: unknown) &#123;</span><br><span class="line">  <span class="built_in">return</span> createRef(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># createRefç›´æ¥è¿”å›ä¸€ä¸ªobjectï¼Œ</span></span><br><span class="line"><span class="comment"># const count = ref(1)</span></span><br><span class="line"><span class="comment"># ==&gt;count = &#123;</span></span><br><span class="line"><span class="comment">#         __v_isRef:true,</span></span><br><span class="line"><span class="comment">#         value:1</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="keyword">function</span> createRef(rawValue: unknown, shallow = <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isRef(rawValue)) &#123;</span><br><span class="line">    <span class="built_in">return</span> rawValue</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">let</span> value = shallow ? rawValue : convert(rawValue)</span><br><span class="line">  const r = &#123;</span><br><span class="line">    __v_isRef: <span class="literal">true</span>,</span><br><span class="line">    get <span class="function"><span class="title">value</span></span>() &#123;</span><br><span class="line">      track(r, TrackOpTypes.GET, <span class="string">'value'</span>)</span><br><span class="line">      <span class="built_in">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">set</span> value(newVal) &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasChanged(toRaw(newVal), rawValue)) &#123;</span><br><span class="line">        rawValue = newVal</span><br><span class="line">        value = shallow ? newVal : convert(newVal)</span><br><span class="line">        trigger(</span><br><span class="line">          r,</span><br><span class="line">          TriggerOpTypes.SET,</span><br><span class="line">          <span class="string">'value'</span>,</span><br><span class="line">          __DEV__ ? &#123; newValue: newVal &#125; : void 0</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº reactive åªæ˜¯é’ˆå¯¹äº object çš„ï¼Œå¯¹äºå†…éƒ¨çš„ prop æ˜¯æ²¡æœ‰åšä»£ç†çš„ï¼Œå› æ­¤ä¸€æ—¦è§£æ„ï¼Œè§£æ„å‡ºæ¥çš„å€¼å°±å·²ç»å¤±å»äº†å“åº”æ€§</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> toRefs&lt;T extends object&gt;(object: T): ToRefs&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; !isProxy(object)) &#123;</span><br><span class="line">    console.warn(`toRefs() expects a reactive object but received a plain one.`)</span><br><span class="line">  &#125;</span><br><span class="line">  const ret: any = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (const key <span class="keyword">in</span> object) &#123;</span><br><span class="line">    ret[key] = toRef(object, key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> toRef&lt;T extends object, K extends keyof T&gt;(</span><br><span class="line">  object: T,</span><br><span class="line">  key: K</span><br><span class="line">): Ref&lt;T[K]&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    __v_isRef: <span class="literal">true</span>,</span><br><span class="line">    get value(): any &#123;</span><br><span class="line">      <span class="built_in">return</span> object[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">set</span> value(newVal) &#123;</span><br><span class="line">      object[key] = newVal</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; as any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LIKE THIS</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">f</span></span>()&#123;</span><br><span class="line">  const obj = reactive(&#123;count:10,age:10]&#125;)</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    ...obj</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const obj = f()</span><br><span class="line"><span class="built_in">let</span> &#123;count,age&#125; = obj</span><br><span class="line">count <span class="comment"># 10</span></span><br><span class="line">count++</span><br><span class="line">count <span class="comment"># 11</span></span><br><span class="line">obj.count <span class="comment">#10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">f</span></span>()&#123;</span><br><span class="line">  const obj = reactive(&#123;count:10,age:10]&#125;)</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    ...toRefs(obj)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const obj = f()</span><br><span class="line">const &#123;count&#125;  = obj <span class="comment"># è¿™æ ·è§£æ„å‡ºæ¥çš„countæ˜¯ä¸€ä¸ªrefç±»å‹ï¼Œå®ƒå…·å¤‡æœ‰å“åº”æ€§</span></span><br><span class="line">count.value <span class="comment"># 10</span></span><br><span class="line">count.value++</span><br><span class="line">count.value <span class="comment">#11</span></span><br><span class="line">obj.count.value <span class="comment"># 11</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹è¿™ä¸ªå¾ˆé•¿å¾ˆé•¿çš„ç±»å‹å£°æ˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> interface RefUnwrapBailTypes &#123;&#125;</span><br><span class="line"><span class="comment"># é¦–å…ˆå¦‚æœTæ˜¯Refç±»å‹çš„ï¼Œé‚£ä¹ˆæŠŠrefç±»å‹é‡Œé¢æ¨æ–­çš„æ•°æ®ç±»å‹ä½œä¸ºç±»å‹ä¼ é€’ç»™UnwrapRefSimple</span></span><br><span class="line"><span class="built_in">export</span> <span class="built_in">type</span> UnwrapRef&lt;T&gt; = T extends Ref&lt;infer V&gt;</span><br><span class="line">  ? UnwrapRefSimple&lt;V&gt;</span><br><span class="line">  : UnwrapRefSimple&lt;T&gt;</span><br><span class="line"><span class="comment"># ç„¶åUnwrapRefSimpleæ ¹æ®ä¼ è¿›æ¥çš„ç±»å‹æ¥å†³å®šè¿”å›ä»€ä¹ˆç±»å‹</span></span><br><span class="line"><span class="built_in">type</span> UnwrapRefSimple&lt;T&gt; = T extends</span><br><span class="line">  | Function</span><br><span class="line">  | CollectionTypes</span><br><span class="line">  | BaseTypes</span><br><span class="line">  | Ref</span><br><span class="line">  | RefUnwrapBailTypes[keyof RefUnwrapBailTypes]</span><br><span class="line">  ? T</span><br><span class="line">  : T extends Array&lt;any&gt;</span><br><span class="line">    ? &#123; [K <span class="keyword">in</span> keyof T]: UnwrapRefSimple&lt;T[K]&gt; &#125;</span><br><span class="line">    : T extends object ? UnwrappedObject&lt;T&gt; : T</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ T[P]è¦ç”¨ UnwrapRef åµŒå¥—åº”è¯¥æ˜¯è¦è€ƒè™‘å¯¹è±¡ä¸­æœ‰ ref çš„æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> UnwrappedObject&lt;T&gt; = &#123; [P <span class="keyword">in</span> keyof T]: UnwrapRef&lt;T[P]&gt; &#125; &amp; SymbolExtract&lt;T&gt;</span><br></pre></td></tr></table></figure>

<h4 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸¤ä¸ªæšä¸¾</span></span><br><span class="line">import &#123; TrackOpTypes, TriggerOpTypes &#125; from <span class="string">'./operations'</span></span><br><span class="line"><span class="comment"># ä¸¤ä¸ªå·¥å…·æ–¹æ³•</span></span><br><span class="line">import &#123; EMPTY_OBJ, isArray &#125; from <span class="string">'@vue/shared'</span></span><br></pre></td></tr></table></figure>

<p>å‚¨å­˜ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The main WeakMap that stores &#123;target -&gt; key -&gt; dep&#125; connections.</span></span><br><span class="line"><span class="comment"># Conceptually, it's easier to think of a dependency as a Dep class</span></span><br><span class="line"><span class="comment"># which maintains a Set of subscribers, but we simply store them as</span></span><br><span class="line"><span class="comment"># raw Sets to reduce memory overhead.</span></span><br><span class="line"><span class="built_in">type</span> Dep = Set&lt;ReactiveEffect&gt;</span><br><span class="line"><span class="built_in">type</span> KeyToDepMap = Map&lt;any, Dep&gt;</span><br><span class="line">const targetMap = new WeakMap&lt;any, KeyToDepMap&gt;()</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> interface ReactiveEffect&lt;T = any&gt; &#123;</span><br><span class="line">  (...args: any[]): T</span><br><span class="line">  _isEffect: <span class="literal">true</span></span><br><span class="line">  id: number</span><br><span class="line">  <span class="comment"># æ˜¯å¦åœæ­¢ç›‘å¬</span></span><br><span class="line">  active: boolean</span><br><span class="line">  <span class="comment"># åŸå§‹å‡½æ•°</span></span><br><span class="line">  raw: () =&gt; T</span><br><span class="line">  <span class="comment"># ä¾èµ–æ•°ç»„</span></span><br><span class="line">  deps: Array&lt;Dep&gt;</span><br><span class="line">  <span class="comment"># é€‰é¡¹</span></span><br><span class="line">  options: ReactiveEffectOptions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> interface ReactiveEffectOptions &#123;</span><br><span class="line">  <span class="comment"># åˆ¤æ–­æ˜¯å¦ç«‹å³æ‰§è¡Œ</span></span><br><span class="line">  lazy?: boolean</span><br><span class="line">  computed?: boolean</span><br><span class="line">  scheduler?: (job: ReactiveEffect) =&gt; void</span><br><span class="line">  onTrack?: (event: DebuggerEvent) =&gt; void</span><br><span class="line">  onTrigger?: (event: DebuggerEvent) =&gt; void</span><br><span class="line">  onStop?: () =&gt; void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="built_in">type</span> DebuggerEvent = &#123;</span><br><span class="line">  effect: ReactiveEffect</span><br><span class="line">  target: object</span><br><span class="line">  <span class="built_in">type</span>: TrackOpTypes | TriggerOpTypes</span><br><span class="line">  key: any</span><br><span class="line">&#125; &amp; DebuggerEventExtraInfo</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> interface DebuggerEventExtraInfo &#123;</span><br><span class="line">  newValue?: any</span><br><span class="line">  oldValue?: any</span><br><span class="line">  oldTarget?: Map&lt;any, any&gt; | Set&lt;any&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å˜é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‚¨å­˜effectçš„æ•°ç»„</span></span><br><span class="line">const effectStack: ReactiveEffect[] = []</span><br><span class="line"><span class="built_in">let</span> activeEffect: ReactiveEffect | undefined</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> const ITERATE_KEY = Symbol(__DEV__ ? <span class="string">'iterate'</span> : <span class="string">''</span>)</span><br><span class="line"><span class="built_in">export</span> const MAP_KEY_ITERATE_KEY = Symbol(__DEV__ ? <span class="string">'Map key iterate'</span> : <span class="string">''</span>)</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­æ˜¯å¦æ˜¯ effect å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isEffect(fn: any): fn is ReactiveEffect &#123;</span><br><span class="line">  <span class="built_in">return</span> fn &amp;&amp; fn._isEffect === <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»º effect å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> effect&lt;T = any&gt;(</span><br><span class="line">  fn: () =&gt; T,</span><br><span class="line">  options: ReactiveEffectOptions = EMPTY_OBJ</span><br><span class="line">): ReactiveEffect&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isEffect(fn)) &#123;</span><br><span class="line">    fn = fn.raw</span><br><span class="line">  &#125;</span><br><span class="line">  const effect = createReactiveEffect(fn, options)</span><br><span class="line">  <span class="comment"># å¦‚æœæ²¡æœ‰lazyå‚æ•°ï¼Œé‚£ä¹ˆeffect å‡½æ•°ç«‹å³æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (!options.lazy) &#123;</span><br><span class="line">    effect()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> effect</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> uid = 0</span><br><span class="line"><span class="comment"># åˆ é™¤effecté‡Œé¢çš„ä¾èµ–çš„ä¾èµ–çš„effectï¼ˆå¾ˆæ‹—å£ï¼‰</span></span><br><span class="line"><span class="keyword">function</span> cleanup(effect: ReactiveEffect) &#123;</span><br><span class="line">  const &#123; deps &#125; = effect</span><br><span class="line">  <span class="keyword">if</span> (deps.length) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; deps.length; i++) &#123;</span><br><span class="line">      deps[i].delete(effect)</span><br><span class="line">    &#125;</span><br><span class="line">    deps.length = 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> createReactiveEffect&lt;T = any&gt;(</span><br><span class="line">  fn: (...args: any[]) =&gt; T,</span><br><span class="line">  options: ReactiveEffectOptions</span><br><span class="line">): ReactiveEffect&lt;T&gt; &#123;</span><br><span class="line">  const effect = <span class="keyword">function</span> reactiveEffect(...args: unknown[]): unknown &#123;</span><br><span class="line">    <span class="comment"># æŠŠè¿™å¥æ³¨é‡Šï¼Œä¸€ä¸ªç”¨ä¾‹æŠ¥é”™ reactivity/effect â€º stop with scheduler</span></span><br><span class="line">    <span class="comment"># æç¤ºæˆ‘ä»¬ åœ¨æŠŠeffectè°ƒç”¨äº†stopä¹‹åï¼Œschedulerä¸åœ¨æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (!effect.active) &#123;</span><br><span class="line">      <span class="built_in">return</span> options.scheduler ? undefined : fn(...args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># é—®ä¸ªé—®é¢˜ï¼Œifä»£ç å—é‡Œé¢çš„è¯­å¥pushäº†ä¸€æ¬¡ï¼Œç„¶åpopäº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜éœ€è¦åˆ¤æ–­effectæ˜¯å¦å­˜åœ¨effectæ ˆä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (!effectStack.includes(effect)) &#123;</span><br><span class="line">      <span class="comment"># è¿™é‡Œè¦åˆ é™¤effectçš„ä¾èµ–é¡¹ï¼Œæ˜¯ä¸ºäº†å¤„ç†effecté‡Œé¢æœ‰æ¡ä»¶è¯­å¥çš„æƒ…å†µï¼Œ</span></span><br><span class="line">      <span class="comment"># åˆ†æ”¯ä¸å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œä¿®æ”¹åˆ†æ”¯ä¸Šçš„å±æ€§ä¸åº”è¯¥æ‰§è¡Œeffect</span></span><br><span class="line">      cleanup(effect)</span><br><span class="line">      try &#123;</span><br><span class="line">        enableTracking()</span><br><span class="line">        effectStack.push(effect)</span><br><span class="line">        activeEffect = effect</span><br><span class="line">        <span class="built_in">return</span> fn(...args)</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        effectStack.pop()</span><br><span class="line">        resetTracking()</span><br><span class="line">        activeEffect = effectStack[effectStack.length - 1]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; as ReactiveEffect</span><br><span class="line">  effect.id = uid++</span><br><span class="line">  effect._isEffect = <span class="literal">true</span></span><br><span class="line">  effect.active = <span class="literal">true</span></span><br><span class="line">  effect.raw = fn</span><br><span class="line">  effect.deps = []</span><br><span class="line">  effect.options = options</span><br><span class="line">  <span class="built_in">return</span> effect</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æä¸ªé—®é¢˜ï¼Œåœ¨ effect å‡½æ•°é‡Œé¢çš„ if è¯­å¥å—é‡Œé¢æ‰§è¡Œäº†ä¸€æ¬¡<code>effectStack.push</code>,ç„¶ååˆæ‰§è¡Œäº†<code>effectStack.pop</code>,ä½†æ˜¯ä¸ºä»€ä¹ˆè¦åœ¨ if è¯­å¥é‡Œé¢åˆ¤æ–­ effect æ˜¯å¦å­˜åœ¨ effectStack ä¸­ï¼Œæ‰€ä»¥æˆ‘æŠŠè¿™ä¸ª if è¯­å¥åˆ é™¤ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å¥—å¨ƒã€‚åœ¨ effect é‡Œé¢è°ƒç”¨ effect æœ¬èº«ï¼Œé¿å…æ— é™é€’å½’ï¼ˆå°å£° bbï¼Œæˆ‘åªçœ‹æ‡‚äº†è¿™å±‚ï¼‰</p>
<p>track å‡½æ•°ï¼Œè¿™æ˜¯ä¸ºäº†æ”¶é›†ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> track(target: object, <span class="built_in">type</span>: TrackOpTypes, key: unknown) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!shouldTrack || activeEffect === undefined) &#123;</span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">let</span> depsMap = targetMap.get(target)</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = new Map()))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">let</span> dep = depsMap.get(key)</span><br><span class="line">  <span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">    depsMap.set(key, (dep = new Set()))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># åœ¨æ”¶é›†ä¾èµ–å‰æ‰§è¡Œäº†cleanupæ–¹æ³•</span></span><br><span class="line">  <span class="keyword">if</span> (!dep.has(activeEffect)) &#123;</span><br><span class="line">    dep.add(activeEffect)</span><br><span class="line">    activeEffect.deps.push(dep)</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; activeEffect.options.onTrack) &#123;</span><br><span class="line">      activeEffect.options.onTrack(&#123;</span><br><span class="line">        effect: activeEffect,</span><br><span class="line">        target,</span><br><span class="line">        <span class="built_in">type</span>,</span><br><span class="line">        key</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> trigger(</span><br><span class="line">  target: object,</span><br><span class="line">  <span class="built_in">type</span>: TriggerOpTypes,</span><br><span class="line">  key?: unknown,</span><br><span class="line">  newValue?: unknown,</span><br><span class="line">  oldValue?: unknown,</span><br><span class="line">  oldTarget?: Map&lt;unknown, unknown&gt; | Set&lt;unknown&gt;</span><br><span class="line">) &#123;</span><br><span class="line">  const depsMap = targetMap.get(target)</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    // never been tracked</span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const effects = new Set&lt;ReactiveEffect&gt;()</span><br><span class="line">  const add = (effectsToAdd: Set&lt;ReactiveEffect&gt; | undefined) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (effectsToAdd) &#123;</span><br><span class="line">      effectsToAdd.forEach(effect =&gt; &#123;</span><br><span class="line">      <span class="comment"># åˆ¤æ–­æ˜¯å¦éœ€è¦æ”¶é›†ä¾èµ–æˆ–è€…effectæ˜¯å¦é‡å¤</span></span><br><span class="line">        <span class="keyword">if</span> (effect !== activeEffect || !shouldTrack) &#123;</span><br><span class="line">          effects.add(effect)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment"># the effect mutated its own dependency during its execution.</span></span><br><span class="line">          <span class="comment"># this can be caused by operations like foo.value++</span></span><br><span class="line">          <span class="comment"># do not trigger or we end in an infinite loop</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">type</span> === TriggerOpTypes.CLEAR) &#123;</span><br><span class="line">    <span class="comment"># collection being cleared</span></span><br><span class="line">    <span class="comment"># trigger all effects for target</span></span><br><span class="line">    depsMap.forEach(add)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">'length'</span> &amp;&amp; isArray(target)) &#123;</span><br><span class="line">    depsMap.forEach((dep, key) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">'length'</span> || key &gt;= (newValue as number)) &#123;</span><br><span class="line">        add(dep)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment"># schedule runs for SET | ADD | DELETE</span></span><br><span class="line">    <span class="keyword">if</span> (key !== void 0) &#123;</span><br><span class="line">      add(depsMap.get(key))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å¢åŠ æˆ–è€…åˆ é™¤æ•°æ®çš„è¡Œä¸ºï¼Œè¿˜è¦å†å¾€ç›¸åº”é˜Ÿåˆ—ä¸­å¢åŠ ç›‘å¬å‡½æ•°</span></span><br><span class="line">    <span class="comment"># also run for iteration key on ADD | DELETE | Map.SET</span></span><br><span class="line">    const isAddOrDelete =</span><br><span class="line">      <span class="built_in">type</span> === TriggerOpTypes.ADD ||</span><br><span class="line">      (<span class="built_in">type</span> === TriggerOpTypes.DELETE &amp;&amp; !isArray(target))</span><br><span class="line">    <span class="comment"># è¿™ä¸ªé€»è¾‘éœ€è¦ä»€ä¹ˆæ—¶å€™èµ°åˆ°ï¼Œæ¯”å¦‚å¯¹æ•°æ®è¿›è¡Œpushæ“ä½œæ—¶ï¼ŒåŠ«æŒçš„keyå…¶å®æ˜¯lengthï¼Œæ­¤æ—¶çš„keyç¡®å®ä¸æ˜¯0ï¼Œä½†æ˜¯depsMap.get(0)å…¶å®æ˜¯ä¸ºç©ºçš„</span></span><br><span class="line">    <span class="comment"># è€ŒdepsMap.get('length')æ‰æ˜¯çœŸçš„æœ‰ç›¸åº”effectï¼Œæ‰€ä»¥éœ€è¦è¡¥å……ç¬¬äºŒä¸ªé€»è¾‘</span></span><br><span class="line">    <span class="comment"># å‡å¦‚ç¬¬ä¸€ä¸ªé€»è¾‘å’Œç¬¬äºŒä¸ªé€»è¾‘éƒ½æ‰§è¡Œäº†ï¼Œé‚£è¿˜æ˜¯åªä¼šæ‰§è¡Œä¸€æ¬¡effectçš„</span></span><br><span class="line">    <span class="comment"># ç†ç”±æ˜¯addä¸­çš„effectsè¿™æ˜¯ä¸€ä¸ªsetç»“æ„ï¼Œè‡ªåŠ¨å»é‡</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      isAddOrDelete ||</span><br><span class="line">      (<span class="built_in">type</span> === TriggerOpTypes.SET &amp;&amp; target instanceof Map)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="comment">#å¦‚æœåŸå§‹æ•°æ®æ˜¯æ•°ç»„ï¼Œåˆ™keyä¸ºlengthï¼Œå¦åˆ™ä¸ºè¿­ä»£è¡Œä¸ºæ ‡è¯†ç¬¦</span></span><br><span class="line">      add(depsMap.get(isArray(target) ? <span class="string">'length'</span> : ITERATE_KEY))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isAddOrDelete &amp;&amp; target instanceof Map) &#123;</span><br><span class="line">      add(depsMap.get(MAP_KEY_ITERATE_KEY))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const run = (effect: ReactiveEffect) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; effect.options.onTrigger) &#123;</span><br><span class="line">      effect.options.onTrigger(&#123;</span><br><span class="line">        effect,</span><br><span class="line">        target,</span><br><span class="line">        key,</span><br><span class="line">        <span class="built_in">type</span>,</span><br><span class="line">        newValue,</span><br><span class="line">        oldValue,</span><br><span class="line">        oldTarget</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># è¿™é‡Œå¯¹computedè¿›è¡ŒåŒºåˆ†ï¼Œå› ä¸ºcomputed å¯¹è±¡ä¸­è‡ªå¸¦schedulerå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (effect.options.scheduler) &#123;</span><br><span class="line">      effect.options.scheduler(effect)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      effect()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment"># è¿è¡Œæ‰€æœ‰è®¡ç®—æ•°æ®çš„ç›‘å¬æ–¹æ³•</span></span><br><span class="line">  effects.forEach(run)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>computed</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> computed&lt;T&gt;(getter: ComputedGetter&lt;T&gt;): ComputedRef&lt;T&gt;</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> computed&lt;T&gt;(</span><br><span class="line">  options: WritableComputedOptions&lt;T&gt;</span><br><span class="line">): WritableComputedRef&lt;T&gt;</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> computed&lt;T&gt;(</span><br><span class="line">  getterOrOptions: ComputedGetter&lt;T&gt; | WritableComputedOptions&lt;T&gt;</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="built_in">let</span> getter: ComputedGetter&lt;T&gt;</span><br><span class="line">  <span class="built_in">let</span> setter: ComputedSetter&lt;T&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isFunction(getterOrOptions)) &#123;</span><br><span class="line">    getter = getterOrOptions</span><br><span class="line">    setter = __DEV__</span><br><span class="line">      ? () =&gt; &#123;</span><br><span class="line">          console.warn(<span class="string">'Write operation failed: computed value is readonly'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      : NOOP</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getter = getterOrOptions.get</span><br><span class="line">    setter = getterOrOptions.set</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">let</span> dirty = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">let</span> value: T</span><br><span class="line">  <span class="built_in">let</span> computed: ComputedRef&lt;T&gt;</span><br><span class="line"></span><br><span class="line">  const runner = effect(getter, &#123;</span><br><span class="line">    lazy: <span class="literal">true</span>,</span><br><span class="line">    scheduler: () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!dirty) &#123;</span><br><span class="line">        dirty = <span class="literal">true</span></span><br><span class="line">        trigger(computed, TriggerOpTypes.SET, <span class="string">'value'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  computed = &#123;</span><br><span class="line">    __v_isRef: <span class="literal">true</span>,</span><br><span class="line">    [ReactiveFlags.IS_READONLY]:</span><br><span class="line">      isFunction(getterOrOptions) || !getterOrOptions.set,</span><br><span class="line"></span><br><span class="line">    // expose effect so computed can be stopped</span><br><span class="line">    effect: runner,</span><br><span class="line">    get <span class="function"><span class="title">value</span></span>() &#123;</span><br><span class="line">       <span class="comment"># è·‘å•æµ‹å¯ä»¥å‘ç°è¿™ä¸ªæ˜¯ä¸ºäº†é˜²æ­¢é‡å¤è®¡ç®—çš„ã€‚</span></span><br><span class="line">      <span class="keyword">if</span> (dirty) &#123;</span><br><span class="line">        value = runner()</span><br><span class="line">        dirty = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment"># æ”¶é›†ä¾èµ–</span></span><br><span class="line">      track(computed, TrackOpTypes.GET, <span class="string">'value'</span>)</span><br><span class="line">      <span class="built_in">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">set</span> value(newValue: T) &#123;</span><br><span class="line">      setter(newValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; as any</span><br><span class="line">  <span class="built_in">return</span> computed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OVER</p>
]]></content>
      <categories>
        <category>TypeScript</category>
        <category>Vue3</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
        <tag>Vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScriptè¯»ä¹¦ç¬”è®°</title>
    <url>/2019/08/05/readingNote-JS/</url>
    <content><![CDATA[<h2 id="newè¿ç®—ç¬¦çš„å®ç°"><a href="#newè¿ç®—ç¬¦çš„å®ç°" class="headerlink" title="newè¿ç®—ç¬¦çš„å®ç°"></a>newè¿ç®—ç¬¦çš„å®ç°</h2><h3 id="å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åŠåŸå‹é“¾çš„æ–¹æ³•"><a href="#å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åŠåŸå‹é“¾çš„æ–¹æ³•" class="headerlink" title="å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åŠåŸå‹é“¾çš„æ–¹æ³•"></a>å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åŠåŸå‹é“¾çš„æ–¹æ³•</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> Testfoo(name) &#123;</span><br><span class="line">    console.log(this[name]) </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Testfoo.prototype.sayHello= <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    console.log(<span class="string">'hello'</span>);</span><br><span class="line">    <span class="built_in">return</span> 1;</span><br><span class="line">&#125;</span><br><span class="line">//ä½¿ç”¨newè¿ç®—ç¬¦</span><br><span class="line"><span class="built_in">let</span> aaa = new Testfoo();</span><br><span class="line">aaa.sayHello();//è¾“å‡ºhello</span><br><span class="line">//ä¸ä½¿ç”¨newè¿ç®—ç¬¦</span><br><span class="line"><span class="built_in">let</span> testObj  = &#123;&#125;;//åˆ›å»ºç©ºå¯¹è±¡</span><br><span class="line">testObj=Object.create(Testfoo.prototype);//åˆ›å»ºä¸€ä¸ªå…·æœ‰Testfooçš„åŸå‹é“¾çš„ç©ºæ–¹æ³•</span><br><span class="line">Testfoo.call(testObj);//æŒ‡å®šthis</span><br><span class="line">console.log(<span class="string">'testObj'</span>,testObj.sayHello());//è¾“å‡ºhello</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h2 id="callå’Œbindå®ç°"><a href="#callå’Œbindå®ç°" class="headerlink" title="callå’Œbindå®ç°"></a>callå’Œbindå®ç°</h2><h3 id="call"><a href="#call" class="headerlink" title="call"></a>call</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Function.prototype.myCall = <span class="keyword">function</span>(ctx, ...argv) &#123;</span><br><span class="line">	ctx = typeof ctx === <span class="string">'object'</span> ? ctx || global : &#123;&#125; // å½“ ctx æ˜¯å¯¹è±¡çš„æ—¶å€™é»˜è®¤è®¾ç½®ä¸º ctxï¼›å¦‚æœä¸º null åˆ™è®¾ç½®ä¸º window å¦åˆ™ä¸ºç©ºå¯¹è±¡</span><br><span class="line">	const fn = Symbol(<span class="string">'fn'</span>)</span><br><span class="line">	ctx[fn] = this</span><br><span class="line">	ctx[fn](...argv)</span><br><span class="line">        delete ctx[fn]</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> objCall = &#123; fn: <span class="string">'functionName'</span>, a: 10 &#125;;</span><br><span class="line">Testfoo.myCall(objCall, <span class="string">'a'</span>);//è¾“å‡º10</span><br></pre></td></tr></table></figure>

<p>ctxä»£è¡¨å½“å‰å¯¹è±¡ï¼ŒthisæŒ‡é’ˆæŒ‡å‘çš„æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å‡½æ•°ï¼Œå°†thisæŒ‡é’ˆæŒ‡å‘çš„æ–¹æ³•çš„å¼•ç”¨åœ°å€èµ‹å€¼ç»™å½“å‰å¯¹è±¡å†…çš„fnå­—æ®µã€‚ç„¶åè°ƒç”¨æ–¹æ³•ï¼Œè¿™æ ·thisæŒ‡é’ˆæŒ‡å‘çš„æ–¹æ³•çš„å†…éƒ¨thisæŒ‡é’ˆçš„æŒ‡å‘å°±æ˜¯å½“å‰å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°äº†thisæŒ‡é’ˆçš„ç»‘å®šï¼Œ</p>
<h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Function.prototype.myBind=<span class="keyword">function</span>(ctx,...arg1)&#123;</span><br><span class="line">    <span class="built_in">return</span> (...arg2)=&gt;&#123;</span><br><span class="line">        <span class="built_in">return</span> this.call(ctx,...arg2,...arg1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj2=&#123;a:1&#125;;</span><br><span class="line"><span class="keyword">function</span> addTwoNum(x,y)&#123;</span><br><span class="line">    console.log(x+y,this.a);</span><br><span class="line">&#125;</span><br><span class="line">addTwoNum.myBind(obj2,2)(2);//4 1;</span><br><span class="line">addTwoNum.myBind(obj2,2,2)();//4 1</span><br><span class="line">addTwoNum.myBind(obj2)(2,2);//4 1</span><br></pre></td></tr></table></figure>

<h2 id="è¿­ä»£å™¨iterator"><a href="#è¿­ä»£å™¨iterator" class="headerlink" title="è¿­ä»£å™¨iterator"></a>è¿­ä»£å™¨iterator</h2><p>iteraotræ¥å£éƒ¨ç½²åœ¨Symbol.iteratorä¸Šï¼Œä¸€äº›å†…ç½®ç±»å‹æ‹¥æœ‰é»˜è®¤çš„è¿­ä»£å™¨è¡Œä¸ºï¼Œå…¶ä»–ç±»å‹ï¼ˆå¦‚ Objectï¼‰åˆ™æ²¡æœ‰ã€‚ä¸‹è¡¨ä¸­çš„å†…ç½®ç±»å‹æ‹¥æœ‰é»˜è®¤çš„@@iteratoræ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Array.prototype[@@iterator]</span><br><span class="line">TypedArray.prototype[@@iterator](</span><br><span class="line">String.prototype[@@iterator]</span><br><span class="line">Map.prototype[@@iterator]</span><br><span class="line">Set.prototype[@@iterator]</span><br></pre></td></tr></table></figure>

<p>éå†æ¥å£å¯ä»¥æ˜¯è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function DiyIterator()&#123;</span><br><span class="line">    var arr=[1,2,3];</span><br><span class="line">    var it=arr[Symbol.iterator]();</span><br><span class="line"></span><br><span class="line">    for(var v,res;(res=it.next())&amp;&amp;!res.done;)&#123;</span><br><span class="line">        v=res.value;</span><br><span class="line">        console.log(v);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function DiyIterator()&#123;</span><br><span class="line">    var arr=[1,2,3];</span><br><span class="line">   for(let item of arr)&#123;</span><br><span class="line">       console.log(item);//1,2,3</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>String, Array, TypedArray, Map and Set æ˜¯æ‰€æœ‰å†…ç½®å¯è¿­ä»£å¯¹è±¡ï¼Œ å› ä¸ºå®ƒä»¬çš„åŸå‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª @@iterator æ–¹æ³•.Objectæ²¡æœ‰éƒ¨ç½²iteratoræ¥å£ï¼Œæ‰€ä»¥å½“æ‰§è¡Œè¿™æ ·çš„è¯­å¥æ—¶ï¼Œå°±ä¼šæŠ¥é”™<br><img src="https://user-gold-cdn.xitu.io/2019/6/27/16b998bea55f3d96?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾ç‰‡"></p>
<p>éå†å¯¹è±¡å¯ä»¥ç”¨for..in..(forâ€¦inè¯­å¥ä»¥ä»»æ„é¡ºåºéå†ä¸€ä¸ªå¯¹è±¡è‡ªæœ‰çš„ã€ç»§æ‰¿çš„ã€å¯æšä¸¾çš„ã€éSymbolçš„å±æ€§ã€‚å¯¹äºæ¯ä¸ªä¸åŒçš„å±æ€§ï¼Œè¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚),æˆ–è€…ç”¨Object.entries(),Object.keys(),Object.values(),æˆ–è€…å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªiteratoræ¥å£ï¼Œç„¶åå°±æˆäº†è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function seriesIterator()&#123;</span><br><span class="line">    let task=&#123;</span><br><span class="line">        [Symbol.iterator]()&#123;</span><br><span class="line">            var steps=this.action.slice();</span><br><span class="line">            return &#123;</span><br><span class="line">                [Symbol.iterator]()&#123;return this&#125;,</span><br><span class="line">                next(...args)&#123;</span><br><span class="line">                    if(steps.length&gt;0)&#123;</span><br><span class="line">                        //ä¸ºå­˜æ”¾functionçš„æ•°ç»„éƒ¨ç½²iteratoræ¥å£</span><br><span class="line">                        let res=steps.shift()(...args);</span><br><span class="line">                        console.log(res);</span><br><span class="line">                        return &#123;</span><br><span class="line">                            value:res,done:false</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        return &#123;done:true&#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                return(v)&#123;</span><br><span class="line">                    steps.length=0;</span><br><span class="line">                    return &#123;value:v,done:true&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        action:[]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    task.action.push(</span><br><span class="line">        function step1(x)&#123;</span><br><span class="line">            console.log(&apos;step 1:&apos;,x);</span><br><span class="line">            return x*2;</span><br><span class="line">        &#125;,</span><br><span class="line">        function step2(x,y)&#123;</span><br><span class="line">            console.log(`step 2 $&#123;x&#125; $&#123;y&#125;`);</span><br><span class="line">            return x+(y*2);</span><br><span class="line">        &#125;,</span><br><span class="line">        function step3(x,y,z)&#123;</span><br><span class="line">            console.log(`step 3 $&#123;x&#125; $&#123;y&#125; $&#123;z&#125;`);</span><br><span class="line">            return (x*y)+z;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    let it=task[Symbol.iterator]();</span><br><span class="line"></span><br><span class="line">    it.next(10);</span><br><span class="line">    it.next(10,10);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://user-gold-cdn.xitu.io/2019/6/27/16b99940ab1c985c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾ç‰‡"></p>
<p>æ ¹æ®MDNæ–‡æ¡£ï¼Œå¦‚æœä¸€ä¸ªè¿­ä»£å™¨ @@iterator æ²¡æœ‰è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªä¸ç¬¦åˆæ ‡å‡†çš„è¿­ä»£å™¨ï¼Œè¿™æ ·çš„è¿­ä»£å™¨å°†ä¼šåœ¨è¿è¡ŒæœŸæŠ›å‡ºå¼‚å¸¸ï¼Œç”šè‡³éå¸¸è¯¡å¼‚çš„ Bugã€‚æ‰€ä»¥ éœ€è¦è¿”å›thisï¼Œnextå°±æ˜¯å…·ä½“çš„é€»è¾‘ï¼Œç§‘ç§‘~</p>
<h2 id="æ‰å¹³åŒ–"><a href="#æ‰å¹³åŒ–" class="headerlink" title="æ‰å¹³åŒ–"></a>æ‰å¹³åŒ–</h2><h3 id="ç¬¬ä¸€ç§å°±æ˜¯å¸¸è§çš„é€’å½’"><a href="#ç¬¬ä¸€ç§å°±æ˜¯å¸¸è§çš„é€’å½’" class="headerlink" title="ç¬¬ä¸€ç§å°±æ˜¯å¸¸è§çš„é€’å½’"></a>ç¬¬ä¸€ç§å°±æ˜¯å¸¸è§çš„é€’å½’</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr=[1,2,3,[3,2,1,[1,2,3]]];</span><br><span class="line">const bianpinghua1= arr =&gt;&#123;</span><br><span class="line">    return arr.reduce((sum,cur)=&gt;&#123;</span><br><span class="line">        return sum.concat(Array.isArray(cur)?bianpinghua1(cur):cur);</span><br><span class="line">    &#125;,[])</span><br><span class="line">&#125;</span><br><span class="line">const testArr = bianpinghua1(arr)//[ 1, 2, 3, 3, 2, 1, 1, 2, 3 ]</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒç§ç”¨es6çš„generator"><a href="#ç¬¬äºŒç§ç”¨es6çš„generator" class="headerlink" title="ç¬¬äºŒç§ç”¨es6çš„generator"></a>ç¬¬äºŒç§ç”¨es6çš„generator</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function*  bianpinghua(arr)&#123; </span><br><span class="line">    if(Array.isArray(arr))&#123;</span><br><span class="line">        for(let i of arr)&#123;</span><br><span class="line">            yield* bianpinghua(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else</span><br><span class="line">        yield arr;</span><br><span class="line">&#125;</span><br><span class="line">for(let i of bianpinghua(arr))&#123;</span><br><span class="line">    console.log(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰ç§ç”¨es6-æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“å“ªä¸ªæ—¶å€™å‡ºçš„api-çš„flat"><a href="#ç¬¬ä¸‰ç§ç”¨es6-æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“å“ªä¸ªæ—¶å€™å‡ºçš„api-çš„flat" class="headerlink" title="ç¬¬ä¸‰ç§ç”¨es6+(æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“å“ªä¸ªæ—¶å€™å‡ºçš„api)çš„flat"></a>ç¬¬ä¸‰ç§ç”¨es6+(æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“å“ªä¸ªæ—¶å€™å‡ºçš„api)çš„flat</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr =[1,2,[3,4]];</span><br><span class="line">let temp =arr.flat(Infinity);</span><br><span class="line">console.lg(temp);//[1,2,3,4]</span><br></pre></td></tr></table></figure>

<h2 id="var-let-const"><a href="#var-let-const" class="headerlink" title="var  let const"></a>var  let const</h2><h3 id="var"><a href="#var" class="headerlink" title="var"></a>var</h3><p>varå£°æ˜çš„å˜é‡æ”¯æŒå˜é‡æå‡ï¼Œæå‡åˆ°å½“å‰ä½œç”¨åŸŸçš„é¡¶å±‚ï¼Œlevelä½äºå‡½æ•°å£°æ˜å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test()&#123;</span><br><span class="line">    console.log(name);</span><br><span class="line">    var name =&apos;Jack&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·è¾“å‡ºçš„nameæ˜¯undefinedï¼Œvar name = â€˜Jackâ€™ åœ¨è§£æå™¨ä¸­åˆ†ä¸ºvar name ; name = â€˜Jackâ€™ ä¸¤æ­¥ï¼Œè€Œvarçš„å˜é‡æå‡äº†var name;æ‰€ä»¥ä¸Šè¿°ä»£ç åœ¨è§£æå™¨ä¸­çš„çœ¼é‡Œæ˜¯è¿™æ ·çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test()&#123;</span><br><span class="line">    var name;</span><br><span class="line">    console.log(name);</span><br><span class="line">    name=&apos;Jack&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="let-const"><a href="#let-const" class="headerlink" title="let const"></a>let const</h3><p>let å’Œ const å£°æ˜çš„å˜é‡ä¸ä¼šåƒvarä¸€æ ·é€ æˆå˜é‡æå‡,let å’Œconst å£°æ˜çš„å˜é‡åªæœ‰åœ¨å£°æ˜ä¹‹åæ‰èƒ½ä½¿ç”¨, letå£°æ˜çš„å˜é‡ä¼šé€ æˆTDZ(æš‚æ—¶æ€§æ­»åŒº)ï¼Œåœ¨å£°æ˜å˜é‡ä¹‹å‰è°ƒç”¨ä¼šæŠ›å‡ºé”™è¯¯ ReferenceError<br>const å£°æ˜çš„å˜é‡ä¸å…è®¸é‡æ–°èµ‹å€¼ï¼Œä½†æ˜¯å…è®¸ä¿®æ”¹å¼•ç”¨åœ°å€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const tempObj =&#123;</span><br><span class="line">    a :1</span><br><span class="line">&#125;</span><br><span class="line">console.log(tempObj);//&#123;a:1&#125;</span><br><span class="line">tempObj.a=2;</span><br><span class="line">console.log(tempObj)//&#123;a:2&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€‰æ‹©ä½¿ç”¨Object.freeze()æ¥å†»ç»“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const tempObj =&#123;</span><br><span class="line">    a :1</span><br><span class="line">&#125;</span><br><span class="line">Object.freeze(tempObj)</span><br><span class="line">console.log(tempObj);//&#123;a:1&#125;</span><br><span class="line">tempObj.a=2;</span><br><span class="line">console.log(tempObj)//&#123;a:1&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h2><h3 id="event-loop"><a href="#event-loop" class="headerlink" title="event loop"></a>event loop</h3><p>   åœ¨JSé‡Œæœ‰ä¸¤ç±»ä»»åŠ¡ï¼Œä¸€ç§æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œä¸€ç§æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œå…¶ä¸­å¼‚æ­¥ä»»åŠ¡åˆå«æœ‰å®ä»»åŠ¡(Macrotasks)å’Œå¾®ä»»åŠ¡(Microtasks )ï¼ŒsetTimeout setInterval setImmediate<br>I/O UIæ¸²æŸ“ å°±æ˜¯å¼‚æ­¥ä»»åŠ¡ä¸­å®ä»»åŠ¡çš„å…¸å‹ä»£è¡¨,è€Œå¾®ä»»åŠ¡ä¸­çš„ä»£è¡¨æ˜¯Pormise,åœ¨JSæ‰§è¡Œé¡ºåºä¸­ï¼Œæœ€å…ˆæ‰§è¡Œçš„æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œæ¥ç€æ˜¯å¼‚æ­¥ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡ï¼Œå†æ¥ç€æ˜¯å®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡çš„æ˜¯æ”¾åœ¨ä¸åŒçš„æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œåªæœ‰å¾®ä»»åŠ¡æ‰§è¡Œå®Œäº†æ‰ä¼šæ‰§è¡Œå¼€å§‹è°ƒç”¨å®ä»»åŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  function test()&#123;</span><br><span class="line">      console.log(2);</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(1);</span><br><span class="line">  test();</span><br><span class="line">  setTimeout(()=&gt;&#123;</span><br><span class="line">      console.log(3);</span><br><span class="line">  &#125;)</span><br><span class="line">  new Promise((resolve,rejected)=&gt;&#123;</span><br><span class="line">      resolve(4);</span><br><span class="line">      console.log(6);</span><br><span class="line">  &#125;).then(res=&gt;&#123;</span><br><span class="line">      console.log(res);</span><br><span class="line">  &#125;)</span><br><span class="line">// 1 2 6 4 3</span><br></pre></td></tr></table></figure>

<p>console.log(1)å’Œtest å‡å±äºåŒæ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥ä»–ä»¬ä¸¤ä¸ªæœ€å…ˆæ‰§è¡Œï¼Œè¾“å‡º1ï¼Œ2 ï¼ŒsetTimeouå’Œpromiseå‡å±äºå¼‚æ­¥ä»»åŠ¡ï¼Œå› æ­¤å®ƒä»¬éƒ½è¢«æ¨åˆ°å…¨å±€APIä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç­‰æ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå°±æ‰§è¡ŒmicroTask queueä¸­çš„å¾®ä»»åŠ¡ï¼Œç­‰å¾®ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶ï¼Œå†å»å¯»æ‰¾macroTask queueä¸­æ˜¯å¦è¿˜æœ‰å¯»æ‰¾æ‰§è¡Œçš„å®ä»»åŠ¡ï¼›å¯¹promiseæ¥è¯´ new Promise()é‡Œé¢çš„ç¨‹åºæ˜¯å±äºåŒæ­¥ä»»åŠ¡çš„,è€Œpormiseçš„thenæ–¹æ³•æ‰æ˜¯å±äºå¼‚æ­¥ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡ã€‚</p>
<h2 id="æ•°ç»„å¸¸è§æ–¹æ³•çš„ä½¿ç”¨"><a href="#æ•°ç»„å¸¸è§æ–¹æ³•çš„ä½¿ç”¨" class="headerlink" title="æ•°ç»„å¸¸è§æ–¹æ³•çš„ä½¿ç”¨"></a>æ•°ç»„å¸¸è§æ–¹æ³•çš„ä½¿ç”¨</h2><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>map() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ç»“æœæ˜¯è¯¥æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ä¸€ä¸ªæä¾›çš„å‡½æ•°åè¿”å›çš„ç»“æœã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function extractId(data)&#123;</span><br><span class="line">    return data.map(item=&gt;item.id);</span><br><span class="line">&#125;</span><br><span class="line">let arr =[</span><br><span class="line">    &#123;</span><br><span class="line">        id:1,</span><br><span class="line">        name:&apos;Tom&apos;,</span><br><span class="line">        age:1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id:2,</span><br><span class="line">        name:&apos;Jack&apos;,</span><br><span class="line">        age:2</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">console.log(extractId(arr));//[1,2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function extractIdAndAge(data)&#123;</span><br><span class="line">    return data.map(item=&gt;[item.id,item.age]);</span><br><span class="line">&#125;</span><br><span class="line">let arr =[</span><br><span class="line">    &#123;</span><br><span class="line">        id:1,</span><br><span class="line">        name:&apos;Tom&apos;,</span><br><span class="line">        age:2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id:2,</span><br><span class="line">        name:&apos;Jack&apos;,</span><br><span class="line">        age:1</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">console.log(extractId(arr));//[ [ 1, 2 ], [ 2, 1 ] ]</span><br></pre></td></tr></table></figure>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>filter() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„, å…¶åŒ…å«é€šè¿‡æ‰€æä¾›å‡½æ•°å®ç°çš„æµ‹è¯•çš„æ‰€æœ‰å…ƒç´ ã€‚filteræ–¹æ³•è¿”å›çš„å…ƒç´ çš„booleanå€¼ä¸ºçœŸ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test(data)&#123;</span><br><span class="line">    return data.filter(item=&gt;item)</span><br><span class="line">&#125;</span><br><span class="line">let arr =[</span><br><span class="line">    undefined,null,NaN,0,false,&apos;&apos;,1</span><br><span class="line">]</span><br><span class="line">console.log(arr)//1</span><br><span class="line">å› ä¸ºundefined,null, NaN , 0 ,false ï¼Œ&apos;&apos;è½¬ä¸ºbooleanå€¼åå‡ä¸ºfalse</span><br></pre></td></tr></table></figure>

<h3 id="every-some"><a href="#every-some" class="headerlink" title="every,some"></a>every,some</h3><p>every() æ–¹æ³•æµ‹è¯•ä¸€ä¸ªæ•°ç»„å†…çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½èƒ½é€šè¿‡æŸä¸ªæŒ‡å®šå‡½æ•°çš„æµ‹è¯•ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚è‹¥æ”¶åˆ°ä¸€ä¸ªç©ºæ•°ç»„ï¼Œæ­¤æ–¹æ³•åœ¨ä¸€åˆ‡æƒ…å†µä¸‹éƒ½ä¼šè¿”å› trueã€‚everyéå†çš„æ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦æ»¡è¶³åˆ¤æ–­æ¡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test(data)&#123;</span><br><span class="line">    return data.every(item=&gt;item&gt;1)</span><br><span class="line">&#125;</span><br><span class="line">let arr =[</span><br><span class="line">    2,3,4,0,0,1,1,null,undefined</span><br><span class="line">]</span><br><span class="line">console.log(test(arr))//falseï¼Œå› ä¸º0&lt;1,null å’Œundefinedä¸æ•°å­—æ¯”è¾ƒæ—¶ä¼šè½¬æˆæ•°å­—0</span><br><span class="line">let arr1= [</span><br><span class="line">    2,3,4,5,6,7,8</span><br><span class="line">]</span><br><span class="line">console.log(test(arr1));//true</span><br></pre></td></tr></table></figure>

<p>some() æ–¹æ³•æµ‹è¯•æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ å¯ä»¥é€šè¿‡è¢«æä¾›çš„å‡½æ•°æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªBooleanç±»å‹çš„å€¼ã€‚åªè¦ä¸€ä¸ªç¬¦åˆæ¡ä»¶ï¼Œå°±è¿”å›true</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test(data)&#123;</span><br><span class="line">    return data.some(item=&gt;item&gt;1)</span><br><span class="line">&#125;</span><br><span class="line">let arr =[</span><br><span class="line">    2,3,4,0,0,1,1,null,undefined</span><br><span class="line">]</span><br><span class="line">console.log(test(arr))//true</span><br></pre></td></tr></table></figure>

<h3 id="spliceã€slice"><a href="#spliceã€slice" class="headerlink" title="spliceã€slice"></a>spliceã€slice</h3><p>splice() æ–¹æ³•é€šè¿‡åˆ é™¤æˆ–æ›¿æ¢ç°æœ‰å…ƒç´ æˆ–è€…åŸåœ°æ·»åŠ æ–°çš„å…ƒç´ æ¥ä¿®æ”¹æ•°ç»„,å¹¶ä»¥æ•°ç»„å½¢å¼è¿”å›è¢«ä¿®æ”¹çš„å†…å®¹ã€‚æ­¤æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ã€‚<br>splice(startNumber,deleteCount,â€¦item)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr=[1,2,3];</span><br><span class="line">arr.splice(0,1);//arr-&gt;[2,3]</span><br><span class="line"></span><br><span class="line">arr.splice(0,0,1);//arr-&gt;[ 1, 2, 3, 4, 5, 6, 7, 8 ]</span><br></pre></td></tr></table></figure>

<p>slice() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡æ˜¯ä¸€ä¸ªç”± begin å’Œ end å†³å®šçš„åŸæ•°ç»„çš„æµ…æ‹·è´ï¼ˆåŒ…æ‹¬ beginï¼Œä¸åŒ…æ‹¬endï¼‰ã€‚åŸå§‹æ•°ç»„ä¸ä¼šè¢«æ”¹å˜ã€‚ä¸ç»™sliceæ·»åŠ å‚æ•°æ—¶é»˜è®¤è¿”å›æ‰€æœ‰å…ƒç´ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr1= [</span><br><span class="line">    2,3,4,5,6,7,8</span><br><span class="line">]</span><br><span class="line">let temp =arr1.slice(0,2)</span><br><span class="line">console.log(temp,arr1);//[ 2, 3 ] [ 2, 3, 4, 5, 6, 7, 8 ]</span><br></pre></td></tr></table></figure>

<h3 id="push-pop-shift-unshift"><a href="#push-pop-shift-unshift" class="headerlink" title="push pop shift unshift"></a>push pop shift unshift</h3><p>pop è¿”å›æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ”¹å˜åŸæ•°ç»„<br>shift è¿”å›æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ”¹å˜åŸæ•°ç»„<br>push  å‘æ•°ç»„çš„æœ«å°¾æ·»åŠ å…ƒç´ <br>unshift å‘æ•°ç»„çš„å¤´éƒ¨æ·»åŠ å…ƒç´ </p>
<h3 id="includes-indexof-lastIndexOf"><a href="#includes-indexof-lastIndexOf" class="headerlink" title="includes indexof lastIndexOf"></a>includes indexof lastIndexOf</h3><p>includes() æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr = [1,2,3];</span><br><span class="line">console.log(arr.includes(1))//true</span><br></pre></td></tr></table></figure>

<p>indexOf()æ–¹æ³•è¿”å›åœ¨æ•°ç»„ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç»™å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1ã€‚<br>lastIndexOfä¸æ­¤ç±»ä¼¼ï¼Œè¿”å›ç»™å®šå…ƒç´ çš„æœ€åä¸€ä¸ªç´¢å¼•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr =[1,2,3,1];</span><br><span class="line">console.log(arr.indexOf(1))//0</span><br><span class="line">console.log(arr.lastIndexOf(2))//3</span><br><span class="line">console.log(arr.indexOf(4))//-1</span><br></pre></td></tr></table></figure>

<h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><p>ç±»å‹è½¬æ¢æœ‰ä¸¤ç§ï¼Œè¦ä¹ˆæ˜¯æ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œè¦ä¹ˆæ˜¯éšå¼ç±»å‹è½¬æ¢</p>
<h3 id="æ˜¾ç¤ºç±»å‹è½¬æ¢è§W3C"><a href="#æ˜¾ç¤ºç±»å‹è½¬æ¢è§W3C" class="headerlink" title="æ˜¾ç¤ºç±»å‹è½¬æ¢è§W3C"></a>æ˜¾ç¤ºç±»å‹è½¬æ¢è§<a href="https://www.w3school.com.cn/js/js_type_conversion.asp" target="_blank" rel="noopener">W3C</a></h3><hr>
<h3 id="éšå¼ç±»å‹è½¬æ¢å¸¸è§äºè¿ç®—ç¬¦æ¯”è¾ƒéšå¼è½¬æ¢ï¼Œå‚è€ƒESè§„èŒƒ11-9-3"><a href="#éšå¼ç±»å‹è½¬æ¢å¸¸è§äºè¿ç®—ç¬¦æ¯”è¾ƒéšå¼è½¬æ¢ï¼Œå‚è€ƒESè§„èŒƒ11-9-3" class="headerlink" title="éšå¼ç±»å‹è½¬æ¢å¸¸è§äºè¿ç®—ç¬¦æ¯”è¾ƒéšå¼è½¬æ¢ï¼Œå‚è€ƒESè§„èŒƒ11.9.3"></a>éšå¼ç±»å‹è½¬æ¢å¸¸è§äºè¿ç®—ç¬¦æ¯”è¾ƒéšå¼è½¬æ¢ï¼Œå‚è€ƒ<a href="http://yanhaijing.com/es5/#199" target="_blank" rel="noopener">ESè§„èŒƒ</a>11.9.3</h3><hr>
<pre><code>è‹¥Type(x)ä¸Type(y)ç›¸åŒï¼Œ åˆ™
è‹¥Type(x)ä¸ºUndefinedï¼Œ è¿”å›trueã€‚
è‹¥Type(x)ä¸ºNullï¼Œ è¿”å›trueã€‚
è‹¥Type(x)ä¸ºNumberï¼Œ åˆ™
è‹¥xä¸ºNaNï¼Œ è¿”å›falseã€‚
è‹¥yä¸ºNaNï¼Œ è¿”å›falseã€‚
è‹¥xä¸yä¸ºç›¸ç­‰æ•°å€¼ï¼Œ è¿”å›trueã€‚
è‹¥x ä¸º +0 ä¸” yä¸ºâˆ’0ï¼Œ è¿”å›trueã€‚
è‹¥x ä¸º âˆ’0 ä¸” yä¸º+0ï¼Œ è¿”å›trueã€‚
è¿”å›falseã€‚
è‹¥Type(x)ä¸ºString, åˆ™å½“xå’Œyä¸ºå®Œå…¨ç›¸åŒçš„å­—ç¬¦åºåˆ—ï¼ˆé•¿åº¦ç›¸ç­‰ä¸”ç›¸åŒå­—ç¬¦åœ¨ç›¸åŒä½ç½®ï¼‰æ—¶è¿”å›trueã€‚ å¦åˆ™ï¼Œ è¿”å›falseã€‚
è‹¥Type(x)ä¸ºBoolean, å½“xå’Œyä¸ºåŒä¸ºtrueæˆ–è€…åŒä¸ºfalseæ—¶è¿”å›trueã€‚ å¦åˆ™ï¼Œ è¿”å›falseã€‚
å½“xå’Œyä¸ºå¼•ç”¨åŒä¸€å¯¹è±¡æ—¶è¿”å›trueã€‚å¦åˆ™ï¼Œè¿”å›falseã€‚
è‹¥xä¸ºnullä¸”yä¸ºundefinedï¼Œ è¿”å›trueã€‚
è‹¥xä¸ºundefinedä¸”yä¸ºnullï¼Œ è¿”å›trueã€‚
è‹¥Type(x) ä¸º Number ä¸” Type(y)ä¸ºStringï¼Œ è¿”å›comparison x == ToNumber(y)çš„ç»“æœã€‚
è‹¥Type(x) ä¸º String ä¸” Type(y)ä¸ºNumberï¼Œ
è¿”å›æ¯”è¾ƒToNumber(x) == yçš„ç»“æœã€‚
è‹¥Type(x)ä¸ºBooleanï¼Œ è¿”å›æ¯”è¾ƒToNumber(x) == yçš„ç»“æœã€‚
è‹¥Type(y)ä¸ºBooleanï¼Œ è¿”å›æ¯”è¾ƒx == ToNumber(y)çš„ç»“æœã€‚
è‹¥Type(x)ä¸ºStringæˆ–Numberï¼Œä¸”Type(y)ä¸ºObjectï¼Œè¿”å›æ¯”è¾ƒx == ToPrimitive(y)çš„ç»“æœã€‚
è‹¥Type(x)ä¸ºObjectä¸”Type(y)ä¸ºStringæˆ–Numberï¼Œ è¿”å›æ¯”è¾ƒToPrimitive(x) == yçš„ç»“æœã€‚
è¿”å›falseã€‚</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]==![]</span><br><span class="line">//ç­‰å¼å³è¾¹çš„æ˜¾ç„¶æ˜¯æ˜¾ç¤ºè½¬æ¢ï¼Œæ ¹æ®è§„åˆ™ï¼Œæ‰€æœ‰å¯¹è±¡æˆ–æ•°ç»„çš„booleanæ€»æ˜¯ä¸ºtrue,é‚£ä¹ˆå–åä¹Ÿå°±æ˜¯false,é‚£ä¹ˆç­‰å¼å°±å˜æˆ[]==false,æ¥ä¸‹æ¥æ˜¯ç­‰å¼çš„éšå¼ç±»å‹è½¬æ¢ï¼Œæ˜æ˜¾ç­‰å¼å·¦è¾¹çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå°±è°ƒç”¨å®ƒçš„ToPrimitiveæ–¹æ³•ï¼Œè¿”å›&apos;&apos;ï¼Œå› æ­¤ç­‰å¼å˜æˆ&apos;&apos;==falseï¼Œ</span><br><span class="line">//æ¥ç€è¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢,&apos;&apos;-&gt;0,false-&gt;0ï¼Œæœ€åç­‰å¼å˜æˆ0==0ï¼Œæ‰€ä»¥ç»“æœæ˜¯true</span><br><span class="line">1==&apos;1&apos;//true</span><br><span class="line">1==null//fasle</span><br><span class="line">1==undefined//false</span><br><span class="line">1==true//true</span><br><span class="line">1==[]//false</span><br><span class="line">&#123;&#125;==0//Unexpected token ==,è¿™æ˜¯å› ä¸ºASTæŠŠç¬¬ä¸€ä¸ª&#123;&#125;ä¸æ˜¯è§£ææˆå¯¹è±¡ï¼Œè€Œæ˜¯è§£ææˆä¸€ä¸ªblock(ä»£ç å—),å› æ­¤å…¶å®ç­‰å¼å·¦è¾¹æ˜¯æ²¡æœ‰å€¼çš„ï¼Œå› æ­¤æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸,æœ‰ç–‘é—®è‡ªè¡Œgoogle AST explorer</span><br><span class="line">0==&#123;&#125;//true</span><br><span class="line">&#123;&#125;+1==1//true ,å¯¹äºåŠ æ³•è¿ç®—ï¼ŒJSä¼šæŠŠè¿ç®—ç¬¦ä¸¤ä¾§çš„å¯¹è±¡è°ƒç”¨toPrimitiveæ–¹æ³•ï¼Œå› æ­¤ç­‰å¼å˜æˆ&apos;&apos;+1==1-&gt;&apos;1&apos;==1-&gt;1==1</span><br></pre></td></tr></table></figure>

<h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p>JSä¸­å¯¹é—­åŒ…çš„è§£é‡Šæ˜¯åœ¨å‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function test(a)&#123;</span><br><span class="line">    return function inner()&#123;</span><br><span class="line">        return ++a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let a = 2;</span><br><span class="line">const testVim = test(a);//testVim åœ¨æ²¡æœ‰é”€æ¯æ—¶å§‹ç»ˆå æœ‰function innerçš„å†…å­˜åœ°å€</span><br><span class="line"></span><br><span class="line">console.log(&quot;testVim:&quot;, testVim());//3</span><br><span class="line">console.log(&quot;testVim:&quot;, testVim());//4</span><br><span class="line">console.log(&quot;testVim:&quot;, testVim());//5</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function makeSizer(size) &#123;</span><br><span class="line">  return function() &#123;</span><br><span class="line">    document.body.style.fontSize = size + &apos;px&apos;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var size12 = makeSizer(12);</span><br><span class="line">var size14 = makeSizer(14);</span><br><span class="line">var size16 = makeSizer(16);</span><br></pre></td></tr></table></figure>

<p>size12ï¼Œsize14 å’Œ size16 ä¸‰ä¸ªå‡½æ•°å°†åˆ†åˆ«æŠŠ body æ–‡æœ¬è°ƒæ•´ä¸º 12ï¼Œ14ï¼Œ16 åƒç´ ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åˆ†åˆ«æ·»åŠ åˆ°æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä¸Šã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.getElementById(&apos;size-12&apos;).onclick = size12;</span><br><span class="line">document.getElementById(&apos;size-14&apos;).onclick = size14;</span><br><span class="line">document.getElementById(&apos;size-16&apos;).onclick = size16;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;#&quot; id=&quot;size-12&quot;&gt;12&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;#&quot; id=&quot;size-14&quot;&gt;14&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;#&quot; id=&quot;size-16&quot;&gt;16&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h2 id="ç»Ÿè®¡åŒä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦"><a href="#ç»Ÿè®¡åŒä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦" class="headerlink" title="ç»Ÿè®¡åŒä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦"></a>ç»Ÿè®¡åŒä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦</h2><h3 id="æ­£åˆ™"><a href="#æ­£åˆ™" class="headerlink" title="æ­£åˆ™"></a>æ­£åˆ™</h3><p>ç”¨æ­£åˆ™åŒ¹é…ï¼Œ\wå¯ä»¥ç”¨.ä»£æ›¿</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let str =&apos;aaaaaaaabbbbbccccccccccccc&apos;;</span><br><span class="line">let getMaxCount = (str)=&gt;&#123;</span><br><span class="line">    const reg = /(\w)\1+/g;</span><br><span class="line">    const result = str.match(reg);</span><br><span class="line">    let finalResult = result.map(item=&gt;&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            length:item.length,</span><br><span class="line">            item:item[0]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).sort((a,b)=&gt;&#123;</span><br><span class="line">        return a.length-b.length&lt;0</span><br><span class="line">    &#125;);</span><br><span class="line">    // console.log(finalResult)</span><br><span class="line">    return finalResult[0];</span><br><span class="line">&#125;</span><br><span class="line">getMaxCount(str);</span><br></pre></td></tr></table></figure>

<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let getMaxCount_2 = (str)=&gt;&#123;</span><br><span class="line">    let temp = str.split(&quot;&quot;);</span><br><span class="line">    let result  = temp.reduce((obj,cur)=&gt;&#123;</span><br><span class="line">        obj[cur] = ++obj[cur]||1;</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;,&#123;&#125;);</span><br><span class="line">    let max = &#123;</span><br><span class="line">        len:0,</span><br><span class="line">        item:&apos;&apos;</span><br><span class="line">    &#125;;</span><br><span class="line">    for(let index in result)&#123;</span><br><span class="line">        if(result[index]&gt;max.len)&#123;</span><br><span class="line">            max.len = result[index];</span><br><span class="line">            max.item = index;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return max;</span><br><span class="line">&#125;</span><br><span class="line">getMaxCount_2(str);</span><br></pre></td></tr></table></figure>

<h2 id="æ•°ç»„å»é‡"><a href="#æ•°ç»„å»é‡" class="headerlink" title="æ•°ç»„å»é‡"></a>æ•°ç»„å»é‡</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const isUnique = (arr)=&gt;&#123;</span><br><span class="line">    const equals = (a, b) =&gt; &#123;</span><br><span class="line">        if (a === b) return true;</span><br><span class="line">        if (a instanceof Date &amp;&amp; b instanceof Date) return a.getTime() === b.getTime();</span><br><span class="line">        if (!a || !b || (typeof a !== &apos;object&apos; &amp;&amp; typeof b !== &apos;object&apos;)) return a === b;</span><br><span class="line">        if (a === null || a === undefined || b === null || b === undefined) return false;</span><br><span class="line">        if (a.prototype !== b.prototype) return false;</span><br><span class="line">        let keys = Object.keys(a);</span><br><span class="line">        if (keys.length !== Object.keys(b).length) return false;</span><br><span class="line">        return keys.every(k =&gt; equals(a[k], b[k]));</span><br><span class="line">      &#125;;</span><br><span class="line">    </span><br><span class="line">    for(let i =0;i&lt;arr.length;i++)&#123;</span><br><span class="line">        for(let j =i+1;j&lt;arr.length;j++)&#123;</span><br><span class="line">            if(!!equals(arr[i],arr[j]))&#123;</span><br><span class="line">                arr.splice(j,1);</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return arr;</span><br><span class="line">&#125;</span><br><span class="line">isUnique([123, [1, 2, 3], [1, &quot;2&quot;, 3], [1, 2, 3], &quot;meili&quot;,&#123;a:1,b:1&#125;,&#123;b:1,a:1&#125;]);</span><br></pre></td></tr></table></figure>

<h2 id="æ•°ç»„è½¬é“¾è¡¨"><a href="#æ•°ç»„è½¬é“¾è¡¨" class="headerlink" title="æ•°ç»„è½¬é“¾è¡¨"></a>æ•°ç»„è½¬é“¾è¡¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">*é“¾è¡¨èŠ‚ç‚¹</span><br><span class="line">*param &#123;*&#125; val</span><br><span class="line">*param &#123;ListNode&#125; next</span><br><span class="line">**/</span><br><span class="line">function ListNode(val,next=null)&#123;</span><br><span class="line">    this.val = val;</span><br><span class="line">    this.next = next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*å°†æ•°ç»„è½¬ä¸ºé“¾è¡¨</span><br><span class="line">*param &#123;array&#125; a</span><br><span class="line">*param &#123;ListNode&#125; </span><br><span class="line">**/</span><br><span class="line">const getListFromArray=a=&gt;&#123;</span><br><span class="line">    let dummy = new ListNode()</span><br><span class="line">    let pre =dummy;</span><br><span class="line">    a.forEach(x =&gt; &#123;</span><br><span class="line">        return pre=pre.next=new ListNode(x);</span><br><span class="line">    &#125;);</span><br><span class="line">    return dummy.next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*å°†é“¾è¡¨è½¬ä¸ºæ•°ç»„</span><br><span class="line">*param &#123;array&#125; </span><br><span class="line">*param &#123;ListNode&#125; node </span><br><span class="line">**/</span><br><span class="line">const getArrayFromList = index=&gt;&#123;</span><br><span class="line">    let a=[];</span><br><span class="line">    while(node)&#123;</span><br><span class="line">        a.push(node.val);</span><br><span class="line">        node = node.next;</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map-Set-WeakMap-WeakSet"><a href="#Map-Set-WeakMap-WeakSet" class="headerlink" title="Map,Set,WeakMap,WeakSet"></a>Map,Set,WeakMap,WeakSet</h2><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>Map å¯¹è±¡ä¿å­˜é”®å€¼å¯¹ã€‚ä»»ä½•å€¼(å¯¹è±¡æˆ–è€…åŸå§‹å€¼) éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”®æˆ–ä¸€ä¸ªå€¼<br>new Map([iterable])<br>Iterable å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…å…¶ä»– iterable å¯¹è±¡ï¼Œå…¶å…ƒç´ ä¸ºé”®å€¼å¯¹(ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œä¾‹å¦‚: [[ 1, â€˜oneâ€™ ],[ 2, â€˜twoâ€™ ]])ã€‚ æ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ·»åŠ åˆ°æ–°çš„ Mapã€‚null ä¼šè¢«å½“åš undefined</p>
<p>Objects å’Œ Maps ç±»ä¼¼çš„æ˜¯ï¼Œå®ƒä»¬éƒ½å…è®¸ä½ æŒ‰é”®å­˜å–ä¸€ä¸ªå€¼ã€åˆ é™¤é”®ã€æ£€æµ‹ä¸€ä¸ªé”®æ˜¯å¦ç»‘å®šäº†å€¼ã€‚å› æ­¤ï¼ˆå¹¶ä¸”ä¹Ÿæ²¡æœ‰å…¶ä»–å†…å»ºçš„æ›¿ä»£æ–¹å¼äº†ï¼‰è¿‡å»æˆ‘ä»¬ä¸€ç›´éƒ½æŠŠå¯¹è±¡å½“æˆ Maps ä½¿ç”¨ã€‚ä¸è¿‡ Maps å’Œ Objects æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ï¼Œåœ¨ä¸‹åˆ—æƒ…å†µé‡Œä½¿ç”¨ Map ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼š</p>
<ul>
<li>ä¸€ä¸ªObjectçš„é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ–è€… Symbolsï¼Œä½†ä¸€ä¸ª Map çš„é”®å¯ä»¥æ˜¯ä»»æ„å€¼ï¼ŒåŒ…æ‹¬å‡½æ•°ã€å¯¹è±¡ã€åŸºæœ¬ç±»å‹ã€‚</li>
<li>Map ä¸­çš„é”®å€¼æ˜¯æœ‰åºçš„ï¼Œè€Œæ·»åŠ åˆ°å¯¹è±¡ä¸­çš„é”®åˆ™ä¸æ˜¯ã€‚å› æ­¤ï¼Œå½“å¯¹å®ƒè¿›è¡Œéå†æ—¶ï¼ŒMap å¯¹è±¡æ˜¯æŒ‰æ’å…¥çš„é¡ºåºè¿”å›é”®å€¼ã€‚</li>
<li>ä½ å¯ä»¥é€šè¿‡ size å±æ€§ç›´æ¥è·å–ä¸€ä¸ª Map çš„é”®å€¼å¯¹ä¸ªæ•°ï¼Œè€Œ Object çš„é”®å€¼å¯¹ä¸ªæ•°åªèƒ½æ‰‹åŠ¨è®¡ç®—ã€‚</li>
<li>Map å¯ç›´æ¥è¿›è¡Œè¿­ä»£ï¼Œè€Œ Object çš„è¿­ä»£éœ€è¦å…ˆè·å–å®ƒçš„é”®æ•°ç»„ï¼Œç„¶åå†è¿›è¡Œè¿­ä»£ã€‚<br>Object éƒ½æœ‰è‡ªå·±çš„åŸå‹ï¼ŒåŸå‹é“¾ä¸Šçš„é”®åæœ‰å¯èƒ½å’Œä½ è‡ªå·±åœ¨å¯¹è±¡ä¸Šçš„è®¾ç½®çš„é”®åäº§ç”Ÿå†²çªã€‚è™½ç„¶ ES5 å¼€å§‹å¯ä»¥ç”¨ map = Object.create(null) æ¥åˆ›å»ºä¸€ä¸ªæ²¡æœ‰åŸå‹çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™ç§ç”¨æ³•ä¸å¤ªå¸¸è§ã€‚</li>
<li>Map åœ¨æ¶‰åŠé¢‘ç¹å¢åˆ é”®å€¼å¯¹çš„åœºæ™¯ä¸‹ä¼šæœ‰äº›æ€§èƒ½ä¼˜åŠ¿ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let map = new Map([</span><br><span class="line">[0,0];</span><br><span class="line">]);</span><br><span class="line">map.size;//1</span><br><span class="line">for(let key of map.keys())&#123;</span><br><span class="line">    console.log(key)//0</span><br><span class="line">&#125;</span><br><span class="line">for(let [key,value] of map.keys())&#123;</span><br><span class="line">    console.log(key,value)//0 0</span><br><span class="line">&#125;</span><br><span class="line">for(let value of map.keys())&#123;</span><br><span class="line">    console.log(value)//0 0</span><br><span class="line">&#125;</span><br><span class="line">map.clear()//æ¸…æ¥šmapå¯¹è±¡æ‰€æœ‰é”®å€¼å¯¹</span><br><span class="line">map.delete(key)/*å¦‚æœ Map å¯¹è±¡ä¸­å­˜åœ¨è¯¥å…ƒç´ ï¼Œåˆ™ç§»é™¤å®ƒå¹¶è¿”å› trueï¼›å¦åˆ™å¦‚æœè¯¥å…ƒç´ ä¸å­˜åœ¨åˆ™è¿”å› false */</span><br><span class="line">map.get(key)/*è¿”å›é”®å¯¹åº”çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›undefinedã€‚*/</span><br><span class="line">map.set(key,value);/*è®¾ç½®Mapå¯¹è±¡ä¸­é”®çš„å€¼ã€‚è¿”å›è¯¥Mapå¯¹è±¡ã€‚*/</span><br><span class="line">map.has(key)/*è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºMapå®ä¾‹æ˜¯å¦åŒ…å«é”®å¯¹åº”çš„å€¼ã€‚*/</span><br></pre></td></tr></table></figure>

<ul>
<li>NaN ä¹Ÿå¯ä»¥ä½œä¸ºMapå¯¹è±¡çš„é”®ã€‚è™½ç„¶ NaN å’Œä»»ä½•å€¼ç”šè‡³å’Œè‡ªå·±éƒ½ä¸ç›¸ç­‰(NaN !== NaN è¿”å›true)ï¼Œä½†ä¸‹é¢çš„ä¾‹å­è¡¨æ˜ï¼ŒNaNä½œä¸ºMapçš„é”®æ¥è¯´æ˜¯æ²¡æœ‰åŒºåˆ«çš„:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var myMap = new Map();</span><br><span class="line">myMap.set(NaN, &quot;not a number&quot;);</span><br><span class="line"></span><br><span class="line">myMap.get(NaN); // &quot;not a number&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨Array.fromå‡½æ•°å¯ä»¥å°†ä¸€ä¸ªMapå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªäºŒç»´é”®å€¼å¯¹æ•°ç»„</span><br><span class="line">var kvArray = [[&quot;key1&quot;, &quot;value1&quot;], [&quot;key2&quot;, &quot;value2&quot;]];</span><br><span class="line">var myMap = new Map(kvArray);</span><br><span class="line"></span><br><span class="line">console.log(Array.from(myMap)); // è¾“å‡ºå’ŒkvArrayç›¸åŒçš„æ•°ç»„</span><br></pre></td></tr></table></figure>

<p>Mapå¯¹è±¡é—´å¯ä»¥è¿›è¡Œåˆå¹¶ï¼Œä½†æ˜¯ä¼šä¿æŒé”®çš„å”¯ä¸€æ€§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var first = new Map([</span><br><span class="line">  [1, &apos;one&apos;],</span><br><span class="line">  [2, &apos;two&apos;],</span><br><span class="line">  [3, &apos;three&apos;],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">var second = new Map([</span><br><span class="line">  [1, &apos;uno&apos;],</span><br><span class="line">  [2, &apos;dos&apos;]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">// åˆå¹¶ä¸¤ä¸ªMapå¯¹è±¡æ—¶ï¼Œå¦‚æœæœ‰é‡å¤çš„é”®å€¼ï¼Œåˆ™åé¢çš„ä¼šè¦†ç›–å‰é¢çš„ã€‚</span><br><span class="line">// å±•å¼€è¿ç®—ç¬¦æœ¬è´¨ä¸Šæ˜¯å°†Mapå¯¹è±¡è½¬æ¢æˆæ•°ç»„ã€‚</span><br><span class="line">var merged = new Map([...first, ...second]);</span><br><span class="line"></span><br><span class="line">console.log(merged.get(1)); // uno</span><br><span class="line">console.log(merged.get(2)); // dos</span><br><span class="line">console.log(merged.get(3)); // three</span><br></pre></td></tr></table></figure>

<p>Mapå¯¹è±¡ä¹Ÿèƒ½ä¸æ•°ç»„åˆå¹¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var merged = new Map([...first, ...second, [1, &apos;eins&apos;]]);</span><br></pre></td></tr></table></figure>

<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>new Set([iterable]);</p>
<ul>
<li>å¦‚æœä¼ é€’ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå®ƒçš„æ‰€æœ‰å…ƒç´ å°†ä¸é‡å¤åœ°è¢«æ·»åŠ åˆ°æ–°çš„ Setä¸­ã€‚å¦‚æœä¸æŒ‡å®šæ­¤å‚æ•°æˆ–å…¶å€¼ä¸ºnullï¼Œåˆ™æ–°çš„ Setä¸ºç©ºã€‚</li>
<li>Set å¯¹è±¡å…è®¸ä½ å­˜å‚¨ä»»ä½•ç±»å‹çš„å”¯ä¸€å€¼ï¼Œæ— è®ºæ˜¯åŸå§‹å€¼æˆ–è€…æ˜¯å¯¹è±¡å¼•ç”¨ã€‚<br>ES6çš„è¿™ä¸ªSetç»“æ„å‡ºæ¥ä»¥åä¸€ç›´è¢«å½“ä½œä¸€ä¸ªå»é‡çš„çš„ä¸€ä¸ªçœæ—¶çœåŠ›çš„ç»“æ„ï¼Œå‰ææ˜¯å»é‡çš„å…ƒç´ ä¸æ˜¯å¼•ç”¨ç±»å‹çš„ã€‚<br><img src="/images/readingNote/set_example.png" alt="å›¾ç‰‡"></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr =[1,2,4,5,6,1,2];</span><br><span class="line">let set2= new Set(arr);//1,2,3,4,5,6  ç”Ÿæˆçš„æ˜¯Setç»“æ„ï¼Œä¸æ˜¯Arrayç»“æ„</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">add(value) </span><br><span class="line">//åœ¨Setå¯¹è±¡å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚è¿”å›è¯¥Setå¯¹è±¡ã€‚</span><br><span class="line">clear()</span><br><span class="line">//ç§»é™¤Setå¯¹è±¡å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</span><br><span class="line">delete(value)</span><br><span class="line">//ç§»é™¤Setçš„ä¸­ä¸è¿™ä¸ªå€¼ç›¸ç­‰çš„å…ƒç´ </span><br><span class="line">entries()</span><br><span class="line">//è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡,[value,value]æ•°ç»„ï¼Œä¸ºäº†ä½¿è¿™ä¸ªæ–¹æ³•å’ŒMapå¯¹è±¡ä¿æŒç›¸ä¼¼ï¼Œ æ¯ä¸ªå€¼çš„é”®å’Œå€¼ç›¸ç­‰ã€‚</span><br><span class="line">has()</span><br><span class="line">//è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥å€¼åœ¨Setä¸­å­˜åœ¨ä¸å¦ã€‚</span><br><span class="line">values()</span><br><span class="line">//è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«Setå¯¹è±¡ä¸­çš„æŒ‰æ’å…¥é¡ºåºæ’åˆ—çš„æ‰€æœ‰å…ƒç´ çš„å€¼ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><p>WeakMap å¯¹è±¡æ˜¯ä¸€ç»„é”®/å€¼å¯¹çš„é›†åˆï¼Œå…¶ä¸­çš„é”®æ˜¯å¼±å¼•ç”¨çš„ã€‚å…¶é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„ã€‚<br>new WeakMap([iterable])<br>Iterable æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆäºŒå…ƒæ•°ç»„ï¼‰æˆ–è€…å…¶ä»–å¯è¿­ä»£çš„ä¸”å…¶å…ƒç´ æ˜¯é”®å€¼å¯¹çš„å¯¹è±¡ã€‚æ¯ä¸ªé”®å€¼å¯¹ä¼šè¢«åŠ åˆ°æ–°çš„ WeakMap é‡Œã€‚null ä¼šè¢«å½“åš undefined</p>
<p>WeakMap çš„ key åªèƒ½æ˜¯ Object ç±»å‹ã€‚ åŸå§‹æ•°æ®ç±»å‹ æ˜¯ä¸èƒ½ä½œä¸º key çš„ï¼ˆæ¯”å¦‚ Symbolï¼‰ã€‚<br>WeakMap çš„ keyæ˜¯ä¸å¯æšä¸¾çš„ï¼Œå› ä¸ºå®ƒçš„å¼±å¼•ç”¨æœºåˆ¶ï¼Œä¸ç¡®ä¿keyæ˜¯å¦ä¼šè¢«GC;æ²¡æœ‰éƒ¨ç½²è¿­ä»£å™¨ï¼Œä¸èƒ½ç”¨forå¾ªç¯éåŠ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">delete(key)</span><br><span class="line">get(key)</span><br><span class="line">has(key)</span><br><span class="line">set(key,value)</span><br></pre></td></tr></table></figure>

<p>å½“WeakMapé‡Œé¢çš„keyè®¾ç½®ä¸ºnullæ—¶ï¼ŒWeakMapé‡Œé¢å°†ä¸å†å­˜å‚¨key=nullçš„æ˜ å°„ï¼Œå–æ¶ˆå†…å­˜å¼•ç”¨é¿å…é€ æˆå†…å­˜æ³„æ¼ï¼Œä»è€Œä½¿å¾—ä¸å†è¢«ä½¿ç”¨çš„keyèƒ½è¢«æ­£ç¡®GC.</p>
<h3 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h3><p>WeakSet å¯¹è±¡å…è®¸ä½ å°†å¼±ä¿æŒå¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚<br>new WeakSet([iterable]);<br>å¦‚æœä¼ å…¥ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°, åˆ™è¯¥å¯¹è±¡çš„æ‰€æœ‰è¿­ä»£å€¼éƒ½ä¼šè¢«è‡ªåŠ¨æ·»åŠ è¿›ç”Ÿæˆçš„ WeakSet å¯¹è±¡ä¸­.<br>WeakSet å¯¹è±¡æ˜¯ä¸€äº›å¯¹è±¡å€¼çš„é›†åˆ, å¹¶ä¸”å…¶ä¸­çš„æ¯ä¸ªå¯¹è±¡å€¼éƒ½åªèƒ½å‡ºç°ä¸€æ¬¡.</p>
<p>å®ƒå’Œ Set å¯¹è±¡çš„åŒºåˆ«æœ‰ä¸¤ç‚¹:</p>
<ul>
<li>WeakSet å¯¹è±¡ä¸­åªèƒ½å­˜æ”¾å¯¹è±¡å¼•ç”¨, ä¸èƒ½å­˜æ”¾å€¼, è€Œ Set å¯¹è±¡éƒ½å¯ä»¥.</li>
<li>WeakSet å¯¹è±¡ä¸­å­˜å‚¨çš„å¯¹è±¡å€¼éƒ½æ˜¯è¢«å¼±å¼•ç”¨çš„, å¦‚æœæ²¡æœ‰å…¶ä»–çš„å˜é‡æˆ–å±æ€§å¼•ç”¨è¿™ä¸ªå¯¹è±¡å€¼, åˆ™è¿™ä¸ªå¯¹è±¡å€¼ä¼šè¢«å½“æˆåƒåœ¾å›æ”¶æ‰. æ­£å› ä¸ºè¿™æ ·, WeakSet å¯¹è±¡æ˜¯æ— æ³•è¢«æšä¸¾çš„, æ²¡æœ‰åŠæ³•æ‹¿åˆ°å®ƒåŒ…å«çš„æ‰€æœ‰å…ƒç´ .</li>
</ul>
<p>æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">clear()</span><br><span class="line">delete(value)</span><br><span class="line">get(value)</span><br><span class="line">has(value)</span><br><span class="line">add(value)</span><br></pre></td></tr></table></figure>

<p>example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var ws = new WeakSet();</span><br><span class="line">var obj = &#123;&#125;;</span><br><span class="line">var foo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">ws.add(window);</span><br><span class="line">ws.add(obj);</span><br><span class="line"></span><br><span class="line">ws.has(window); // true</span><br><span class="line">ws.has(foo);    // false, å¯¹è±¡ foo å¹¶æ²¡æœ‰è¢«æ·»åŠ è¿› ws ä¸­ </span><br><span class="line"></span><br><span class="line">ws.delete(window); // ä»é›†åˆä¸­åˆ é™¤ window å¯¹è±¡</span><br><span class="line">ws.has(window);    // false, window å¯¹è±¡å·²ç»è¢«åˆ é™¤äº†</span><br><span class="line"></span><br><span class="line">ws.clear(); // æ¸…ç©ºæ•´ä¸ª WeakSet å¯¹è±¡</span><br></pre></td></tr></table></figure>

<h2 id="å°æ•°å’Œæ•´æ•°çš„é‚£äº›äº‹"><a href="#å°æ•°å’Œæ•´æ•°çš„é‚£äº›äº‹" class="headerlink" title="å°æ•°å’Œæ•´æ•°çš„é‚£äº›äº‹"></a>å°æ•°å’Œæ•´æ•°çš„é‚£äº›äº‹</h2><h3 id="å–æ•´"><a href="#å–æ•´" class="headerlink" title="å–æ•´"></a>å–æ•´</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const num = 2147483648.88;</span><br><span class="line">console.log(num&gt;&gt;&gt;0);// 2147483648 </span><br><span class="line">console.log(Math.trunc(num))//2147483648</span><br><span class="line">//Math.ceil,Math.round,Math.floorå‡å¯ä»¥å–æ•´ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ˜¯å‘ä¸Šå–æ•´ï¼Œå››èˆäº”å…¥å–æ•´ï¼Œå‘ä¸‹å–æ•´</span><br></pre></td></tr></table></figure>

<h3 id="å–å°æ•°"><a href="#å–å°æ•°" class="headerlink" title="å–å°æ•°"></a>å–å°æ•°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const num = 2147483648.88;</span><br><span class="line">console.log(num%1)//0.880000114440918</span><br><span class="line">console.log(3.1|0)//3;</span><br><span class="line">console.log(num|0)//-2147483648ï¼Œ&apos;|&apos;ç”±äºä»…èƒ½å¤„ç†32ä½æ•´æ•°ï¼Œæ‰€ä»¥ä¸€æ—¦æ•°å­—è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œ&apos;|&apos;å°±ä¸èƒ½æ­£ç¡®å¤„ç†</span><br><span class="line">// ç”±äºæ¶‰åŠåˆ°æµ®ç‚¹æ•°è®¡ç®—ï¼Œæ— è®ºåŠ å‡ä¹˜é™¤éƒ½ä¼šå‡ºç°ç²¾åº¦ç¼ºå¤±é—®é¢˜</span><br></pre></td></tr></table></figure>

<h3 id="æµ®ç‚¹æ•°æ¯”è¾ƒ"><a href="#æµ®ç‚¹æ•°æ¯”è¾ƒ" class="headerlink" title="æµ®ç‚¹æ•°æ¯”è¾ƒ"></a>æµ®ç‚¹æ•°æ¯”è¾ƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//ç”±äºç²¾åº¦çš„é—®é¢˜ï¼Œæµ®ç‚¹æ•°ä¸èƒ½ç”¨&apos;===&apos;å’Œ&apos;!==&apos;æ¥è¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">let a =0.1,b=0.2,c=0.3;</span><br><span class="line">let sum =a+b;</span><br><span class="line">console.log(sum==c);//false,ç”±äºç²¾åº¦é—®é¢˜ï¼Œæ‰€ä»¥0.1+0.2æ˜¯ä¸ç­‰äº0.3çš„ï¼Œåº”è¯¥ç­‰äº0.30000000000000004</span><br><span class="line">function fract(a,b)&#123;</span><br><span class="line">  return Math.abs(a-b)&lt;Number.EPSILON</span><br><span class="line">&#125;</span><br><span class="line">console.log(fract(sum,c));//true,Number.EPSILON å±æ€§è¡¨ç¤º 1 ä¸Numberå¯è¡¨ç¤ºçš„å¤§äº 1 çš„æœ€å°çš„æµ®ç‚¹æ•°ä¹‹é—´çš„å·®å€¼ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="ä½æ“ä½œç¬¦"><a href="#ä½æ“ä½œç¬¦" class="headerlink" title="ä½æ“ä½œç¬¦"></a>ä½æ“ä½œç¬¦</h2><h3 id="lt-lt-å·¦ç§»"><a href="#lt-lt-å·¦ç§»" class="headerlink" title="&lt;&lt; å·¦ç§»"></a>&lt;&lt; å·¦ç§»</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//è¯¥æ“ä½œç¬¦ä¼šå°†ç¬¬ä¸€ä¸ªæ“ä½œæ•°å‘å·¦ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ã€‚å‘å·¦è¢«ç§»å‡ºçš„ä½è¢«ä¸¢å¼ƒï¼Œå³ä¾§ç”¨ 0 è¡¥å……ã€‚</span><br><span class="line">9&lt;&lt;2 =36;</span><br><span class="line">9(base 10) =00000000000000000000000000001001 (base 2)</span><br><span class="line">9&lt;&lt;2(base 10) =00000000000000000000000000100100 (base 2)</span><br><span class="line">//åœ¨æ•°å­— x ä¸Šå·¦ç§» y æ¯”ç‰¹å¾—åˆ° x * 2y.å› æ­¤9&lt;&lt;2 = 9*Math.pow(2,2)</span><br></pre></td></tr></table></figure>

<h3 id="gt-gt-å³ç§»-æœ‰ç¬¦å·"><a href="#gt-gt-å³ç§»-æœ‰ç¬¦å·" class="headerlink" title="&gt;&gt; å³ç§»(æœ‰ç¬¦å·)"></a>&gt;&gt; å³ç§»(æœ‰ç¬¦å·)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//è¯¥æ“ä½œç¬¦ä¼šå°†ç¬¬ä¸€ä¸ªæ“ä½œæ•°å‘å³ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ã€‚å‘å³è¢«ç§»å‡ºçš„ä½è¢«ä¸¢å¼ƒï¼Œæ‹·è´æœ€å·¦ä¾§çš„ä½ä»¥å¡«å……å·¦ä¾§ã€‚ç”±äºæ–°çš„æœ€å·¦ä¾§çš„ä½æ€»æ˜¯å’Œä»¥å‰ç›¸åŒï¼Œç¬¦å·ä½æ²¡æœ‰è¢«æ”¹å˜ã€‚æ‰€ä»¥è¢«ç§°ä½œâ€œç¬¦å·ä¼ æ’­â€ã€‚</span><br><span class="line">9 (base 10): 00000000000000000000000000001001 (base 2)            </span><br><span class="line">9 &gt;&gt; 2 (base 10): 00000000000000000000000000000010 (base 2) = 2 (base 10)</span><br><span class="line">------</span><br><span class="line">-9 (base 10): 11111111111111111111111111110111 (base 2)</span><br><span class="line">-9 &gt;&gt; 2 (base 10): 11111111111111111111111111111101 (base 2) = -3 (base 10)</span><br></pre></td></tr></table></figure>

<h3 id="gt-gt-gt-å³ç§»-æ— ç¬¦å·"><a href="#gt-gt-gt-å³ç§»-æ— ç¬¦å·" class="headerlink" title="&gt;&gt;&gt;å³ç§»(æ— ç¬¦å·)"></a>&gt;&gt;&gt;å³ç§»(æ— ç¬¦å·)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">è¯¥æ“ä½œç¬¦ä¼šå°†ç¬¬ä¸€ä¸ªæ“ä½œæ•°å‘å³ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ã€‚å‘å³è¢«ç§»å‡ºçš„ä½è¢«ä¸¢å¼ƒï¼Œå·¦ä¾§ç”¨0å¡«å……ã€‚å› ä¸ºç¬¦å·ä½å˜æˆäº† 0ï¼Œæ‰€ä»¥ç»“æœæ€»æ˜¯éè´Ÿçš„ã€‚ï¼ˆè¯‘æ³¨ï¼šå³ä¾¿å³ç§» 0 ä¸ªæ¯”ç‰¹ï¼Œç»“æœä¹Ÿæ˜¯éè´Ÿçš„ã€‚ï¼‰</span><br><span class="line">*/</span><br><span class="line">9 (base 10): 00000000000000000000000000001001 (base 2)</span><br><span class="line">9 &gt;&gt;&gt; 2 (base 10): 00000000000000000000000000000010 (base 2) = 2 (base 10)</span><br><span class="line">-------</span><br><span class="line">-9 (base 10): 11111111111111111111111111110111 (base 2)</span><br><span class="line">-9 &gt;&gt;&gt; 2 (base 10): 00111111111111111111111111111101 (base 2) = 1073741821 (base 10)</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²è½¬æ•´æ•°"><a href="#å­—ç¬¦ä¸²è½¬æ•´æ•°" class="headerlink" title="å­—ç¬¦ä¸²è½¬æ•´æ•°"></a>å­—ç¬¦ä¸²è½¬æ•´æ•°</h3><ul>
<li>Number<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const str = &apos;1&apos;;</span><br><span class="line">Number(str)//1</span><br><span class="line">Numebr(&apos;&apos;)//0</span><br><span class="line">Number(&apos;123n&apos;)//NaN</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Number ä»å­—ç¬¦ä¸²ç¬¬ä¸€ä½å¼€å§‹åˆ¤æ–­ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸æ˜¯æ•°å­—ï¼Œè¿”å›NaNï¼Œå¦‚æœæ˜¯ç©ºä¸²ï¼Œè¿”å›0ï¼›</p>
<ul>
<li>parseInt</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">parseInt(&apos;&apos;)//NaN</span><br><span class="line">parseInt(&apos;123&apos;)//123</span><br><span class="line">parseInt(&apos;123n&apos;)//123</span><br><span class="line">parseInt(&apos;n123n&apos;)//NaN</span><br></pre></td></tr></table></figure>

<p>parseInt è§£æ è¿‡ç¨‹ä¸­ï¼Œå½“éæ•°å­—å­—ç¬¦æ’åœ¨æ•°å­—åé¢æ—¶ï¼Œè¿”å›è§£æåˆ°çš„æ•°å­—ï¼Œå½“éæ•°å­—å­—ç¬¦æ’åœ¨æ•°å­—å‰é¢æ—¶ï¼Œè¿”å›NaN</p>
<ul>
<li>â€˜&gt;&gt;åº•å±‚äºŒè¿›åˆ¶ç¬¦â€™<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;123&apos; &gt;&gt; 0 //123</span><br><span class="line">&apos;123n&apos; &gt;&gt; 0 //0</span><br><span class="line">&apos;n123&apos; &gt;&gt;0 //0 </span><br><span class="line">&apos;&apos; &gt;&gt; 0 //0</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>æ— æ•ˆæ•°å­—è¿”å›0ï¼Œæœ‰æ•ˆæ•°å­—è¿”å›æ•°å­—</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote class="blockquote-center">æˆ‘ä¼šåŠªåŠ›æ›´æ–°çš„</blockquote>]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚</title>
    <url>/2020/09/16/request-of-complex-simply/</url>
    <content><![CDATA[<h3 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h3><p>è¯·æ±‚æ–¹æ³•åªèƒ½æ˜¯ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ol>
<li>GET</li>
<li>POST</li>
<li>HEAD</li>
</ol>
<p>è¯·æ±‚å¤´åªèƒ½ç”¨ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Content-Type ï¼ˆéœ€è¦æ³¨æ„é¢å¤–çš„é™åˆ¶ï¼‰</li>
<li>DPR</li>
<li>Downlink</li>
<li>Save-Data</li>
<li>Viewport-Width</li>
<li>Width</li>
</ol>
<p>Contentâ€”â€”Typeåªèƒ½æœ‰ä»¥ä¸‹å‡ ç§</p>
<ol>
<li>text/plain</li>
<li>multipart/form-data</li>
<li>application/x-www-form-urlencoded</li>
</ol>
<p>è¯·æ±‚ä¸­çš„ä»»æ„XMLHttpRequestUpload å¯¹è±¡å‡æ²¡æœ‰æ³¨å†Œä»»ä½•äº‹ä»¶ç›‘å¬å™¨ï¼›XMLHttpRequestUpload å¯¹è±¡å¯ä»¥ä½¿ç”¨ XMLHttpRequest.upload å±æ€§è®¿é—®ã€‚</p>
<p>è¯·æ±‚ä¸­æ²¡æœ‰ä½¿ç”¨ ReadableStream å¯¹è±¡ã€‚</p>
<h3 id="å¤æ‚è¯·æ±‚"><a href="#å¤æ‚è¯·æ±‚" class="headerlink" title="å¤æ‚è¯·æ±‚"></a>å¤æ‚è¯·æ±‚</h3><p>éç®€å•è¯·æ±‚å°±æ˜¯å¤æ‚äº²æ±‚</p>
]]></content>
  </entry>
  <entry>
    <title>åœ¨JSæ–‡ä»¶ä½¿ç”¨svgåŠ è½½svgæ–‡ä»¶</title>
    <url>/2020/10/13/svgInJS/</url>
    <content><![CDATA[<h3 id="æ€ä¹ˆåœ¨jsæ–‡ä»¶ä¸­ç”¨å¼•ç”¨svgæ–‡ä»¶"><a href="#æ€ä¹ˆåœ¨jsæ–‡ä»¶ä¸­ç”¨å¼•ç”¨svgæ–‡ä»¶" class="headerlink" title="æ€ä¹ˆåœ¨jsæ–‡ä»¶ä¸­ç”¨å¼•ç”¨svgæ–‡ä»¶"></a>æ€ä¹ˆåœ¨jsæ–‡ä»¶ä¸­ç”¨å¼•ç”¨svgæ–‡ä»¶</h3><p>ä½¿ç”¨webpackçš„require.context,å®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°</p>
<ul>
<li>è¦æœç´¢çš„æ–‡ä»¶å¤¹ç›®å½•</li>
<li>æ˜¯å¦è¿˜åº”è¯¥æœç´¢å®ƒçš„å­ç›®å½•ï¼Œ</li>
<li>ä»¥åŠä¸€ä¸ªåŒ¹é…æ–‡ä»¶çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const req = require.context(<span class="string">'./svg'</span>, <span class="literal">false</span>, /\.svg$/)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>reqè¿”å›çš„æ˜¯ä¸€ä¸ªæ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> webpackContext(req) &#123;</span><br><span class="line">	var id = webpackContextResolve(req);</span><br><span class="line">	<span class="built_in">return</span> __webpack_require__(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒ…å«ä¸‰ä¸ªå±æ€§</p>
<ul>
<li>id</li>
<li>keys </li>
<li>resolve<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">webpackContext.keys = <span class="keyword">function</span> <span class="function"><span class="title">webpackContextKeys</span></span>() &#123;</span><br><span class="line">	<span class="built_in">return</span> Object.keys(map);</span><br><span class="line">&#125;;</span><br><span class="line">webpackContext.resolve = webpackContextResolve;</span><br><span class="line">webpackContext.id = <span class="string">"./src/icons/svg sync \\.svg$"</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>å†ä½¿ç”¨<code>const requireAll = requireContext =&gt; requireContext.keys().map(requireContext)</code>ä¹‹åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªModuleçš„æ•°ç»„,æ•°ç»„çš„æ¯ä¸€é¡¹å°±æ˜¯æ‰§è¡Œimportåçš„Module<br><img src="/images/svg-in-js/map.png" alt="dom"><br><img src="/images/svg-in-js/image.png" alt="image"><br>Moduleæ•°ç»„<br><img src="/images/svg-in-js/module.png" alt="module"><br><strong>webpack_require</strong>æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> __webpack_require__(moduleId) &#123;</span><br><span class="line">/******/</span><br><span class="line">/******/ 		// Check <span class="keyword">if</span> module is <span class="keyword">in</span> cache</span><br><span class="line">/******/ 		<span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line">/******/ 			<span class="built_in">return</span> installedModules[moduleId].exports;</span><br><span class="line">/******/ 		&#125;</span><br><span class="line">/******/ 		// Create a new module (and put it into the cache)</span><br><span class="line">/******/ 		var module = installedModules[moduleId] = &#123;</span><br><span class="line">/******/ 			i: moduleId,</span><br><span class="line">/******/ 			l: <span class="literal">false</span>,</span><br><span class="line">/******/ 			exports: &#123;&#125;,</span><br><span class="line">/******/ 			hot: hotCreateModule(moduleId),</span><br><span class="line">/******/ 			parents: (hotCurrentParentsTemp = hotCurrentParents, hotCurrentParents = [], hotCurrentParentsTemp),</span><br><span class="line">/******/ 			children: []</span><br><span class="line">/******/ 		&#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ 		// Execute the module <span class="keyword">function</span></span><br><span class="line">/******/ 		modules[moduleId].call(module.exports, module, module.exports, hotCreateRequire(moduleId));</span><br><span class="line">/******/</span><br><span class="line">/******/ 		// Flag the module as loaded</span><br><span class="line">/******/ 		module.l = <span class="literal">true</span>;</span><br><span class="line">/******/</span><br><span class="line">/******/ 		// Return the exports of the module</span><br><span class="line">/******/ 		<span class="built_in">return</span> module.exports;</span><br><span class="line">/******/ 	&#125;</span><br></pre></td></tr></table></figure>

<p>svg example</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/***/ <span class="string">"./src/icons/svg/bug.svg"</span>:</span><br><span class="line">/*!*******************************!*\</span><br><span class="line">  !*** ./src/icons/svg/bug.svg ***!</span><br><span class="line">  \*******************************/</span><br><span class="line">/*! exports provided: default */</span><br><span class="line">/***/ (<span class="keyword">function</span>(module, __webpack_exports__, __webpack_require__) &#123;</span><br><span class="line"></span><br><span class="line"><span class="string">"use strict"</span>;</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var svg_baker_runtime_browser_symbol__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! svg-baker-runtime/browser-symbol */ \"./node_modules/svg-baker-runtime/browser-symbol.js\");\n/* harmony import */ var svg_baker_runtime_browser_symbol__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(svg_baker_runtime_browser_symbol__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var svg_sprite_loader_runtime_browser_sprite_build__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! svg-sprite-loader/runtime/browser-sprite.build */ \"./node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\");\n/* harmony import */ var svg_sprite_loader_runtime_browser_sprite_build__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(svg_sprite_loader_runtime_browser_sprite_build__WEBPACK_IMPORTED_MODULE_1__);\n\n\nvar symbol = new svg_baker_runtime_browser_symbol__WEBPACK_IMPORTED_MODULE_0___default.a(&#123;\n  \"id\": \"icon-bug\",\n  \"use\": \"icon-bug-usage\",\n  \"viewBox\": \"0 0 128 128\",\n  \"content\": \"&lt;symbol xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 128 128\\\" id=\\\"icon-bug\\\"&gt;&lt;path d=\\\"M127.88 73.143c0 1.412-.506 2.635-1.518 3.669-1.011 1.033-2.209 1.55-3.592 1.55h-17.887c0 9.296-1.783 17.178-5.35 23.645l16.609 17.044c1.011 1.034 1.517 2.257 1.517 3.67 0 1.412-.506 2.635-1.517 3.668-.958 1.033-2.155 1.55-3.593 1.55-1.438 0-2.635-.517-3.593-1.55l-15.811-16.063a15.49 15.49 0 0 1-1.196 1.06c-.532.434-1.65 1.208-3.353 2.322a50.104 50.104 0 0 1-5.192 2.974c-1.758.87-3.94 1.658-6.546 2.364-2.607.706-5.189 1.06-7.748 1.06V47.044H58.89v73.062c-2.716 0-5.417-.367-8.106-1.102-2.688-.734-5.003-1.631-6.945-2.692a66.769 66.769 0 0 1-5.268-3.179c-1.571-1.057-2.73-1.94-3.476-2.65L33.9 109.34l-14.611 16.877c-1.066 1.14-2.344 1.711-3.833 1.711-1.277 0-2.422-.434-3.434-1.304-1.012-.978-1.557-2.187-1.635-3.627-.079-1.44.333-2.705 1.236-3.794l16.129-18.51c-3.087-6.197-4.63-13.644-4.63-22.342H5.235c-1.383 0-2.58-.517-3.592-1.55S.125 74.545.125 73.132c0-1.412.506-2.635 1.518-3.668 1.012-1.034 2.21-1.55 3.592-1.55h17.887V43.939L9.308 29.833c-1.012-1.033-1.517-2.256-1.517-3.669 0-1.412.505-2.635 1.517-3.668 1.012-1.034 2.21-1.55 3.593-1.55s2.58.516 3.593 1.55l13.813 14.106h67.396l13.814-14.106c1.012-1.034 2.21-1.55 3.592-1.55 1.384 0 2.581.516 3.593 1.55 1.012 1.033 1.518 2.256 1.518 3.668 0 1.413-.506 2.636-1.518 3.67l-13.814 14.105v23.975h17.887c1.383 0 2.58.516 3.593 1.55 1.011 1.033 1.517 2.256 1.517 3.668l-.005.01zM89.552 26.175H38.448c0-7.23 2.489-13.386 7.466-18.469C50.892 2.623 56.92.082 64 .082c7.08 0 13.108 2.541 18.086 7.624 4.977 5.083 7.466 11.24 7.466 18.469z\\\" /&gt;&lt;/symbol&gt;\"\n&#125;);\nvar result = svg_sprite_loader_runtime_browser_sprite_build__WEBPACK_IMPORTED_MODULE_1___default.a.add(symbol);\n/* harmony default export */ __webpack_exports__[\"default\"] = (symbol);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaWNvbnMvc3ZnL2J1Zy5zdmcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvaWNvbnMvc3ZnL2J1Zy5zdmc/MjI4NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3ByaXRlU3ltYm9sIGZyb20gXCJzdmctYmFrZXItcnVudGltZS9icm93c2VyLXN5bWJvbFwiO1xuaW1wb3J0IHNwcml0ZSBmcm9tIFwic3ZnLXNwcml0ZS1sb2FkZXIvcnVudGltZS9icm93c2VyLXNwcml0ZS5idWlsZFwiO1xudmFyIHN5bWJvbCA9IG5ldyBTcHJpdGVTeW1ib2woe1xuICBcImlkXCI6IFwiaWNvbi1idWdcIixcbiAgXCJ1c2VcIjogXCJpY29uLWJ1Zy11c2FnZVwiLFxuICBcInZpZXdCb3hcIjogXCIwIDAgMTI4IDEyOFwiLFxuICBcImNvbnRlbnRcIjogXCI8c3ltYm9sIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCIgdmlld0JveD1cXFwiMCAwIDEyOCAxMjhcXFwiIGlkPVxcXCJpY29uLWJ1Z1xcXCI+PHBhdGggZD1cXFwiTTEyNy44OCA3My4xNDNjMCAxLjQxMi0uNTA2IDIuNjM1LTEuNTE4IDMuNjY5LTEuMDExIDEuMDMzLTIuMjA5IDEuNTUtMy41OTIgMS41NWgtMTcuODg3YzAgOS4yOTYtMS43ODMgMTcuMTc4LTUuMzUgMjMuNjQ1bDE2LjYwOSAxNy4wNDRjMS4wMTEgMS4wMzQgMS41MTcgMi4yNTcgMS41MTcgMy42NyAwIDEuNDEyLS41MDYgMi42MzUtMS41MTcgMy42NjgtLjk1OCAxLjAzMy0yLjE1NSAxLjU1LTMuNTkzIDEuNTUtMS40MzggMC0yLjYzNS0uNTE3LTMuNTkzLTEuNTVsLTE1LjgxMS0xNi4wNjNhMTUuNDkgMTUuNDkgMCAwIDEtMS4xOTYgMS4wNmMtLjUzMi40MzQtMS42NSAxLjIwOC0zLjM1MyAyLjMyMmE1MC4xMDQgNTAuMTA0IDAgMCAxLTUuMTkyIDIuOTc0Yy0xLjc1OC44Ny0zLjk0IDEuNjU4LTYuNTQ2IDIuMzY0LTIuNjA3LjcwNi01LjE4OSAxLjA2LTcuNzQ4IDEuMDZWNDcuMDQ0SDU4Ljg5djczLjA2MmMtMi43MTYgMC01LjQxNy0uMzY3LTguMTA2LTEuMTAyLTIuNjg4LS43MzQtNS4wMDMtMS42MzEtNi45NDUtMi42OTJhNjYuNzY5IDY2Ljc2OSAwIDAgMS01LjI2OC0zLjE3OWMtMS41NzEtMS4wNTctMi43My0xLjk0LTMuNDc2LTIuNjVMMzMuOSAxMDkuMzRsLTE0LjYxMSAxNi44NzdjLTEuMDY2IDEuMTQtMi4zNDQgMS43MTEtMy44MzMgMS43MTEtMS4yNzcgMC0yLjQyMi0uNDM0LTMuNDM0LTEuMzA0LTEuMDEyLS45NzgtMS41NTctMi4xODctMS42MzUtMy42MjctLjA3OS0xLjQ0LjMzMy0yLjcwNSAxLjIzNi0zLjc5NGwxNi4xMjktMTguNTFjLTMuMDg3LTYuMTk3LTQuNjMtMTMuNjQ0LTQuNjMtMjIuMzQySDUuMjM1Yy0xLjM4MyAwLTIuNTgtLjUxNy0zLjU5Mi0xLjU1Uy4xMjUgNzQuNTQ1LjEyNSA3My4xMzJjMC0xLjQxMi41MDYtMi42MzUgMS41MTgtMy42NjggMS4wMTItMS4wMzQgMi4yMS0xLjU1IDMuNTkyLTEuNTVoMTcuODg3VjQzLjkzOUw5LjMwOCAyOS44MzNjLTEuMDEyLTEuMDMzLTEuNTE3LTIuMjU2LTEuNTE3LTMuNjY5IDAtMS40MTIuNTA1LTIuNjM1IDEuNTE3LTMuNjY4IDEuMDEyLTEuMDM0IDIuMjEtMS41NSAzLjU5My0xLjU1czIuNTguNTE2IDMuNTkzIDEuNTVsMTMuODEzIDE0LjEwNmg2Ny4zOTZsMTMuODE0LTE0LjEwNmMxLjAxMi0xLjAzNCAyLjIxLTEuNTUgMy41OTItMS41NSAxLjM4NCAwIDIuNTgxLjUxNiAzLjU5MyAxLjU1IDEuMDEyIDEuMDMzIDEuNTE4IDIuMjU2IDEuNTE4IDMuNjY4IDAgMS40MTMtLjUwNiAyLjYzNi0xLjUxOCAzLjY3bC0xMy44MTQgMTQuMTA1djIzLjk3NWgxNy44ODdjMS4zODMgMCAyLjU4LjUxNiAzLjU5MyAxLjU1IDEuMDExIDEuMDMzIDEuNTE3IDIuMjU2IDEuNTE3IDMuNjY4bC0uMDA1LjAxek04OS41NTIgMjYuMTc1SDM4LjQ0OGMwLTcuMjMgMi40ODktMTMuMzg2IDcuNDY2LTE4LjQ2OUM1MC44OTIgMi42MjMgNTYuOTIuMDgyIDY0IC4wODJjNy4wOCAwIDEzLjEwOCAyLjU0MSAxOC4wODYgNy42MjQgNC45NzcgNS4wODMgNy40NjYgMTEuMjQgNy40NjYgMTguNDY5elxcXCIgLz48L3N5bWJvbD5cIlxufSk7XG52YXIgcmVzdWx0ID0gc3ByaXRlLmFkZChzeW1ib2wpO1xuZXhwb3J0IGRlZmF1bHQgc3ltYm9sIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/icons/svg/bug.svg\n"</span>);</span><br><span class="line"></span><br><span class="line">/***/ &#125;)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åœ¨JSä¸­ä½¿ç”¨svgæ ‡ç­¾æ¥åŠ è½½å¯¹åº”çš„svgæ–‡ä»¶çš„æ—¶å€™åªéœ€è¦åœ¨svgæ ‡ç­¾åŠ å…¥use ç„¶åç»™idå±æ€§èµ‹å€¼ä¸ºå¯¹åº”symbolçš„idï¼Œæ¯”å¦‚<code>id=&quot;#icon-404&quot;</code></p>
]]></content>
  </entry>
  <entry>
    <title>å·¥å…·å‡½æ•°</title>
    <url>/2019/09/16/toolFunc/</url>
    <content><![CDATA[<h3 id="é˜²æŠ–"><a href="#é˜²æŠ–" class="headerlink" title="é˜²æŠ–"></a>é˜²æŠ–</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function debounce(func, wait) &#123;</span><br><span class="line">    let timeout = null;</span><br><span class="line">    return function () &#123;</span><br><span class="line">        let context = this;</span><br><span class="line">        let args = arguments;</span><br><span class="line"></span><br><span class="line">        if (timeout) &#123;</span><br><span class="line">          clearTimeout(timeout);</span><br><span class="line">          timeout = null;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        timeout = setTimeout(() =&gt; &#123;</span><br><span class="line">            func.apply(context, args);</span><br><span class="line">        &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="èŠ‚æµ"><a href="#èŠ‚æµ" class="headerlink" title="èŠ‚æµ"></a>èŠ‚æµ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function throttle(func, wait) &#123;</span><br><span class="line">    let previous = 0;</span><br><span class="line">    return function() &#123;</span><br><span class="line">        let now = Date.now();</span><br><span class="line">        let context = this;</span><br><span class="line">        let args = arguments;</span><br><span class="line">        if (now - previous &gt; wait) &#123;</span><br><span class="line">            func.apply(context, args);</span><br><span class="line">            previous = now;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„"></a>åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let arr=[];</span><br><span class="line">Array.isArray(arr);</span><br><span class="line">//or</span><br><span class="line">Object.prototype.toString.call(arr) === &apos;[Object Array]&apos;;</span><br></pre></td></tr></table></figure>

<h3 id="æ—¶é—´æˆ³è½¬å­—ç¬¦ä¸²"><a href="#æ—¶é—´æˆ³è½¬å­—ç¬¦ä¸²" class="headerlink" title="æ—¶é—´æˆ³è½¬å­—ç¬¦ä¸²"></a>æ—¶é—´æˆ³è½¬å­—ç¬¦ä¸²</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function getTime(_time,joiner,joiner2)&#123;</span><br><span class="line">  if(!time)&#123;</span><br><span class="line">    return &apos;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  let time = new Date(_time);</span><br><span class="line">  const year = time.getFullYear();//è·å–å¹´ä»½</span><br><span class="line">  const month = time.getMonth()+1;//get the month of the time</span><br><span class="line">  const date = time.getDate()&lt;10 ? &apos;0&apos;+time.getDate():time.getDate();//get the day of the time;</span><br><span class="line">  const hour = time.getHours();</span><br><span class="line">  const minute = time.getMinutes();</span><br><span class="line">  const seconds = time.getSeconds();</span><br><span class="line">  const result = `$&#123;year&#125;$&#123;joiner&#125;$&#123;month&#125;$&#123;joiner&#125;$&#123;date&#125;  $&#123;hour&#125;$&#123;joiner2&#125;$&#123;minute&#125;$&#123;joiner2&#125;$&#123;seconds&#125;`;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ·±åˆå¹¶"><a href="#æ·±åˆå¹¶" class="headerlink" title="æ·±åˆå¹¶"></a>æ·±åˆå¹¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> * @see merge</span><br><span class="line"> * @param &#123;Object&#125; obj1 Object to merge</span><br><span class="line"> * @returns &#123;Object&#125; Result of all merge properties</span><br><span class="line"> */</span><br><span class="line">function deepMerge(/* obj1, obj2, obj3, ... */) &#123;</span><br><span class="line">  var result = &#123;&#125;;</span><br><span class="line">  function assignValue(val, key) &#123;</span><br><span class="line">    if (typeof result[key] === &apos;object&apos; &amp;&amp; typeof val === &apos;object&apos;) &#123;</span><br><span class="line">      result[key] = deepMerge(result[key], val);</span><br><span class="line">    &#125; else if (typeof val === &apos;object&apos;) &#123;</span><br><span class="line">      result[key] = deepMerge(&#123;&#125;, val);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      result[key] = val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  for (var i = 0, l = arguments.length; i &lt; l; i++) &#123;</span><br><span class="line">    forEach(arguments[i], assignValue);</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const matchTime = /(?&lt;=\s+\-\s+)(.)+|(.)+(?=\s+\-\s+)/g;//å°†xxå¹´xxæœˆxxæ—¥-xxå¹´xxæœˆxxæ—¥çš„æ—¶é—´æ ¼å¼åˆ‡å‰²</span><br><span class="line">const regx_positiveInt = /^[0-9]*[1-9][0-9]*$/; //æ­£æ•´æ•°</span><br><span class="line">const regx_positiveAndZeroInt = /^\d+$/; //éè´Ÿæ•´æ•°ï¼ˆæ­£æ•´æ•°å’Œ0ï¼‰</span><br><span class="line">const regx_number = /^[0-9]*$/;//æ•°å­—</span><br><span class="line">const regx_ip=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.)&#123;3&#125;(25[0-5]|2[0-4]\d|[01]?\d\d?)$/;//IPåœ°å€</span><br></pre></td></tr></table></figure>

<h3 id="å¤§æ•°ç›¸åŠ "><a href="#å¤§æ•°ç›¸åŠ " class="headerlink" title="å¤§æ•°ç›¸åŠ "></a>å¤§æ•°ç›¸åŠ </h3><p>ç”±äºJavaScriptä¸­ä¸ç®¡æ•´æ•°è¿˜æ˜¯å°æ•°éƒ½æ˜¯Numberç±»å‹ï¼Œå®ƒçš„å®ç°æ˜¯éµå¾ª IEEE 754æ ‡å‡†ï¼Œå‚¨å­˜æ–¹å¼æ˜¯ä»¥åŒç²¾åº¦æµ®ç‚¹æ•°å‚¨å­˜çš„ï¼Œå¯ä»¥è¡¨ç¤ºåè¿›åˆ¶çš„15æˆ–è€…16ä½æœ‰æ•ˆæ•°å­—ï¼Œæ‰€ä»¥å½“è¿›è¡Œè¿ç®—çš„æ•°å­—è¶…è¿‡è¿™ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œå°±ä¼šç”¨æœ‰ç²¾åº¦ç¼ºå¤±çš„é—®é¢˜ï¼Œå¯¼è‡´è®¡ç®—ä¸å‡†ç¡®ï¼Œæ‰€ä»¥åœ¨å¤§æ•°åŠ å‡çš„æ—¶å€™éœ€è¦è½¬æˆå­—ç¬¦ä¸²æ¥åšï¼Œæˆ–è€…es6+æœ‰ä¸ªBigIntç±»å‹ä¹Ÿæ”¯æŒåšå¤§æ•°åŠ å‡ï¼Œæˆ–è€…å¯ä»¥é€‰æ‹©npmä¸Šçš„å¤§æ•°åŠ å‡æ’ä»¶ï¼Œæ¯”å¦‚number-precision</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var addStrings = function(num1, num2) &#123;</span><br><span class="line">  const maxLen = Math.max.apply(null, [num1.length, num2.length]);</span><br><span class="line">  let result = &quot;&quot;;</span><br><span class="line">  let ans = 0;</span><br><span class="line">  if(num1.length&lt;maxLen)&#123;</span><br><span class="line">      num1 = num1.padStart(maxLen, &quot;0&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  if(num2.length&lt;maxLen)&#123;</span><br><span class="line">      num2 = num2.padStart(maxLen, &quot;0&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  for (let i = maxLen - 1; i &gt;= 0; --i) &#123;</span><br><span class="line">    const temp =ans+Number(num1[i]) + Number(num2[i]);</span><br><span class="line">    result=(temp % 10)+result;</span><br><span class="line">    ans = Math.floor(temp / 10);</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(result);</span><br><span class="line">  return ans===1?ans+ result:result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ·±å…‹éš†"><a href="#æ·±å…‹éš†" class="headerlink" title="æ·±å…‹éš†"></a>æ·±å…‹éš†</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const isObject = (item)=&gt;&#123;</span><br><span class="line">  return Object.prototype.toString.call(item) === &apos;[object Object]&apos;;</span><br><span class="line">&#125;</span><br><span class="line">const isArray = (item)=&gt;&#123;</span><br><span class="line">  return Object.prototype.toString.call(item) === &apos;[object Array]&apos;;</span><br><span class="line">&#125;</span><br><span class="line">const isDate = item =&gt;&#123;</span><br><span class="line">  return Object.prototype.toString.call(item) === &apos;[object Date]&apos;;</span><br><span class="line">&#125;</span><br><span class="line">const isFunction = item =&gt;&#123;</span><br><span class="line">  return Object.prototype.toString.call(item) === &apos;[object Function]&apos;;</span><br><span class="line">&#125;</span><br><span class="line">const deepClone=function(obj)&#123;</span><br><span class="line">    const cloneObj=isArray(obj)?[]:isObject(obj)?&#123;&#125;:&apos;&apos;;</span><br><span class="line">    for(let key in obj)&#123;</span><br><span class="line">      if(obj.hasOwnProperty(key))&#123;</span><br><span class="line">        if(isObject(obj[key])||isArray(obj[key]))&#123;</span><br><span class="line">          Object.assign(cloneObj,&#123;</span><br><span class="line">           [key]: deepClone(Reflect.get(obj,key))</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">          cloneObj[key] = obj[key];</span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return cloneObj;</span><br><span class="line">&#125;</span><br><span class="line">function deepCopy(original) &#123;</span><br><span class="line">  if (Array.isArray(original)) &#123;</span><br><span class="line">    return original.map(elem =&gt; deepCopy(elem));</span><br><span class="line">  &#125; else if (typeof original === &apos;object&apos; &amp;&amp; original !== null) &#123;</span><br><span class="line">    return Object.fromEntries(</span><br><span class="line">      Object.entries(original)</span><br><span class="line">        .map(([k, v]) =&gt; [k, deepCopy(v)]));</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // Primitive value: atomic, no need to copy</span><br><span class="line">    return original;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ·±å±‚æ›´æ–°"><a href="#æ·±å±‚æ›´æ–°" class="headerlink" title="æ·±å±‚æ›´æ–°"></a>æ·±å±‚æ›´æ–°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function deepUpdate(original, keys, value) &#123;</span><br><span class="line">  if (keys.length === 0) &#123;</span><br><span class="line">    return value;</span><br><span class="line">  &#125;</span><br><span class="line">  const currentKey = keys[0];</span><br><span class="line">  if (Array.isArray(original)) &#123;</span><br><span class="line">    return original.map(</span><br><span class="line">      (v, index) =&gt; index === currentKey</span><br><span class="line">        ? deepUpdate(v, keys.slice(1), value) // (A)</span><br><span class="line">        : v); // (B)</span><br><span class="line">  &#125; else if (typeof original === &apos;object&apos; &amp;&amp; original !== null) &#123;</span><br><span class="line">    return Object.fromEntries(</span><br><span class="line">      Object.entries(original).map(</span><br><span class="line">        (keyValuePair) =&gt; &#123;</span><br><span class="line">          const [k,v] = keyValuePair;</span><br><span class="line">          if (k === currentKey) &#123;</span><br><span class="line">            return [k, deepUpdate(v, keys.slice(1), value)]; // (C)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            return keyValuePair; // (D)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // Primitive value</span><br><span class="line">    return original;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ·±å±‚å†»ç»“"><a href="#æ·±å±‚å†»ç»“" class="headerlink" title="æ·±å±‚å†»ç»“"></a>æ·±å±‚å†»ç»“</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function deepFreeze(value) &#123;</span><br><span class="line">  if (Array.isArray(value)) &#123;</span><br><span class="line">    for (const element of value) &#123;</span><br><span class="line">      deepFreeze(element);</span><br><span class="line">    &#125;</span><br><span class="line">    Object.freeze(value);</span><br><span class="line">  &#125; else if (typeof value === &apos;object&apos; &amp;&amp; value !== null) &#123;</span><br><span class="line">    for (const v of Object.values(value)) &#123;</span><br><span class="line">      deepFreeze(v);</span><br><span class="line">    &#125;</span><br><span class="line">    Object.freeze(value);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // Nothing to do: primitive values are already immutable</span><br><span class="line">  &#125; </span><br><span class="line">  return value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŸºäºç°æœ‰å¯¹è±¡çš„è‡ªå®šä¹‰æ–¹æ³•"><a href="#åŸºäºç°æœ‰å¯¹è±¡çš„è‡ªå®šä¹‰æ–¹æ³•" class="headerlink" title="åŸºäºç°æœ‰å¯¹è±¡çš„è‡ªå®šä¹‰æ–¹æ³•"></a>åŸºäºç°æœ‰å¯¹è±¡çš„è‡ªå®šä¹‰æ–¹æ³•</h3><p>PS:(ä¸å»ºè®®ç›´æ¥æ±¡æŸ“åŸå‹é“¾ï¼Œç±»å‹Date.prototype.xxx=function(){}è¿™æ ·çš„å†™æ³•)</p>
<p>ä¸ªäººæ¯”è¾ƒå–œæ¬¢å¯„ç”Ÿç»„åˆç»§æ‰¿æˆ–è€…es6çš„calssç»§æ‰¿ï¼Œæ¯”å¦‚è¦å†™ä¸€ä¸ªåŸºäºDateçš„formatæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class DateSelf extends Date&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line">    super();</span><br><span class="line">  &#125;</span><br><span class="line">  getAll(begin,end)&#123;</span><br><span class="line">    let arr=[];</span><br><span class="line">    var ab = begin.split(&quot;-&quot;);</span><br><span class="line">    var ae = end.split(&quot;-&quot;);</span><br><span class="line">    var db = new Date();</span><br><span class="line">    db.setUTCFullYear(ab[0], ab[1] - 1, ab[2]);</span><br><span class="line">    var de = new Date();</span><br><span class="line">    de.setUTCFullYear(ae[0], ae[1] - 1, ae[2]);</span><br><span class="line">    var unixDb = db.getTime();</span><br><span class="line">    var unixDe = de.getTime();</span><br><span class="line">    for (var k = unixDb; k &lt;= unixDe;) &#123;</span><br><span class="line">        // arr.push((new Date(parseInt(k))).format());</span><br><span class="line">        arr.push((DateSelf.formatter(parseInt(k))))</span><br><span class="line">        k = k + 24 * 60 * 60 * 1000;</span><br><span class="line">    &#125;</span><br><span class="line">    return arr;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">DateSelf.formatter=function(time)&#123;</span><br><span class="line">  var s = &apos;&apos;;</span><br><span class="line">  const k =  new Date(time)</span><br><span class="line">  var mouth = (k.getMonth() + 1)&gt;=10?(k.getMonth() + 1):(&apos;0&apos;+(k.getMonth() + 1));</span><br><span class="line">  var day = k.getDate()&gt;=10?k.getDate():(&apos;0&apos;+k.getDate());</span><br><span class="line">  s += k.getFullYear() + &apos;-&apos;; // è·å–å¹´ä»½ã€‚</span><br><span class="line">  s += mouth + &quot;-&quot;; // è·å–æœˆä»½ã€‚</span><br><span class="line">  s += day; // è·å–æ—¥ã€‚</span><br><span class="line">  return (s); // è¿”å›æ—¥æœŸã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­å¯¹è±¡ç±»å‹"><a href="#åˆ¤æ–­å¯¹è±¡ç±»å‹" class="headerlink" title="åˆ¤æ–­å¯¹è±¡ç±»å‹"></a>åˆ¤æ–­å¯¹è±¡ç±»å‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Object.toType = (function toType(global) &#123;</span><br><span class="line">  return function(obj) &#123;</span><br><span class="line">    if (obj === global) &#123;</span><br><span class="line">      return &quot;global&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return (&#123;&#125;).toString.call(obj).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(this)</span><br></pre></td></tr></table></figure>

<h3 id="ç”¨promsieå¼‚æ­¥åŠ è½½å›¾åƒ"><a href="#ç”¨promsieå¼‚æ­¥åŠ è½½å›¾åƒ" class="headerlink" title="ç”¨promsieå¼‚æ­¥åŠ è½½å›¾åƒ"></a>ç”¨promsieå¼‚æ­¥åŠ è½½å›¾åƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">functin load(image,attributes)&#123;</span><br><span class="line">  	if (!image) &#123;</span><br><span class="line">		return Promise.reject();</span><br><span class="line">	&#125; else if (typeof image === &apos;string&apos;) &#123;</span><br><span class="line">		/* Create a &lt;img&gt; from a string */</span><br><span class="line">		const src = image;</span><br><span class="line">		image = new Image();</span><br><span class="line">		Object.keys(attributes || &#123;&#125;).forEach(</span><br><span class="line">			name =&gt; image.setAttribute(name, attributes[name])</span><br><span class="line">		);</span><br><span class="line">		image.src = src;</span><br><span class="line">	&#125; else if (image.length !== undefined) &#123;</span><br><span class="line">		/* Treat as multiple images */</span><br><span class="line"></span><br><span class="line">		// Momentarily ignore errors</span><br><span class="line">		const reflected = [].map.call(image, img =&gt; load(img, attributes).catch(err =&gt; err));</span><br><span class="line"></span><br><span class="line">		return Promise.all(reflected).then(results =&gt; &#123;</span><br><span class="line">			const loaded = results.filter(x =&gt; x.naturalWidth);</span><br><span class="line">			if (loaded.length === results.length) &#123;</span><br><span class="line">				return loaded;</span><br><span class="line">			&#125;</span><br><span class="line">			return Promise.reject(&#123;</span><br><span class="line">				loaded,</span><br><span class="line">				errored: results.filter(x =&gt; !x.naturalWidth)</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125; else if (image.tagName.toUpperCase() !== &apos;IMG&apos;) &#123;</span><br><span class="line">		return Promise.reject();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	const promise = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">		if (image.naturalWidth) &#123;</span><br><span class="line">			// If the browser can determine the naturalWidth the</span><br><span class="line">			// image is already loaded successfully</span><br><span class="line">			resolve(image);</span><br><span class="line">		&#125; else if (image.complete) &#123;</span><br><span class="line">			// If the image is complete but the naturalWidth is 0px</span><br><span class="line">			// it is probably broken</span><br><span class="line">			reject(image);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			image.addEventListener(&apos;load&apos;, fulfill);</span><br><span class="line">			image.addEventListener(&apos;error&apos;, fulfill);</span><br><span class="line">		&#125;</span><br><span class="line">		function fulfill() &#123;</span><br><span class="line">			if (image.naturalWidth) &#123;</span><br><span class="line">				resolve(image);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				reject(image);</span><br><span class="line">			&#125;</span><br><span class="line">			image.removeEventListener(&apos;load&apos;, fulfill);</span><br><span class="line">			image.removeEventListener(&apos;error&apos;, fulfill);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	promise.image = image;</span><br><span class="line">	return promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–ç±»å‹"><a href="#è·å–ç±»å‹" class="headerlink" title="è·å–ç±»å‹"></a>è·å–ç±»å‹</h3><p>({}).toString.call(obj) çš„ç”¨æ³•ä¸ Object.prototype.toString.call(obj)ä¸€æ ·ã€‚è¿™ä¸¤ä¸ªè¿”å›çš„æ ¼å¼æ˜¯[object [class]].</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const toType = (obj) =&gt;&#123;</span><br><span class="line">   return (&#123;&#125;).toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()</span><br><span class="line">&#125;</span><br><span class="line">toType(&#123;a: 4&#125;); //&quot;object&quot;</span><br><span class="line">toType([1, 2, 3]); //&quot;array&quot;</span><br><span class="line">(function() &#123;console.log(toType(arguments))&#125;)(); //arguments</span><br><span class="line">toType(new ReferenceError); //&quot;error&quot;</span><br><span class="line">toType(new Date); //&quot;date&quot;</span><br><span class="line">toType(/a-z/); //&quot;regexp&quot;</span><br><span class="line">toType(Math); //&quot;math&quot;</span><br><span class="line">toType(JSON); //&quot;json&quot;</span><br><span class="line">toType(new Number(4)); //&quot;number&quot;</span><br><span class="line">toType(new String(&quot;abc&quot;)); //&quot;string&quot;</span><br><span class="line">toType(new Boolean(true)); //&quot;boolean&quot;</span><br><span class="line"></span><br><span class="line">//typeof ä¹Ÿå¯ä»¥åˆ¤æ–­ç±»å‹,ä½†æ˜¯åªèƒ½è·å–åŸºæœ¬ç±»å‹ï¼Œå¼•ç”¨ç±»å‹ç»Ÿä¸€è¿”å›objectï¼Œæ‰€ä»¥å°½é‡ç”¨toTypeçš„æ–¹æ³•;instanceofä¹Ÿå¯ä»¥,ç„¶é¹…instanceofæ˜¯åŸºäºåŸå‹é“¾åˆ¤æ–­çš„ï¼Œå¦‚æœç»§æ‰¿çš„è¯</span><br><span class="line">  class MyArray extends Array&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">      super()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const myArray = new MyArray();</span><br><span class="line">  console.log(`Array: $&#123;myArray instanceof Array&#125;`);</span><br><span class="line">  console.log(`MyArray :$&#123;myArray instanceof MyArray&#125;`);</span><br><span class="line">  //è¿™æ ·ä¸¤ä¸ªè¿”å›çš„éƒ½æ˜¯true</span><br></pre></td></tr></table></figure>

<p>å‡ ä¸ªå†…ç½®å¯¹è±¡æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œå› æ­¤ä¸èƒ½ç”¨instanceofæ¥åˆ¤æ–­ç±»å‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math instanceof Math //TypeError</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªwindowå¯ä»¥åŒ…å«å¤šä¸ªiframeæ¡†æ¶ï¼Œæ„å‘³ç€åŒ…å«å¤šä¸ªå…¨å±€ä¸Šä¸‹æ–‡ï¼Œå› æ­¤æ„å‘³ç€æ¯ä¸ªç±»å‹æœ‰å¤šä¸ªæ„é€ å™¨ï¼Œåœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹ï¼Œç»™å®šçš„å¯¹è±¡ç±»å‹ä¸èƒ½ä¿è¯æ˜¯ç»™å®šçš„æ„é€ å‡½æ•°çš„å®ä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const ifFrame = document.createElement(&apos;iframe&apos;);</span><br><span class="line">document.body.appendChild(ifFrame);</span><br><span class="line">const IFrameArray = window.frames[1].Array; </span><br><span class="line">const array = new IFrameArray();</span><br><span class="line"></span><br><span class="line">array instanceof IFrameArray //true</span><br><span class="line">array instanceof Array // false</span><br></pre></td></tr></table></figure>

<p>ç”±äºarrayçš„constructoræ˜¯iframeä¸­çš„Array,å› æ­¤å³ä½¿array ä¸ æ­¤æ—¶çš„windowä¸Šä¸‹æ–‡ä¸­çš„Arrayéƒ½æ˜¯æ•°ç»„èŒƒç•´ï¼Œä½†æ˜¯instanceofæ˜¯åŸºäºåŸå‹é“¾æ¥åˆ¤æ–­çš„ï¼Œarrayçš„åŸå‹é“¾æ˜¯å¹¶æ²¡æœ‰æŒ‡å‘å½“å‰windowä¸‹çš„Array,å› æ­¤array instanceof Array ä¸º false</p>
<p>ä¹‹å‰çš„toTypeæœ‰ä¸ªé—®é¢˜,å½“toTypeçš„ä¼ å‚æ˜¯window,windowå†…ç½®æ–¹æ³•ä»¥åŠDOMæ—¶ï¼Œæœ‰å¾ˆé•¿ä¸€ä¸²çš„ç»“æœè¿”å›æ—¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">toType(window);</span><br><span class="line">//&quot;global&quot; (Chrome) &quot;domwindow&quot; (Safari) &quot;window&quot; (FF/IE9) &quot;object&quot; (IE7/IE8)</span><br><span class="line"> </span><br><span class="line">toType(document);</span><br><span class="line">//&quot;htmldocument&quot; (Chrome/FF/Safari) &quot;document&quot; (IE9) &quot;object&quot; (IE7/IE8)</span><br><span class="line"> </span><br><span class="line">toType(document.createElement(&apos;a&apos;));</span><br><span class="line">//&quot;htmlanchorelement&quot; (Chrome/FF/Safari/IE) &quot;object&quot; (IE7/IE8)</span><br><span class="line"> </span><br><span class="line">toType(alert);</span><br><span class="line">//&quot;function&quot; (Chrome/FF/Safari/IE9) &quot;object&quot; (IE7/IE8)</span><br></pre></td></tr></table></figure>

<p>æ”¹è¿›ä¸€ä¸‹toTypeæ–¹æ³•,å°†è¿™ä¸ªæ–¹æ³•æŒ‚è½½åˆ°Objectä¸Š,ä½†æ˜¯ä¸è¦æŒ‚è½½åˆ°prototypeä¸Šï¼Œå°†è¿™ä¸ªæ–¹æ³•å†™æˆIIFE+é—­åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Object.toType = (function toType(global) &#123;</span><br><span class="line">  return function(obj) &#123;</span><br><span class="line">    if (obj === global) &#123;</span><br><span class="line">      return &quot;global&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return (&#123;&#125;).toString.call(obj).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(this)</span><br><span class="line">Object.toType(window); //&quot;global&quot; (all browsers)</span><br><span class="line">Object.toType([1,2,3]); //&quot;array&quot; (all browsers)</span><br><span class="line">Object.toType(/a-z/); //&quot;regexp&quot; (all browsers)</span><br><span class="line">Object.toType(JSON); //&quot;json&quot; (all browsers)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„,å¦‚æœæ‰”è¿›æ¥ä¸€ä¸ªæœªçŸ¥ç±»å‹,åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Object.toType(fff)//ReferenceError</span><br></pre></td></tr></table></figure>

<p>ç©ä¸ªå¥½ç©çš„ï¼Œåº”è¯¥å¯ä»¥ç”¨å…·åç»„åŒ¹é…æ¥è·å–ç±»å‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Object.toType = (function(global)&#123;</span><br><span class="line">    const reg = /(?&lt;type&gt;(?&lt;=\s+?)[A-Za-z]+)/;</span><br><span class="line">    return function(obj)&#123;</span><br><span class="line">      if(obj === global)&#123;</span><br><span class="line">          return &apos;global&apos;;</span><br><span class="line">      &#125;</span><br><span class="line">      const matchObj = reg.exec(Object.prototype.toString.call(obj));</span><br><span class="line">      const type =  matchObj.groups.type;</span><br><span class="line">      return type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(this)</span><br></pre></td></tr></table></figure>

<h3 id="takeRightWhile"><a href="#takeRightWhile" class="headerlink" title="takeRightWhile"></a>takeRightWhile</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const takeRightWhile = (arr, func) =&gt;</span><br><span class="line">  arr.reduceRight((acc, el) =&gt; (func(el) ? acc : [el, ...acc]), []);</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">takeRightWhile([1, 2, 3, 4], n =&gt; n &lt; 3); // [3, 4]</span><br></pre></td></tr></table></figure>

<h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const zip = (...arrays) =&gt; &#123;</span><br><span class="line">  const maxLength = Math.max(...arrays.map(x =&gt; x.length));</span><br><span class="line">  return Array.from(&#123; length: maxLength &#125;).map((_, i) =&gt; &#123;</span><br><span class="line">    return Array.from(&#123; length: arrays.length &#125;, (_, k) =&gt; arrays[k][i]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zip([&apos;a&apos;, &apos;b&apos;], [1, 2], [true, false]); // [[&apos;a&apos;, 1, true], [&apos;b&apos;, 2, false]]</span><br><span class="line">zip([&apos;a&apos;], [1, 2], [true, false]); // [[&apos;a&apos;, 1, true], [undefined, 2, false]]</span><br></pre></td></tr></table></figure>

<h3 id="èšåˆå‡½æ•°"><a href="#èšåˆå‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°"></a>èšåˆå‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//å•ä¸ªå‚æ•°</span><br><span class="line">const pipe = (...fns) =&gt; x =&gt; &#123;</span><br><span class="line">    return fns.reduceRight((v,fn)=&gt;&#123;</span><br><span class="line">       return fn(v);</span><br><span class="line">    &#125;,x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const square = v =&gt; v+1;</span><br><span class="line">const double = v =&gt; v+2;</span><br><span class="line">const addOne = v =&gt; v+3;</span><br><span class="line"></span><br><span class="line">const res = pipe(square,double,addOne);</span><br><span class="line">res(3)//9</span><br></pre></td></tr></table></figure>

<h3 id="elementIsVisibleInViewport"><a href="#elementIsVisibleInViewport" class="headerlink" title="elementIsVisibleInViewport"></a>elementIsVisibleInViewport</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const elementIsVisibleInViewport = (el, partiallyVisible = false) =&gt; &#123;</span><br><span class="line">  const &#123; top, left, bottom, right &#125; = el.getBoundingClientRect();</span><br><span class="line">  const &#123; innerHeight, innerWidth &#125; = window;</span><br><span class="line">  return partiallyVisible</span><br><span class="line">    ? ((top &gt; 0 &amp;&amp; top &lt; innerHeight) || (bottom &gt; 0 &amp;&amp; bottom &lt; innerHeight)) &amp;&amp;</span><br><span class="line">        ((left &gt; 0 &amp;&amp; left &lt; innerWidth) || (right &gt; 0 &amp;&amp; right &lt; innerWidth))</span><br><span class="line">    : top &gt;= 0 &amp;&amp; left &gt;= 0 &amp;&amp; bottom &lt;= innerHeight &amp;&amp; right &lt;= innerWidth;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">elementIsVisibleInViewport(el); // false - (not fully visible)</span><br><span class="line">elementIsVisibleInViewport(el, true); // true - (partially visible)</span><br></pre></td></tr></table></figure>

<h3 id="èšåˆå‡½æ•°-2"><a href="#èšåˆå‡½æ•°-2" class="headerlink" title="èšåˆå‡½æ•°(2)"></a>èšåˆå‡½æ•°(2)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//ç¬¬ä¸€ä¸ªå‡½æ•°å…è®¸å¤šä¸ªå‚æ•°ï¼Œå‰©ä½™å‡½æ•°ä»…å…è®¸ä¸€ä¸ªå‚æ•°</span><br><span class="line">const composeRight = (...fns) =&gt; fns.reduce((f,g)=&gt;(...args)=&gt;g(f(...args)));</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const add =(x,y) =&gt; x+y;</span><br><span class="line">const square = x =&gt; x**2;</span><br><span class="line">const addAndSquare = composeRight(add,square);</span><br></pre></td></tr></table></figure>

<h3 id="uniqueSymmetricDifference"><a href="#uniqueSymmetricDifference" class="headerlink" title="uniqueSymmetricDifference"></a>uniqueSymmetricDifference</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const uniqueSymmetricDifference = (a, b) =&gt; [</span><br><span class="line">  ...new Set([...a.filter(v =&gt; !b.includes(v)), ...b.filter(v =&gt; !a.includes(v))])</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uniqueSymmetricDifference([1, 2, 3], [1, 2, 4]); // [3, 4]</span><br></pre></td></tr></table></figure>

<h3 id="è·å–é•¿åº¦"><a href="#è·å–é•¿åº¦" class="headerlink" title="è·å–é•¿åº¦"></a>è·å–é•¿åº¦</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const size = val =&gt;</span><br><span class="line">    Array.isArray(val)</span><br><span class="line">        ? val.length</span><br><span class="line">        : val &amp;&amp; typeof val === &apos;object&apos;</span><br><span class="line">        ? val.size || val.length || Object.keys(val).length</span><br><span class="line">        : typeof val === &apos;string&apos;</span><br><span class="line">            ? new Blob([val]).size</span><br><span class="line">            : 0;</span><br></pre></td></tr></table></figure>

<h3 id="initialArrayWithRangeRight"><a href="#initialArrayWithRangeRight" class="headerlink" title="initialArrayWithRangeRight"></a>initialArrayWithRangeRight</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const initialArrayWithRangeRight = (end,start = 0, step = 1) =&gt; &#123;</span><br><span class="line">    return Array.from(&#123;length:Math.ceil(end-start+1)/step&#125;).map((v,i,arr)=&gt;&#123;</span><br><span class="line">        return (arr.length-i-1)*step+start;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">initialArrayWithRangeRight(5)// [5,4,3,2,1,0]</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºåŠ å¯†hash"><a href="#åˆ›å»ºåŠ å¯†hash" class="headerlink" title="åˆ›å»ºåŠ å¯†hash"></a>åˆ›å»ºåŠ å¯†hash</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const hashBrowser = val =&gt;</span><br><span class="line">  crypto.subtle.digest(&apos;SHA-256&apos;, new TextEncoder(&apos;utf-8&apos;).encode(val)).then(h =&gt; &#123;</span><br><span class="line">    let hexes = [],</span><br><span class="line">      view = new DataView(h);</span><br><span class="line">    for (let i = 0; i &lt; view.byteLength; i += 4)</span><br><span class="line">      hexes.push((&apos;00000000&apos; + view.getUint32(i).toString(16)).slice(-8));</span><br><span class="line">    return hexes.join(&apos;&apos;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashBrowser(JSON.stringify(&#123; a: &apos;a&apos;, b: [1, 2, 3, 4], foo: &#123; c: &apos;bar&apos; &#125; &#125;)).then(console.log); // &apos;04aa106279f5977f59f9067fa9712afc4aedc6f5862a8defc34552d8c7206393&apos;</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰äº‹ä»¶"><a href="#è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰äº‹ä»¶"></a>è‡ªå®šä¹‰äº‹ä»¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const triggerEvnet = (el,eventType,detail) =&gt; el.dispatchEvent(new CustomEvent(eventType,detail));</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">triggerEvnet(document.getElementById(&apos;id&apos;),&apos;click&apos;);//è§¦å‘å‰éœ€è¦å…ˆæ³¨å†Œæ–¹æ³•ï¼ŒaddEventListeneræˆ–è€…attachEvent</span><br></pre></td></tr></table></figure>

<h3 id="isWritableStream"><a href="#isWritableStream" class="headerlink" title="isWritableStream"></a>isWritableStream</h3><p>æ£€æŸ¥ç»™å®šå‚æ•°æ˜¯å¦æ˜¯å¯å†™çš„æµä½“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const isWriteable = val =&gt; val !== null &amp;&amp;</span><br><span class="line">  typeof val === &apos;object&apos; &amp;&amp;</span><br><span class="line">  typeof val.pipe === &apos;function&apos; &amp;&amp;</span><br><span class="line">  typeof val._write === &apos;function&apos; &amp;&amp;</span><br><span class="line">  typeof val._writableState === &apos;object&apos;;</span><br></pre></td></tr></table></figure>

<p>Nodeç¯å¢ƒä¸­ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">isWritableStream(fs.createWriteStream(&apos;test.txt&apos;)); // true</span><br></pre></td></tr></table></figure>

<h3 id="æ‰“ä¹±æ•°ç»„é¡ºåº"><a href="#æ‰“ä¹±æ•°ç»„é¡ºåº" class="headerlink" title="æ‰“ä¹±æ•°ç»„é¡ºåº"></a>æ‰“ä¹±æ•°ç»„é¡ºåº</h3><p>æ´—ç‰Œç®—æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const shuffle = (arr) =&gt; &#123;</span><br><span class="line">  let m = arr.length;</span><br><span class="line">  while(m)&#123;</span><br><span class="line">    const i = Math.floor(Math.random()*m--);</span><br><span class="line">    [arr[i],arr[m]] =[arr[m],arr[i]]; </span><br><span class="line">  &#125;</span><br><span class="line">  return arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>tool</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜é›…çš„ä¹¦å†™æ–¹å¼</title>
    <url>/2019/10/27/usage-for-better/</url>
    <content><![CDATA[<h3 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//å˜é‡å£°æ˜ç”¨let or const</span><br><span class="line">let a = 1;</span><br><span class="line">const b = 2;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="å¯¹è±¡å±æ€§èµ‹å€¼"><a href="#å¯¹è±¡å±æ€§èµ‹å€¼" class="headerlink" title="å¯¹è±¡å±æ€§èµ‹å€¼"></a>å¯¹è±¡å±æ€§èµ‹å€¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const getKey(key)&#123;</span><br><span class="line">  return `a key named $&#123;key&#125;`</span><br><span class="line">&#125;</span><br><span class="line">//ä½¿ç”¨åŠ¨æ€å±æ€§ä½œä¸ºé”®åï¼Œç”¨è®¡ç®—åçš„å±æ€§</span><br><span class="line">const obj=&#123;</span><br><span class="line">  id:1,</span><br><span class="line">  name:&apos;John&apos;,</span><br><span class="line">  [getKey(&apos;enable&apos;)]:&apos;Tom&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”®åä¸é”®å€¼çš„å˜é‡åç›¸åŒï¼Œä¸éœ€è¦å†™ä¸¤é"><a href="#é”®åä¸é”®å€¼çš„å˜é‡åç›¸åŒï¼Œä¸éœ€è¦å†™ä¸¤é" class="headerlink" title="é”®åä¸é”®å€¼çš„å˜é‡åç›¸åŒï¼Œä¸éœ€è¦å†™ä¸¤é"></a>é”®åä¸é”®å€¼çš„å˜é‡åç›¸åŒï¼Œä¸éœ€è¦å†™ä¸¤é</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const name = &apos;John&apos;;</span><br><span class="line">const obj = &#123;</span><br><span class="line">  name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¯¹è±¡æ•°æ®åˆ†ç»„æ’åº"><a href="#å¯¹è±¡æ•°æ®åˆ†ç»„æ’åº" class="headerlink" title="å¯¹è±¡æ•°æ®åˆ†ç»„æ’åº"></a>å¯¹è±¡æ•°æ®åˆ†ç»„æ’åº</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//è§£æ„èµ‹å€¼çš„æ’å‰é¢</span><br><span class="line">const name = &apos;John&apos;,age=2, grade = 80;</span><br><span class="line">const obj = &#123;</span><br><span class="line">  name,</span><br><span class="line">  age,</span><br><span class="line">  level:grade</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å±æ€§å£°æ˜"><a href="#å±æ€§å£°æ˜" class="headerlink" title="å±æ€§å£°æ˜"></a>å±æ€§å£°æ˜</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//é”®åå£°æ˜ä¸éœ€è¦å†™å¼•å·,ä»…æœ‰æ— æ•ˆæ ‡è¯†ç¬¦éœ€è¦åŠ å¼•å·</span><br><span class="line">const obj = &#123;</span><br><span class="line">  a:1,</span><br><span class="line">  &apos;data-self:true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸è¦ç›´æ¥è°ƒç”¨Object-prototypeçš„æ–¹æ³•ï¼Œæ¯”å¦‚hasOwnProperty"><a href="#ä¸è¦ç›´æ¥è°ƒç”¨Object-prototypeçš„æ–¹æ³•ï¼Œæ¯”å¦‚hasOwnProperty" class="headerlink" title="ä¸è¦ç›´æ¥è°ƒç”¨Object.prototypeçš„æ–¹æ³•ï¼Œæ¯”å¦‚hasOwnProperty"></a>ä¸è¦ç›´æ¥è°ƒç”¨Object.prototypeçš„æ–¹æ³•ï¼Œæ¯”å¦‚hasOwnProperty</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const obj = &#123;</span><br><span class="line">  a:1</span><br><span class="line">&#125;</span><br><span class="line">//ä¸è¦ç›´æ¥ç”¨ojb.hasOwnProperty(Do not use obj.hasOwnProperty directly)</span><br><span class="line"></span><br><span class="line">Object.prototype.hasOwnProperty.call(obj,key)//use Object.prototype.call instead</span><br><span class="line">//or</span><br><span class="line">const has = Object.prototype.hasOwnProperty;</span><br><span class="line">has.call(obj,key)//</span><br></pre></td></tr></table></figure>

<h3 id="use-the-object-spread-operator-instead-of-Object-assign-to-shallow-copy-objects"><a href="#use-the-object-spread-operator-instead-of-Object-assign-to-shallow-copy-objects" class="headerlink" title="use the object spread operator instead of Object.assign to shallow-copy objects"></a>use the object spread operator instead of Object.assign to shallow-copy objects</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const obj = &#123;</span><br><span class="line">  name:&apos;Tom&apos;</span><br><span class="line">&#125;</span><br><span class="line">const cloneObj =&#123;...obj,age:1&#125;//cloneObj -&gt; &#123;name:&apos;Tom&apos;,age:1&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-spread-operator-to-copy-Array"><a href="#use-spread-operator-to-copy-Array" class="headerlink" title="use spread operator to copy Array"></a>use spread operator to copy Array</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const arr = [1,2,3,4];</span><br><span class="line">const cloneArr = [...arr];//cloneArr - .[1,2,3,4]</span><br></pre></td></tr></table></figure>

<h3 id="use-Array-from-or-spread-operator-to-convert-an-iterable-Object"><a href="#use-Array-from-or-spread-operator-to-convert-an-iterable-Object" class="headerlink" title="use Array.from() or spread operator to convert an iterable Object"></a>use Array.from() or spread operator to convert an iterable Object</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const foo = document.querySelectorAll(&apos;.foo&apos;);//it is a nodelist</span><br><span class="line"></span><br><span class="line">const arrNode = Array.from(foo);</span><br><span class="line"></span><br><span class="line">//or</span><br><span class="line"></span><br><span class="line">const arrNode1 = [...foo];</span><br></pre></td></tr></table></figure>

<h3 id="use-Array-from-instead-of-spread-operator-for-mapping-over-iterables-because-it-wonâ€™t-creat-an-intermediate-array"><a href="#use-Array-from-instead-of-spread-operator-for-mapping-over-iterables-because-it-wonâ€™t-creat-an-intermediate-array" class="headerlink" title="use Array.from() instead of spread operator  for mapping over iterables ,because it wonâ€™t creat an intermediate array"></a>use Array.from() instead of spread operator  for mapping over iterables ,because it wonâ€™t creat an intermediate array</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const foo =[1,2,3];</span><br><span class="line">const bar = Array.from(foo,function(item)&#123;</span><br><span class="line">  return Math.pow(item,2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="use-object-destructuring-when-accessing-and-using-multiple-properties-of-an-object"><a href="#use-object-destructuring-when-accessing-and-using-multiple-properties-of-an-object" class="headerlink" title="use object destructuring when accessing and using multiple properties of an object."></a>use object destructuring when accessing and using multiple properties of an object.</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//No</span><br><span class="line">const render = param =&gt; &#123;</span><br><span class="line">  const firstName = param.firstName;</span><br><span class="line">  const secondName = param.secondName;</span><br><span class="line">&#125;</span><br><span class="line">//Yes,and maybe we should give them default value,or if firstName or secondName dont exist in param , they will be undefined</span><br><span class="line">const render = param =&gt;&#123;</span><br><span class="line">  const &#123;</span><br><span class="line">    firstName=&apos;&apos; ,secondName=&apos;&apos;</span><br><span class="line">  &#125; = param;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-array-destructuring-instead-of-arr-0"><a href="#use-array-destructuring-instead-of-arr-0" class="headerlink" title="use array destructuring instead of arr[0]."></a>use array destructuring instead of arr[0].</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const render = param =&gt;&#123;</span><br><span class="line">  const [firstName,secondName] = param;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-object-destructuring-if-u-dont-need-certaine-property"><a href="#use-object-destructuring-if-u-dont-need-certaine-property" class="headerlink" title="use object destructuring if u dont need certaine property"></a>use object destructuring if u dont need certaine property</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// if u dont need secondName,u can use object destructuring,and what u need exists in rest</span><br><span class="line">const render = param =&gt;&#123;</span><br><span class="line">  const &#123;</span><br><span class="line">    secondName,...rest</span><br><span class="line">  &#125; =param//rest-&gt; &#123;firstName,age&#125;</span><br><span class="line">&#125;</span><br><span class="line">render(&#123;</span><br><span class="line">  firstName,</span><br><span class="line">  secondName,</span><br><span class="line">  age</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="use-instead-of-â€˜â€™-or-â€œâ€"><a href="#use-instead-of-â€˜â€™-or-â€œâ€" class="headerlink" title="use `` instead of â€˜â€™ or â€œâ€"></a>use `` instead of â€˜â€™ or â€œâ€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const name = &apos;John&apos;;</span><br><span class="line">//No</span><br><span class="line">const wholeName = &apos;My name is&apos;+ name;</span><br><span class="line">//Yes</span><br><span class="line">const wholeName = `my name is $&#123;name&#125;`</span><br></pre></td></tr></table></figure>

<h3 id="dont-declare-function-in-a-block-like-if-while-etc"><a href="#dont-declare-function-in-a-block-like-if-while-etc" class="headerlink" title="dont declare function in a block like if,while ,etc"></a>dont declare function in a block like if,while ,etc</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//No</span><br><span class="line">if(true)&#123;</span><br><span class="line">  function test()&#123;</span><br><span class="line">    console.log(&apos;bad&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//Yes</span><br><span class="line">let test ;</span><br><span class="line">if(true)&#123;</span><br><span class="line">  test = () =&gt;&#123;</span><br><span class="line">    console.log(&apos;good&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-spread-operator-â€¦-instead-of-arguments-because-arguments-is-a-Array-like-Array-and-not-a-real-Array"><a href="#use-spread-operator-â€¦-instead-of-arguments-because-arguments-is-a-Array-like-Array-and-not-a-real-Array" class="headerlink" title="use spread operator(â€¦) instead of arguments,because arguments is a Array-like Array and not a real Array"></a>use spread operator(â€¦) instead of arguments,because arguments is a Array-like Array and not a real Array</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//No</span><br><span class="line">const render = arguments =&gt; &#123;</span><br><span class="line">  const arr = Array.prototype.slice.call(arguments);</span><br><span class="line">&#125;</span><br><span class="line">//Yes</span><br><span class="line">const render =(...args) =&gt; &#123;</span><br><span class="line">  const arr = args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-void-0-instead-of-undefined"><a href="#use-void-0-instead-of-undefined" class="headerlink" title="use void 0 instead of undefined"></a>use void 0 instead of undefined</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let undefined = 1;</span><br><span class="line">var a;</span><br><span class="line">console.log(a === undefined)// false</span><br><span class="line">console.log(a === void 0)//false</span><br></pre></td></tr></table></figure>

<h3 id="in-a-module-with-single-export-use-default-export-instead-of-name-export"><a href="#in-a-module-with-single-export-use-default-export-instead-of-name-export" class="headerlink" title="in a module with single export use default export instead of name export"></a>in a module with single export use default export instead of name export</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default function es6()&#123;&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»Šæ—¥éšç¬”</title>
    <url>/2020/08/15/vue-react-new-release/</url>
    <content><![CDATA[<p>react æ›´æ–°äº†<br><img src="/images/update-of-frame/react.png" alt="react"></p>
<p>vueè„šæ‰‹æ¶æ›´æ–°</p>
<p><img src="/images/update-of-frame/vue.jpeg" alt="vue"></p>
<p>æ¥ç©~</p>
]]></content>
      <categories>
        <category>vue</category>
        <category>react</category>
      </categories>
  </entry>
  <entry>
    <title>vuex</title>
    <url>/2020/04/28/vuex/</url>
    <content><![CDATA[<h2 id="vuex-ç®€è¿°"><a href="#vuex-ç®€è¿°" class="headerlink" title="vuex ç®€è¿°"></a>vuex ç®€è¿°</h2><p>vuex æœ¬è´¨ä¸Šå°±æ˜¯ vue ä¸­çš„ mixinï¼Œstore åœ¨æ¯ä¸ª vue ç»„å»ºå®ä¾‹åˆ›å»ºçš„æ—¶å€™é€šè¿‡ mixin çš„æ–¹å¼æ³¨å…¥çš„ï¼Œmixin å°±ç±»ä¼¼è¿™æ ·çš„æ ¼å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const mixComponent = &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span></span>()&#123;</span><br><span class="line">        <span class="built_in">return</span> &#123;</span><br><span class="line">            message:<span class="string">'hello'</span>,</span><br><span class="line">            foo:<span class="string">'abc'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">new Vue(&#123;</span><br><span class="line">    mixins:[mixComponent],</span><br><span class="line">    <span class="function"><span class="title">data</span></span>()&#123;</span><br><span class="line">        <span class="built_in">return</span> &#123;</span><br><span class="line">            message:<span class="string">'goodbye'</span>,</span><br><span class="line">            bar:<span class="string">'def'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">created</span></span>()&#123;</span><br><span class="line">        console.log(this.<span class="variable">$data</span>)</span><br><span class="line">        <span class="comment"># =&gt; &#123;message:'goodbye',foo:'abc',bar:'def'&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å½“ç»„å»ºå’Œæ··å…¥çš„ mixins å«æœ‰åŒåé€‰é¡¹æ—¶ï¼Œè¿™äº›é€‰é¡¹å°†ä¼šä»¥é€‚å½“çš„æ–¹å¼è¿›è¡Œåˆå¹¶ï¼Œæ¯”å¦‚ mixins ä¸­çš„ data å’Œç»„å»ºçš„ data æœ‰åŒåå±æ€§æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šä»¥ç»„å»ºä¸­çš„æ•°æ®ä¸ºå‡†ã€‚å½“å…·æœ‰åŒåçš„é’©å­å‡½æ•°æ—¶ï¼Œé‚£ä¹ˆåŒåçš„é’©å­å‡½æ•°å°†ä¼šç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œå®ƒä»¬éƒ½å°†è¢«è°ƒç”¨ã€‚å¦å¤–ï¼Œmixins ä¸­çš„é’©å­å‡½æ•°å°†ä¼šåœ¨ç»„ä»¶è‡ªèº«é’©å­ä¹‹å‰è°ƒç”¨ã€‚<br>å€¼ä¸ºå¯¹è±¡çš„é€‰é¡¹æ—¶ï¼Œå®ƒä»¬å°†ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œk-v å†²çªæ—¶ï¼Œå–ç»„ä»¶ä¸­çš„ kvã€‚<br>è€Œ vuex æ­£æ˜¯å…¨å±€çš„ mixinsï¼Œå°†ä¼šåœ¨æ¯ä¸ªç»„ä»¶ create çš„æ—¶å€™æ³¨å…¥</p>
<a id="more"></a>
<h3 id="Vue-use"><a href="#Vue-use" class="headerlink" title="Vue.use"></a><a href="https://cn.vuejs.org/v2/api/#Vue-use" target="_blank" rel="noopener">Vue.use</a></h3><p>å¯ä»¥çœ‹çœ‹å®˜ç½‘å¯¹è¿™ä¸ªæ–¹æ³•å¯¹ä»‹ç»</p>
<ul>
<li><p>å‚æ•°ï¼š</p>
<p>{Object | Function} plugin</p>
</li>
<li><p>ç”¨æ³•ï¼š</p>
<p>å®‰è£… Vue.js æ’ä»¶ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æä¾› install æ–¹æ³•ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸º install æ–¹æ³•ã€‚install æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°† Vue ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<p>è¯¥æ–¹æ³•éœ€è¦åœ¨è°ƒç”¨ new Vue() ä¹‹å‰è¢«è°ƒç”¨ã€‚</p>
<p>å½“ install æ–¹æ³•è¢«åŒä¸€ä¸ªæ’ä»¶å¤šæ¬¡è°ƒç”¨ï¼Œæ’ä»¶å°†åªä¼šè¢«å®‰è£…ä¸€æ¬¡ã€‚</p>
</li>
<li><p>å‚è€ƒï¼š<a href="https://cn.vuejs.org/v2/guide/plugins.html" target="_blank" rel="noopener">æ’ä»¶</a></p>
</li>
</ul>
<p>ç„¶åçœ‹çœ‹æºä»£ç æ€ä¹ˆå®ç°çš„,åœ¨ vue ä¸­ï¼Œè¦æƒ³ä½¿ç”¨ vuexï¼Œé‚£ä¹ˆè‚¯å®šå°±è¦å®‰è£…å®˜æ–¹çš„ vuex æ’ä»¶ï¼Œç„¶ååœ¨å…¥å£æ–‡ä»¶ä¸­è°ƒç”¨ Vue.use(vuex)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> initUse (Vue) &#123;</span><br><span class="line">  Vue.use = <span class="keyword">function</span> (plugin) &#123;</span><br><span class="line">    var installedPlugins = (this._installedPlugins || (this._installedPlugins = []));</span><br><span class="line">    <span class="comment"># å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›thisä¹Ÿå°±æ˜¯Vue</span></span><br><span class="line">    <span class="keyword">if</span> (installedPlugins.indexOf(plugin) &gt; -1) &#123;</span><br><span class="line">      <span class="built_in">return</span> this</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># additional parameters</span></span><br><span class="line">    var args = toArray(arguments, 1);</span><br><span class="line">    <span class="comment"># æŠŠ thisï¼ˆä¹Ÿå°±æ˜¯Vueï¼‰ä½œä¸ºæ•°ç»„çš„ç¬¬ä¸€é¡¹</span></span><br><span class="line">    args.unshift(this);</span><br><span class="line">    <span class="comment"># å¦‚æœæ’ä»¶çš„installå±æ€§æ˜¯å‡½æ•°,è°ƒç”¨å®ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (typeof plugin.install === <span class="string">'function'</span>) &#123;</span><br><span class="line">      plugin.install.apply(plugin, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeof plugin === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment"># å¦‚æœæ’ä»¶æ˜¯å‡½æ•°,åˆ™è°ƒç”¨å®ƒ</span></span><br><span class="line">      <span class="comment"># apply(null) ä¸¥æ ¼æ¨¡å¼ä¸‹ plugin æ’ä»¶å‡½æ•°çš„ this å°±æ˜¯ null</span></span><br><span class="line">      plugin.apply(null, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># æ·»åŠ åˆ°å·²å®‰è£…çš„æ’ä»¶</span></span><br><span class="line">    installedPlugins.push(plugin);</span><br><span class="line">    <span class="built_in">return</span> this</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååº·åº· install å‡½æ•°åšäº†ä»€ä¹ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> install(_Vue)&#123;</span><br><span class="line">    <span class="comment"># Vueå­˜åœ¨å¹¶ä¸”ç›¸ç­‰ï¼Œè¯´æ˜å·²ç»æ‰§è¡Œè¿‡installäº†ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span>(Vue &amp;&amp; _Vue === Vue)&#123;</span><br><span class="line">        //çœç•¥éç”Ÿäº§ç¯å¢ƒæŠ¥é”™ä»£ç </span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    Vue = _Vue</span><br><span class="line">    applyMixin(Vue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OKï¼Œç»§ç»­çœ‹ applyMixin</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> default <span class="keyword">function</span> (Vue) &#123;</span><br><span class="line">  const version = Number(Vue.version.split(<span class="string">'.'</span>)[0])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (version &gt;= 2) &#123;</span><br><span class="line">    <span class="comment"># åˆå¹¶é€‰é¡¹å beforeCreate æ˜¯æ•°ç»„é‡Œå‡½æ•°çš„å½¢å¼  [func,  func]</span></span><br><span class="line">    <span class="comment"># æœ€åè°ƒç”¨å¾ªç¯éå†è¿™ä¸ªæ•°ç»„ï¼Œè°ƒç”¨è¿™äº›å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ç§å‡½æ•°ä¸å‡½æ•°åˆå¹¶çš„è§£å†³æ–¹æ¡ˆã€‚</span></span><br><span class="line">    Vue.mixin(&#123; beforeCreate: vuexInit &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      //å…¼å®¹vue 1.xçš„ä»£ç ï¼Œä¸ç®¡å®ƒ</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Vuex init hook, injected into each instances init hooks list.</span><br><span class="line">   */</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">vuexInit</span></span> () &#123;</span><br><span class="line">    <span class="comment"># console.log('vuexInit')</span></span><br><span class="line">    const options = this.<span class="variable">$options</span></span><br><span class="line">    <span class="comment"># åœ¨è°ƒç”¨vue.useè£…è½½vuexçš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªæ–¹æ³•æ³¨å…¥åˆ°mixinsä¸­çš„beforeCreatedä¸­ï¼Œå› ä¸ºåŒåé’©å­å‡½æ•°ä¸ä¼šè¦†ç›–ï¼Œä¼šç»„æˆæ•°ç»„ç„¶åéå†æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„$optionså°±æ˜¯åœ¨åˆå§‹åŒ–new Vuex.Store(options=&#123;&#125;)è¿™ä¸ªæ—¶å€™ä¼ è¿›æ¥çš„å‚æ•°ï¼Œè¿™æ ·æ··å…¥ä¹‹åæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥åœ¨thisè®¿é—®storeå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (options.store) &#123;</span><br><span class="line">      console.log(<span class="string">'options.store'</span>)</span><br><span class="line">      this.<span class="variable">$store</span> = typeof options.store === <span class="string">'function'</span></span><br><span class="line">        ? options.store()</span><br><span class="line">        : options.store</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.parent &amp;&amp; options.parent.<span class="variable">$store</span>) &#123;</span><br><span class="line">      console.log(<span class="string">'options.parent.$store'</span>)</span><br><span class="line">      this.<span class="variable">$store</span> = options.parent.<span class="variable">$store</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ¥çœ‹ç”Ÿæˆ Store çš„æ„é€ å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import applyMixin from <span class="string">'./mixin'</span></span><br><span class="line">import devtoolPlugin from <span class="string">'./plugins/devtool'</span></span><br><span class="line">import ModuleCollection from <span class="string">'./module/module-collection'</span></span><br><span class="line">import &#123; forEachValue, isObject, isPromise, assert, partial &#125; from <span class="string">'./util'</span></span><br><span class="line"><span class="built_in">let</span> Vue</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ˜¯å¼•å…¥æ–‡ä»¶ï¼ŒapplyMixin ä¹‹å‰æœ‰è¯´ï¼Œç„¶åæ˜¯ devtoolPluginï¼Œçœ‹åå­—çŒœåº”è¯¥æ˜¯ vue-devtool æœ‰å…³ï¼Œpassï¼Œç„¶åæ˜¯ä¸€äº›å°è£…çš„å·¥å…·å‡½æ•°ï¼Œçœ‹ä¸€ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¡ä»¶æ–­è¨€ï¼Œä¸æ»¡è¶³æ¡ä»¶æŠ›å‡ºé”™è¯¯</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> assert (condition, msg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!condition) throw new Error(`[vuex] <span class="variable">$&#123;msg&#125;</span>`)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> partial(fn,arg)&#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        <span class="built_in">return</span> fn(arg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># åˆ¤æ–­promiseï¼Œä½†æ˜¯è¿™ä¸ªåˆ¤æ–­æ–¹æ³•æ˜¯ä¸ä¸¥è°¨çš„ï¼Œå‡è®¾æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªobject =&gt; const obj =&#123;then()&#123;&#125;&#125;,objå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¹Ÿæ‹¥æœ‰thenæ–¹æ³•ï¼Œä½†æ˜¯å®ƒå…¶å®ä¸æ˜¯ä¸€ä¸ªpromise</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isPromise(val)&#123;</span><br><span class="line">    <span class="built_in">return</span> val &amp;&amp; typeof val.then === <span class="string">'function'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¿™ä¸ªæ–¹æ³•ä¸ä»…ä»…ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯objectï¼ŒåŒæ—¶è¿˜æœ‰dateï¼Œregexpï¼Œarray</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> isObject(val)&#123;</span><br><span class="line">    <span class="built_in">return</span> obj!==null &amp;&amp; typeof val === <span class="string">'object'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»Ÿä¸€æˆå¯¹è±¡é£æ ¼</span></span><br><span class="line"><span class="keyword">function</span> unifyObjectStyle (<span class="built_in">type</span>, payload, options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isObject(<span class="built_in">type</span>) &amp;&amp; type.type) &#123;</span><br><span class="line">    options = payload</span><br><span class="line">    payload = <span class="built_in">type</span></span><br><span class="line">    <span class="built_in">type</span> = type.type</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># typeä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œéç”Ÿäº§ç¯å¢ƒæŠ¥é”™</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    assert(typeof <span class="built_in">type</span> === <span class="string">'string'</span>, `expects string as the <span class="built_in">type</span>, but found <span class="variable">$&#123;typeof type&#125;</span>.`)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> &#123; <span class="built_in">type</span>, payload, options &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯ä»¥é—­åŒ…çš„å½¢å¼è¿”å›ä¸€ä¸ªæ–°å‡½æ•°<br>ç„¶åå…¨å±€å£°æ˜ä¸€ä¸ª Vue å˜é‡ï¼Œæ‰“ä¸€ä¸‹æ–­ç‚¹æˆ‘ä»¬å¯ä»¥å‘ç° Vue å‚¨å­˜çš„å…¶å®æ˜¯ä¸€ä¸ª function<br>ç„¶åçœ‹æ­£æ–‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> class Store &#123;</span><br><span class="line">  constructor (options = &#123;&#125;) &#123;</span><br><span class="line">    <span class="comment"># Auto install if it is not done yet and `window` has `Vue`.</span></span><br><span class="line">    <span class="comment"># To allow users to avoid auto-installation in some cases,</span></span><br><span class="line">    <span class="comment"># this code should be placed here. See #731</span></span><br><span class="line">    <span class="comment"># å¦‚æœæ˜¯ cdn script å¼•å…¥vuexæ’ä»¶ï¼Œåˆ™è‡ªåŠ¨å®‰è£…vuexæ’ä»¶ï¼Œä¸éœ€è¦ç”¨Vue.use(Vuex)æ¥å®‰è£…</span></span><br><span class="line">    <span class="keyword">if</span> (!Vue &amp;&amp; typeof window !== <span class="string">'undefined'</span> &amp;&amp; window.Vue) &#123;</span><br><span class="line">      install(window.Vue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="comment"># å¿…é¡»ä½¿ç”¨Vue.use(Vuex) åˆ›å»º store å®ä¾‹</span></span><br><span class="line">      assert(Vue, `must call Vue.use(Vuex) before creating a store instance.`)</span><br><span class="line">      <span class="comment"># å½“å‰ç¯å¢ƒä¸æ”¯æŒPromiseï¼ŒæŠ¥é”™ï¼švuexéœ€è¦Promise polyfill</span></span><br><span class="line">      assert(typeof Promise !== <span class="string">'undefined'</span>, `vuex requires a Promise polyfill <span class="keyword">in</span> this browser.`)</span><br><span class="line">      <span class="comment"># Store å‡½æ•°å¿…é¡»ä½¿ç”¨newæ“ä½œç¬¦è°ƒç”¨</span></span><br><span class="line">      assert(this instanceof Store, `store must be called with the new operator.`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const &#123;</span><br><span class="line">      <span class="comment"># æ’ä»¶é»˜è®¤æ˜¯ç©ºæ•°ç»„</span></span><br><span class="line">      plugins = [],</span><br><span class="line">      <span class="comment"># ä¸¥æ ¼æ¨¡å¼é»˜è®¤æ˜¯false</span></span><br><span class="line">      strict = <span class="literal">false</span></span><br><span class="line">    &#125; = options</span><br><span class="line"></span><br><span class="line">    <span class="comment"># store internal state</span></span><br><span class="line">    <span class="comment"># store å®ä¾‹å¯¹è±¡ å†…éƒ¨çš„ state</span></span><br><span class="line">    this._committing = <span class="literal">false</span></span><br><span class="line">    <span class="comment"># ç”¨æ¥å­˜æ”¾å¤„ç†åçš„ç”¨æˆ·è‡ªå®šä¹‰çš„actoins</span></span><br><span class="line">    <span class="comment"># Object.createç”Ÿæˆçš„å®ä¾‹æ˜¯ä¸ä¼šæœ‰åŸå‹é“¾è¿™ç§ä¸œè¥¿çš„</span></span><br><span class="line">    this._actions = Object.create(null)</span><br><span class="line">    <span class="comment"># ç”¨æ¥å­˜æ”¾ actions è®¢é˜…</span></span><br><span class="line">    this._actionSubscribers = []</span><br><span class="line">    <span class="comment"># ç”¨æ¥å­˜æ”¾å¤„ç†åçš„ç”¨æˆ·è‡ªå®šä¹‰çš„mutations</span></span><br><span class="line">    this._mutations = Object.create(null)</span><br><span class="line">    <span class="comment"># ç”¨æ¥å­˜æ”¾å¤„ç†åçš„ç”¨æˆ·è‡ªå®šä¹‰çš„ getters</span></span><br><span class="line">    this._wrappedGetters = Object.create(null)</span><br><span class="line">    <span class="comment"># æ¨¡å—æ”¶é›†å™¨ï¼Œæ„é€ æ¨¡å—æ ‘å½¢ç»“æ„</span></span><br><span class="line">    this._modules = new ModuleCollection(options)</span><br><span class="line">    /<span class="comment">#ç”¨äºå­˜å‚¨æ¨¡å—å‘½åç©ºé—´çš„å…³ç³»</span></span><br><span class="line">    this._modulesNamespaceMap = Object.create(null)</span><br><span class="line">    <span class="comment"># è®¢é˜…</span></span><br><span class="line">    this._subscribers = []</span><br><span class="line">     <span class="comment"># ç”¨äºä½¿ç”¨ $watch è§‚æµ‹ getters</span></span><br><span class="line">    this._watcherVM = new Vue()</span><br><span class="line">     <span class="comment"># ç”¨æ¥å­˜æ”¾ç”Ÿæˆçš„æœ¬åœ° getters çš„ç¼“å­˜</span></span><br><span class="line">    this._makeLocalGettersCache = Object.create(null)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#bind commit and dispatch to self</span></span><br><span class="line">     <span class="comment"># ç»™è‡ªå·± ç»‘å®š commit å’Œ dispatch</span></span><br><span class="line">    const store = this</span><br><span class="line">    const &#123; dispatch, commit &#125; = this</span><br><span class="line">    <span class="comment"># ä¸ºä½•è¦è¿™æ ·ç»‘å®š ?</span></span><br><span class="line">    <span class="comment"># è¯´æ˜è°ƒç”¨commitå’Œdispach çš„ this ä¸ä¸€å®šæ˜¯ store å®ä¾‹</span></span><br><span class="line">    <span class="comment"># è¿™æ˜¯ç¡®ä¿è¿™ä¸¤ä¸ªå‡½æ•°é‡Œçš„thisæ˜¯storeå®ä¾‹</span></span><br><span class="line">    this.dispatch = <span class="keyword">function</span> boundDispatch (<span class="built_in">type</span>, payload) &#123;</span><br><span class="line">      <span class="built_in">return</span> dispatch.call(store, <span class="built_in">type</span>, payload)</span><br><span class="line">    &#125;</span><br><span class="line">    this.commit = <span class="keyword">function</span> boundCommit (<span class="built_in">type</span>, payload, options) &#123;</span><br><span class="line">      <span class="built_in">return</span> commit.call(store, <span class="built_in">type</span>, payload, options)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># strict mode</span></span><br><span class="line">    this.strict = strict</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ ¹æ¨¡å—çš„state</span></span><br><span class="line">    const state = this._modules.root.state</span><br><span class="line"></span><br><span class="line">    <span class="comment"># init root module.</span></span><br><span class="line">    <span class="comment"># this also recursively registers all sub-modules</span></span><br><span class="line">    <span class="comment"># and collects all module getters inside this._wrappedGetters</span></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– æ ¹æ¨¡å—</span></span><br><span class="line">    <span class="comment"># å¹¶ä¸”ä¹Ÿé€’å½’çš„æ³¨å†Œæ‰€æœ‰å­æ¨¡å—</span></span><br><span class="line">    <span class="comment"># å¹¶ä¸”æ”¶é›†æ‰€æœ‰æ¨¡å—çš„ getters æ”¾åœ¨ this._wrappedGetters é‡Œé¢</span></span><br><span class="line">    installModule(this, state, [], this._modules.root)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># initialize the store vm, which is responsible for the reactivity</span></span><br><span class="line">    <span class="comment"># (also registers _wrappedGetters as computed properties)</span></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– store._vm å“åº”å¼çš„</span></span><br><span class="line">    <span class="comment"># å¹¶ä¸”æ³¨å†Œ _wrappedGetters ä½œä¸º computed çš„å±æ€§</span></span><br><span class="line">    resetStoreVM(this, state)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># apply plugins</span></span><br><span class="line">    <span class="comment"># æŠŠå®ä¾‹storeä¼ ç»™æ’ä»¶å‡½æ•°ï¼Œæ‰§è¡Œæ‰€æœ‰æ’ä»¶</span></span><br><span class="line">    plugins.forEach(plugin =&gt; plugin(this))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– vue-devtool å¼€å‘å·¥å…·</span></span><br><span class="line">    <span class="comment"># å‚æ•° devtools ä¼ é€’äº†å– devtools å¦åˆ™å–Vue.config.devtools é…ç½®</span></span><br><span class="line">    const useDevtools = options.devtools !== undefined ? options.devtools : Vue.config.devtools</span><br><span class="line">    <span class="keyword">if</span> (useDevtools) &#123;</span><br><span class="line">      devtoolPlugin(this)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># çœç•¥æ–¹æ³•</span></span><br><span class="line">    <span class="comment"># Vue.Storeæœ¬åœ°commit dispatch</span></span><br><span class="line">    commit(_type,_payload,_options)&#123;</span><br><span class="line">        <span class="comment">#ä»£ç è·Ÿä¹‹å‰æ³¨å†Œçš„æ—¶å€™ç±»ä¼¼</span></span><br><span class="line">        const &#123;</span><br><span class="line">            <span class="built_in">type</span>,</span><br><span class="line">            payload,</span><br><span class="line">            options</span><br><span class="line">        &#125; = unifyObjectStyle(_type, _payload, _options)</span><br><span class="line"></span><br><span class="line">        const mutation = &#123; <span class="built_in">type</span>, payload &#125;</span><br><span class="line">        <span class="comment"># å–å‡ºå¤„ç†åçš„ç”¨æˆ·å®šä¹‰ mutation</span></span><br><span class="line">        const entry = this._mutations[<span class="built_in">type</span>]</span><br><span class="line">        <span class="keyword">if</span> (!entry) &#123;</span><br><span class="line">            <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">                console.error(`[vuex] unknown mutation <span class="built_in">type</span>: <span class="variable">$&#123;type&#125;</span>`)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        this._withCommit(() =&gt; &#123;</span><br><span class="line">            entry.forEach(<span class="keyword">function</span> commitIterator (handler) &#123;</span><br><span class="line">                <span class="comment"># è¿™é‡Œä¼šè·³åˆ°ä¹‹å‰æ³¨å†Œæ—¶çš„å‡½æ•°æ‰€ç»‘å®šçš„æ–°å‡½æ•°æ ¼å¼</span></span><br><span class="line">                handler(payload)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        this._subscribers.forEach(sub =&gt; sub(mutation, this.state))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">            options &amp;&amp; options.silent</span><br><span class="line">        ) &#123;</span><br><span class="line">            console.warn(</span><br><span class="line">                `[vuex] mutation <span class="built_in">type</span>: <span class="variable">$&#123;type&#125;</span>. Silent option has been removed. ` +</span><br><span class="line">                <span class="string">'Use the filter functionality in the vue-devtools'</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;ï¼Œ</span><br><span class="line">    dispatch (_type, _payload) &#123;</span><br><span class="line">        <span class="comment"># check object-style dispatch</span></span><br><span class="line">        <span class="comment"># è·å–åˆ°typeå’Œpayloadå‚æ•°</span></span><br><span class="line">        const &#123;</span><br><span class="line">            <span class="built_in">type</span>,</span><br><span class="line">            payload</span><br><span class="line">        &#125; = unifyObjectStyle(_type, _payload)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å£°æ˜ action å˜é‡ ç­‰äº typeå’Œpayloadå‚æ•°</span></span><br><span class="line">        const action = &#123; <span class="built_in">type</span>, payload &#125;</span><br><span class="line">        <span class="comment"># å…¥å£ï¼Œä¹Ÿå°±æ˜¯ _actions é›†åˆ</span></span><br><span class="line">        const entry = this._actions[<span class="built_in">type</span>]</span><br><span class="line">        <span class="comment"># å¦‚æœä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (!entry) &#123;</span><br><span class="line">            <span class="comment"># éç”Ÿäº§ç¯å¢ƒæŠ¥é”™ï¼ŒåŒ¹é…ä¸åˆ° action ç±»å‹</span></span><br><span class="line">            <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">                console.error(`[vuex] unknown action <span class="built_in">type</span>: <span class="variable">$&#123;type&#125;</span>`)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># ä¸å¾€ä¸‹æ‰§è¡Œ</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            this._actionSubscribers</span><br><span class="line">                .filter(sub =&gt; sub.before)</span><br><span class="line">                .forEach(sub =&gt; sub.before(action, this.state))</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">                console.warn(`[vuex] error <span class="keyword">in</span> before action subscribers: `)</span><br><span class="line">                console.error(e)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const result = entry.length &gt; 1</span><br><span class="line">        ? Promise.all(entry.map(handler =&gt; handler(payload)))</span><br><span class="line">        : entry[0](payload)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> result.then(res =&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                this._actionSubscribers</span><br><span class="line">                .filter(sub =&gt; sub.after)</span><br><span class="line">                .forEach(sub =&gt; sub.after(action, this.state))</span><br><span class="line">            &#125; catch (e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">                console.warn(`[vuex] error <span class="keyword">in</span> after action subscribers: `)</span><br><span class="line">                console.error(e)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span> res</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK,åº·åº· installModule æ€ä¹ˆæ‰§è¡Œçš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># æ³¨å†Œåœ¨å‘½åç©ºé—´çš„mapå¯¹è±¡ä¸­ã€‚</span></span><br><span class="line"><span class="comment"># æ¨¡å—å‘½åæ§ä»¶ä¸º true æ‰§è¡Œä»¥ä¸‹ä»£ç </span></span><br><span class="line"><span class="comment"># ä¸»è¦ç”¨äºåœ¨ helpers è¾…åŠ©å‡½æ•°ï¼Œæ ¹æ®å‘½åç©ºé—´è·å–æ¨¡å—</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">function</span> getModuleByNamespace (store, helper, namespace) &#123;</span><br><span class="line">      <span class="comment"># _modulesNamespaceMap è¿™ä¸ªå˜é‡åœ¨ class Store ä¸­</span></span><br><span class="line">      const module = store._modulesNamespaceMap[namespace]</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !module) &#123;</span><br><span class="line">        console.error(`[vuex] module namespace not found <span class="keyword">in</span> <span class="variable">$&#123;helper&#125;</span>(): <span class="variable">$&#123;namespace&#125;</span>`)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">return</span> module</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å–å‘½åç©ºé—´</span></span><br><span class="line"><span class="keyword">function</span> getNamespace (path) &#123;</span><br><span class="line">      <span class="built_in">let</span> module = this.rootï¼›</span><br><span class="line">      <span class="built_in">return</span> path.reduce((namespace, key) =&gt; &#123;</span><br><span class="line">        module = module.getChild(key)</span><br><span class="line">        <span class="built_in">return</span> namespace + (module.namespaced ? key + <span class="string">'/'</span> : <span class="string">''</span>)</span><br><span class="line">      &#125;, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æ ¹æ®è·¯å¾„æ¥è·å–åµŒå¥—çš„state</span></span><br><span class="line"><span class="keyword">function</span> getNestedState(state,path)&#123;</span><br><span class="line">    <span class="built_in">return</span> path.length ? path.reduce((state,key)=&gt;state[key],state):state</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> installModule (store, rootState, path, module, hot) &#123;</span><br><span class="line">  <span class="comment"># æ˜¯æ ¹æ¨¡å—</span></span><br><span class="line">  const isRoot = !path.length</span><br><span class="line">  <span class="comment"># è·å–å‘½åç©ºé—´</span></span><br><span class="line">  const namespace = store._modules.getNamespace(path)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># register in namespace map</span></span><br><span class="line">  <span class="keyword">if</span> (module.namespaced) &#123;</span><br><span class="line">    <span class="comment"># æ¨¡å—å‘½åç©ºé—´mapå¯¹è±¡ä¸­å·²ç»æœ‰äº†ï¼Œå¼€å‘ç¯å¢ƒæŠ¥é”™æç¤ºé‡å¤</span></span><br><span class="line">    <span class="keyword">if</span> (store._modulesNamespaceMap[namespace] &amp;&amp; process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      console.error(`[vuex] duplicate namespace <span class="variable">$&#123;namespace&#125;</span> <span class="keyword">for</span> the namespaced module <span class="variable">$&#123;path.join('/')&#125;</span>`)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># module èµ‹å€¼ç»™ _modulesNamespaceMap[namespace]</span></span><br><span class="line">    store._modulesNamespaceMap[namespace] = module</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># set state</span></span><br><span class="line">  <span class="comment"># ä¸æ˜¯æ ¹æ¨¡å—ä¸”ä¸æ˜¯çƒ­é‡è½½</span></span><br><span class="line">  <span class="keyword">if</span> (!isRoot &amp;&amp; !hot) &#123;</span><br><span class="line">    <span class="comment"># è·å–çˆ¶çº§çš„state</span></span><br><span class="line">    const parentState = getNestedState(rootState, path.slice(0, -1))</span><br><span class="line">    <span class="comment"># æ¨¡å—åç§°</span></span><br><span class="line">    <span class="comment"># æ¯”å¦‚ cart</span></span><br><span class="line">    const moduleName = path[path.length - 1]</span><br><span class="line">    <span class="comment"># state æ³¨å†Œ</span></span><br><span class="line">    store._withCommit(() =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (moduleName <span class="keyword">in</span> parentState) &#123;</span><br><span class="line">          console.warn(</span><br><span class="line">            `[vuex] state field <span class="string">"<span class="variable">$&#123;moduleName&#125;</span>"</span> was overridden by a module with the same name at <span class="string">"<span class="variable">$&#123;path.join('.')&#125;</span>"</span>`</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># æœ€åå¾—åˆ°çš„æ˜¯ç±»ä¼¼è¿™æ ·çš„ç»“æ„ä¸”æ˜¯å“åº”å¼çš„æ•°æ® æ¯”å¦‚</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Storeå®ä¾‹ï¼š&#123;</span></span><br><span class="line">        <span class="comment"># çœç•¥è‹¥å¹²å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">        <span class="comment"># è¿™é‡Œçš„stateæ˜¯åªè¯»å±æ€§ å¯æœç´¢ get state æŸ¥çœ‹</span></span><br><span class="line">        <span class="comment"># state: &#123;</span></span><br><span class="line">        <span class="comment">#   cart: &#123;</span></span><br><span class="line">        <span class="comment">#     checkoutStatus: null,</span></span><br><span class="line">        <span class="comment">#     items: []</span></span><br><span class="line">        <span class="comment">#    &#125;</span></span><br><span class="line">        <span class="comment">#   &#125;</span></span><br><span class="line">        <span class="comment"># &#125;</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">      Vue.set(parentState, moduleName, module.state)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># module.context  è¿™ä¸ªèµ‹å€¼ä¸»è¦æ˜¯ç»™ helpers ä¸­ mapStateã€mapGettersã€mapMutationsã€mapActionså››ä¸ªè¾…åŠ©å‡½æ•°ä½¿ç”¨çš„ã€‚</span></span><br><span class="line">  <span class="comment"># ç”Ÿæˆæœ¬åœ°çš„dispatchã€commitã€getterså’Œstate</span></span><br><span class="line">  <span class="comment">#  ä¸»è¦ä½œç”¨å°±æ˜¯æŠ¹å¹³å·®å¼‚åŒ–ï¼Œä¸éœ€è¦ç”¨æˆ·å†ä¼ æ¨¡å—å‚æ•°</span></span><br><span class="line">  const <span class="built_in">local</span> = module.context = makeLocalContext(store, namespace, path)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¾ªç¯éå†æ³¨å†Œmutation</span></span><br><span class="line">  module.forEachMutation((mutation, key) =&gt; &#123;</span><br><span class="line">    const namespacedType = namespace + key</span><br><span class="line">    registerMutation(store, namespacedType, mutation, <span class="built_in">local</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¾ªç¯éå†æ³¨å†Œ action</span></span><br><span class="line">  module.forEachAction((action, key) =&gt; &#123;</span><br><span class="line">    const <span class="built_in">type</span> = action.root ? key : namespace + key</span><br><span class="line">    const handler = action.handler || action</span><br><span class="line">    registerAction(store, <span class="built_in">type</span>, handler, <span class="built_in">local</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¾ªç¯éå†æ³¨å†Œ getter</span></span><br><span class="line">  module.forEachGetter((getter, key) =&gt; &#123;</span><br><span class="line">    const namespacedType = namespace + key</span><br><span class="line">    registerGetter(store, namespacedType, getter, <span class="built_in">local</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * æ³¨å†Œå­æ¨¡å—</span><br><span class="line">   * forEachChild (fn) &#123;</span><br><span class="line">        forEachValue(this._children, fn)</span><br><span class="line">      &#125;</span><br><span class="line">   */</span><br><span class="line">  module.forEachChild((child, key) =&gt; &#123;</span><br><span class="line">    installModule(store, rootState, path.concat(key), child, hot)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> makeLocalContext(store,namespace,path)&#123;</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æœ‰å‘½åç©ºé—´ç”Ÿæˆ</span></span><br><span class="line">    const noNamespace = namespace === <span class="string">''</span></span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰å‘½åç©ºé—´ã€‚é‚£ä¹ˆå°±ç›´æ¥ç”¨storeçš„dispatch</span></span><br><span class="line">    const <span class="built_in">local</span> = &#123;</span><br><span class="line">        dispatch: noNamespace ?store.dispatch :(_type,_payload,_options)=&gt;&#123;</span><br><span class="line">            <span class="comment"># è¿™æ­¥æ˜¯ä¸ºäº†æŠ¹å¹³å·®å¼‚åŒ–ï¼Œå› ä¸ºè°ƒç”¨æ–¹å¼å¯ä»¥æ˜¯ dispatch(type,payload)ï¼Œä¹Ÿå¯ä»¥æ˜¯dispatch(&#123;type,payload,options&#125;),æ‰€ä»¥è¿™é‡Œéœ€è¦åšä¸€ä¸ªå‡½æ•°æ¥å½¢æˆç»Ÿä¸€çš„é£æ ¼</span></span><br><span class="line">            const args = unifyObjectstyle(_type,_payload,_options)</span><br><span class="line"></span><br><span class="line">            const &#123;payload,options&#125; = args</span><br><span class="line"></span><br><span class="line">            <span class="built_in">let</span> &#123;<span class="built_in">type</span>&#125; = args</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!options|| options.root)&#123;</span><br><span class="line">                <span class="built_in">type</span> = namespace + <span class="built_in">type</span></span><br><span class="line">                <span class="keyword">if</span>(â€™ç”Ÿäº§ç¯å¢ƒâ€˜)&#123;</span><br><span class="line">                    <span class="comment"># çœç•¥éç”Ÿäº§ç¯å¢ƒæŠ¥é”™ä»£ç </span></span><br><span class="line">                    <span class="built_in">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span> store.dispatch(<span class="built_in">type</span>,payload)</span><br><span class="line">        &#125;,</span><br><span class="line">        commit:noNamespace?store.commit:(_type,_payload,_options)=&gt;&#123;</span><br><span class="line">            const args = unifyObjectstyle(_type,_payload,_options)</span><br><span class="line"></span><br><span class="line">            const &#123;payload,options&#125; = args</span><br><span class="line"></span><br><span class="line">            <span class="built_in">let</span> &#123;<span class="built_in">type</span>&#125; = args</span><br><span class="line">            <span class="keyword">if</span>(!options|| options.root)&#123;</span><br><span class="line">                <span class="built_in">type</span> = namespace + <span class="built_in">type</span></span><br><span class="line">                <span class="keyword">if</span>(â€™ç”Ÿäº§ç¯å¢ƒâ€˜)&#123;</span><br><span class="line">                    <span class="comment"># çœç•¥éç”Ÿäº§ç¯å¢ƒæŠ¥é”™ä»£ç </span></span><br><span class="line">                    <span class="built_in">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span> store.commit(<span class="built_in">type</span>,payload,options)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># getters  å’Œ states å¿…é¡»æ˜¯æ‡’åŠ è½½ ï¼Œå› ä¸º å®ƒä»¬ä¼šè¢«å®ä¾‹çš„updateä¿®æ”¹</span></span><br><span class="line">    Object.defineProperties(<span class="built_in">local</span>, &#123;</span><br><span class="line">        getters: &#123;</span><br><span class="line">        <span class="comment"># æ²¡æœ‰å‘½åç©ºé—´ï¼Œç›´æ¥å–å€¼ store.getters</span></span><br><span class="line">        get: noNamespace</span><br><span class="line">            ? () =&gt; store.getters</span><br><span class="line">            <span class="comment"># å¦åˆ™</span></span><br><span class="line">            : () =&gt; makeLocalGetters(store, namespace)</span><br><span class="line">        &#125;,</span><br><span class="line">        state: &#123;</span><br><span class="line">            get: () =&gt; getNestedState(store.state, path)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> <span class="built_in">local</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>makeLocalGetters</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> makeLocalGetters (store, namespace) &#123;</span><br><span class="line">  <span class="comment"># _makeLocalGettersCache ç¼“å­˜æ˜¯vuex v3.1.2ä¸­ åŠ çš„</span></span><br><span class="line">  <span class="comment"># å¦‚æœä¸å­˜åœ¨gettersæœ¬åœ°ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæ‰æ‰§è¡Œä¸‹é¢çš„ä»£ç </span></span><br><span class="line">  <span class="comment"># å¦‚æœå­˜åœ¨ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="comment"># return store._makeLocalGettersCache[namespace]</span></span><br><span class="line">  <span class="keyword">if</span> (!store._makeLocalGettersCache[namespace]) &#123;</span><br><span class="line">    <span class="comment"># å£°æ˜ gettersProxyå¯¹è±¡</span></span><br><span class="line">    const gettersProxy = &#123;&#125;</span><br><span class="line">    <span class="comment"># å‘½åç©ºé—´ é•¿åº¦</span></span><br><span class="line">    const splitPos = namespace.length</span><br><span class="line">    Object.keys(store.getters).forEach(<span class="built_in">type</span> =&gt; &#123;</span><br><span class="line">      <span class="comment"># skip if the target getter is not match this namespace</span></span><br><span class="line">      <span class="comment"># å¦‚æœç›®æ ‡gettersæ²¡æœ‰åŒ¹é…åˆ°å‘½åç©ºé—´ç›´æ¥è·³è¿‡</span></span><br><span class="line">      <span class="keyword">if</span> (type.slice(0, splitPos) !== namespace) <span class="built_in">return</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># extract local getter type</span></span><br><span class="line">      <span class="comment"># æå–æœ¬åœ°type</span></span><br><span class="line">      const localType = type.slice(splitPos)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Add a port to the getters proxy.</span></span><br><span class="line">      <span class="comment"># Define as getter property because</span></span><br><span class="line">      <span class="comment"># we do not want to evaluate the getters in this time.</span></span><br><span class="line">      <span class="comment"># æ·»åŠ ä¸€ä¸ªä»£ç†</span></span><br><span class="line">      <span class="comment"># å®šä¹‰getters å±æ€§</span></span><br><span class="line">      <span class="comment"># å› ä¸ºæˆ‘ä»¬ç°åœ¨ä¸æƒ³è®¡ç®—getters</span></span><br><span class="line">      Object.defineProperty(gettersProxy, localType, &#123;</span><br><span class="line">        get: () =&gt; store.getters[<span class="built_in">type</span>],</span><br><span class="line">        <span class="comment"># å¯ä»¥æšä¸¾</span></span><br><span class="line">        enumerable: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment"># èµ‹å€¼</span></span><br><span class="line">    store._makeLocalGettersCache[namespace] = gettersProxy</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¦‚æœå­˜åœ¨ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="built_in">return</span> store._makeLocalGettersCache[namespace]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œ mutations</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> registerMutation (store, <span class="built_in">type</span>, handler, <span class="built_in">local</span>) &#123;</span><br><span class="line">  <span class="comment"># æ”¶é›†çš„æ‰€æœ‰çš„mutationsæ‰¾å¯¹åº”çš„mutationå‡½æ•°ï¼Œæ²¡æœ‰å°±èµ‹å€¼ç©ºæ•°ç»„</span></span><br><span class="line">  const entry = store._mutations[<span class="built_in">type</span>] || (store._mutations[<span class="built_in">type</span>] = [])</span><br><span class="line">  <span class="comment"># æœ€å mutation</span></span><br><span class="line">  entry.push(<span class="keyword">function</span> wrappedMutationHandler (payload) &#123;</span><br><span class="line">    <span class="comment"># æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨mutationå‡½æ•°çš„æ—¶å€™ä»…éœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œè€Œå‡½æ•°ä½“çš„å‚æ•°åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå‚æ•°å´ä¸æ˜¯æˆ‘ä»¬æ‰€ä¼ é€’çš„å‚æ•°ï¼Œè€Œæ˜¯stateçš„åŸå› </span></span><br><span class="line">    handler.call(store, local.state, payload)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œ action</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> registerAction (store, <span class="built_in">type</span>, handler, <span class="built_in">local</span>) &#123;</span><br><span class="line">  const entry = store._actions[<span class="built_in">type</span>] || (store._actions[<span class="built_in">type</span>] = [])</span><br><span class="line">  /<span class="comment"># payload æ˜¯actionså‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">  entry.push(<span class="keyword">function</span> wrappedActionHandler (payload) &#123;</span><br><span class="line">      <span class="comment"># æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè°ƒç”¨actionçš„æ—¶å€™ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯stateï¼Œè€Œä¸æ˜¯storeå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">let</span> res = handler.call(store, &#123;</span><br><span class="line">      dispatch: local.dispatch,</span><br><span class="line">      commit: local.commit,</span><br><span class="line">      getters: local.getters,</span><br><span class="line">      state: local.state,</span><br><span class="line">      rootGetters: store.getters,</span><br><span class="line">      rootState: store.state</span><br><span class="line">    &#125;, payload)</span><br><span class="line">    <span class="keyword">if</span> (!isPromise(res)) &#123;</span><br><span class="line">      res = Promise.resolve(res)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># devtool å·¥å…·è§¦å‘ vuex:error</span></span><br><span class="line">    <span class="keyword">if</span> (store._devtoolHook) &#123;</span><br><span class="line">      <span class="comment"># catch æ•è·é”™è¯¯</span></span><br><span class="line">      <span class="built_in">return</span> res.catch(err =&gt; &#123;</span><br><span class="line">        store._devtoolHook.emit(<span class="string">'vuex:error'</span>, err)</span><br><span class="line">        <span class="comment"># æŠ›å‡ºé”™è¯¯</span></span><br><span class="line">        throw err</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment"># ç„¶åå‡½æ•°æ‰§è¡Œç»“æœ</span></span><br><span class="line">      <span class="built_in">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œ getters</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨è§£ç•¥ï¼Œéƒ½å·®ä¸å¤šé€»è¾‘</span></span><br><span class="line"><span class="keyword">function</span> registerGetter (store, <span class="built_in">type</span>, rawGetter, <span class="built_in">local</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (store._wrappedGetters[<span class="built_in">type</span>]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      console.error(`[vuex] duplicate getter key: <span class="variable">$&#123;type&#125;</span>`)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  store._wrappedGetters[<span class="built_in">type</span>] = <span class="keyword">function</span> wrappedGetter (store) &#123;</span><br><span class="line">    <span class="built_in">return</span> rawGetter(</span><br><span class="line">      local.state, <span class="comment"># local state</span></span><br><span class="line">      local.getters, <span class="comment"># local getters</span></span><br><span class="line">      store.state, <span class="comment"># root state</span></span><br><span class="line">      store.getters <span class="comment"># root getters</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>resetStoreVM</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸ªæ–¹æ³•è®©storeå˜æˆä¸€ä¸ªå“åº”å¼çš„vueå®ä¾‹</span></span><br><span class="line"><span class="keyword">function</span> resetStoreVM (store, state, hot) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å­˜å‚¨ä¸€ä»½è€çš„Vueå®ä¾‹å¯¹è±¡ _vm</span></span><br><span class="line">  const oldVm = store._vm</span><br><span class="line"></span><br><span class="line">  <span class="comment"># bind store public getters</span></span><br><span class="line">  <span class="comment"># ç»‘å®š store.getter</span></span><br><span class="line">  store.getters = &#123;&#125;</span><br><span class="line">  <span class="comment"># reset local getters cache</span></span><br><span class="line">  <span class="comment"># é‡ç½® æœ¬åœ°gettersçš„ç¼“å­˜</span></span><br><span class="line">  store._makeLocalGettersCache = Object.create(null)</span><br><span class="line">  <span class="comment"># æ³¨å†Œæ—¶æ”¶é›†çš„å¤„ç†åçš„ç”¨æˆ·è‡ªå®šä¹‰çš„ wrappedGetters</span></span><br><span class="line">  const wrappedGetters = store._wrappedGetters</span><br><span class="line">  <span class="comment"># å£°æ˜ è®¡ç®—å±æ€§ computed å¯¹è±¡</span></span><br><span class="line">  const computed = &#123;&#125;</span><br><span class="line">  <span class="comment"># éå† wrappedGetters èµ‹å€¼åˆ° computed ä¸Š</span></span><br><span class="line">  forEachValue(wrappedGetters, (fn, key) =&gt; &#123;</span><br><span class="line">    <span class="comment"># use computed to leverage its lazy-caching mechanism</span></span><br><span class="line">    <span class="comment"># direct inline function use will lead to closure preserving oldVm.</span></span><br><span class="line">    <span class="comment"># using partial to return function with only arguments preserved in closure environment.</span></span><br><span class="line">    computed[key] = partial(fn, store)</span><br><span class="line">    <span class="comment"># getter èµ‹å€¼ keys</span></span><br><span class="line">    Object.defineProperty(store.getters, key, &#123;</span><br><span class="line">      get: () =&gt; store._vm[key],</span><br><span class="line">      enumerable: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># use a Vue instance to store the state tree</span></span><br><span class="line">  <span class="comment"># suppress warnings just in case the user has added</span></span><br><span class="line">  <span class="comment"># some funky global mixins</span></span><br><span class="line">  <span class="comment"># ä½¿ç”¨ä¸€ä¸ª Vue å®ä¾‹å¯¹è±¡å­˜å‚¨ state æ ‘</span></span><br><span class="line">  <span class="comment"># é˜»æ­¢è­¦å‘Š ç”¨æˆ·æ·»åŠ çš„ä¸€äº›å…¨å±€mixins</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å£°æ˜å˜é‡ silent å­˜å‚¨ç”¨æˆ·è®¾ç½®çš„é™é»˜æ¨¡å¼é…ç½®</span></span><br><span class="line">  const silent = Vue.config.silent</span><br><span class="line">  <span class="comment"># é™é»˜æ¨¡å¼å¼€å¯</span></span><br><span class="line">  Vue.config.silent = <span class="literal">true</span></span><br><span class="line">  store._vm = new Vue(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      $<span class="variable">$state</span>: state</span><br><span class="line">    &#125;,</span><br><span class="line">    computed</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment"># æŠŠå­˜å‚¨çš„é™é»˜æ¨¡å¼é…ç½®èµ‹å€¼å›æ¥</span></span><br><span class="line">  Vue.config.silent = silent</span><br><span class="line"></span><br><span class="line">  <span class="comment"># enable strict mode for new vm</span></span><br><span class="line">  <span class="comment"># å¼€å¯ä¸¥æ ¼æ¨¡å¼ æ‰§è¡Œè¿™å¥</span></span><br><span class="line">  <span class="comment"># ç”¨$watch è§‚æµ‹ stateï¼Œåªèƒ½ä½¿ç”¨ mutation ä¿®æ”¹ ä¹Ÿå°±æ˜¯ _withCommit å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (store.strict) &#123;</span><br><span class="line">    enableStrictMode(store)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¦‚æœå­˜åœ¨è€çš„ _vm å®ä¾‹</span></span><br><span class="line">  <span class="keyword">if</span> (oldVm) &#123;</span><br><span class="line">    <span class="comment"># çƒ­åŠ è½½ä¸º true</span></span><br><span class="line">    <span class="keyword">if</span> (hot) &#123;</span><br><span class="line">      <span class="comment">#dispatch changes in all subscribed watchers</span></span><br><span class="line">      <span class="comment">#to force getter re-evaluation for hot reloading.</span></span><br><span class="line">      <span class="comment">#è®¾ç½®  oldVm._data.$$state = null</span></span><br><span class="line">      store._withCommit(() =&gt; &#123;</span><br><span class="line">        oldVm._data.$<span class="variable">$state</span> = null</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># å®ä¾‹é”€æ¯</span></span><br><span class="line">    Vue.nextTick(() =&gt; oldVm.<span class="variable">$destroy</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¾…åŠ©å‡½æ•°"><a href="#è¾…åŠ©å‡½æ•°" class="headerlink" title="è¾…åŠ©å‡½æ•°"></a>è¾…åŠ©å‡½æ•°</h2><h3 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> const mapState = normalizeNamespace((namespace, states) =&gt; &#123;</span><br><span class="line">  const res = &#123;&#125;</span><br><span class="line">  <span class="comment"># éç”Ÿäº§ç¯å¢ƒ åˆ¤æ–­å‚æ•° states  å¿…é¡»æ˜¯æ•°ç»„æˆ–è€…æ˜¯å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !isValidMap(states)) &#123;</span><br><span class="line">    console.error(<span class="string">'[vuex] mapState: mapper parameter must be either an Array or an Object'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment"># normalizeMap æœ€ç»ˆéƒ½æ˜¯è¿”å›æ•°ç»„ [ &#123; key, val &#125; ] å½¢å¼</span></span><br><span class="line">   <span class="comment"># normalizeMap([1, 2, 3]) =&gt; [ &#123; key: 1, val: 1 &#125;, &#123; key: 2, val: 2 &#125;, &#123; key: 3, val: 3 &#125; ]</span></span><br><span class="line">   <span class="comment"># normalizeMap(&#123;a: 1, b: 2, c: 3&#125;) =&gt; [ &#123; key: 'a', val: 1 &#125;, &#123; key: 'b', val: 2 &#125;, &#123; key: 'c', val: 3 &#125; ]</span></span><br><span class="line"></span><br><span class="line">  normalizeMap(states).forEach((&#123; key, val &#125;) =&gt; &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="function"><span class="title">mappedState</span></span> () &#123;</span><br><span class="line">      <span class="built_in">let</span> state = this.<span class="variable">$store</span>.state</span><br><span class="line">      <span class="built_in">let</span> getters = this.<span class="variable">$store</span>.getters</span><br><span class="line">      <span class="comment"># ä¼ äº†å‚æ•° namespace</span></span><br><span class="line">      <span class="keyword">if</span> (namespace) &#123;</span><br><span class="line">        <span class="comment"># ç”¨ namespace ä» store ä¸­æ‰¾ä¸€ä¸ªæ¨¡å—ã€‚</span></span><br><span class="line">        const module = getModuleByNamespace(this.<span class="variable">$store</span>, <span class="string">'mapState'</span>, namespace)</span><br><span class="line">        <span class="keyword">if</span> (!module) &#123;</span><br><span class="line">          <span class="built_in">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        state = module.context.state</span><br><span class="line">        getters = module.context.getters</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">return</span> typeof val === <span class="string">'function'</span></span><br><span class="line">        ? val.call(this, state, getters)</span><br><span class="line">        : state[val]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># æ ‡è®°ä¸º vuex æ–¹ä¾¿åœ¨ devtools æ˜¾ç¤º</span></span><br><span class="line">    <span class="comment"># mark vuex getter for devtools</span></span><br><span class="line">    res[key].vuex = <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>çœ‹äº†ä¸‹å‰©ä¸‹çš„å‡ ä¸ªmapï¼Œé€»è¾‘éƒ½ä¸€æ ·ï¼Œå°±æ˜¯returnéƒ½æ—¶å€™åšä¸‹ä¿®æ”¹å°±å¥½ï¼Œé‚£å°±è¿™æ ·å•¦<br>Doneï¼</p>
<p>â€”â€”- æ›´æ–° 2020.6.26<br>å®³ ï¼Œå‘ç°vuexæ›´æ–°åˆ°vuex4äº†ï¼Œç„¶åæˆ‘çœ‹äº†ä¸€ä¸‹ï¼Œæœ‰ä¸ªä¸œè¥¿æ”¹äº†ï¼Œäººå®¶ä¸ç”¨mixinæ¥æ³¨å…¥storeè¿™ä¸œè¥¿äº†å“ˆï¼Œäººå®¶ç”¨provideå’Œinjectæ¥æ³¨å…¥storeäº†<br><a href="https://github.com/vuejs/vuex/blob/4.0/src/store.js">ä»£ç </a></p>
<h4 id="çœ‹ä¸‹ç®€å•çš„ç¤ºä¾‹ä»£ç "><a href="#çœ‹ä¸‹ç®€å•çš„ç¤ºä¾‹ä»£ç " class="headerlink" title="çœ‹ä¸‹ç®€å•çš„ç¤ºä¾‹ä»£ç "></a>çœ‹ä¸‹ç®€å•çš„ç¤ºä¾‹ä»£ç </h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import &#123; createApp &#125; from <span class="string">'vue'</span></span><br><span class="line">import Counter from <span class="string">'./Counter.vue'</span></span><br><span class="line">import store from <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line">const app = createApp(Counter)</span><br><span class="line">console.log(<span class="string">'app is created'</span>)</span><br><span class="line">app.use(store)</span><br><span class="line">console.log(<span class="string">'store is used'</span>)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨app.useæ–¹æ³•çš„æ—¶å€™ç”¨è°ƒç”¨æ³¨å…¥pluginçš„installæ–¹æ³•<br>ï¼ˆå¦‚æœinstallæ–¹æ³•å­˜åœ¨çš„è¯ï¼‰ï¼Œçœ‹ä¸‹useæ–¹æ³•æ€ä¹ˆå†™çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use(plugin, ...options) &#123;</span><br><span class="line">         <span class="keyword">if</span> (installedPlugins.has(plugin)) &#123;</span><br><span class="line">             (process.env.NODE_ENV !== <span class="string">'production'</span>) &amp;&amp; warn(`Plugin has already been applied to target app.`);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (plugin &amp;&amp; isFunction(plugin.install)) &#123;</span><br><span class="line">             installedPlugins.add(plugin);</span><br><span class="line">             plugin.install(app, ...options);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(plugin)) &#123;</span><br><span class="line">             installedPlugins.add(plugin);</span><br><span class="line">             plugin(app, ...options);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((process.env.NODE_ENV !== <span class="string">'production'</span>)) &#123;</span><br><span class="line">             warn(`A plugin must either be a <span class="keyword">function</span> or an object with an <span class="string">"install"</span> ` +</span><br><span class="line">                 `<span class="keyword">function</span>.`);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="built_in">return</span> app;</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<p>ç„¶åçœ‹ä¸‹vuexä¸­çš„installæ–¹æ³•æ€ä¹ˆå†™çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">install (app, injectKey) &#123;</span><br><span class="line">    app.provide(injectKey || storeKey, this)</span><br><span class="line">    app.config.globalProperties.<span class="variable">$store</span> = this</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾å¾—çœ‹å‡ºæ˜¯æŠŠstoreæ”¾åˆ°provideä¸­å®è¡Œäº†ï¼Œå¹¶ä¸”å› ä¸ºåœ¨è°ƒç”¨çš„æ—¶å€™æ˜¯ç”¨çš„<code>plugin.install(app)</code>çš„æ–¹æ³•æ¥å†™çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™çš„thisæŒ‡å‘çš„æ˜¯storeå®ä¾‹ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠstoreå®ä¾‹æ³¨å…¥åˆ°appå®ä¾‹ä¸­äº† ï¼Œè¿™æ ·å†™çš„å¥½å¤„æˆ‘è§‰å¾—å°±æ˜¯æ•°æ®æ¥æºæ›´æ¸…æ™°äº†å§ã€‚</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
</search>
